function update_schematics(){for(var schematics=$(".schematic"),i=0;i<schematics.length;++i)if("true"!=schematics[i].getAttribute("loaded")){try{new schematic.Schematic(schematics[i])}catch(err){var msgdiv=document.createElement("div");msgdiv.style.border="thick solid #FF0000",msgdiv.style.margins="20px",msgdiv.style.padding="20px";var msg=document.createTextNode("Sorry, there a browser error in starting the schematic tool.  The tool is known to be compatible with the latest versions of Firefox and Chrome, which we recommend you use.");msgdiv.appendChild(msg),schematics[i].parentNode.insertBefore(msgdiv,schematics[i])}schematics[i].setAttribute("loaded","true")}}function add_schematic_handler(other_onload){return function(){other_onload&&other_onload(),update_schematics()}}function prepare_schematics(){for(var schematics=$(".schematic"),i=schematics.length-1;i>=0;i--)schematics[i].schematic.update_value()}(function(){var __indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};this.Problem=function(){function Problem(element){var _this=this;this.enableCheckButtonAfterTimeout=function(){return Problem.prototype.enableCheckButtonAfterTimeout.apply(_this,arguments)},this.enableCheckButtonAfterResponse=function(){return Problem.prototype.enableCheckButtonAfterResponse.apply(_this,arguments)},this.enableCheckButton=function(){return Problem.prototype.enableCheckButton.apply(_this,arguments)},this.refreshAnswers=function(){return Problem.prototype.refreshAnswers.apply(_this,arguments)},this.updateMathML=function(){return Problem.prototype.updateMathML.apply(_this,arguments)},this.refreshMath=function(){return Problem.prototype.refreshMath.apply(_this,arguments)},this.save_internal=function(){return Problem.prototype.save_internal.apply(_this,arguments)},this.save=function(){return Problem.prototype.save.apply(_this,arguments)},this.gentle_alert=function(){return Problem.prototype.gentle_alert.apply(_this,arguments)},this.show=function(){return Problem.prototype.show.apply(_this,arguments)},this.reset=function(){return Problem.prototype.reset.apply(_this,arguments)},this.check_internal=function(){return Problem.prototype.check_internal.apply(_this,arguments)},this.check=function(){return Problem.prototype.check.apply(_this,arguments)},this.check_fd=function(){return Problem.prototype.check_fd.apply(_this,arguments)},this.check_save_waitfor=function(){return Problem.prototype.check_save_waitfor.apply(_this,arguments)},this.setupInputTypes=function(){return Problem.prototype.setupInputTypes.apply(_this,arguments)},this.poll=function(){return Problem.prototype.poll.apply(_this,arguments)},this.get_queuelen=function(){return Problem.prototype.get_queuelen.apply(_this,arguments)},this.queueing=function(){return Problem.prototype.queueing.apply(_this,arguments)},this.forceUpdate=function(){return Problem.prototype.forceUpdate.apply(_this,arguments)},this.updateProgress=function(){return Problem.prototype.updateProgress.apply(_this,arguments)},this.renderProgressState=function(){return Problem.prototype.renderProgressState.apply(_this,arguments)},this.bind=function(){return Problem.prototype.bind.apply(_this,arguments)},this.el=$(element).find(".problems-wrapper"),this.id=this.el.data("problem-id"),this.element_id=this.el.attr("id"),this.url=this.el.data("url"),this.has_timed_out=!1,this.has_response=!1,this.render()}return Problem.prototype.$=function(selector){return $(selector,this.el)},Problem.prototype.bind=function(){var problem_prefix,_this=this;return"undefined"!=typeof MathJax&&null!==MathJax&&this.el.find(".problem > div").each(function(index,element){return MathJax.Hub.Queue(["Typeset",MathJax.Hub,element])}),window.update_schematics(),problem_prefix=this.element_id.replace(/problem_/,""),this.inputs=this.$("[id^=input_"+problem_prefix+"_]"),this.$("div.action input:button").click(this.refreshAnswers),this.checkButton=this.$("div.action input.check"),this.checkButtonCheckText=this.checkButton.val(),this.checkButtonCheckingText=this.checkButton.data("checking"),this.checkButton.click(this.check_fd),this.$("div.action input.reset").click(this.reset),this.$("div.action button.show").click(this.show),this.$("div.action input.save").click(this.save),this.bindResetCorrectness(),Collapsible.setCollapsibles(this.el),this.$("input.math").keyup(this.refreshMath),"undefined"!=typeof MathJax&&null!==MathJax?this.$("input.math").each(function(index,element){return MathJax.Hub.Queue([_this.refreshMath,null,element])}):void 0},Problem.prototype.renderProgressState=function(){var a,detail,earned,possible,progress,progress_template,status;return detail=this.el.data("progress_detail"),status=this.el.data("progress_status"),"none"!==status&&null!=detail&&detail.indexOf("/")>0&&(a=detail.split("/"),earned=parseFloat(a[0]),possible=parseFloat(a[1]),progress_template=ngettext("(%(earned)s/%(possible)s point)","(%(earned)s/%(possible)s points)",possible),progress=interpolate(progress_template,{earned:earned,possible:possible},!0)),"none"===status&&null!=detail&&detail.indexOf("/")>0&&(a=detail.split("/"),possible=parseFloat(a[1]),progress_template=ngettext("(%(num_points)s point possible)","(%(num_points)s points possible)",possible),progress=interpolate(progress_template,{num_points:possible},!0)),this.$(".problem-progress").html(progress)},Problem.prototype.updateProgress=function(response){return response.progress_changed&&(this.el.data("progress_status",response.progress_status),this.el.data("progress_detail",response.progress_detail),this.el.trigger("progressChanged")),this.renderProgressState()},Problem.prototype.forceUpdate=function(response){return this.el.data("progress_status",response.progress_status),this.el.data("progress_detail",response.progress_detail),this.el.trigger("progressChanged"),this.renderProgressState()},Problem.prototype.queueing=function(){var queuelen;return this.queued_items=this.$(".xqueue"),this.num_queued_items=this.queued_items.length,this.num_queued_items>0?(window.queuePollerID&&window.clearTimeout(window.queuePollerID),queuelen=this.get_queuelen(),window.queuePollerID=window.setTimeout(this.poll,10*queuelen)):void 0},Problem.prototype.get_queuelen=function(){var minlen;return minlen=1/0,this.queued_items.each(function(index,qitem){var len;return len=parseInt($.text(qitem)),minlen>len?minlen=len:void 0}),minlen},Problem.prototype.poll=function(){var _this=this;return $.postWithPrefix(""+this.url+"/problem_get",function(response){return _this.new_queued_items=$(response.html).find(".xqueue"),_this.new_queued_items.length!==_this.num_queued_items&&(_this.el.html(response.html),JavascriptLoader.executeModuleScripts(_this.el,function(){return _this.setupInputTypes(),_this.bind()})),_this.num_queued_items=_this.new_queued_items.length,0===_this.num_queued_items?(_this.forceUpdate(response),delete window.queuePollerID):window.queuePollerID=window.setTimeout(_this.poll,1e3)})},Problem.inputAjax=function(url,input_id,dispatch,data,callback){return data.dispatch=dispatch,data.input_id=input_id,$.postWithPrefix(""+url+"/input_ajax",data,callback)},Problem.prototype.render=function(content){var _this=this;return content?(this.el.attr({"aria-busy":"true","aria-live":"off","aria-atomic":"false"}),this.el.html(content),JavascriptLoader.executeModuleScripts(this.el,function(){return _this.setupInputTypes(),_this.bind(),_this.queueing()}),this.el.attr("aria-busy","false")):$.postWithPrefix(""+this.url+"/problem_get",function(response){return _this.el.html(response.html),JavascriptLoader.executeModuleScripts(_this.el,function(){return _this.setupInputTypes(),_this.bind(),_this.queueing(),_this.forceUpdate(response)})})},Problem.prototype.setupInputTypes=function(){var _this=this;return this.inputtypeDisplays={},this.el.find(".capa_inputtype").each(function(index,inputtype){var classes,cls,id,setupMethod,_i,_len,_results;for(classes=$(inputtype).attr("class").split(" "),id=$(inputtype).attr("id"),_results=[],_i=0,_len=classes.length;_len>_i;_i++)cls=classes[_i],setupMethod=_this.inputtypeSetupMethods[cls],_results.push(null!=setupMethod?_this.inputtypeDisplays[id]=setupMethod(inputtype):void 0);return _results})},Problem.prototype.check_save_waitfor=function(callback){var flag,inp,_i,_len,_ref,_this=this;for(flag=!1,_ref=this.inputs,_i=0,_len=_ref.length;_len>_i;_i++)if(inp=_ref[_i],$(inp).is("input[waitfor]")){try{$(inp).data("waitfor")(function(){return _this.refreshAnswers(),callback()})}catch(e){throw alert("Waitfor Exception"===e.name?e.message:"Could not grade your answer. The submission was aborted."),e}flag=!0}else flag=!1;return flag},Problem.prototype.check_fd=function(){var abort_submission,error,error_html,errors,fd,file_not_selected,file_too_large,max_filesize,required_files_not_submitted,settings,timeout_id,unallowed_file_submitted,_i,_len,_this=this;if(0===this.el.find("input:file").length)return void this.check();if(this.enableCheckButton(!1),!window.FormData)return alert("Submission aborted! Sorry, your browser does not support file uploads. If you can, please use Chrome or Safari which have been verified to support file uploads."),void this.enableCheckButton(!0);for(timeout_id=this.enableCheckButtonAfterTimeout(),fd=new FormData,max_filesize=4e6,file_too_large=!1,file_not_selected=!1,required_files_not_submitted=!1,unallowed_file_submitted=!1,errors=[],this.inputs.each(function(index,element){var allowed_files,file,max_size,required_files,_i,_len,_ref,_ref1,_ref2;if("file"!==element.type)return fd.append(element.id,element.value);for(required_files=$(element).data("required_files"),allowed_files=$(element).data("allowed_files"),_ref=element.files,_i=0,_len=_ref.length;_len>_i;_i++)file=_ref[_i],0!==allowed_files.length&&(_ref1=file.name,__indexOf.call(allowed_files,_ref1)<0)&&(unallowed_file_submitted=!0,errors.push("You submitted "+file.name+"; only "+allowed_files+" are allowed.")),_ref2=file.name,__indexOf.call(required_files,_ref2)>=0&&required_files.splice(required_files.indexOf(file.name),1),file.size>max_filesize&&(file_too_large=!0,max_size=max_filesize/1e6,errors.push("Your file "+file.name+" is too large (max size: {max_size}MB)")),fd.append(element.id,file);return 0===element.files.length&&(file_not_selected=!0,fd.append(element.id,"")),0!==required_files.length?(required_files_not_submitted=!0,errors.push("You did not submit the required files: "+required_files+".")):void 0}),file_not_selected&&errors.push("You did not select any files to submit"),error_html="<ul>\n",_i=0,_len=errors.length;_len>_i;_i++)error=errors[_i],error_html+="<li>"+error+"</li>\n";return error_html+="</ul>",this.gentle_alert(error_html),(abort_submission=file_too_large||file_not_selected||unallowed_file_submitted||required_files_not_submitted)?(window.clearTimeout(timeout_id),void this.enableCheckButton(!0)):(settings={type:"POST",data:fd,processData:!1,contentType:!1,complete:this.enableCheckButtonAfterResponse,success:function(response){switch(response.success){case"incorrect":case"correct":_this.render(response.contents),_this.updateProgress(response);break;default:_this.gentle_alert(response.success)}return Logger.log("problem_graded",[_this.answers,response.contents],_this.id)}},$.ajaxWithPrefix(""+this.url+"/problem_check",settings))},Problem.prototype.check=function(){return this.check_save_waitfor(this.check_internal)?void 0:this.check_internal()},Problem.prototype.check_internal=function(){var timeout_id,_this=this;return this.enableCheckButton(!1),timeout_id=this.enableCheckButtonAfterTimeout(),Logger.log("problem_check",this.answers),analytics.track("edx.bi.course.problem.checked",{category:"courseware",problem_id:this.id,answers:this.answers}),$.postWithPrefix(""+this.url+"/problem_check",this.answers,function(response){switch(response.success){case"incorrect":case"correct":window.SR.readElts($(response.contents).find(".status")),_this.render(response.contents),_this.updateProgress(response),_this.el.hasClass("showed")&&_this.el.removeClass("showed"),_this.$("div.action input.check").focus();break;default:_this.gentle_alert(response.success)}return Logger.log("problem_graded",[_this.answers,response.contents],_this.id)}).always(this.enableCheckButtonAfterResponse)},Problem.prototype.reset=function(){var _this=this;return Logger.log("problem_reset",this.answers),$.postWithPrefix(""+this.url+"/problem_reset",{id:this.id},function(response){return _this.render(response.html),_this.updateProgress(response)})},Problem.prototype.show=function(){var answer_text,_this=this;return this.el.hasClass("showed")?(this.$("[id^=answer_], [id^=solution_]").text(""),this.$("[correct_answer]").attr({correct_answer:null}),this.el.removeClass("showed"),this.$(".show-label").text(gettext("Show Answer")),this.$(".show-label .sr").text(gettext("Reveal Answer")),window.SR.readText(gettext("Answer hidden")),this.el.find(".capa_inputtype").each(function(index,inputtype){var classes,cls,display,hideMethod,_i,_len,_results;for(display=_this.inputtypeDisplays[$(inputtype).attr("id")],classes=$(inputtype).attr("class").split(" "),_results=[],_i=0,_len=classes.length;_len>_i;_i++)cls=classes[_i],hideMethod=_this.inputtypeHideAnswerMethods[cls],_results.push(null!=hideMethod?hideMethod(inputtype,display):void 0);return _results})):(Logger.log("problem_show",{problem:this.id}),answer_text=[],$.postWithPrefix(""+this.url+"/problem_show",function(response){var answers;return answers=response.answers,$.each(answers,function(key,value){var answer,choice,solution,_i,_len,_results;if($.isArray(value)){for(_results=[],_i=0,_len=value.length;_len>_i;_i++)choice=value[_i],_this.$("label[for='input_"+key+"_"+choice+"']").attr({correct_answer:"true"}),_results.push(answer_text.push("<p>"+gettext("Answer:")+" "+value+"</p>"));return _results}answer=_this.$("#answer_"+key+", #solution_"+key),answer.html(value),Collapsible.setCollapsibles(answer);try{solution=$(value).find(".detailed-solution")}catch(e){solution={}}return answer_text.push(solution.length?solution:"<p>"+gettext("Answer:")+" "+value+"</p>")}),_this.el.find(".capa_inputtype").each(function(index,inputtype){var classes,cls,display,showMethod,_i,_len,_results;for(classes=$(inputtype).attr("class").split(" "),_results=[],_i=0,_len=classes.length;_len>_i;_i++)cls=classes[_i],display=_this.inputtypeDisplays[$(inputtype).attr("id")],showMethod=_this.inputtypeShowAnswerMethods[cls],_results.push(null!=showMethod?showMethod(inputtype,display,answers):void 0);return _results}),"undefined"!=typeof MathJax&&null!==MathJax&&_this.el.find(".problem > div").each(function(index,element){return MathJax.Hub.Queue(["Typeset",MathJax.Hub,element])}),_this.$(".show-label").text(gettext("Hide Answer")),_this.$(".show-label .sr").text(gettext("Hide Answer")),_this.el.addClass("showed"),_this.updateProgress(response),window.SR.readElts(answer_text)}))},Problem.prototype.gentle_alert=function(msg){var alert_elem;return this.el.find(".capa_alert").length&&this.el.find(".capa_alert").remove(),alert_elem="<div class='capa_alert'>"+msg+"</div>",this.el.find(".action").after(alert_elem),this.el.find(".capa_alert").css({opacity:0}).animate({opacity:1},700),window.SR.readElts(this.el.find(".capa_alert"))},Problem.prototype.save=function(){return this.check_save_waitfor(this.save_internal)?void 0:this.save_internal()},Problem.prototype.save_internal=function(){var _this=this;return Logger.log("problem_save",this.answers),$.postWithPrefix(""+this.url+"/problem_save",this.answers,function(response){var saveMessage;return saveMessage=response.msg,_this.gentle_alert(saveMessage),_this.updateProgress(response)})},Problem.prototype.refreshMath=function(event,element){var elid,eqn,jax,mathjax_preprocessor,preprocessor_tag,target;element||(element=event.target),elid=element.id.replace(/^input_/,""),target="display_"+elid,preprocessor_tag="inputtype_"+elid,mathjax_preprocessor=this.inputtypeDisplays[preprocessor_tag],"undefined"!=typeof MathJax&&null!==MathJax&&(jax=MathJax.Hub.getAllJax(target)[0])&&(eqn=$(element).val(),mathjax_preprocessor&&(eqn=mathjax_preprocessor(eqn)),MathJax.Hub.Queue(["Text",jax,eqn],[this.updateMathML,jax,element]))},Problem.prototype.updateMathML=function(jax,element){try{return $("#"+element.id+"_dynamath").val(jax.root.toMathML(""))}catch(exception){if(!exception.restart)throw exception;if("undefined"!=typeof MathJax&&null!==MathJax)return MathJax.Callback.After([this.refreshMath,jax],exception.restart)}},Problem.prototype.refreshAnswers=function(){return this.$("input.schematic").each(function(index,element){return element.schematic.update_value()}),this.$(".CodeMirror").each(function(index,element){return element.CodeMirror.save?element.CodeMirror.save():void 0}),this.answers=this.inputs.serialize()},Problem.prototype.bindResetCorrectness=function(){var $inputtypes,_this=this;return $inputtypes=this.el.find(".capa_inputtype").add(this.el.find(".inputtype")),$inputtypes.each(function(index,inputtype){var bindMethod,classes,cls,_i,_len,_results;for(classes=$(inputtype).attr("class").split(" "),_results=[],_i=0,_len=classes.length;_len>_i;_i++)cls=classes[_i],bindMethod=_this.bindResetCorrectnessByInputtype[cls],_results.push(null!=bindMethod?bindMethod(inputtype):void 0);return _results})},Problem.prototype.bindResetCorrectnessByInputtype={formulaequationinput:function(element){return $(element).find("input").on("input",function(){var $p;return $p=$(element).find("p.status"),$p.text(gettext("unanswered")),$p.parent().removeClass().addClass("unanswered")})},choicegroup:function(element){var $element,id;return $element=$(element),id=$element.attr("id").match(/^inputtype_(.*)$/)[1],$element.find("input").on("change",function(){var $status;return $status=$("#status_"+id),$status[0]?($status.removeClass().addClass("unanswered"),$status.empty().css("display","inline-block")):$("<span>",{"class":"unanswered",style:"display: inline-block;",id:"status_"+id}),$element.find("label").removeClass()})},"option-input":function(element){var $select,id;return $select=$(element).find("select"),id=$select.attr("id").match(/^input_(.*)$/)[1],$select.on("change",function(){var $status;return $status=$("#status_"+id).removeClass().addClass("unanswered").find("span").text(gettext("Status: unsubmitted"))})},textline:function(element){return $(element).find("input").on("input",function(){var $p;return $p=$(element).find("p.status"),$p.text(gettext("unanswered")),$p.parent().removeClass("correct incorrect").addClass("unanswered")})}},Problem.prototype.inputtypeSetupMethods={"text-input-dynamath":function(element){var data,preprocessor,preprocessorClass,preprocessorClassName;return data=$(element).find(".text-input-dynamath_data"),preprocessorClassName=data.data("preprocessor"),preprocessorClass=window[preprocessorClassName],null==preprocessorClass?!1:(preprocessor=new preprocessorClass,preprocessor.fn)},javascriptinput:function(element){var container,data,display,displayClass,evaluation,params,problemState,submission,submissionField;return data=$(element).find(".javascriptinput_data"),params=data.data("params"),submission=data.data("submission"),evaluation=data.data("evaluation"),problemState=data.data("problem_state"),displayClass=window[data.data("display_class")],""===evaluation&&(evaluation=null),container=$(element).find(".javascriptinput_container"),submissionField=$(element).find(".javascriptinput_input"),display=new displayClass(problemState,submission,evaluation,container,submissionField,params),display.render(),display},cminput:function(container){var element,linenumbers,mode,spaces,tabsize;return element=$(container).find("textarea"),tabsize=element.data("tabsize"),mode=element.data("mode"),linenumbers=element.data("linenums"),spaces=Array(parseInt(tabsize)+1).join(" "),CodeMirror.fromTextArea(element[0],{lineNumbers:linenumbers,indentUnit:tabsize,tabSize:tabsize,mode:mode,matchBrackets:!0,lineWrapping:!0,indentWithTabs:!1,smartIndent:!1,extraKeys:{Esc:function(){return $(".grader-status").focus(),!1},Tab:function(cm){return cm.replaceSelection(spaces,"end"),!1}}})}},Problem.prototype.inputtypeShowAnswerMethods={choicegroup:function(element,display,answers){var answer,choice,input_id,_i,_len,_results;for(element=$(element),input_id=element.attr("id").replace(/inputtype_/,""),answer=answers[input_id],_results=[],_i=0,_len=answer.length;_len>_i;_i++)choice=answer[_i],_results.push(element.find("label[for='input_"+input_id+"_"+choice+"']").addClass("choicegroup_correct"));return _results},javascriptinput:function(element,display,answers){var answer,answer_id;return answer_id=$(element).attr("id").split("_").slice(1).join("_"),answer=JSON.parse(answers[answer_id]),display.showAnswer(answer)},choicetextgroup:function(element,display,answers){var answer,choice,input_id,_i,_len,_results;for(element=$(element),input_id=element.attr("id").replace(/inputtype_/,""),answer=answers[input_id],_results=[],_i=0,_len=answer.length;_len>_i;_i++)choice=answer[_i],_results.push(element.find("section#forinput"+choice).addClass("choicetextgroup_show_correct"));return _results},imageinput:function(element,display,answers){var canvas,container,ctx,id,types;return types={rectangle:function(ctx,coords){var rects,reg;return reg=/^\(([0-9]+),([0-9]+)\)-\(([0-9]+),([0-9]+)\)$/,rects=coords.replace(/\s*/g,"").split(/;/),$.each(rects,function(index,rect){var abs,height,points,width;return abs=Math.abs,points=reg.exec(rect),points?(width=abs(points[3]-points[1]),height=abs(points[4]-points[2]),ctx.rect(points[1],points[2],width,height)):void 0}),ctx.stroke(),ctx.fill()},regions:function(ctx,coords){var parseCoords;return parseCoords=function(coords){var reg;return reg=JSON.parse(coords),"undefined"==typeof reg[0][0][0]&&(reg=[reg]),reg},$.each(parseCoords(coords),function(index,region){return ctx.beginPath(),$.each(region,function(index,point){return 0===index?ctx.moveTo(point[0],point[1]):ctx.lineTo(point[0],point[1])}),ctx.closePath(),ctx.stroke(),ctx.fill()})}},element=$(element),id=element.attr("id").replace(/inputtype_/,""),container=element.find("#answer_"+id),canvas=document.createElement("canvas"),canvas.width=container.data("width"),canvas.height=container.data("height"),canvas.getContext?(ctx=canvas.getContext("2d"),ctx.fillStyle="rgba(255,255,255,.3)",ctx.strokeStyle="#FF0000",ctx.lineWidth="2",answers[id]?($.each(answers[id],function(key,value){return null!=types[key]&&value?types[key](ctx,value):void 0}),container.html(canvas)):console.log("Answer is absent for image input with id="+id)):console.log("Canvas is not supported.")}},Problem.prototype.inputtypeHideAnswerMethods={choicegroup:function(element){return element=$(element),element.find("label").removeClass("choicegroup_correct")},javascriptinput:function(element,display){return display.hideAnswer()},choicetextgroup:function(element){return element=$(element),element.find("section[id^='forinput']").removeClass("choicetextgroup_show_correct")}},Problem.prototype.enableCheckButton=function(enable){return enable?(this.checkButton.removeClass("is-disabled"),this.checkButton.val(this.checkButtonCheckText)):(this.checkButton.addClass("is-disabled"),this.checkButton.val(this.checkButtonCheckingText))},Problem.prototype.enableCheckButtonAfterResponse=function(){return this.has_response=!0,this.enableCheckButton(this.has_timed_out?!0:!1)},Problem.prototype.enableCheckButtonAfterTimeout=function(){var enableCheckButton,_this=this;return this.has_timed_out=!1,this.has_response=!1,enableCheckButton=function(){return _this.has_timed_out=!0,_this.has_response?_this.enableCheckButton(!0):void 0},window.setTimeout(enableCheckButton,750)},Problem}.call(this)}).call(this),function(){"use strict";var XModule={};XModule.Descriptor=function(){var Descriptor=function(element){this.element=element,this.update=_.bind(this.update,this)};return Descriptor.prototype.onUpdate=function(callback){this.callbacks||(this.callbacks=[]),this.callbacks.push(callback)},Descriptor.prototype.update=function(){var data,callbacks,length;data=this.save(),callbacks=this.callbacks,length=callbacks.length,$.each(callbacks,function(index,callback){callback(data)})},Descriptor.prototype.save=function(){return{}},Descriptor}(),this.XBlockToXModuleShim=function(runtime,element){var module,moduleType=$(element).data("type");if("None"!==moduleType)try{return module=new window[moduleType](element),$(element).hasClass("xmodule_edit")&&$(document).trigger("XModule.loaded.edit",[element,module]),$(element).hasClass("xmodule_display")&&$(document).trigger("XModule.loaded.display",[element,module]),module}catch(error){console.error("Unable to load "+moduleType+": "+error.message)}},this.XModule=XModule}.call(this),function(){this.PeerGrading=function(){function PeerGrading(element){var _this=this;this.activate_problem=function(){return PeerGrading.prototype.activate_problem.apply(_this,arguments)},this.show_results=function(){return PeerGrading.prototype.show_results.apply(_this,arguments)},this.construct_progress_bar=function(){return PeerGrading.prototype.construct_progress_bar.apply(_this,arguments)},this.el=element,this.peer_grading_container=this.$(this.peer_grading_sel),this.use_single_location=this.peer_grading_container.data("use-single-location"),this.peer_grading_outer_container=this.$(this.peer_grading_container_sel),this.ajax_url=this.peer_grading_container.data("ajax-url"),"true"===this.use_single_location.toLowerCase()?this.activate_problem():(this.error_container=this.$(this.error_container_sel),this.error_container.toggle(!this.error_container.is(":empty")),this.message_container=this.$(this.message_container_sel),this.message_container.toggle(!this.message_container.is(":empty")),this.problem_button=this.$(this.problem_button_sel),this.problem_button.click(this.show_results),this.problem_list=this.$(this.problem_list_sel),this.construct_progress_bar())}return PeerGrading.prototype.peer_grading_sel=".peer-grading",PeerGrading.prototype.peer_grading_container_sel=".peer-grading-container",PeerGrading.prototype.error_container_sel=".error-container",PeerGrading.prototype.message_container_sel=".message-container",PeerGrading.prototype.problem_button_sel=".problem-button",PeerGrading.prototype.problem_list_sel=".problem-list",PeerGrading.prototype.progress_bar_sel=".progress-bar",PeerGrading.prototype.$=function(selector){return $(selector,this.el)},PeerGrading.prototype.construct_progress_bar=function(){var problems,_this=this;return problems=this.problem_list.find("tr").next(),problems.each(function(index,element){var bar_max,bar_value,problem,progress_bar;return problem=$(element),progress_bar=problem.find(_this.progress_bar_sel),bar_value=parseInt(problem.data("graded")),bar_max=parseInt(problem.data("required"))+bar_value,progress_bar.progressbar({value:bar_value,max:bar_max})})},PeerGrading.prototype.show_results=function(event){var data,location_to_fetch,_this=this;return location_to_fetch=$(event.target).data("location"),data={location:location_to_fetch},$.postWithPrefix(""+this.ajax_url+"problem",data,function(response){var backend;return response.success?(_this.peer_grading_outer_container.after(response.html).remove(),backend=new PeerGradingProblemBackend(_this.ajax_url,!1),new PeerGradingProblem(backend,_this.el)):_this.gentle_alert(response.error)})},PeerGrading.prototype.activate_problem=function(){var backend;return backend=new PeerGradingProblemBackend(this.ajax_url,!1),new PeerGradingProblem(backend,this.el)},PeerGrading}()}.call(this),function(){this.Hinter=function(){function Hinter(element){var _this=this;this.set_bottom_links=function(){return Hinter.prototype.set_bottom_links.apply(_this,arguments)},this.answer_choice_handle=function(){return Hinter.prototype.answer_choice_handle.apply(_this,arguments)},this.wizard_link_handle=function(){return Hinter.prototype.wizard_link_handle.apply(_this,arguments)},this.clear_default_text=function(){return Hinter.prototype.clear_default_text.apply(_this,arguments)},this.submit_hint=function(){return Hinter.prototype.submit_hint.apply(_this,arguments)},this.vote=function(){return Hinter.prototype.vote.apply(_this,arguments)},this.expand=function(){return Hinter.prototype.expand.apply(_this,arguments)},this.bind=function(){return Hinter.prototype.bind.apply(_this,arguments)},this.capture_problem=function(){return Hinter.prototype.capture_problem.apply(_this,arguments)},this.el=$(element).find(".crowdsource-wrapper"),this.url=this.el.data("url"),Logger.listen("problem_graded",this.el.data("child-id"),this.capture_problem),this.render()}return Hinter.prototype.capture_problem=function(event_type,data){var answers,response,_this=this;return answers=data[0],response=data[1],-1===response.search(/class="correct/)?$.postWithPrefix(""+this.url+"/get_hint",answers,function(response){return _this.render(response.contents)}):$.postWithPrefix(""+this.url+"/get_feedback",answers,function(response){return _this.render(response.contents)})},Hinter.prototype.$=function(selector){return $(selector,this.el)},Hinter.prototype.bind=function(){return this.$("input.vote").click(this.vote),this.$("input.submit-hint").click(this.submit_hint),this.$(".custom-hint").click(this.clear_default_text),this.$(".expand").click(this.expand),this.$(".wizard-link").click(this.wizard_link_handle),this.$(".answer-choice").click(this.answer_choice_handle)},Hinter.prototype.expand=function(eventObj){var target;return target=this.$("#"+this.$(eventObj.currentTarget).data("target")),"none"===this.$(target).css("display")?this.$(target).css("display","block"):this.$(target).css("display","none"),this.set_bottom_links()},Hinter.prototype.vote=function(eventObj){var all_pks,post_json,target,_this=this;return target=this.$(eventObj.currentTarget),all_pks=this.$("#pk-list").attr("data-pk-list"),post_json={answer:target.attr("data-answer"),hint:target.data("hintno"),pk_list:all_pks},$.postWithPrefix(""+this.url+"/vote",post_json,function(response){return _this.render(response.contents)})},Hinter.prototype.submit_hint=function(){var post_json,textarea,_this=this;return textarea=$(".custom-hint"),""!==this.answer?(post_json={answer:this.answer,hint:textarea.val()},$.postWithPrefix(""+this.url+"/submit_hint",post_json,function(response){return _this.render(response.contents)})):void 0},Hinter.prototype.clear_default_text=function(eventObj){var target;return target=this.$(eventObj.currentTarget),void 0===target.data("cleared")?(target.val(""),target.data("cleared",!0)):void 0},Hinter.prototype.wizard_link_handle=function(eventObj){var target;return target=this.$(eventObj.currentTarget),this.go_to(target.attr("dest"))},Hinter.prototype.answer_choice_handle=function(eventObj){return this.answer=this.$(eventObj.target).attr("value"),this.$("#blank-answer").html(this.answer),this.go_to("p3")},Hinter.prototype.set_bottom_links=function(){var viewbox_height;return this.$(".bottom").css("margin-top","0px"),viewbox_height=parseInt(this.$(".wizard-viewbox").css("height"),10),this.$(".bottom").each(function(index,obj){var view_height;return view_height=parseInt($(obj).parent().css("height"),10),$(obj).css("margin-top",viewbox_height-view_height+"px")})},Hinter.prototype.render=function(content){var hints_exist,styles,_this=this;return content&&(content=content.trim()),content?(this.el.html(content),this.el.show(),JavascriptLoader.executeModuleScripts(this.el,function(){return _this.bind()}),this.$("#previous-answer-0").css("display","inline")):this.el.hide(),this.answer="",styles=document.body.style,this.go_to=""===styles.WebkitTransform||""===styles.transform?this.transform_go_to:this.legacy_go_to,hints_exist="True"===this.$("#hints-exist").html(),this.go_to(hints_exist?"p1":"p2")},Hinter.prototype.transform_go_to=function(view_id){var id_to_index,translate_string;return id_to_index={p1:0,p2:1,p3:2},translate_string="translateX("+-1*id_to_index[view_id]*parseInt($("#"+view_id).css("width"),10)+"px)",this.$(".wizard-container").css("transform",translate_string),this.$(".wizard-container").css("-webkit-transform",translate_string),this.set_bottom_links()
},Hinter.prototype.legacy_go_to=function(view_id){return this.$(".wizard-view").css("display","none"),this.$("#"+view_id).css("display","block"),this.set_bottom_links()},Hinter}()}.call(this),function(){this.JavascriptLoader=function(){function JavascriptLoader(){}return JavascriptLoader.executeModuleScripts=function(el,callback){var callbackCalled,completed,completionHandlerGenerator,completionHandlerGeneratorIE,i,loaded,placeholders;return null==callback&&(callback=null),placeholders=el.find(".script_placeholder"),0===placeholders.length?void(null!=callback&&callback()):(completed=function(){var _i,_ref,_results;for(_results=[],i=_i=1,_ref=placeholders.length;_ref>=1?_ref>=_i:_i>=_ref;i=_ref>=1?++_i:--_i)_results.push(!1);return _results}(),callbackCalled=!1,completionHandlerGeneratorIE=function(index){return function(){return"complete"===this.readyState||"loaded"===this.readyState?completionHandlerGenerator(index)():void 0}},completionHandlerGenerator=function(index){return function(){var allComplete,flag,_i,_len;for(allComplete=!0,completed[index]=!0,_i=0,_len=completed.length;_len>_i;_i++)if(flag=completed[_i],!flag){allComplete=!1;break}return allComplete&&!callbackCalled&&(callbackCalled=!0,null!=callback)?callback():void 0}},loaded={},placeholders.each(function(index,placeholder){var s,src;return src=$(placeholder).attr("data-src"),src in loaded?completionHandlerGenerator(index)():(loaded[src]=!0,s=document.createElement("script"),s.setAttribute("src",src),s.setAttribute("type","text/javascript"),s.onload=completionHandlerGenerator(index),s.onreadystatechange=completionHandlerGeneratorIE(index),$("head")[0].appendChild(s)),$(placeholder).remove()}))},JavascriptLoader}()}.call(this),function(){var _this=this;this.Sequence=function(){function Sequence(element){var _this=this;this._change_sequential=function(){return Sequence.prototype._change_sequential.apply(_this,arguments)},this.previous=function(){return Sequence.prototype.previous.apply(_this,arguments)},this.next=function(){return Sequence.prototype.next.apply(_this,arguments)},this.goto=function(){return Sequence.prototype.goto.apply(_this,arguments)},this.toggleArrows=function(){return Sequence.prototype.toggleArrows.apply(_this,arguments)},this.updateProgress=function(){return Sequence.prototype.updateProgress.apply(_this,arguments)},this.requestToken=$(element).data("request-token"),this.el=$(element).find(".sequence"),this.contents=this.$(".seq_contents"),this.content_container=this.$("#seq_content"),this.num_contents=this.contents.length,this.id=this.el.data("id"),this.ajaxUrl=this.el.data("ajax-url"),this.base_page_title=" | "+document.title,this.initProgress(),this.bind(),this.render(parseInt(this.el.data("position")))}return Sequence.prototype.$=function(selector){return $(selector,this.el)},Sequence.prototype.bind=function(){return this.$("#sequence-list a").click(this.goto)},Sequence.prototype.initProgress=function(){return this.progressTable={}},Sequence.prototype.updatePageTitle=function(){var position_link;return position_link=this.link_for(this.position),position_link&&position_link.data("page-title")?document.title=position_link.data("page-title")+this.base_page_title:void 0},Sequence.prototype.hookUpProgressEvent=function(){return $(".problems-wrapper").bind("progressChanged",this.updateProgress)},Sequence.prototype.mergeProgress=function(p1,p2){var w1,w2;return"NA"===p1?p2:"NA"===p2?p1:"done"===p1&&"done"===p2?"done":(w1="done"===p1||"in_progress"===p1,w2="done"===p2||"in_progress"===p2,w1||w2?"in_progress":"none")},Sequence.prototype.updateProgress=function(){var new_progress;return new_progress="NA",_this=this,$(".problems-wrapper").each(function(){var progress;return progress=$(this).data("progress_status"),new_progress=_this.mergeProgress(progress,new_progress)}),this.progressTable[this.position]=new_progress,this.setProgress(new_progress,this.link_for(this.position))},Sequence.prototype.setProgress=function(progress,element){switch(element.removeClass("progress-none").removeClass("progress-some").removeClass("progress-done"),progress){case"none":return element.addClass("progress-none");case"in_progress":return element.addClass("progress-some");case"done":return element.addClass("progress-done")}},Sequence.prototype.toggleArrows=function(){return this.$(".sequence-nav-buttons a").unbind("click"),0===this.contents.length?(this.$(".sequence-nav-buttons .prev a").addClass("disabled").attr("aria-hidden","true"),void this.$(".sequence-nav-buttons .next a").addClass("disabled").attr("aria-hidden","true")):(1===this.position?this.$(".sequence-nav-buttons .prev a").addClass("disabled").attr("aria-hidden","true"):this.$(".sequence-nav-buttons .prev a").removeClass("disabled").attr("aria-hidden","false").click(this.previous),this.position===this.contents.length?this.$(".sequence-nav-buttons .next a").addClass("disabled").attr("aria-hidden","true"):this.$(".sequence-nav-buttons .next a").removeClass("disabled").attr("aria-hidden","false").click(this.next))},Sequence.prototype.render=function(new_position){var current_tab,modx_full_url,sequence_links;return this.position!==new_position&&(void 0!==this.position&&(this.mark_visited(this.position),modx_full_url=""+this.ajaxUrl+"/goto_position",$.postWithPrefix(modx_full_url,{position:new_position})),this.el.trigger("sequence:change"),this.mark_active(new_position),current_tab=this.contents.eq(new_position-1),this.content_container.html(current_tab.text()).attr("aria-labelledby",current_tab.attr("aria-labelledby")),XBlock.initializeBlocks(this.content_container,this.requestToken),window.update_schematics(),this.position=new_position,this.toggleArrows(),this.hookUpProgressEvent(),this.updatePageTitle(),sequence_links=this.content_container.find("a.seqnav"),sequence_links.click(this.goto)),this.$("a.active").blur()},Sequence.prototype.goto=function(event){var alert_template,alert_text,new_position;return event.preventDefault(),new_position=$(event.target).hasClass("seqnav")?$(event.target).attr("href"):$(event.target).data("element"),new_position>=1&&new_position<=this.num_contents?(Logger.log("seq_goto",{old:this.position,"new":new_position,id:this.id}),analytics.pageview(this.id),analytics.track("edx.bi.course.sequential.direct.clicked",{category:"courseware",sequence_id:this.id,current_sequential:this.position,target_sequential:new_position}),window.queuePollerID&&(window.clearTimeout(window.queuePollerID),delete window.queuePollerID),this.render(new_position)):(alert_template=gettext("Sequence error! Cannot navigate to tab %(tab_name)s in the current SequenceModule. Please contact the course staff."),alert_text=interpolate(alert_template,{tab_name:new_position},!0),alert(alert_text))},Sequence.prototype.next=function(event){return this._change_sequential("seq_next",event)},Sequence.prototype.previous=function(event){return this._change_sequential("seq_prev",event)},Sequence.prototype._change_sequential=function(direction,event){var new_position,offset,tracking_messages;if("seq_prev"===direction||"seq_next"===direction)return event.preventDefault(),offset={seq_next:1,seq_prev:-1},new_position=this.position+offset[direction],Logger.log(direction,{old:this.position,"new":new_position,id:this.id}),analytics.pageview(this.id),tracking_messages={seq_prev:"edx.bi.course.sequential.previous.clicked",seq_next:"edx.bi.course.sequential.next.clicked"},analytics.track(tracking_messages[direction],{category:"courseware",sequence_id:this.id,current_sequential:this.position,target_sequential:new_position}),$(event.target).closest('nav[class="sequence-bottom"]').length>0&&$.scrollTo(0,150),this.render(new_position)},Sequence.prototype.link_for=function(position){return this.$("#sequence-list a[data-element="+position+"]")},Sequence.prototype.mark_visited=function(position){var element;return element=this.link_for(position),element.removeClass("inactive").removeClass("active").addClass("visited")},Sequence.prototype.mark_active=function(position){var element;return this.$('#sequence-list [role="tab"]').attr({"aria-selected":null}),element=this.link_for(position),element.removeClass("inactive").removeClass("visited").addClass("active").attr({"aria-selected":"true",tabindex:"0"})},Sequence}()}.call(this),function(){this.Rubric=function(){function Rubric(el){var _this=this;this.check_complete=function(){return Rubric.prototype.check_complete.apply(_this,arguments)},this.get_total_score=function(){return Rubric.prototype.get_total_score.apply(_this,arguments)},this.get_score_list=function(){return Rubric.prototype.get_score_list.apply(_this,arguments)},this.tracking_callback=function(){return Rubric.prototype.tracking_callback.apply(_this,arguments)},this.keypress_callback=function(){return Rubric.prototype.keypress_callback.apply(_this,arguments)},this.initialize=function(){return Rubric.prototype.initialize.apply(_this,arguments)},this.el=el}return Rubric.prototype.rubric_category_sel=".rubric-category",Rubric.prototype.rubric_sel=".rubric",Rubric.prototype.initialize=function(location){return this.$(this.rubric_sel).data("location",location),this.$('input[class="score-selection"]').change(this.tracking_callback),$(window).unbind("keydown",this.keypress_callback),$(window).keydown(this.keypress_callback),this.categories=this.$(this.rubric_category_sel),this.category=this.$(this.categories.first()),this.category_index=0},Rubric.prototype.$=function(selector){return $(selector,this.el)},Rubric.prototype.keypress_callback=function(event){var inputs,max_score,selected;if(!this.$(event.target).is("input, textarea")){if(event.which>=48&&event.which<=57)selected=event.which-48;else{if(!(event.which>=96&&event.which<=105))return;selected=event.which-96}if(this.category_index<=this.categories.length){if(inputs=this.$("input[name='score-selection-"+this.category_index+"']"),max_score=inputs.length-1,selected>max_score||0>selected)return;return inputs.filter("input[value="+selected+"]").click(),this.category_index++,this.category=this.$(this.categories[this.category_index])}}},Rubric.prototype.tracking_callback=function(event){var category,data,location,target_selection;return target_selection=this.$(event.target).val(),category=this.$(event.target).data("category"),location=this.$(this.rubric_sel).data("location"),data={location:location,selection:target_selection,category:category},Logger.log("rubric_select",data)},Rubric.prototype.get_score_list=function(){var i,num_categories,score,score_lst,_i,_ref;for(num_categories=this.$(this.rubric_category_sel).length,score_lst=[],i=_i=0,_ref=num_categories-1;_ref>=0?_ref>=_i:_i>=_ref;i=_ref>=0?++_i:--_i)score=this.$("input[name='score-selection-"+i+"']:checked").val(),score_lst.push(score);return score_lst},Rubric.prototype.get_total_score=function(){var score,score_lst,tot,_i,_len;for(score_lst=this.get_score_list(),tot=0,_i=0,_len=score_lst.length;_len>_i;_i++)score=score_lst[_i],tot+=parseInt(score);return tot},Rubric.prototype.check_complete=function(){var i,num_categories,score,_i,_ref;for(num_categories=this.$(this.rubric_category_sel).length,i=_i=0,_ref=num_categories-1;_ref>=0?_ref>=_i:_i>=_ref;i=_ref>=0?++_i:--_i)if(score=this.$("input[name='score-selection-"+i+"']:checked").val(),void 0===score)return!1;return!0},Rubric}(),this.CombinedOpenEnded=function(){function CombinedOpenEnded(el){var _this=this;this.graded_callback=function(){return CombinedOpenEnded.prototype.graded_callback.apply(_this,arguments)},this.setup_score_selection=function(){return CombinedOpenEnded.prototype.setup_score_selection.apply(_this,arguments)},this.toggle_rubric=function(){return CombinedOpenEnded.prototype.toggle_rubric.apply(_this,arguments)},this.preview_image=function(){return CombinedOpenEnded.prototype.preview_image.apply(_this,arguments)},this.remove_attribute=function(){return CombinedOpenEnded.prototype.remove_attribute.apply(_this,arguments)},this.prompt_hide=function(){return CombinedOpenEnded.prototype.prompt_hide.apply(_this,arguments)},this.prompt_show=function(){return CombinedOpenEnded.prototype.prompt_show.apply(_this,arguments)},this.shift_rubric=function(){return CombinedOpenEnded.prototype.shift_rubric.apply(_this,arguments)},this.previous_rubric=function(){return CombinedOpenEnded.prototype.previous_rubric.apply(_this,arguments)},this.next_rubric=function(){return CombinedOpenEnded.prototype.next_rubric.apply(_this,arguments)},this.hide_rubrics=function(){return CombinedOpenEnded.prototype.hide_rubrics.apply(_this,arguments)},this.collapse_question=function(){return CombinedOpenEnded.prototype.collapse_question.apply(_this,arguments)},this.replace_text_inputs=function(){return CombinedOpenEnded.prototype.replace_text_inputs.apply(_this,arguments)},this.hide_file_upload=function(){return CombinedOpenEnded.prototype.hide_file_upload.apply(_this,arguments)},this.setup_file_upload=function(){return CombinedOpenEnded.prototype.setup_file_upload.apply(_this,arguments)},this.poll=function(){return CombinedOpenEnded.prototype.poll.apply(_this,arguments)},this.queueing=function(){return CombinedOpenEnded.prototype.queueing.apply(_this,arguments)},this.gentle_alert=function(){return CombinedOpenEnded.prototype.gentle_alert.apply(_this,arguments)},this.next_problem=function(){return CombinedOpenEnded.prototype.next_problem.apply(_this,arguments)},this.reset=function(){return CombinedOpenEnded.prototype.reset.apply(_this,arguments)},this.confirm_reset=function(){return CombinedOpenEnded.prototype.confirm_reset.apply(_this,arguments)},this.skip_post_assessment=function(){return CombinedOpenEnded.prototype.skip_post_assessment.apply(_this,arguments)},this.save_hint=function(){return CombinedOpenEnded.prototype.save_hint.apply(_this,arguments)},this.save_assessment=function(){return CombinedOpenEnded.prototype.save_assessment.apply(_this,arguments)},this.keyup_handler=function(){return CombinedOpenEnded.prototype.keyup_handler.apply(_this,arguments)},this.keydown_handler=function(){return CombinedOpenEnded.prototype.keydown_handler.apply(_this,arguments)},this.save_answer=function(){return CombinedOpenEnded.prototype.save_answer.apply(_this,arguments)},this.confirm_save_answer=function(){return CombinedOpenEnded.prototype.confirm_save_answer.apply(_this,arguments)},this.replace_answer=function(){return CombinedOpenEnded.prototype.replace_answer.apply(_this,arguments)},this.store_answer=function(){return CombinedOpenEnded.prototype.store_answer.apply(_this,arguments)},this.rebind=function(){return CombinedOpenEnded.prototype.rebind.apply(_this,arguments)},this.message_post=function(){return CombinedOpenEnded.prototype.message_post.apply(_this,arguments)},this.show_combined_rubric_current=function(){return CombinedOpenEnded.prototype.show_combined_rubric_current.apply(_this,arguments)},this.get_html=function(){return CombinedOpenEnded.prototype.get_html.apply(_this,arguments)},this.get_html_callback=function(){return CombinedOpenEnded.prototype.get_html_callback.apply(_this,arguments)},this.el=el,this.$el=$(el),this.reinitialize(el),$(window).keydown(this.keydown_handler),$(window).keyup(this.keyup_handler)}return CombinedOpenEnded.prototype.wrapper_sel="section.xmodule_CombinedOpenEndedModule",CombinedOpenEnded.prototype.coe_sel="section.combined-open-ended",CombinedOpenEnded.prototype.reset_button_sel=".reset-button",CombinedOpenEnded.prototype.next_step_sel=".next-step-button",CombinedOpenEnded.prototype.question_header_sel=".question-header",CombinedOpenEnded.prototype.submit_evaluation_sel=".submit-evaluation-button",CombinedOpenEnded.prototype.result_container_sel="div.result-container",CombinedOpenEnded.prototype.combined_rubric_sel=".combined-rubric-container",CombinedOpenEnded.prototype.open_ended_child_sel="section.open-ended-child",CombinedOpenEnded.prototype.error_sel=".error",CombinedOpenEnded.prototype.answer_area_sel="textarea.answer",CombinedOpenEnded.prototype.answer_area_div_sel="div.answer",CombinedOpenEnded.prototype.prompt_sel=".prompt",CombinedOpenEnded.prototype.rubric_wrapper_sel=".rubric-wrapper",CombinedOpenEnded.prototype.hint_wrapper_sel=".hint-wrapper",CombinedOpenEnded.prototype.message_wrapper_sel=".message-wrapper",CombinedOpenEnded.prototype.submit_button_sel=".submit-button",CombinedOpenEnded.prototype.skip_button_sel=".skip-button",CombinedOpenEnded.prototype.file_upload_sel=".file-upload",CombinedOpenEnded.prototype.file_upload_box_sel=".file-upload-box",CombinedOpenEnded.prototype.file_upload_preview_sel=".file-upload-preview",CombinedOpenEnded.prototype.fof_sel="textarea.feedback-on-feedback",CombinedOpenEnded.prototype.sub_id_sel="input.submission_id",CombinedOpenEnded.prototype.grader_id_sel="input.grader_id",CombinedOpenEnded.prototype.grader_status_sel=".grader-status",CombinedOpenEnded.prototype.info_rubric_elements_sel=".rubric-info-item",CombinedOpenEnded.prototype.rubric_collapse_sel=".rubric-collapse",CombinedOpenEnded.prototype.next_rubric_sel=".rubric-next-button",CombinedOpenEnded.prototype.previous_rubric_sel=".rubric-previous-button",CombinedOpenEnded.prototype.oe_alert_sel=".open-ended-alert",CombinedOpenEnded.prototype.save_button_sel=".save-button",CombinedOpenEnded.prototype.$=function(selector){return $(selector,this.el)},CombinedOpenEnded.prototype.reinitialize=function(){return this.has_been_reset=!1,this.wrapper=this.$(this.wrapper_sel),this.coe=this.$(this.coe_sel),this.ajax_url=this.coe.data("ajax-url"),this.get_html(),this.coe=this.$(this.coe_sel),this.allow_reset=this.coe.data("allow_reset"),this.id=this.coe.data("id"),this.state=this.coe.data("state"),this.task_count=this.coe.data("task-count"),this.task_number=this.coe.data("task-number"),this.accept_file_upload=this.coe.data("accept-file-upload"),this.location=this.coe.data("location"),this.rub=new Rubric(this.coe),this.rub.initialize(this.location),this.is_ctrl=!1,this.reset_button=this.$(this.reset_button_sel),this.reset_button.click(this.confirm_reset),this.next_problem_button=this.$(this.next_step_sel),this.next_problem_button.click(this.next_problem),this.question_header=this.$(this.question_header_sel),this.question_header.click(this.collapse_question),Collapsible.setCollapsibles(this.$el),this.submit_evaluation_button=this.$(this.submit_evaluation_sel),this.submit_evaluation_button.click(this.message_post),this.results_container=this.$(this.result_container_sel),this.combined_rubric_container=this.$(this.combined_rubric_sel),this.oe=this.$(this.open_ended_child_sel),this.errors_area=this.$(this.oe).find(this.error_sel),this.answer_area=this.$(this.oe).find(this.answer_area_sel),this.prompt_container=this.$(this.oe).find(this.prompt_sel),this.rubric_wrapper=this.$(this.oe).find(this.rubric_wrapper_sel),this.hint_wrapper=this.$(this.oe).find(this.hint_wrapper_sel),this.message_wrapper=this.$(this.oe).find(this.message_wrapper_sel),this.submit_button=this.$(this.oe).find(this.submit_button_sel),this.save_button=this.$(this.oe).find(this.save_button_sel),this.child_state=this.oe.data("state"),this.child_type=this.oe.data("child-type"),"openended"===this.child_type&&(this.skip_button=this.$(this.oe).find(this.skip_button_sel),this.skip_button.click(this.skip_post_assessment)),this.file_upload_area=this.$(this.oe).find(this.file_upload_sel),this.can_upload_files=!1,this.open_ended_child=this.$(this.oe).find(this.open_ended_child_sel),this.out_of_sync_message="The problem state got out of sync.  Try reloading the page.",this.task_number>1?this.prompt_hide():1===this.task_number&&"initial"!==this.child_state&&this.prompt_hide(),this.find_assessment_elements(),this.find_hint_elements(),this.rebind()},CombinedOpenEnded.prototype.get_html_callback=function(response){return this.coe.replaceWith(response.html)},CombinedOpenEnded.prototype.get_html=function(){var url;return url=""+this.ajax_url+"/get_html",$.ajaxWithPrefix({type:"POST",url:url,data:{},success:this.get_html_callback,async:!1})},CombinedOpenEnded.prototype.show_combined_rubric_current=function(){var data,_this=this;return data={},$.postWithPrefix(""+this.ajax_url+"/get_combined_rubric",data,function(response){return response.success&&(_this.combined_rubric_container.after(response.html).remove(),_this.combined_rubric_container=_this.$(_this.combined_rubric_sel),_this.toggle_rubric(""),_this.rubric_collapse=_this.$(_this.rubric_collapse_sel),_this.rubric_collapse.click(_this.toggle_rubric),_this.hide_rubrics(),_this.$(_this.previous_rubric_sel).click(_this.previous_rubric),_this.$(_this.next_rubric_sel).click(_this.next_rubric),response.hide_reset)?_this.reset_button.hide():void 0})},CombinedOpenEnded.prototype.message_post=function(event){var evaluation_scoring,external_grader_message,fd,feedback,grader_id,score,settings,submission_id,_this=this;return external_grader_message=$(event.target).parent().parent().parent(),evaluation_scoring=$(event.target).parent(),fd=new FormData,feedback=this.$(evaluation_scoring).find(this.fof_sel)[0].value,submission_id=this.$(external_grader_message).find(this.sub_id_sel)[0].value,grader_id=this.$(external_grader_message).find(this.grader_id_sel)[0].value,score=this.$(evaluation_scoring).find("input:radio[name='evaluation-score']:checked").val(),fd.append("feedback",feedback),fd.append("submission_id",submission_id),fd.append("grader_id",grader_id),score?(fd.append("score",score),settings={type:"POST",data:fd,processData:!1,contentType:!1,success:function(response){return _this.gentle_alert(response.msg),_this.$("section.evaluation").slideToggle(),_this.message_wrapper.html(response.message_html)}},$.ajaxWithPrefix(""+this.ajax_url+"/save_post_assessment",settings)):void this.gentle_alert(gettext("You need to pick a rating before you can submit."))},CombinedOpenEnded.prototype.rebind=function(){if(this.submit_button.unbind("click"),this.submit_button.show(),this.save_button.unbind("click"),this.save_button.hide(),this.reset_button.hide(),this.hide_file_upload(),this.next_problem_button.hide(),this.hint_area.attr("disabled",!1),1===this.task_number&&"assessing"===this.child_state&&this.prompt_hide(),"done"===this.child_state&&this.rubric_wrapper.hide(),"openended"===this.child_type&&this.skip_button.hide(),"True"===this.allow_reset){if(this.show_combined_rubric_current(),this.reset_button.show(),this.submit_button.hide(),this.answer_area.attr("disabled",!0),this.replace_text_inputs(),this.hint_area.attr("disabled",!0),this.task_number<this.task_count)return this.gentle_alert(gettext("Your score did not meet the criteria to move to the next step."))}else{if("initial"===this.child_state)return this.answer_area.attr("disabled",!1),this.submit_button.prop("value",gettext("Submit")),this.submit_button.click(this.confirm_save_answer),this.setup_file_upload(),this.save_button.click(this.store_answer),this.save_button.show();if("assessing"===this.child_state){if(this.answer_area.attr("disabled",!0),this.replace_text_inputs(),this.hide_file_upload(),this.submit_button.prop("value",gettext("Submit assessment")),this.submit_button.click(this.save_assessment),this.submit_button.attr("disabled",!0),"openended"===this.child_type)return this.submit_button.hide(),this.queueing(),this.grader_status=this.$(this.grader_status_sel),this.grader_status.html("<span class='grading'>"+gettext("Your response has been submitted. Please check back later for your grade.</span>"));if("selfassessment"===this.child_type)return this.setup_score_selection()}else{if("post_assessment"===this.child_state)return"openended"===this.child_type&&(this.skip_button.show(),this.skip_post_assessment()),this.answer_area.attr("disabled",!0),this.replace_text_inputs(),this.submit_button.prop("value",gettext("Submit post-assessment")),this.submit_button.click("selfassessment"===this.child_type?this.save_hint:this.message_post);if("done"===this.child_state)return this.show_combined_rubric_current(),this.rubric_wrapper.hide(),this.answer_area.attr("disabled",!0),this.replace_text_inputs(),this.hint_area.attr("disabled",!0),this.submit_button.hide(),"openended"===this.child_type&&this.skip_button.hide(),this.task_number<this.task_count?this.next_problem_button.show():this.reset_button.show()}}},CombinedOpenEnded.prototype.find_assessment_elements=function(){return this.assessment=this.$('input[name="grade-selection"]')},CombinedOpenEnded.prototype.find_hint_elements=function(){return this.hint_area=this.$("textarea.post_assessment")},CombinedOpenEnded.prototype.store_answer=function(event){var data,_this=this;return event.preventDefault(),"initial"===this.child_state?(data={student_answer:this.answer_area.val()},this.save_button.attr("disabled",!0),$.postWithPrefix(""+this.ajax_url+"/store_answer",data,function(response){return response.success?_this.gentle_alert(gettext("Answer saved, but not yet submitted.")):_this.errors_area.html(response.error),_this.save_button.attr("disabled",!1)})):this.errors_area.html(this.out_of_sync_message)},CombinedOpenEnded.prototype.replace_answer=function(response){var answer_area_div;return response.success?(this.rubric_wrapper.html(response.rubric_html),this.rubric_wrapper.show(),this.rub=new Rubric(this.coe),this.rub.initialize(this.location),this.child_state="assessing",this.find_assessment_elements(),this.answer_area.val(response.student_response),this.rebind(),answer_area_div=this.$(this.answer_area_div_sel),answer_area_div.html(response.student_response)):(this.submit_button.show(),this.submit_button.attr("disabled",!1),this.gentle_alert(response.error))},CombinedOpenEnded.prototype.confirm_save_answer=function(event){var confirmation_text,_this=this;return confirmation_text=gettext("Please confirm that you wish to submit your work. You will not be able to make any changes after submitting."),accessible_confirm(confirmation_text,function(){return _this.save_answer(event)})},CombinedOpenEnded.prototype.save_answer=function(event){var fd,files,max_filesize,settings,that,valid_files_attached,_this=this;return this.$el.find(this.oe_alert_sel).remove(),this.submit_button.attr("disabled",!0),this.submit_button.hide(),event.preventDefault(),this.answer_area.attr("disabled",!0),max_filesize=2e6,"initial"===this.child_state?(files="",valid_files_attached=!1,this.can_upload_files===!0&&(files=this.$(this.file_upload_box_sel)[0].files[0],void 0!==files&&(valid_files_attached=!0,files.size>max_filesize))?(files="",this.submit_button.show(),this.submit_button.attr("disabled",!1),void this.gentle_alert(gettext("You are trying to upload a file that is too large for our system.  Please choose a file under 2MB or paste a link to it into the answer box."))):(fd=new FormData,fd.append("student_answer",this.answer_area.val()),fd.append("student_file",files),fd.append("valid_files_attached",valid_files_attached),that=this,settings={type:"POST",data:fd,processData:!1,contentType:!1,async:!1,success:function(response){return _this.replace_answer(response)}},$.ajaxWithPrefix(""+this.ajax_url+"/save_answer",settings))):this.errors_area.html(this.out_of_sync_message)},CombinedOpenEnded.prototype.keydown_handler=function(event){return 17===event.which&&this.is_ctrl===!1?this.is_ctrl=!0:this.is_ctrl===!0&&13===event.which&&"assessing"===this.child_state&&this.rub.check_complete()?this.save_assessment(event):void 0},CombinedOpenEnded.prototype.keyup_handler=function(event){return 17===event.which&&this.is_ctrl===!0?this.is_ctrl=!1:void 0},CombinedOpenEnded.prototype.save_assessment=function(event){var checked_assessment,data,score_list,_this=this;return this.submit_button.attr("disabled",!0),this.submit_button.hide(),event.preventDefault(),"assessing"===this.child_state&&this.rub.check_complete()?(checked_assessment=this.rub.get_total_score(),score_list=this.rub.get_score_list(),data={assessment:checked_assessment,score_list:score_list},$.postWithPrefix(""+this.ajax_url+"/save_assessment",data,function(response){return response.success?(_this.child_state=response.state,"post_assessment"===_this.child_state?(_this.hint_wrapper.html(response.hint_html),_this.find_hint_elements()):"done"===_this.child_state&&_this.rubric_wrapper.hide(),_this.rebind()):_this.gentle_alert(response.error)})):this.errors_area.html(this.out_of_sync_message)},CombinedOpenEnded.prototype.save_hint=function(event){var data,_this=this;return event.preventDefault(),"post_assessment"===this.child_state?(data={hint:this.hint_area.val()},$.postWithPrefix(""+this.ajax_url+"/save_post_assessment",data,function(response){return response.success?(_this.message_wrapper.html(response.message_html),_this.child_state="done",_this.rebind()):_this.errors_area.html(response.error)})):this.errors_area.html(this.out_of_sync_message)},CombinedOpenEnded.prototype.skip_post_assessment=function(){var _this=this;return"post_assessment"===this.child_state?$.postWithPrefix(""+this.ajax_url+"/skip_post_assessment",{},function(response){return response.success?(_this.child_state="done",_this.rebind()):_this.errors_area.html(response.error)}):this.errors_area.html(this.out_of_sync_message)},CombinedOpenEnded.prototype.confirm_reset=function(event){var message,_this=this;return message=gettext("Are you sure you want to remove your previous response to this question?"),accessible_confirm(message,function(){return _this.reset(event)})},CombinedOpenEnded.prototype.reset=function(event){var _this=this;return event.preventDefault(),"done"===this.child_state||"True"===this.allow_reset?$.postWithPrefix(""+this.ajax_url+"/reset",{},function(response){return response.success?(_this.answer_area.val(""),_this.rubric_wrapper.html(""),_this.hint_wrapper.html(""),_this.message_wrapper.html(""),_this.child_state="initial",_this.coe.after(response.html).remove(),_this.allow_reset="False",_this.reinitialize(_this.element),_this.has_been_reset=!0,_this.rebind(),_this.reset_button.hide()):_this.errors_area.html(response.error)}):this.errors_area.html(this.out_of_sync_message)},CombinedOpenEnded.prototype.next_problem=function(){var _this=this;return"done"===this.child_state?$.postWithPrefix(""+this.ajax_url+"/next_problem",{},function(response){return response.success?(_this.answer_area.val(""),_this.rubric_wrapper.html(""),_this.hint_wrapper.html(""),_this.message_wrapper.html(""),_this.child_state="initial",_this.coe.after(response.html).remove(),_this.reinitialize(_this.element),_this.rebind(),_this.next_problem_button.hide(),response.allow_reset?(_this.gentle_alert(gettext("Your score did not meet the criteria to move to the next step.")),_this.show_combined_rubric_current()):_this.gentle_alert(gettext("Moved to next step."))):_this.errors_area.html(response.error)}):this.errors_area.html(this.out_of_sync_message)},CombinedOpenEnded.prototype.gentle_alert=function(msg){var alert_elem;return this.$el.find(this.oe_alert_sel).length&&this.$el.find(this.oe_alert_sel).remove(),alert_elem="<div class='open-ended-alert' role='alert'>"+msg+"</div>",this.$el.find(".open-ended-action").after(alert_elem),this.$el.find(this.oe_alert_sel).css({opacity:0}).animate({opacity:1},700)},CombinedOpenEnded.prototype.queueing=function(){return"assessing"===this.child_state&&"openended"===this.child_type?(window.queuePollerID&&window.clearTimeout(window.queuePollerID),window.queuePollerID=window.setTimeout(this.poll,1e4)):void 0},CombinedOpenEnded.prototype.poll=function(){var _this=this;return $.postWithPrefix(""+this.ajax_url+"/check_for_score",function(response){return"done"===response.state||"post_assessment"===response.state?(delete window.queuePollerID,_this.reload()):window.queuePollerID=window.setTimeout(_this.poll,1e4)})},CombinedOpenEnded.prototype.setup_file_upload=function(){return"True"===this.accept_file_upload?window.File&&window.FileReader&&window.FileList&&window.Blob?(this.can_upload_files=!0,this.file_upload_area.html('<input type="file" class="file-upload-box"><img class="file-upload-preview" src="#" alt="Uploaded image" />'),this.file_upload_area.show(),this.$(this.file_upload_preview_sel).hide(),this.$(this.file_upload_box_sel).change(this.preview_image)):this.gentle_alert(gettext("File uploads are required for this question, but are not supported in your browser. Try the newest version of Google Chrome. Alternatively, if you have uploaded the image to another website, you can paste a link to it into the answer box.")):void 0
},CombinedOpenEnded.prototype.hide_file_upload=function(){return"True"===this.accept_file_upload?this.file_upload_area.hide():void 0},CombinedOpenEnded.prototype.replace_text_inputs=function(){var answer_class,answer_id,answer_val,new_text;return answer_class=this.answer_area.attr("class"),answer_id=this.answer_area.attr("id"),answer_val=this.answer_area.val(),new_text="",new_text="<div class='"+answer_class+"' id='"+answer_id+"'>"+answer_val+"</div>",this.answer_area.replaceWith(new_text)},CombinedOpenEnded.prototype.reload=function(){return this.reinitialize()},CombinedOpenEnded.prototype.collapse_question=function(){var new_text;return this.prompt_container.slideToggle(),this.prompt_container.toggleClass("open"),this.prompt_container.hasClass("open")?(new_text=gettext("Show Question"),Logger.log("oe_show_question",{location:this.location})):(Logger.log("oe_hide_question",{location:this.location}),new_text=gettext("Hide Question")),this.question_header.text(new_text),!1},CombinedOpenEnded.prototype.hide_rubrics=function(){var rub,rubrics,_i,_len,_results;for(rubrics=this.$(this.combined_rubric_sel),_results=[],_i=0,_len=rubrics.length;_len>_i;_i++)rub=rubrics[_i],_results.push("shown"===this.$(rub).data("status")?this.$(rub).show():this.$(rub).hide());return _results},CombinedOpenEnded.prototype.next_rubric=function(){return this.shift_rubric(1),!1},CombinedOpenEnded.prototype.previous_rubric=function(){return this.shift_rubric(-1),!1},CombinedOpenEnded.prototype.shift_rubric=function(i){var number,rub,rubrics,_i,_len;for(rubrics=this.$(this.combined_rubric_sel),number=0,_i=0,_len=rubrics.length;_len>_i;_i++)rub=rubrics[_i],"shown"===this.$(rub).data("status")&&(number=this.$(rub).data("number")),this.$(rub).data("status","hidden");return 1===i&&number<rubrics.length-1&&(number+=i),-1===i&&number>0&&(number+=i),this.$(rubrics[number]).data("status","shown"),this.hide_rubrics()},CombinedOpenEnded.prototype.prompt_show=function(){return this.prompt_container.is(":hidden")===!0?(this.prompt_container.slideToggle(),this.prompt_container.toggleClass("open"),this.question_header.text(gettext("Hide Question"))):void 0},CombinedOpenEnded.prototype.prompt_hide=function(){return this.prompt_container.is(":visible")===!0?(this.prompt_container.slideToggle(),this.prompt_container.toggleClass("open"),this.question_header.text(gettext("Show Question"))):void 0},CombinedOpenEnded.prototype.log_feedback_click=function(event){var generated_event_type,target;return target=this.$(event.target),target.hasClass("see-full-feedback")?Logger.log("oe_show_full_feedback",{}):target.hasClass("respond-to-feedback")?Logger.log("oe_show_respond_to_feedback",{}):(generated_event_type=link_text.toLowerCase().replace(" ","_"),Logger.log("oe_"+generated_event_type,{}))},CombinedOpenEnded.prototype.log_feedback_selection=function(event){var target_selection;return target_selection=this.$(event.target).val(),Logger.log("oe_feedback_response_selected",{value:target_selection})},CombinedOpenEnded.prototype.remove_attribute=function(name){return this.$(this.file_upload_preview_sel).attr(name)?this.$(this.file_upload_preview_sel)[0].removeAttribute(name):void 0},CombinedOpenEnded.prototype.preview_image=function(){var reader,_this=this;return this.$(this.file_upload_box_sel)[0].files&&this.$(this.file_upload_box_sel)[0].files[0]?(reader=new FileReader,reader.onload=function(e){var height_px,max_dim,scale_factor,width_px;return max_dim=150,_this.remove_attribute("src"),_this.remove_attribute("height"),_this.remove_attribute("width"),_this.$(_this.file_upload_preview_sel).attr("src",e.target.result),height_px=_this.$(_this.file_upload_preview_sel)[0].height,width_px=_this.$(_this.file_upload_preview_sel)[0].width,scale_factor=0,scale_factor=height_px>width_px?height_px/max_dim:width_px/max_dim,_this.$(_this.file_upload_preview_sel)[0].width=width_px/scale_factor,_this.$(_this.file_upload_preview_sel)[0].height=height_px/scale_factor,_this.$(_this.file_upload_preview_sel).show()},reader.readAsDataURL(this.$(this.file_upload_box_sel)[0].files[0])):void 0},CombinedOpenEnded.prototype.toggle_rubric=function(){var info_rubric_elements;return info_rubric_elements=this.$(this.info_rubric_elements_sel),info_rubric_elements.slideToggle(),!1},CombinedOpenEnded.prototype.setup_score_selection=function(){return this.$("input[class='score-selection']").change(this.graded_callback)},CombinedOpenEnded.prototype.graded_callback=function(){return this.rub.check_complete()?(this.submit_button.attr("disabled",!1),this.submit_button.show()):void 0},CombinedOpenEnded}()}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};this.InlineDiscussion=function(_super){function InlineDiscussion(element){this.el=$(element).find(".discussion-module"),this.view=new DiscussionModuleView({el:this.el})}return __extends(InlineDiscussion,_super),InlineDiscussion}(XModule.Descriptor)}.call(this),function(){"use strict";function format(time,formatFull){var hours,minutes,seconds;return(!_.isFinite(time)||0>time)&&(time=0),seconds=Math.floor(time),minutes=Math.floor(seconds/60),hours=Math.floor(minutes/60),seconds%=60,minutes%=60,formatFull?""+_pad(hours)+":"+_pad(minutes)+":"+_pad(seconds%60):hours?""+hours+":"+_pad(minutes)+":"+_pad(seconds%60):""+minutes+":"+_pad(seconds%60)}function formatFull(time){return format(time,!0)}function convert(time,oldSpeed,newSpeed){return(time*oldSpeed/newSpeed).toFixed(3)}function _pad(number){return 10>number?"0"+number:""+number}this.Time={format:format,formatFull:formatFull,convert:convert}}.call(this),window.Poll=function(el){RequireJS.require(["PollMain"],function(PollMain){new PollMain(el)})};var SequenceNav=function($element){var listOrigin,mouseOrigin,$element=$element,$wrapper=$element.find(".sequence-list-wrapper"),$list=$element.find("#sequence-list"),$arrows=$element.find(".sequence-nav-buttons"),maxScroll=$list.width()-$wrapper.width()+20,$leftShadow=$('<div class="left-shadow"></div>'),$rightShadow=$('<div class="right-shadow"></div>'),$body=$("body"),startDrag=function(e){updateWidths(),mouseOrigin=e.pageX,listOrigin=$list.position().left,$body.css("-webkit-user-select","none"),$body.bind("mousemove",moveDrag),$body.bind("mouseup",stopDrag)},moveDrag=function(e){var offset=e.pageX-mouseOrigin,targetLeft=clamp(listOrigin+offset,-maxScroll,0);updateHorizontalPosition(targetLeft),setShadows(targetLeft)},stopDrag=function(){$body.css("-webkit-user-select","auto"),$body.unbind("mousemove",moveDrag),$body.unbind("mouseup",stopDrag)},setShadows=function(left){var left=left||$list.position().left,padding=30,leftPercent=clamp(-left/padding,0,1);$leftShadow.css("opacity",leftPercent);var rightPercent=clamp((maxScroll+left)/padding,0,1);$rightShadow.css("opacity",rightPercent)},clamp=function(val,min,max){return val>max?max:min>val?min:val},updateWidths=function(){maxScroll=$list.width()-$wrapper.width()+20;var targetLeft=clamp($list.position().left,-maxScroll,0);updateHorizontalPosition(targetLeft),setShadows(targetLeft)},updateHorizontalPosition=function(left){$list.css({left:left+"px"})},checkPosition=function(){var $active=$element.find(".active");$active[0]&&($active.position().left+$active.width()>$wrapper.width()-$list.position().left?$list.animate({left:-$active.position().left+$wrapper.width()-$active.width()-10+"px"},{step:setShadows}):$active.position().left<-$list.position().left&&$list.animate({left:-$active.position().left+10+"px"},{step:setShadows}))};$wrapper.append($leftShadow).append($rightShadow),setShadows(0),$wrapper.bind("mousedown",startDrag),$arrows.bind("click",checkPosition),$(window).bind("resize",updateWidths),setTimeout(function(){checkPosition()},200)};!function(requirejs,require,define){define("GstMain",["State","GeneralMethods","Sliders","Inputs","Graph","ElOutput","GLabelElOutput"],function(State,GeneralMethods,Sliders,Inputs,Graph,ElOutput,GLabelElOutput){function GstMain(gstId){var config,gstClass,state;if("processed"!==$("#"+gstId).attr("data-processed")){$("#"+gstId).attr("data-processed","processed");try{config=JSON.parse($("#"+gstId+"_json").html()).root}catch(err){return console.log("ERROR: could not parse config JSON."),console.log('$("#" + gstId + "_json").html() = ',$("#"+gstId+"_json").html()),console.log("JSON.parse(...) = ",JSON.parse($("#"+gstId+"_json").html())),void console.log("config = ",config)}if("string"!=typeof config["@class"])return console.log("ERROR: Could not get the class name of GST."),void console.log('config["@class"] = ',config["@class"]);if(gstClass=config["@class"],state=State(gstId,config),state.showDebugInfo=!1,void 0===state)return void console.log("ERROR: The state object was not initialized properly.");Sliders(gstId,state),Inputs(gstId,gstClass,state),ElOutput(config,state),GLabelElOutput(config,state),Graph(gstId,config,state)}}return GstMain})}(RequireJS.requirejs,RequireJS.require,RequireJS.define),function(){"use strict";this.LTI=function(element){var dataAttrs=$(element).find(".lti").data(),askToSendUsername="True"===dataAttrs.askToSendUsername,askToSendEmail="True"===dataAttrs.askToSendEmail;$(element).on("click",".link_lti_new_window",function(){return askToSendUsername&&askToSendEmail?confirm(gettext("Click OK to have your username and e-mail address sent to a 3rd party application.\n\nClick Cancel to return to this page without sending your information.")):askToSendUsername?confirm(gettext("Click OK to have your username sent to a 3rd party application.\n\nClick Cancel to return to this page without sending your information.")):askToSendEmail?confirm(gettext("Click OK to have your e-mail address sent to a 3rd party application.\n\nClick Cancel to return to this page without sending your information.")):!0})}}.call(this),function(){this.JavascriptLoader=function(){function JavascriptLoader(){}return JavascriptLoader.executeModuleScripts=function(el,callback){var callbackCalled,completed,completionHandlerGenerator,completionHandlerGeneratorIE,i,loaded,placeholders;return null==callback&&(callback=null),placeholders=el.find(".script_placeholder"),0===placeholders.length?void(null!=callback&&callback()):(completed=function(){var _i,_ref,_results;for(_results=[],i=_i=1,_ref=placeholders.length;_ref>=1?_ref>=_i:_i>=_ref;i=_ref>=1?++_i:--_i)_results.push(!1);return _results}(),callbackCalled=!1,completionHandlerGeneratorIE=function(index){return function(){return"complete"===this.readyState||"loaded"===this.readyState?completionHandlerGenerator(index)():void 0}},completionHandlerGenerator=function(index){return function(){var allComplete,flag,_i,_len;for(allComplete=!0,completed[index]=!0,_i=0,_len=completed.length;_len>_i;_i++)if(flag=completed[_i],!flag){allComplete=!1;break}return allComplete&&!callbackCalled&&(callbackCalled=!0,null!=callback)?callback():void 0}},loaded={},placeholders.each(function(index,placeholder){var s,src;return src=$(placeholder).attr("data-src"),src in loaded?completionHandlerGenerator(index)():(loaded[src]=!0,s=document.createElement("script"),s.setAttribute("src",src),s.setAttribute("type","text/javascript"),s.onload=completionHandlerGenerator(index),s.onreadystatechange=completionHandlerGeneratorIE(index),$("head")[0].appendChild(s)),$(placeholder).remove()}))},JavascriptLoader}()}.call(this),function(){this.Conditional=function(){function Conditional(element,callerElId){var dependencies;this.el=$(element).find(".conditional-wrapper"),this.callerElId=callerElId,void 0!==callerElId&&(dependencies=this.el.data("depends"),"string"==typeof dependencies&&dependencies.length>0&&-1===dependencies.indexOf(callerElId))||(this.url=this.el.data("url"),this.render(element))}return Conditional.prototype.render=function(element){var _this=this;return $.postWithPrefix(""+this.url+"/conditional_get",function(response){var i,parentEl,parentId,_i,_len,_ref;for(_this.el.html(""),_ref=response.html,_i=0,_len=_ref.length;_len>_i;_i++)i=_ref[_i],_this.el.append(i);return parentEl=$(element).parent(),parentId=parentEl.attr("id"),response.message===!1?parentEl.hasClass("vert")?parentEl.hide():$(element).hide():parentEl.hasClass("vert")?parentEl.show():$(element).show(),XBlock.initializeBlocks(_this.el)})},Conditional}()}.call(this),d3=function(){function n(n){return null!=n&&!isNaN(n)}function t(n){return n.length}function e(n){for(var t=1;n*t%1;)t*=10;return t}function r(n,t){try{for(var e in t)Object.defineProperty(n.prototype,e,{value:t[e],enumerable:!1})}catch(r){n.prototype=t}}function u(){}function i(){}function a(n,t,e){return function(){var r=e.apply(t,arguments);return r===t?n:r}}function o(){}function c(n){function t(){for(var t,r=e,u=-1,i=r.length;++u<i;)(t=r[u].on)&&t.apply(this,arguments);return n}var e=[],r=new u;return t.on=function(t,u){var i,a=r.get(t);return arguments.length<2?a&&a.on:(a&&(a.on=null,e=e.slice(0,i=e.indexOf(a)).concat(e.slice(i+1)),r.remove(t)),u&&e.push(r.set(t,{on:u})),n)},t}function l(){oa.event.stopPropagation(),oa.event.preventDefault()}function f(){for(var n,t=oa.event;n=t.sourceEvent;)t=n;return t}function s(n){for(var t=new o,e=0,r=arguments.length;++e<r;)t[arguments[e]]=c(t);return t.of=function(e,r){return function(u){try{var i=u.sourceEvent=oa.event;u.target=n,oa.event=u,t[u.type].apply(e,r)}finally{oa.event=i}}},t}function h(n,t){var e=n.ownerSVGElement||n;if(e.createSVGPoint){var r=e.createSVGPoint();if(0>ma&&(la.scrollX||la.scrollY)){e=oa.select(ca.body).append("svg").style("position","absolute").style("top",0).style("left",0);var u=e[0][0].getScreenCTM();ma=!(u.f||u.e),e.remove()}return ma?(r.x=t.pageX,r.y=t.pageY):(r.x=t.clientX,r.y=t.clientY),r=r.matrixTransform(n.getScreenCTM().inverse()),[r.x,r.y]}var i=n.getBoundingClientRect();return[t.clientX-i.left-n.clientLeft,t.clientY-i.top-n.clientTop]}function g(n){for(var t=-1,e=n.length,r=[];++t<e;)r.push(n[t]);return r}function p(n){return Array.prototype.slice.call(n)}function d(n){return Ma(n,Ea),n}function m(n){return function(){return xa(n,this)}}function v(n){return function(){return ba(n,this)}}function y(n,t){function e(){this.removeAttribute(n)}function r(){this.removeAttributeNS(n.space,n.local)}function u(){this.setAttribute(n,t)}function i(){this.setAttributeNS(n.space,n.local,t)}function a(){var e=t.apply(this,arguments);null==e?this.removeAttribute(n):this.setAttribute(n,e)}function o(){var e=t.apply(this,arguments);null==e?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,e)}return n=oa.ns.qualify(n),null==t?n.local?r:e:"function"==typeof t?n.local?o:a:n.local?i:u}function M(n){return n.trim().replace(/\s+/g," ")}function x(n){return RegExp("(?:^|\\s+)"+oa.requote(n)+"(?:\\s+|$)","g")}function _(n,t){function e(){for(var e=-1;++e<u;)n[e](this,t)}function r(){for(var e=-1,r=t.apply(this,arguments);++e<u;)n[e](this,r)}n=n.trim().split(/\s+/).map(w);var u=n.length;return"function"==typeof t?r:e}function w(n){var t=x(n);return function(e,r){if(u=e.classList)return r?u.add(n):u.remove(n);var u=e.getAttribute("class")||"";r?(t.lastIndex=0,t.test(u)||e.setAttribute("class",M(u+" "+n))):e.setAttribute("class",M(u.replace(t," ")))}}function S(n,t,e){function r(){this.style.removeProperty(n)}function u(){this.style.setProperty(n,t,e)}function i(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(n):this.style.setProperty(n,r,e)}return null==t?r:"function"==typeof t?i:u}function E(n,t){function e(){delete this[n]}function r(){this[n]=t}function u(){var e=t.apply(this,arguments);null==e?delete this[n]:this[n]=e}return null==t?e:"function"==typeof t?u:r}function k(n){return{__data__:n}}function A(n){return function(){return Sa(this,n)}}function q(n){return arguments.length||(n=oa.ascending),function(t,e){return!t-!e||n(t.__data__,e.__data__)}}function N(){}function T(n,t,e){function r(){var t=this[a];t&&(this.removeEventListener(n,t,t.$),delete this[a])}function u(){var u=c(t,va(arguments));r.call(this),this.addEventListener(n,this[a]=u,u.$=e),u._=t}function i(){var t,e=RegExp("^__on([^.]+)"+oa.requote(n)+"$");for(var r in this)if(t=r.match(e)){var u=this[r];this.removeEventListener(t[1],u,u.$),delete this[r]}}var a="__on"+n,o=n.indexOf("."),c=C;o>0&&(n=n.substring(0,o));var l=qa.get(n);return l&&(n=l,c=z),o?t?u:r:t?N:i}function C(n,t){return function(e){var r=oa.event;oa.event=e,t[0]=this.__data__;try{n.apply(this,t)}finally{oa.event=r}}}function z(n,t){var e=C(n,t);return function(n){var t=this,r=n.relatedTarget;r&&(r===t||8&r.compareDocumentPosition(t))||e.call(t,n)}}function D(n,t){for(var e=0,r=n.length;r>e;e++)for(var u,i=n[e],a=0,o=i.length;o>a;a++)(u=i[a])&&t(u,a,e);return n}function j(n){return Ma(n,Na),n}function L(){}function F(n,t,e){return new H(n,t,e)}function H(n,t,e){this.h=n,this.s=t,this.l=e}function P(n,t,e){function r(n){return n>360?n-=360:0>n&&(n+=360),60>n?i+(a-i)*n/60:180>n?a:240>n?i+(a-i)*(240-n)/60:i}function u(n){return Math.round(255*r(n))}var i,a;return n%=360,0>n&&(n+=360),t=0>t?0:t>1?1:t,e=0>e?0:e>1?1:e,a=.5>=e?e*(1+t):e+t-e*t,i=2*e-a,tt(u(n+120),u(n),u(n-120))}function R(n){return n>0?1:0>n?-1:0}function O(n){return Math.acos(Math.max(-1,Math.min(1,n)))}function Y(n){return n>1?La/2:-1>n?-La/2:Math.asin(n)}function U(n){return(Math.exp(n)-Math.exp(-n))/2}function I(n){return(Math.exp(n)+Math.exp(-n))/2}function V(n){return(n=Math.sin(n/2))*n}function X(n,t,e){return new Z(n,t,e)}function Z(n,t,e){this.h=n,this.c=t,this.l=e}function B(n,t,e){return $(e,Math.cos(n*=Ha)*t,Math.sin(n)*t)}function $(n,t,e){return new J(n,t,e)}function J(n,t,e){this.l=n,this.a=t,this.b=e}function G(n,t,e){var r=(n+16)/116,u=r+t/500,i=r-e/200;return u=W(u)*Ya,r=W(r)*Ua,i=W(i)*Ia,tt(nt(3.2404542*u-1.5371385*r-.4985314*i),nt(-.969266*u+1.8760108*r+.041556*i),nt(.0556434*u-.2040259*r+1.0572252*i))}function K(n,t,e){return X(Math.atan2(e,t)*Pa,Math.sqrt(t*t+e*e),n)}function W(n){return n>.206893034?n*n*n:(n-4/29)/7.787037}function Q(n){return n>.008856?Math.pow(n,1/3):7.787037*n+4/29}function nt(n){return Math.round(255*(.00304>=n?12.92*n:1.055*Math.pow(n,1/2.4)-.055))}function tt(n,t,e){return new et(n,t,e)}function et(n,t,e){this.r=n,this.g=t,this.b=e}function rt(n){return 16>n?"0"+Math.max(0,n).toString(16):Math.min(255,n).toString(16)}function ut(n,t,e){var r,u,i,a=0,o=0,c=0;if(r=/([a-z]+)\((.*)\)/i.exec(n))switch(u=r[2].split(","),r[1]){case"hsl":return e(parseFloat(u[0]),parseFloat(u[1])/100,parseFloat(u[2])/100);case"rgb":return t(ct(u[0]),ct(u[1]),ct(u[2]))}return(i=Za.get(n))?t(i.r,i.g,i.b):(null!=n&&"#"===n.charAt(0)&&(4===n.length?(a=n.charAt(1),a+=a,o=n.charAt(2),o+=o,c=n.charAt(3),c+=c):7===n.length&&(a=n.substring(1,3),o=n.substring(3,5),c=n.substring(5,7)),a=parseInt(a,16),o=parseInt(o,16),c=parseInt(c,16)),t(a,o,c))}function it(n,t,e){var r,u,i=Math.min(n/=255,t/=255,e/=255),a=Math.max(n,t,e),o=a-i,c=(a+i)/2;return o?(u=.5>c?o/(a+i):o/(2-a-i),r=n==a?(t-e)/o+(e>t?6:0):t==a?(e-n)/o+2:(n-t)/o+4,r*=60):u=r=0,F(r,u,c)}function at(n,t,e){n=ot(n),t=ot(t),e=ot(e);var r=Q((.4124564*n+.3575761*t+.1804375*e)/Ya),u=Q((.2126729*n+.7151522*t+.072175*e)/Ua),i=Q((.0193339*n+.119192*t+.9503041*e)/Ia);return $(116*u-16,500*(r-u),200*(u-i))}function ot(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function ct(n){var t=parseFloat(n);return"%"===n.charAt(n.length-1)?Math.round(2.55*t):t}function lt(n){return"function"==typeof n?n:function(){return n}}function ft(n){return n}function st(n){return 1===n.length?function(t,e){n(null==t?e:null)}:n}function ht(n,t){function e(n,e,i){arguments.length<3&&(i=e,e=null);var a=oa.xhr(n,t,i);return a.row=function(n){return arguments.length?a.response(null==(e=n)?r:u(n)):e},a.row(e)}function r(n){return e.parse(n.responseText)}function u(n){return function(t){return e.parse(t.responseText,n)}}function a(t){return t.map(o).join(n)}function o(n){return c.test(n)?'"'+n.replace(/\"/g,'""')+'"':n}var c=RegExp('["'+n+"\n]"),l=n.charCodeAt(0);return e.parse=function(n,t){var r;return e.parseRows(n,function(n,e){if(r)return r(n,e-1);var u=Function("d","return {"+n.map(function(n,t){return JSON.stringify(n)+": d["+t+"]"}).join(",")+"}");r=t?function(n,e){return t(u(n),e)}:u})},e.parseRows=function(n,t){function e(){if(f>=c)return a;if(u)return u=!1,i;var t=f;if(34===n.charCodeAt(t)){for(var e=t;e++<c;)if(34===n.charCodeAt(e)){if(34!==n.charCodeAt(e+1))break;++e}f=e+2;var r=n.charCodeAt(e+1);return 13===r?(u=!0,10===n.charCodeAt(e+2)&&++f):10===r&&(u=!0),n.substring(t+1,e).replace(/""/g,'"')}for(;c>f;){var r=n.charCodeAt(f++),o=1;if(10===r)u=!0;else if(13===r)u=!0,10===n.charCodeAt(f)&&(++f,++o);else if(r!==l)continue;return n.substring(t,f-o)}return n.substring(t)}for(var r,u,i={},a={},o=[],c=n.length,f=0,s=0;(r=e())!==a;){for(var h=[];r!==i&&r!==a;)h.push(r),r=e();(!t||(h=t(h,s++)))&&o.push(h)}return o},e.format=function(t){if(Array.isArray(t[0]))return e.formatRows(t);var r=new i,u=[];return t.forEach(function(n){for(var t in n)r.has(t)||u.push(r.add(t))}),[u.map(o).join(n)].concat(t.map(function(t){return u.map(function(n){return o(t[n])}).join(n)})).join("\n")},e.formatRows=function(n){return n.map(a).join("\n")},e}function gt(){for(var n,t=Date.now(),e=Ka;e;)n=t-e.then,n>=e.delay&&(e.flush=e.callback(n)),e=e.next;var r=pt()-t;r>24?(isFinite(r)&&(clearTimeout($a),$a=setTimeout(gt,r)),Ba=0):(Ba=1,Wa(gt))}function pt(){for(var n=null,t=Ka,e=1/0;t;)t.flush?(delete Ga[t.callback.id],t=n?n.next=t.next:Ka=t.next):(e=Math.min(e,t.then+t.delay),t=(n=t).next);return e}function dt(n,t){var e=Math.pow(10,3*Math.abs(8-t));return{scale:t>8?function(n){return n/e}:function(n){return n*e},symbol:n}}function mt(n,t){return t-(n?Math.ceil(Math.log(n)/Math.LN10):1)}function vt(n){return n+""}function yt(n,t){co.hasOwnProperty(n.type)&&co[n.type](n,t)}function Mt(n,t,e){var r,u=-1,i=n.length-e;for(t.lineStart();++u<i;)r=n[u],t.point(r[0],r[1]);t.lineEnd()}function xt(n,t){var e=-1,r=n.length;for(t.polygonStart();++e<r;)Mt(n[e],t,1);t.polygonEnd()}function bt(){function n(n,t){n*=Ha,t=t*Ha/2+La/4;var e=n-r,a=Math.cos(t),o=Math.sin(t),c=i*o,l=fo,f=so,s=u*a+c*Math.cos(e),h=c*Math.sin(e);fo=l*s-f*h,so=f*s+l*h,r=n,u=a,i=o}var t,e,r,u,i;ho.point=function(a,o){ho.point=n,r=(t=a)*Ha,u=Math.cos(o=(e=o)*Ha/2+La/4),i=Math.sin(o)},ho.lineEnd=function(){n(t,e)}}function _t(n){function t(n,t){r>n&&(r=n),n>i&&(i=n),u>t&&(u=t),t>a&&(a=t)}function e(){o.point=o.lineEnd=N}var r,u,i,a,o={point:t,lineStart:N,lineEnd:N,polygonStart:function(){o.lineEnd=e},polygonEnd:function(){o.point=t}};return function(t){return a=i=-(r=u=1/0),oa.geo.stream(t,n(o)),[[r,u],[i,a]]}}function wt(n,t){if(!go){++po,n*=Ha;var e=Math.cos(t*=Ha);mo+=(e*Math.cos(n)-mo)/po,vo+=(e*Math.sin(n)-vo)/po,yo+=(Math.sin(t)-yo)/po}}function St(){var n,t;go=1,Et(),go=2;var e=Mo.point;Mo.point=function(r,u){e(n=r,t=u)},Mo.lineEnd=function(){Mo.point(n,t),kt(),Mo.lineEnd=kt}}function Et(){function n(n,u){n*=Ha;var i=Math.cos(u*=Ha),a=i*Math.cos(n),o=i*Math.sin(n),c=Math.sin(u),l=Math.atan2(Math.sqrt((l=e*c-r*o)*l+(l=r*a-t*c)*l+(l=t*o-e*a)*l),t*a+e*o+r*c);po+=l,mo+=l*(t+(t=a)),vo+=l*(e+(e=o)),yo+=l*(r+(r=c))}var t,e,r;go>1||(1>go&&(go=1,po=mo=vo=yo=0),Mo.point=function(u,i){u*=Ha;var a=Math.cos(i*=Ha);t=a*Math.cos(u),e=a*Math.sin(u),r=Math.sin(i),Mo.point=n})}function kt(){Mo.point=wt}function At(n){var t=n[0],e=n[1],r=Math.cos(e);return[r*Math.cos(t),r*Math.sin(t),Math.sin(e)]}function qt(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function Nt(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function Tt(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function Ct(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function zt(n){var t=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}function Dt(){return!0}function jt(n){return[Math.atan2(n[1],n[0]),Math.asin(Math.max(-1,Math.min(1,n[2])))]}function Lt(n,t){return Math.abs(n[0]-t[0])<Fa&&Math.abs(n[1]-t[1])<Fa}function Ft(n,t,e,r,u){var i=[],a=[];if(n.forEach(function(n){if(!((t=n.length-1)<=0)){var t,e=n[0],r=n[t];if(Lt(e,r)){u.lineStart();for(var o=0;t>o;++o)u.point((e=n[o])[0],e[1]);return void u.lineEnd()}var c={point:e,points:n,other:null,visited:!1,entry:!0,subject:!0},l={point:e,points:[e],other:c,visited:!1,entry:!1,subject:!1};c.other=l,i.push(c),a.push(l),c={point:r,points:[r],other:null,visited:!1,entry:!1,subject:!0},l={point:r,points:[r],other:c,visited:!1,entry:!0,subject:!1},c.other=l,i.push(c),a.push(l)}}),a.sort(t),Ht(i),Ht(a),i.length){if(e)for(var o=1,c=!e(a[0].point),l=a.length;l>o;++o)a[o].entry=c=!c;for(var f,s,h,g=i[0];;){for(f=g;f.visited;)if((f=f.next)===g)return;s=f.points,u.lineStart();do{if(f.visited=f.other.visited=!0,f.entry){if(f.subject)for(var o=0;o<s.length;o++)u.point((h=s[o])[0],h[1]);else r(f.point,f.next.point,1,u);f=f.next}else{if(f.subject){s=f.prev.points;for(var o=s.length;--o>=0;)u.point((h=s[o])[0],h[1])}else r(f.point,f.prev.point,-1,u);f=f.prev}f=f.other,s=f.points}while(!f.visited);u.lineEnd()}}}function Ht(n){if(t=n.length){for(var t,e,r=0,u=n[0];++r<t;)u.next=e=n[r],e.prev=u,u=e;u.next=e=n[0],e.prev=u}}function Pt(n,t,e){return function(r){function u(t,e){n(t,e)&&r.point(t,e)}function i(n,t){m.point(n,t)}function a(){v.point=i,m.lineStart()}function o(){v.point=u,m.lineEnd()}function c(n,t){M.point(n,t),d.push([n,t])}function l(){M.lineStart(),d=[]}function f(){c(d[0][0],d[0][1]),M.lineEnd();var n,t=M.clean(),e=y.buffer(),u=e.length;if(!u)return p=!0,g+=Yt(d,-1),void(d=null);if(d=null,1&t){n=e[0],h+=Yt(n,1);var i,u=n.length-1,a=-1;for(r.lineStart();++a<u;)r.point((i=n[a])[0],i[1]);return void r.lineEnd()}u>1&&2&t&&e.push(e.pop().concat(e.shift())),s.push(e.filter(Rt))}var s,h,g,p,d,m=t(r),v={point:u,lineStart:a,lineEnd:o,polygonStart:function(){v.point=c,v.lineStart=l,v.lineEnd=f,p=!1,g=h=0,s=[],r.polygonStart()},polygonEnd:function(){v.point=u,v.lineStart=a,v.lineEnd=o,s=oa.merge(s),s.length?Ft(s,Ut,null,e,r):(-Fa>h||p&&-Fa>g)&&(r.lineStart(),e(null,null,1,r),r.lineEnd()),r.polygonEnd(),s=null},sphere:function(){r.polygonStart(),r.lineStart(),e(null,null,1,r),r.lineEnd(),r.polygonEnd()}},y=Ot(),M=t(y);return v}}function Rt(n){return n.length>1}function Ot(){var n,t=[];return{lineStart:function(){t.push(n=[])},point:function(t,e){n.push([t,e])},lineEnd:N,buffer:function(){var e=t;return t=[],n=null,e},rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))}}}function Yt(n,t){if(!(e=n.length))return 0;for(var e,r,u,i=0,a=0,o=n[0],c=o[0],l=o[1],f=Math.cos(l),s=Math.atan2(t*Math.sin(c)*f,Math.sin(l)),h=1-t*Math.cos(c)*f,g=s;++i<e;)o=n[i],f=Math.cos(l=o[1]),r=Math.atan2(t*Math.sin(c=o[0])*f,Math.sin(l)),u=1-t*Math.cos(c)*f,Math.abs(h-2)<Fa&&Math.abs(u-2)<Fa||(Math.abs(u)<Fa||Math.abs(h)<Fa||(Math.abs(Math.abs(r-s)-La)<Fa?u+h>2&&(a+=4*(r-s)):a+=Math.abs(h-2)<Fa?4*(r-g):((3*La+r-s)%(2*La)-La)*(h+u)),g=s,s=r,h=u);return a}function Ut(n,t){return((n=n.point)[0]<0?n[1]-La/2-Fa:La/2-n[1])-((t=t.point)[0]<0?t[1]-La/2-Fa:La/2-t[1])}function It(n){var t,e=0/0,r=0/0,u=0/0;return{lineStart:function(){n.lineStart(),t=1},point:function(i,a){var o=i>0?La:-La,c=Math.abs(i-e);Math.abs(c-La)<Fa?(n.point(e,r=(r+a)/2>0?La/2:-La/2),n.point(u,r),n.lineEnd(),n.lineStart(),n.point(o,r),n.point(i,r),t=0):u!==o&&c>=La&&(Math.abs(e-u)<Fa&&(e-=u*Fa),Math.abs(i-o)<Fa&&(i-=o*Fa),r=Vt(e,r,i,a),n.point(u,r),n.lineEnd(),n.lineStart(),n.point(o,r),t=0),n.point(e=i,r=a),u=o},lineEnd:function(){n.lineEnd(),e=r=0/0},clean:function(){return 2-t}}}function Vt(n,t,e,r){var u,i,a=Math.sin(n-e);return Math.abs(a)>Fa?Math.atan((Math.sin(t)*(i=Math.cos(r))*Math.sin(e)-Math.sin(r)*(u=Math.cos(t))*Math.sin(n))/(u*i*a)):(t+r)/2}function Xt(n,t,e,r){var u;if(null==n)u=e*La/2,r.point(-La,u),r.point(0,u),r.point(La,u),r.point(La,0),r.point(La,-u),r.point(0,-u),r.point(-La,-u),r.point(-La,0),r.point(-La,u);else if(Math.abs(n[0]-t[0])>Fa){var i=(n[0]<t[0]?1:-1)*La;u=e*i/2,r.point(-i,u),r.point(0,u),r.point(i,u)}else r.point(t[0],t[1])}function Zt(n){function t(n,t){return Math.cos(n)*Math.cos(t)>i}function e(n){var e,i,c,l,f;return{lineStart:function(){l=c=!1,f=1},point:function(s,h){var g,p=[s,h],d=t(s,h),m=a?d?0:u(s,h):d?u(s+(0>s?La:-La),h):0;if(!e&&(l=c=d)&&n.lineStart(),d!==c&&(g=r(e,p),(Lt(e,g)||Lt(p,g))&&(p[0]+=Fa,p[1]+=Fa,d=t(p[0],p[1]))),d!==c)f=0,d?(n.lineStart(),g=r(p,e),n.point(g[0],g[1])):(g=r(e,p),n.point(g[0],g[1]),n.lineEnd()),e=g;else if(o&&e&&a^d){var v;m&i||!(v=r(p,e,!0))||(f=0,a?(n.lineStart(),n.point(v[0][0],v[0][1]),n.point(v[1][0],v[1][1]),n.lineEnd()):(n.point(v[1][0],v[1][1]),n.lineEnd(),n.lineStart(),n.point(v[0][0],v[0][1])))}!d||e&&Lt(e,p)||n.point(p[0],p[1]),e=p,c=d,i=m},lineEnd:function(){c&&n.lineEnd(),e=null},clean:function(){return f|(l&&c)<<1}}}function r(n,t,e){var r=At(n),u=At(t),a=[1,0,0],o=Nt(r,u),c=qt(o,o),l=o[0],f=c-l*l;if(!f)return!e&&n;var s=i*c/f,h=-i*l/f,g=Nt(a,o),p=Ct(a,s),d=Ct(o,h);Tt(p,d);var m=g,v=qt(p,m),y=qt(m,m),M=v*v-y*(qt(p,p)-1);if(!(0>M)){var x=Math.sqrt(M),b=Ct(m,(-v-x)/y);if(Tt(b,p),b=jt(b),!e)return b;var _,w=n[0],S=t[0],E=n[1],k=t[1];w>S&&(_=w,w=S,S=_);var A=S-w,q=Math.abs(A-La)<Fa,N=q||Fa>A;if(!q&&E>k&&(_=E,E=k,k=_),N?q?E+k>0^b[1]<(Math.abs(b[0]-w)<Fa?E:k):E<=b[1]&&b[1]<=k:A>La^(w<=b[0]&&b[0]<=S)){var T=Ct(m,(-v+x)/y);return Tt(T,p),[b,jt(T)]}}}function u(t,e){var r=a?n:La-n,u=0;return-r>t?u|=1:t>r&&(u|=2),-r>e?u|=4:e>r&&(u|=8),u}var i=Math.cos(n),a=i>0,o=Math.abs(i)>Fa,c=ie(n,6*Ha);return Pt(t,e,c)}function Bt(n,t,e,r){function u(r,u){return Math.abs(r[0]-n)<Fa?u>0?0:3:Math.abs(r[0]-e)<Fa?u>0?2:1:Math.abs(r[1]-t)<Fa?u>0?1:0:u>0?3:2}function i(n,t){return a(n.point,t.point)}function a(n,t){var e=u(n,1),r=u(t,1);return e!==r?e-r:0===e?t[1]-n[1]:1===e?n[0]-t[0]:2===e?n[1]-t[1]:t[0]-n[0]}function o(u,i){var a=i[0]-u[0],o=i[1]-u[1],c=[0,1];return Math.abs(a)<Fa&&Math.abs(o)<Fa?n<=u[0]&&u[0]<=e&&t<=u[1]&&u[1]<=r:$t(n-u[0],a,c)&&$t(u[0]-e,-a,c)&&$t(t-u[1],o,c)&&$t(u[1]-r,-o,c)?(c[1]<1&&(i[0]=u[0]+c[1]*a,i[1]=u[1]+c[1]*o),c[0]>0&&(u[0]+=c[0]*a,u[1]+=c[0]*o),!0):!1}return function(c){function l(i){var a=u(i,-1),o=f([0===a||3===a?n:e,a>1?r:t]);return o}function f(n){for(var t=0,e=M.length,r=n[1],u=0;e>u;++u)for(var i=1,a=M[u],o=a.length,c=a[0];o>i;++i)b=a[i],c[1]<=r?b[1]>r&&s(c,b,n)>0&&++t:b[1]<=r&&s(c,b,n)<0&&--t,c=b;return 0!==t}function s(n,t,e){return(t[0]-n[0])*(e[1]-n[1])-(e[0]-n[0])*(t[1]-n[1])}function h(i,o,c,l){var f=0,s=0;if(null==i||(f=u(i,c))!==(s=u(o,c))||a(i,o)<0^c>0){do l.point(0===f||3===f?n:e,f>1?r:t);while((f=(f+c+4)%4)!==s)}else l.point(o[0],o[1])}function g(u,i){return u>=n&&e>=u&&i>=t&&r>=i}function p(n,t){g(n,t)&&c.point(n,t)}function d(){C.point=v,M&&M.push(x=[]),q=!0,A=!1,E=k=0/0}function m(){y&&(v(_,w),S&&A&&T.rejoin(),y.push(T.buffer())),C.point=p,A&&c.lineEnd()}function v(n,t){n=Math.max(-bo,Math.min(bo,n)),t=Math.max(-bo,Math.min(bo,t));var e=g(n,t);if(M&&x.push([n,t]),q)_=n,w=t,S=e,q=!1,e&&(c.lineStart(),c.point(n,t));else if(e&&A)c.point(n,t);else{var r=[E,k],u=[n,t];o(r,u)?(A||(c.lineStart(),c.point(r[0],r[1])),c.point(u[0],u[1]),e||c.lineEnd()):(c.lineStart(),c.point(n,t))}E=n,k=t,A=e}var y,M,x,_,w,S,E,k,A,q,N=c,T=Ot(),C={point:p,lineStart:d,lineEnd:m,polygonStart:function(){c=T,y=[],M=[]},polygonEnd:function(){c=N,(y=oa.merge(y)).length?(c.polygonStart(),Ft(y,i,l,h,c),c.polygonEnd()):f([n,t])&&(c.polygonStart(),c.lineStart(),h(null,null,1,c),c.lineEnd(),c.polygonEnd()),y=M=x=null}};return C}}function $t(n,t,e){if(Math.abs(t)<Fa)return 0>=n;var r=n/t;if(t>0){if(r>e[1])return!1;r>e[0]&&(e[0]=r)}else{if(r<e[0])return!1;r<e[1]&&(e[1]=r)}return!0}function Jt(n,t){function e(e,r){return e=n(e,r),t(e[0],e[1])}return n.invert&&t.invert&&(e.invert=function(e,r){return e=t.invert(e,r),e&&n.invert(e[0],e[1])}),e}function Gt(n){function t(t){function r(e,r){e=n(e,r),t.point(e[0],e[1])}function i(){f=0/0,d.point=a,t.lineStart()}function a(r,i){var a=At([r,i]),o=n(r,i);e(f,s,l,h,g,p,f=o[0],s=o[1],l=r,h=a[0],g=a[1],p=a[2],u,t),t.point(f,s)}function o(){d.point=r,t.lineEnd()
}function c(){var n,r,c,m,v,y,M;i(),d.point=function(t,e){a(n=t,r=e),c=f,m=s,v=h,y=g,M=p,d.point=a},d.lineEnd=function(){e(f,s,l,h,g,p,c,m,n,v,y,M,u,t),d.lineEnd=o,o()}}var l,f,s,h,g,p,d={point:r,lineStart:i,lineEnd:o,polygonStart:function(){t.polygonStart(),d.lineStart=c},polygonEnd:function(){t.polygonEnd(),d.lineStart=i}};return d}function e(t,u,i,a,o,c,l,f,s,h,g,p,d,m){var v=l-t,y=f-u,M=v*v+y*y;if(M>4*r&&d--){var x=a+h,b=o+g,_=c+p,w=Math.sqrt(x*x+b*b+_*_),S=Math.asin(_/=w),E=Math.abs(Math.abs(_)-1)<Fa?(i+s)/2:Math.atan2(b,x),k=n(E,S),A=k[0],q=k[1],N=A-t,T=q-u,C=y*N-v*T;(C*C/M>r||Math.abs((v*N+y*T)/M-.5)>.3)&&(e(t,u,i,a,o,c,A,q,E,x/=w,b/=w,_,d,m),m.point(A,q),e(A,q,E,x,b,_,l,f,s,h,g,p,d,m))}}var r=.5,u=16;return t.precision=function(n){return arguments.length?(u=(r=n*n)>0&&16,t):Math.sqrt(r)},t}function Kt(n){return Wt(function(){return n})()}function Wt(n){function t(n){return n=a(n[0]*Ha,n[1]*Ha),[n[0]*f+o,c-n[1]*f]}function e(n){return n=a.invert((n[0]-o)/f,(c-n[1])/f),n&&[n[0]*Pa,n[1]*Pa]}function r(){a=Jt(i=te(d,m,v),u);var n=u(g,p);return o=s-n[0]*f,c=h+n[1]*f,t}var u,i,a,o,c,l=Gt(function(n,t){return n=u(n,t),[n[0]*f+o,c-n[1]*f]}),f=150,s=480,h=250,g=0,p=0,d=0,m=0,v=0,y=xo,M=ft,x=null,b=null;return t.stream=function(n){return Qt(i,y(l(M(n))))},t.clipAngle=function(n){return arguments.length?(y=null==n?(x=n,xo):Zt((x=+n)*Ha),t):x},t.clipExtent=function(n){return arguments.length?(b=n,M=null==n?ft:Bt(n[0][0],n[0][1],n[1][0],n[1][1]),t):b},t.scale=function(n){return arguments.length?(f=+n,r()):f},t.translate=function(n){return arguments.length?(s=+n[0],h=+n[1],r()):[s,h]},t.center=function(n){return arguments.length?(g=n[0]%360*Ha,p=n[1]%360*Ha,r()):[g*Pa,p*Pa]},t.rotate=function(n){return arguments.length?(d=n[0]%360*Ha,m=n[1]%360*Ha,v=n.length>2?n[2]%360*Ha:0,r()):[d*Pa,m*Pa,v*Pa]},oa.rebind(t,l,"precision"),function(){return u=n.apply(this,arguments),t.invert=u.invert&&e,r()}}function Qt(n,t){return{point:function(e,r){r=n(e*Ha,r*Ha),e=r[0],t.point(e>La?e-2*La:-La>e?e+2*La:e,r[1])},sphere:function(){t.sphere()},lineStart:function(){t.lineStart()},lineEnd:function(){t.lineEnd()},polygonStart:function(){t.polygonStart()},polygonEnd:function(){t.polygonEnd()}}}function ne(n,t){return[n,t]}function te(n,t,e){return n?t||e?Jt(re(n),ue(t,e)):re(n):t||e?ue(t,e):ne}function ee(n){return function(t,e){return t+=n,[t>La?t-2*La:-La>t?t+2*La:t,e]}}function re(n){var t=ee(n);return t.invert=ee(-n),t}function ue(n,t){function e(n,t){var e=Math.cos(t),o=Math.cos(n)*e,c=Math.sin(n)*e,l=Math.sin(t),f=l*r+o*u;return[Math.atan2(c*i-f*a,o*r-l*u),Math.asin(Math.max(-1,Math.min(1,f*i+c*a)))]}var r=Math.cos(n),u=Math.sin(n),i=Math.cos(t),a=Math.sin(t);return e.invert=function(n,t){var e=Math.cos(t),o=Math.cos(n)*e,c=Math.sin(n)*e,l=Math.sin(t),f=l*i-c*a;return[Math.atan2(c*i+l*a,o*r+f*u),Math.asin(Math.max(-1,Math.min(1,f*r-o*u)))]},e}function ie(n,t){var e=Math.cos(n),r=Math.sin(n);return function(u,i,a,o){null!=u?(u=ae(e,u),i=ae(e,i),(a>0?i>u:u>i)&&(u+=2*a*La)):(u=n+2*a*La,i=n);for(var c,l=a*t,f=u;a>0?f>i:i>f;f-=l)o.point((c=jt([e,-r*Math.cos(f),-r*Math.sin(f)]))[0],c[1])}}function ae(n,t){var e=At(t);e[0]-=n,zt(e);var r=O(-e[1]);return((-e[2]<0?-r:r)+2*Math.PI-Fa)%(2*Math.PI)}function oe(n,t,e){var r=oa.range(n,t-Fa,e).concat(t);return function(n){return r.map(function(t){return[n,t]})}}function ce(n,t,e){var r=oa.range(n,t-Fa,e).concat(t);return function(n){return r.map(function(t){return[t,n]})}}function le(n){return n.source}function fe(n){return n.target}function se(n,t,e,r){var u=Math.cos(t),i=Math.sin(t),a=Math.cos(r),o=Math.sin(r),c=u*Math.cos(n),l=u*Math.sin(n),f=a*Math.cos(e),s=a*Math.sin(e),h=2*Math.asin(Math.sqrt(V(r-t)+u*a*V(e-n))),g=1/Math.sin(h),p=h?function(n){var t=Math.sin(n*=h)*g,e=Math.sin(h-n)*g,r=e*c+t*f,u=e*l+t*s,a=e*i+t*o;return[Math.atan2(u,r)*Pa,Math.atan2(a,Math.sqrt(r*r+u*u))*Pa]}:function(){return[n*Pa,t*Pa]};return p.distance=h,p}function he(){function n(n,u){var i=Math.sin(u*=Ha),a=Math.cos(u),o=Math.abs((n*=Ha)-t),c=Math.cos(o);_o+=Math.atan2(Math.sqrt((o=a*Math.sin(o))*o+(o=r*i-e*a*c)*o),e*i+r*a*c),t=n,e=i,r=a}var t,e,r;wo.point=function(u,i){t=u*Ha,e=Math.sin(i*=Ha),r=Math.cos(i),wo.point=n},wo.lineEnd=function(){wo.point=wo.lineEnd=N}}function ge(n){var t=0,e=La/3,r=Wt(n),u=r(t,e);return u.parallels=function(n){return arguments.length?r(t=n[0]*La/180,e=n[1]*La/180):[180*(t/La),180*(e/La)]},u}function pe(n,t){function e(n,t){var e=Math.sqrt(i-2*u*Math.sin(t))/u;return[e*Math.sin(n*=u),a-e*Math.cos(n)]}var r=Math.sin(n),u=(r+Math.sin(t))/2,i=1+r*(2*u-r),a=Math.sqrt(i)/u;return e.invert=function(n,t){var e=a-t;return[Math.atan2(n,e)/u,Math.asin((i-(n*n+e*e)*u*u)/(2*u))]},e}function de(n,t){var e=n(t[0]),r=n([.5*(t[0][0]+t[1][0]),t[0][1]]),u=n([t[1][0],t[0][1]]),i=n(t[1]),a=r[1]-e[1],o=r[0]-e[0],c=u[1]-r[1],l=u[0]-r[0],f=a/o,s=c/l,h=.5*(f*s*(e[1]-u[1])+s*(e[0]+r[0])-f*(r[0]+u[0]))/(s-f),g=(.5*(e[0]+r[0])-h)/f+.5*(e[1]+r[1]),p=i[0]-h,d=i[1]-g,m=e[0]-h,v=e[1]-g,y=p*p+d*d,M=m*m+v*v,x=Math.atan2(d,p),b=Math.atan2(v,m);return function(t){var e=t[0]-h,r=t[1]-g,u=e*e+r*r,i=Math.atan2(r,e);return u>y&&M>u&&i>x&&b>i?n.invert(t):void 0}}function me(){function n(n,t){Eo+=u*n-r*t,r=n,u=t}var t,e,r,u;ko.point=function(i,a){ko.point=n,t=r=i,e=u=a},ko.lineEnd=function(){n(t,e)}}function ve(){function n(n,t){a.push("M",n,",",t,i)}function t(n,t){a.push("M",n,",",t),o.point=e}function e(n,t){a.push("L",n,",",t)}function r(){o.point=n}function u(){a.push("Z")}var i=we(4.5),a=[],o={point:n,lineStart:function(){o.point=t},lineEnd:r,polygonStart:function(){o.lineEnd=u},polygonEnd:function(){o.lineEnd=r,o.point=n},pointRadius:function(n){return i=we(n),o},result:function(){if(a.length){var n=a.join("");return a=[],n}}};return o}function ye(n,t){go||(mo+=n,vo+=t,++yo)}function Me(){function n(n,r){var u=n-t,i=r-e,a=Math.sqrt(u*u+i*i);mo+=a*(t+n)/2,vo+=a*(e+r)/2,yo+=a,t=n,e=r}var t,e;if(1!==go){if(!(1>go))return;go=1,mo=vo=yo=0}Ao.point=function(r,u){Ao.point=n,t=r,e=u}}function xe(){Ao.point=ye}function be(){function n(n,t){var e=u*n-r*t;mo+=e*(r+n),vo+=e*(u+t),yo+=3*e,r=n,u=t}var t,e,r,u;2>go&&(go=2,mo=vo=yo=0),Ao.point=function(i,a){Ao.point=n,t=r=i,e=u=a},Ao.lineEnd=function(){n(t,e)}}function _e(n){function t(t,e){n.moveTo(t,e),n.arc(t,e,a,0,2*La)}function e(t,e){n.moveTo(t,e),o.point=r}function r(t,e){n.lineTo(t,e)}function u(){o.point=t}function i(){n.closePath()}var a=4.5,o={point:t,lineStart:function(){o.point=e},lineEnd:u,polygonStart:function(){o.lineEnd=i},polygonEnd:function(){o.lineEnd=u,o.point=t},pointRadius:function(n){return a=n,o},result:N};return o}function we(n){return"m0,"+n+"a"+n+","+n+" 0 1,1 0,"+-2*n+"a"+n+","+n+" 0 1,1 0,"+2*n+"z"}function Se(n){var t=Gt(function(t,e){return n([t*Pa,e*Pa])});return function(n){return n=t(n),{point:function(t,e){n.point(t*Ha,e*Ha)},sphere:function(){n.sphere()},lineStart:function(){n.lineStart()},lineEnd:function(){n.lineEnd()},polygonStart:function(){n.polygonStart()},polygonEnd:function(){n.polygonEnd()}}}}function Ee(n,t){function e(t,e){var r=Math.cos(t),u=Math.cos(e),i=n(r*u);return[i*u*Math.sin(t),i*Math.sin(e)]}return e.invert=function(n,e){var r=Math.sqrt(n*n+e*e),u=t(r),i=Math.sin(u),a=Math.cos(u);return[Math.atan2(n*i,r*a),Math.asin(r&&e*i/r)]},e}function ke(n,t){function e(n,t){var e=Math.abs(Math.abs(t)-La/2)<Fa?0:a/Math.pow(u(t),i);return[e*Math.sin(i*n),a-e*Math.cos(i*n)]}var r=Math.cos(n),u=function(n){return Math.tan(La/4+n/2)},i=n===t?Math.sin(n):Math.log(r/Math.cos(t))/Math.log(u(t)/u(n)),a=r*Math.pow(u(n),i)/i;return i?(e.invert=function(n,t){var e=a-t,r=R(i)*Math.sqrt(n*n+e*e);return[Math.atan2(n,e)/i,2*Math.atan(Math.pow(a/r,1/i))-La/2]},e):qe}function Ae(n,t){function e(n,t){var e=i-t;return[e*Math.sin(u*n),i-e*Math.cos(u*n)]}var r=Math.cos(n),u=n===t?Math.sin(n):(r-Math.cos(t))/(t-n),i=r/u+n;return Math.abs(u)<Fa?ne:(e.invert=function(n,t){var e=i-t;return[Math.atan2(n,e)/u,i-R(u)*Math.sqrt(n*n+e*e)]},e)}function qe(n,t){return[n,Math.log(Math.tan(La/4+t/2))]}function Ne(n){var t,e=Kt(n),r=e.scale,u=e.translate,i=e.clipExtent;return e.scale=function(){var n=r.apply(e,arguments);return n===e?t?e.clipExtent(null):e:n},e.translate=function(){var n=u.apply(e,arguments);return n===e?t?e.clipExtent(null):e:n},e.clipExtent=function(n){var a=i.apply(e,arguments);if(a===e){if(t=null==n){var o=La*r(),c=u();i([[c[0]-o,c[1]-o],[c[0]+o,c[1]+o]])}}else t&&(a=null);return a},e.clipExtent(null)}function Te(n,t){var e=Math.cos(t)*Math.sin(n);return[Math.log((1+e)/(1-e))/2,Math.atan2(Math.tan(t),Math.cos(n))]}function Ce(n){function t(t){function a(){l.push("M",i(n(f),o))}for(var c,l=[],f=[],s=-1,h=t.length,g=lt(e),p=lt(r);++s<h;)u.call(this,c=t[s],s)?f.push([+g.call(this,c,s),+p.call(this,c,s)]):f.length&&(a(),f=[]);return f.length&&a(),l.length?l.join(""):null}var e=ze,r=De,u=Dt,i=je,a=i.key,o=.7;return t.x=function(n){return arguments.length?(e=n,t):e},t.y=function(n){return arguments.length?(r=n,t):r},t.defined=function(n){return arguments.length?(u=n,t):u},t.interpolate=function(n){return arguments.length?(a="function"==typeof n?i=n:(i=Do.get(n)||je).key,t):a},t.tension=function(n){return arguments.length?(o=n,t):o},t}function ze(n){return n[0]}function De(n){return n[1]}function je(n){return n.join("L")}function Le(n){return je(n)+"Z"}function Fe(n){for(var t=0,e=n.length,r=n[0],u=[r[0],",",r[1]];++t<e;)u.push("V",(r=n[t])[1],"H",r[0]);return u.join("")}function He(n){for(var t=0,e=n.length,r=n[0],u=[r[0],",",r[1]];++t<e;)u.push("H",(r=n[t])[0],"V",r[1]);return u.join("")}function Pe(n,t){return n.length<4?je(n):n[1]+Ye(n.slice(1,n.length-1),Ue(n,t))}function Re(n,t){return n.length<3?je(n):n[0]+Ye((n.push(n[0]),n),Ue([n[n.length-2]].concat(n,[n[1]]),t))}function Oe(n,t){return n.length<3?je(n):n[0]+Ye(n,Ue(n,t))}function Ye(n,t){if(t.length<1||n.length!=t.length&&n.length!=t.length+2)return je(n);var e=n.length!=t.length,r="",u=n[0],i=n[1],a=t[0],o=a,c=1;if(e&&(r+="Q"+(i[0]-2*a[0]/3)+","+(i[1]-2*a[1]/3)+","+i[0]+","+i[1],u=n[1],c=2),t.length>1){o=t[1],i=n[c],c++,r+="C"+(u[0]+a[0])+","+(u[1]+a[1])+","+(i[0]-o[0])+","+(i[1]-o[1])+","+i[0]+","+i[1];for(var l=2;l<t.length;l++,c++)i=n[c],o=t[l],r+="S"+(i[0]-o[0])+","+(i[1]-o[1])+","+i[0]+","+i[1]}if(e){var f=n[c];r+="Q"+(i[0]+2*o[0]/3)+","+(i[1]+2*o[1]/3)+","+f[0]+","+f[1]}return r}function Ue(n,t){for(var e,r=[],u=(1-t)/2,i=n[0],a=n[1],o=1,c=n.length;++o<c;)e=i,i=a,a=n[o],r.push([u*(a[0]-e[0]),u*(a[1]-e[1])]);return r}function Ie(n){if(n.length<3)return je(n);var t=1,e=n.length,r=n[0],u=r[0],i=r[1],a=[u,u,u,(r=n[1])[0]],o=[i,i,i,r[1]],c=[u,",",i];for($e(c,a,o);++t<e;)r=n[t],a.shift(),a.push(r[0]),o.shift(),o.push(r[1]),$e(c,a,o);for(t=-1;++t<2;)a.shift(),a.push(r[0]),o.shift(),o.push(r[1]),$e(c,a,o);return c.join("")}function Ve(n){if(n.length<4)return je(n);for(var t,e=[],r=-1,u=n.length,i=[0],a=[0];++r<3;)t=n[r],i.push(t[0]),a.push(t[1]);for(e.push(Be(Fo,i)+","+Be(Fo,a)),--r;++r<u;)t=n[r],i.shift(),i.push(t[0]),a.shift(),a.push(t[1]),$e(e,i,a);return e.join("")}function Xe(n){for(var t,e,r=-1,u=n.length,i=u+4,a=[],o=[];++r<4;)e=n[r%u],a.push(e[0]),o.push(e[1]);for(t=[Be(Fo,a),",",Be(Fo,o)],--r;++r<i;)e=n[r%u],a.shift(),a.push(e[0]),o.shift(),o.push(e[1]),$e(t,a,o);return t.join("")}function Ze(n,t){var e=n.length-1;if(e)for(var r,u,i=n[0][0],a=n[0][1],o=n[e][0]-i,c=n[e][1]-a,l=-1;++l<=e;)r=n[l],u=l/e,r[0]=t*r[0]+(1-t)*(i+u*o),r[1]=t*r[1]+(1-t)*(a+u*c);return Ie(n)}function Be(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]}function $e(n,t,e){n.push("C",Be(jo,t),",",Be(jo,e),",",Be(Lo,t),",",Be(Lo,e),",",Be(Fo,t),",",Be(Fo,e))}function Je(n,t){return(t[1]-n[1])/(t[0]-n[0])}function Ge(n){for(var t=0,e=n.length-1,r=[],u=n[0],i=n[1],a=r[0]=Je(u,i);++t<e;)r[t]=(a+(a=Je(u=i,i=n[t+1])))/2;return r[t]=a,r}function Ke(n){for(var t,e,r,u,i=[],a=Ge(n),o=-1,c=n.length-1;++o<c;)t=Je(n[o],n[o+1]),Math.abs(t)<1e-6?a[o]=a[o+1]=0:(e=a[o]/t,r=a[o+1]/t,u=e*e+r*r,u>9&&(u=3*t/Math.sqrt(u),a[o]=u*e,a[o+1]=u*r));for(o=-1;++o<=c;)u=(n[Math.min(c,o+1)][0]-n[Math.max(0,o-1)][0])/(6*(1+a[o]*a[o])),i.push([u||0,a[o]*u||0]);return i}function We(n){return n.length<3?je(n):n[0]+Ye(n,Ke(n))}function Qe(n,t,e,r){var u,i,a,o,c,l,f;return u=r[n],i=u[0],a=u[1],u=r[t],o=u[0],c=u[1],u=r[e],l=u[0],f=u[1],(f-a)*(o-i)-(c-a)*(l-i)>0}function nr(n,t,e){return(e[0]-t[0])*(n[1]-t[1])<(e[1]-t[1])*(n[0]-t[0])}function tr(n,t,e,r){var u=n[0],i=e[0],a=t[0]-u,o=r[0]-i,c=n[1],l=e[1],f=t[1]-c,s=r[1]-l,h=(o*(c-l)-s*(u-i))/(s*a-o*f);return[u+h*a,c+h*f]}function er(n,t){var e={list:n.map(function(n,t){return{index:t,x:n[0],y:n[1]}}).sort(function(n,t){return n.y<t.y?-1:n.y>t.y?1:n.x<t.x?-1:n.x>t.x?1:0}),bottomSite:null},r={list:[],leftEnd:null,rightEnd:null,init:function(){r.leftEnd=r.createHalfEdge(null,"l"),r.rightEnd=r.createHalfEdge(null,"l"),r.leftEnd.r=r.rightEnd,r.rightEnd.l=r.leftEnd,r.list.unshift(r.leftEnd,r.rightEnd)},createHalfEdge:function(n,t){return{edge:n,side:t,vertex:null,l:null,r:null}},insert:function(n,t){t.l=n,t.r=n.r,n.r.l=t,n.r=t},leftBound:function(n){var t=r.leftEnd;do t=t.r;while(t!=r.rightEnd&&u.rightOf(t,n));return t=t.l},del:function(n){n.l.r=n.r,n.r.l=n.l,n.edge=null},right:function(n){return n.r},left:function(n){return n.l},leftRegion:function(n){return null==n.edge?e.bottomSite:n.edge.region[n.side]},rightRegion:function(n){return null==n.edge?e.bottomSite:n.edge.region[Ho[n.side]]}},u={bisect:function(n,t){var e={region:{l:n,r:t},ep:{l:null,r:null}},r=t.x-n.x,u=t.y-n.y,i=r>0?r:-r,a=u>0?u:-u;return e.c=n.x*r+n.y*u+.5*(r*r+u*u),i>a?(e.a=1,e.b=u/r,e.c/=r):(e.b=1,e.a=r/u,e.c/=u),e},intersect:function(n,t){var e=n.edge,r=t.edge;if(!e||!r||e.region.r==r.region.r)return null;var u=e.a*r.b-e.b*r.a;if(Math.abs(u)<1e-10)return null;var i,a,o=(e.c*r.b-r.c*e.b)/u,c=(r.c*e.a-e.c*r.a)/u,l=e.region.r,f=r.region.r;l.y<f.y||l.y==f.y&&l.x<f.x?(i=n,a=e):(i=t,a=r);var s=o>=a.region.r.x;return s&&"l"===i.side||!s&&"r"===i.side?null:{x:o,y:c}},rightOf:function(n,t){var e=n.edge,r=e.region.r,u=t.x>r.x;if(u&&"l"===n.side)return 1;if(!u&&"r"===n.side)return 0;if(1===e.a){var i=t.y-r.y,a=t.x-r.x,o=0,c=0;if(!u&&e.b<0||u&&e.b>=0?c=o=i>=e.b*a:(c=t.x+t.y*e.b>e.c,e.b<0&&(c=!c),c||(o=1)),!o){var l=r.x-e.region.l.x;c=e.b*(a*a-i*i)<l*i*(1+2*a/l+e.b*e.b),e.b<0&&(c=!c)}}else{var f=e.c-e.a*t.x,s=t.y-f,h=t.x-r.x,g=f-r.y;c=s*s>h*h+g*g}return"l"===n.side?c:!c},endPoint:function(n,e,r){n.ep[e]=r,n.ep[Ho[e]]&&t(n)},distance:function(n,t){var e=n.x-t.x,r=n.y-t.y;return Math.sqrt(e*e+r*r)}},i={list:[],insert:function(n,t,e){n.vertex=t,n.ystar=t.y+e;for(var r=0,u=i.list,a=u.length;a>r;r++){var o=u[r];if(!(n.ystar>o.ystar||n.ystar==o.ystar&&t.x>o.vertex.x))break}u.splice(r,0,n)},del:function(n){for(var t=0,e=i.list,r=e.length;r>t&&e[t]!=n;++t);e.splice(t,1)},empty:function(){return 0===i.list.length},nextEvent:function(n){for(var t=0,e=i.list,r=e.length;r>t;++t)if(e[t]==n)return e[t+1];return null},min:function(){var n=i.list[0];return{x:n.vertex.x,y:n.ystar}},extractMin:function(){return i.list.shift()}};r.init(),e.bottomSite=e.list.shift();for(var a,o,c,l,f,s,h,g,p,d,m,v,y,M=e.list.shift();;)if(i.empty()||(a=i.min()),M&&(i.empty()||M.y<a.y||M.y==a.y&&M.x<a.x))o=r.leftBound(M),c=r.right(o),h=r.rightRegion(o),v=u.bisect(h,M),s=r.createHalfEdge(v,"l"),r.insert(o,s),d=u.intersect(o,s),d&&(i.del(o),i.insert(o,d,u.distance(d,M))),o=s,s=r.createHalfEdge(v,"r"),r.insert(o,s),d=u.intersect(s,c),d&&i.insert(s,d,u.distance(d,M)),M=e.list.shift();else{if(i.empty())break;o=i.extractMin(),l=r.left(o),c=r.right(o),f=r.right(c),h=r.leftRegion(o),g=r.rightRegion(c),m=o.vertex,u.endPoint(o.edge,o.side,m),u.endPoint(c.edge,c.side,m),r.del(o),i.del(c),r.del(c),y="l",h.y>g.y&&(p=h,h=g,g=p,y="r"),v=u.bisect(h,g),s=r.createHalfEdge(v,y),r.insert(l,s),u.endPoint(v,Ho[y],m),d=u.intersect(l,s),d&&(i.del(l),i.insert(l,d,u.distance(d,h))),d=u.intersect(s,f),d&&i.insert(s,d,u.distance(d,h))}for(o=r.right(r.leftEnd);o!=r.rightEnd;o=r.right(o))t(o.edge)}function rr(n){return n.x}function ur(n){return n.y}function ir(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function ar(n,t,e,r,u,i){if(!n(t,e,r,u,i)){var a=.5*(e+u),o=.5*(r+i),c=t.nodes;c[0]&&ar(n,c[0],e,r,a,o),c[1]&&ar(n,c[1],a,r,u,o),c[2]&&ar(n,c[2],e,o,a,i),c[3]&&ar(n,c[3],a,o,u,i)}}function or(n,t){n=oa.rgb(n),t=oa.rgb(t);var e=n.r,r=n.g,u=n.b,i=t.r-e,a=t.g-r,o=t.b-u;return function(n){return"#"+rt(Math.round(e+i*n))+rt(Math.round(r+a*n))+rt(Math.round(u+o*n))}}function cr(n){var t=[n.a,n.b],e=[n.c,n.d],r=fr(t),u=lr(t,e),i=fr(sr(e,t,-u))||0;t[0]*e[1]<e[0]*t[1]&&(t[0]*=-1,t[1]*=-1,r*=-1,u*=-1),this.rotate=(r?Math.atan2(t[1],t[0]):Math.atan2(-e[0],e[1]))*Pa,this.translate=[n.e,n.f],this.scale=[r,i],this.skew=i?Math.atan2(u,i)*Pa:0}function lr(n,t){return n[0]*t[0]+n[1]*t[1]}function fr(n){var t=Math.sqrt(lr(n,n));return t&&(n[0]/=t,n[1]/=t),t}function sr(n,t,e){return n[0]+=e*t[0],n[1]+=e*t[1],n}function hr(n,t){return t-=n,function(e){return n+t*e}}function gr(n,t){var e,r=[],u=[],i=oa.transform(n),a=oa.transform(t),o=i.translate,c=a.translate,l=i.rotate,f=a.rotate,s=i.skew,h=a.skew,g=i.scale,p=a.scale;return o[0]!=c[0]||o[1]!=c[1]?(r.push("translate(",null,",",null,")"),u.push({i:1,x:hr(o[0],c[0])},{i:3,x:hr(o[1],c[1])})):r.push(c[0]||c[1]?"translate("+c+")":""),l!=f?(l-f>180?f+=360:f-l>180&&(l+=360),u.push({i:r.push(r.pop()+"rotate(",null,")")-2,x:hr(l,f)})):f&&r.push(r.pop()+"rotate("+f+")"),s!=h?u.push({i:r.push(r.pop()+"skewX(",null,")")-2,x:hr(s,h)}):h&&r.push(r.pop()+"skewX("+h+")"),g[0]!=p[0]||g[1]!=p[1]?(e=r.push(r.pop()+"scale(",null,",",null,")"),u.push({i:e-4,x:hr(g[0],p[0])},{i:e-2,x:hr(g[1],p[1])})):(1!=p[0]||1!=p[1])&&r.push(r.pop()+"scale("+p+")"),e=u.length,function(n){for(var t,i=-1;++i<e;)r[(t=u[i]).i]=t.x(n);return r.join("")}}function pr(n,t){var e,r={},u={};for(e in n)e in t?r[e]=vr(e)(n[e],t[e]):u[e]=n[e];for(e in t)e in n||(u[e]=t[e]);return function(n){for(e in r)u[e]=r[e](n);return u}}function dr(n,t){var e,r,u,i,a,o=0,c=0,l=[],f=[];for(Ro.lastIndex=0,r=0;e=Ro.exec(t);++r)e.index&&l.push(t.substring(o,c=e.index)),f.push({i:l.length,x:e[0]}),l.push(null),o=Ro.lastIndex;for(o<t.length&&l.push(t.substring(o)),r=0,i=f.length;(e=Ro.exec(n))&&i>r;++r)if(a=f[r],a.x==e[0]){if(a.i)if(null==l[a.i+1])for(l[a.i-1]+=a.x,l.splice(a.i,1),u=r+1;i>u;++u)f[u].i--;else for(l[a.i-1]+=a.x+l[a.i+1],l.splice(a.i,2),u=r+1;i>u;++u)f[u].i-=2;else if(null==l[a.i+1])l[a.i]=a.x;else for(l[a.i]=a.x+l[a.i+1],l.splice(a.i+1,1),u=r+1;i>u;++u)f[u].i--;f.splice(r,1),i--,r--}else a.x=hr(parseFloat(e[0]),parseFloat(a.x));for(;i>r;)a=f.pop(),null==l[a.i+1]?l[a.i]=a.x:(l[a.i]=a.x+l[a.i+1],l.splice(a.i+1,1)),i--;return 1===l.length?null==l[0]?f[0].x:function(){return t}:function(n){for(r=0;i>r;++r)l[(a=f[r]).i]=a.x(n);return l.join("")}}function mr(n,t){for(var e,r=oa.interpolators.length;--r>=0&&!(e=oa.interpolators[r](n,t)););return e}function vr(n){return"transform"==n?gr:mr}function yr(n,t){var e,r=[],u=[],i=n.length,a=t.length,o=Math.min(n.length,t.length);for(e=0;o>e;++e)r.push(mr(n[e],t[e]));for(;i>e;++e)u[e]=n[e];for(;a>e;++e)u[e]=t[e];return function(n){for(e=0;o>e;++e)u[e]=r[e](n);return u}}function Mr(n){return function(t){return 0>=t?0:t>=1?1:n(t)}}function xr(n){return function(t){return 1-n(1-t)}}function br(n){return function(t){return.5*(.5>t?n(2*t):2-n(2-2*t))}}function _r(n){return n*n}function wr(n){return n*n*n}function Sr(n){if(0>=n)return 0;if(n>=1)return 1;var t=n*n,e=t*n;return 4*(.5>n?e:3*(n-t)+e-.75)}function Er(n){return function(t){return Math.pow(t,n)}}function kr(n){return 1-Math.cos(n*La/2)}function Ar(n){return Math.pow(2,10*(n-1))}function qr(n){return 1-Math.sqrt(1-n*n)}function Nr(n,t){var e;return arguments.length<2&&(t=.45),arguments.length?e=t/(2*La)*Math.asin(1/n):(n=1,e=t/4),function(r){return 1+n*Math.pow(2,10*-r)*Math.sin(2*(r-e)*La/t)}}function Tr(n){return n||(n=1.70158),function(t){return t*t*((n+1)*t-n)}}function Cr(n){return 1/2.75>n?7.5625*n*n:2/2.75>n?7.5625*(n-=1.5/2.75)*n+.75:2.5/2.75>n?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375}function zr(n,t){n=oa.hcl(n),t=oa.hcl(t);var e=n.h,r=n.c,u=n.l,i=t.h-e,a=t.c-r,o=t.l-u;return i>180?i-=360:-180>i&&(i+=360),function(n){return B(e+i*n,r+a*n,u+o*n)+""}}function Dr(n,t){n=oa.hsl(n),t=oa.hsl(t);var e=n.h,r=n.s,u=n.l,i=t.h-e,a=t.s-r,o=t.l-u;return i>180?i-=360:-180>i&&(i+=360),function(n){return P(e+i*n,r+a*n,u+o*n)+""}}function jr(n,t){n=oa.lab(n),t=oa.lab(t);var e=n.l,r=n.a,u=n.b,i=t.l-e,a=t.a-r,o=t.b-u;return function(n){return G(e+i*n,r+a*n,u+o*n)+""}}function Lr(n,t){return t-=n,function(e){return Math.round(n+t*e)}}function Fr(n,t){return t=t-(n=+n)?1/(t-n):0,function(e){return(e-n)*t}}function Hr(n,t){return t=t-(n=+n)?1/(t-n):0,function(e){return Math.max(0,Math.min(1,(e-n)*t))}}function Pr(n){for(var t=n.source,e=n.target,r=Or(t,e),u=[t];t!==r;)t=t.parent,u.push(t);for(var i=u.length;e!==r;)u.splice(i,0,e),e=e.parent;return u}function Rr(n){for(var t=[],e=n.parent;null!=e;)t.push(n),n=e,e=e.parent;return t.push(n),t}function Or(n,t){if(n===t)return n;for(var e=Rr(n),r=Rr(t),u=e.pop(),i=r.pop(),a=null;u===i;)a=u,u=e.pop(),i=r.pop();return a}function Yr(n){n.fixed|=2}function Ur(n){n.fixed&=-7}function Ir(n){n.fixed|=4,n.px=n.x,n.py=n.y}function Vr(n){n.fixed&=-5}function Xr(n,t,e){var r=0,u=0;if(n.charge=0,!n.leaf)for(var i,a=n.nodes,o=a.length,c=-1;++c<o;)i=a[c],null!=i&&(Xr(i,t,e),n.charge+=i.charge,r+=i.charge*i.cx,u+=i.charge*i.cy);if(n.point){n.leaf||(n.point.x+=Math.random()-.5,n.point.y+=Math.random()-.5);var l=t*e[n.point.index];n.charge+=n.pointCharge=l,r+=l*n.point.x,u+=l*n.point.y}n.cx=r/n.charge,n.cy=u/n.charge}function Zr(n,t){return oa.rebind(n,t,"sort","children","value"),n.nodes=n,n.links=Gr,n}function Br(n){return n.children}function $r(n){return n.value}function Jr(n,t){return t.value-n.value}function Gr(n){return oa.merge(n.map(function(n){return(n.children||[]).map(function(t){return{source:n,target:t}})}))}function Kr(n){return n.x}function Wr(n){return n.y}function Qr(n,t,e){n.y0=t,n.y=e}function nu(n){return oa.range(n.length)}function tu(n){for(var t=-1,e=n[0].length,r=[];++t<e;)r[t]=0;return r}function eu(n){for(var t,e=1,r=0,u=n[0][1],i=n.length;i>e;++e)(t=n[e][1])>u&&(r=e,u=t);return r}function ru(n){return n.reduce(uu,0)}function uu(n,t){return n+t[1]}function iu(n,t){return au(n,Math.ceil(Math.log(t.length)/Math.LN2+1))}function au(n,t){for(var e=-1,r=+n[0],u=(n[1]-r)/t,i=[];++e<=t;)i[e]=u*e+r;return i}function ou(n){return[oa.min(n),oa.max(n)]}function cu(n,t){return n.parent==t.parent?1:2}function lu(n){var t=n.children;return t&&t.length?t[0]:n._tree.thread}function fu(n){var t,e=n.children;return e&&(t=e.length)?e[t-1]:n._tree.thread}function su(n,t){var e=n.children;if(e&&(u=e.length))for(var r,u,i=-1;++i<u;)t(r=su(e[i],t),n)>0&&(n=r);return n}function hu(n,t){return n.x-t.x}function gu(n,t){return t.x-n.x}function pu(n,t){return n.depth-t.depth}function du(n,t){function e(n,r){var u=n.children;if(u&&(a=u.length))for(var i,a,o=null,c=-1;++c<a;)i=u[c],e(i,o),o=i;t(n,r)}e(n,null)}function mu(n){for(var t,e=0,r=0,u=n.children,i=u.length;--i>=0;)t=u[i]._tree,t.prelim+=e,t.mod+=e,e+=t.shift+(r+=t.change)}function vu(n,t,e){n=n._tree,t=t._tree;var r=e/(t.number-n.number);n.change+=r,t.change-=r,t.shift+=e,t.prelim+=e,t.mod+=e}function yu(n,t,e){return n._tree.ancestor.parent==t.parent?n._tree.ancestor:e}function Mu(n,t){return n.value-t.value}function xu(n,t){var e=n._pack_next;n._pack_next=t,t._pack_prev=n,t._pack_next=e,e._pack_prev=t}function bu(n,t){n._pack_next=t,t._pack_prev=n}function _u(n,t){var e=t.x-n.x,r=t.y-n.y,u=n.r+t.r;return u*u-e*e-r*r>.001}function wu(n){function t(n){f=Math.min(n.x-n.r,f),s=Math.max(n.x+n.r,s),h=Math.min(n.y-n.r,h),g=Math.max(n.y+n.r,g)}if((e=n.children)&&(l=e.length)){var e,r,u,i,a,o,c,l,f=1/0,s=-1/0,h=1/0,g=-1/0;if(e.forEach(Su),r=e[0],r.x=-r.r,r.y=0,t(r),l>1&&(u=e[1],u.x=u.r,u.y=0,t(u),l>2))for(i=e[2],Au(r,u,i),t(i),xu(r,i),r._pack_prev=i,xu(i,u),u=r._pack_next,a=3;l>a;a++){Au(r,u,i=e[a]);var p=0,d=1,m=1;for(o=u._pack_next;o!==u;o=o._pack_next,d++)if(_u(o,i)){p=1;break}if(1==p)for(c=r._pack_prev;c!==o._pack_prev&&!_u(c,i);c=c._pack_prev,m++);p?(m>d||d==m&&u.r<r.r?bu(r,u=o):bu(r=c,u),a--):(xu(r,i),u=i,t(i))}var v=(f+s)/2,y=(h+g)/2,M=0;for(a=0;l>a;a++)i=e[a],i.x-=v,i.y-=y,M=Math.max(M,i.r+Math.sqrt(i.x*i.x+i.y*i.y));n.r=M,e.forEach(Eu)}}function Su(n){n._pack_next=n._pack_prev=n}function Eu(n){delete n._pack_next,delete n._pack_prev}function ku(n,t,e,r){var u=n.children;if(n.x=t+=r*n.x,n.y=e+=r*n.y,n.r*=r,u)for(var i=-1,a=u.length;++i<a;)ku(u[i],t,e,r)}function Au(n,t,e){var r=n.r+e.r,u=t.x-n.x,i=t.y-n.y;if(r&&(u||i)){var a=t.r+e.r,o=u*u+i*i;a*=a,r*=r;var c=.5+(r-a)/(2*o),l=Math.sqrt(Math.max(0,2*a*(r+o)-(r-=o)*r-a*a))/(2*o);e.x=n.x+c*u+l*i,e.y=n.y+c*i-l*u}else e.x=n.x+r,e.y=n.y}function qu(n){return 1+oa.max(n,function(n){return n.y})}function Nu(n){return n.reduce(function(n,t){return n+t.x},0)/n.length}function Tu(n){var t=n.children;return t&&t.length?Tu(t[0]):n}function Cu(n){var t,e=n.children;return e&&(t=e.length)?Cu(e[t-1]):n}function zu(n){return{x:n.x,y:n.y,dx:n.dx,dy:n.dy}}function Du(n,t){var e=n.x+t[3],r=n.y+t[0],u=n.dx-t[1]-t[3],i=n.dy-t[0]-t[2];return 0>u&&(e+=u/2,u=0),0>i&&(r+=i/2,i=0),{x:e,y:r,dx:u,dy:i}}function ju(n){var t=n[0],e=n[n.length-1];return e>t?[t,e]:[e,t]}function Lu(n){return n.rangeExtent?n.rangeExtent():ju(n.range())}function Fu(n,t,e,r){var u=e(n[0],n[1]),i=r(t[0],t[1]);return function(n){return i(u(n))}}function Hu(n,t){var e,r=0,u=n.length-1,i=n[r],a=n[u];return i>a&&(e=r,r=u,u=e,e=i,i=a,a=e),(t=t(a-i))&&(n[r]=t.floor(i),n[u]=t.ceil(a)),n}function Pu(n,t,e,r){var u=[],i=[],a=0,o=Math.min(n.length,t.length)-1;for(n[o]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++a<=o;)u.push(e(n[a-1],n[a])),i.push(r(t[a-1],t[a]));return function(t){var e=oa.bisect(n,t,1,o)-1;return i[e](u[e](t))}}function Ru(n,t,e,r){function u(){var u=Math.min(n.length,t.length)>2?Pu:Fu,c=r?Hr:Fr;return a=u(n,t,c,e),o=u(t,n,c,mr),i}function i(n){return a(n)}var a,o;return i.invert=function(n){return o(n)},i.domain=function(t){return arguments.length?(n=t.map(Number),u()):n},i.range=function(n){return arguments.length?(t=n,u()):t},i.rangeRound=function(n){return i.range(n).interpolate(Lr)},i.clamp=function(n){return arguments.length?(r=n,u()):r},i.interpolate=function(n){return arguments.length?(e=n,u()):e},i.ticks=function(t){return Iu(n,t)},i.tickFormat=function(t,e){return Vu(n,t,e)},i.nice=function(){return Hu(n,Yu),u()},i.copy=function(){return Ru(n,t,e,r)},u()}function Ou(n,t){return oa.rebind(n,t,"range","rangeRound","interpolate","clamp")}function Yu(n){return n=Math.pow(10,Math.round(Math.log(n)/Math.LN10)-1),n&&{floor:function(t){return Math.floor(t/n)*n},ceil:function(t){return Math.ceil(t/n)*n}}}function Uu(n,t){var e=ju(n),r=e[1]-e[0],u=Math.pow(10,Math.floor(Math.log(r/t)/Math.LN10)),i=t/r*u;return.15>=i?u*=10:.35>=i?u*=5:.75>=i&&(u*=2),e[0]=Math.ceil(e[0]/u)*u,e[1]=Math.floor(e[1]/u)*u+.5*u,e[2]=u,e}function Iu(n,t){return oa.range.apply(oa,Uu(n,t))}function Vu(n,t,e){var r=-Math.floor(Math.log(Uu(n,t)[2])/Math.LN10+.01);return oa.format(e?e.replace(ro,function(n,t,e,u,i,a,o,c,l,f){return[t,e,u,i,a,o,c,l||"."+(r-2*("%"===f)),f].join("")}):",."+r+"f")}function Xu(n,t,e,r){function u(t){return n(e(t))}return u.invert=function(t){return r(n.invert(t))},u.domain=function(t){return arguments.length?(t[0]<0?(e=$u,r=Ju):(e=Zu,r=Bu),n.domain(t.map(e)),u):n.domain().map(r)},u.base=function(n){return arguments.length?(t=+n,u):t},u.nice=function(){return n.domain(Hu(n.domain(),Gu(t))),u},u.ticks=function(){var u=ju(n.domain()),i=[];if(u.every(isFinite)){var a=Math.log(t),o=Math.floor(u[0]/a),c=Math.ceil(u[1]/a),l=r(u[0]),f=r(u[1]),s=t%1?2:t;if(e===$u)for(i.push(-Math.pow(t,-o));o++<c;)for(var h=s-1;h>0;h--)i.push(-Math.pow(t,-o)*h);else{for(;c>o;o++)for(var h=1;s>h;h++)i.push(Math.pow(t,o)*h);i.push(Math.pow(t,o))}for(o=0;i[o]<l;o++);for(c=i.length;i[c-1]>f;c--);i=i.slice(o,c)}return i},u.tickFormat=function(n,i){if(arguments.length<2&&(i=$o),!arguments.length)return i;var a,o=Math.log(t),c=Math.max(.1,n/u.ticks().length),l=e===$u?(a=-1e-12,Math.floor):(a=1e-12,Math.ceil);return function(n){return n/r(o*l(e(n)/o+a))<=c?i(n):""}},u.copy=function(){return Xu(n.copy(),t,e,r)},Ou(u,n)}function Zu(n){return Math.log(0>n?0:n)}function Bu(n){return Math.exp(n)}function $u(n){return-Math.log(n>0?0:-n)}function Ju(n){return-Math.exp(-n)}function Gu(n){n=Math.log(n);var t={floor:function(t){return Math.floor(t/n)*n},ceil:function(t){return Math.ceil(t/n)*n}};return function(){return t}}function Ku(n,t){function e(t){return n(r(t))}var r=Wu(t),u=Wu(1/t);return e.invert=function(t){return u(n.invert(t))},e.domain=function(t){return arguments.length?(n.domain(t.map(r)),e):n.domain().map(u)},e.ticks=function(n){return Iu(e.domain(),n)},e.tickFormat=function(n,t){return Vu(e.domain(),n,t)},e.nice=function(){return e.domain(Hu(e.domain(),Yu))},e.exponent=function(n){if(!arguments.length)return t;var i=e.domain();return r=Wu(t=n),u=Wu(1/t),e.domain(i)},e.copy=function(){return Ku(n.copy(),t)},Ou(e,n)}function Wu(n){return function(t){return 0>t?-Math.pow(-t,n):Math.pow(t,n)}}function Qu(n,t){function e(t){return a[((i.get(t)||i.set(t,n.push(t)))-1)%a.length]}function r(t,e){return oa.range(n.length).map(function(n){return t+e*n})}var i,a,o;return e.domain=function(r){if(!arguments.length)return n;n=[],i=new u;for(var a,o=-1,c=r.length;++o<c;)i.has(a=r[o])||i.set(a,n.push(a));return e[t.t].apply(e,t.a)},e.range=function(n){return arguments.length?(a=n,o=0,t={t:"range",a:arguments},e):a},e.rangePoints=function(u,i){arguments.length<2&&(i=0);var c=u[0],l=u[1],f=(l-c)/(Math.max(1,n.length-1)+i);return a=r(n.length<2?(c+l)/2:c+f*i/2,f),o=0,t={t:"rangePoints",a:arguments},e},e.rangeBands=function(u,i,c){arguments.length<2&&(i=0),arguments.length<3&&(c=i);var l=u[1]<u[0],f=u[l-0],s=u[1-l],h=(s-f)/(n.length-i+2*c);return a=r(f+h*c,h),l&&a.reverse(),o=h*(1-i),t={t:"rangeBands",a:arguments},e},e.rangeRoundBands=function(u,i,c){arguments.length<2&&(i=0),arguments.length<3&&(c=i);var l=u[1]<u[0],f=u[l-0],s=u[1-l],h=Math.floor((s-f)/(n.length-i+2*c)),g=s-f-(n.length-i)*h;return a=r(f+Math.round(g/2),h),l&&a.reverse(),o=Math.round(h*(1-i)),t={t:"rangeRoundBands",a:arguments},e},e.rangeBand=function(){return o},e.rangeExtent=function(){return ju(t.a[0])},e.copy=function(){return Qu(n,t)},e.domain(n)}function ni(n,t){function e(){var e=0,i=t.length;for(u=[];++e<i;)u[e-1]=oa.quantile(n,e/i);return r}function r(n){return isNaN(n=+n)?0/0:t[oa.bisect(u,n)]}var u;return r.domain=function(t){return arguments.length?(n=t.filter(function(n){return!isNaN(n)}).sort(oa.ascending),e()):n},r.range=function(n){return arguments.length?(t=n,e()):t},r.quantiles=function(){return u},r.copy=function(){return ni(n,t)},e()}function ti(n,t,e){function r(t){return e[Math.max(0,Math.min(a,Math.floor(i*(t-n))))]}function u(){return i=e.length/(t-n),a=e.length-1,r}var i,a;return r.domain=function(e){return arguments.length?(n=+e[0],t=+e[e.length-1],u()):[n,t]},r.range=function(n){return arguments.length?(e=n,u()):e},r.copy=function(){return ti(n,t,e)},u()}function ei(n,t){function e(e){return t[oa.bisect(n,e)]}return e.domain=function(t){return arguments.length?(n=t,e):n},e.range=function(n){return arguments.length?(t=n,e):t},e.copy=function(){return ei(n,t)},e}function ri(n){function t(n){return+n}return t.invert=t,t.domain=t.range=function(e){return arguments.length?(n=e.map(t),t):n},t.ticks=function(t){return Iu(n,t)},t.tickFormat=function(t,e){return Vu(n,t,e)},t.copy=function(){return ri(n)},t}function ui(n){return n.innerRadius}function ii(n){return n.outerRadius}function ai(n){return n.startAngle}function oi(n){return n.endAngle}function ci(n){for(var t,e,r,u=-1,i=n.length;++u<i;)t=n[u],e=t[0],r=t[1]+Qo,t[0]=e*Math.cos(r),t[1]=e*Math.sin(r);return n}function li(n){function t(t){function c(){d.push("M",o(n(v),s),f,l(n(m.reverse()),s),"Z")}for(var h,g,p,d=[],m=[],v=[],y=-1,M=t.length,x=lt(e),b=lt(u),_=e===r?function(){return g}:lt(r),w=u===i?function(){return p}:lt(i);++y<M;)a.call(this,h=t[y],y)?(m.push([g=+x.call(this,h,y),p=+b.call(this,h,y)]),v.push([+_.call(this,h,y),+w.call(this,h,y)])):m.length&&(c(),m=[],v=[]);
return m.length&&c(),d.length?d.join(""):null}var e=ze,r=ze,u=0,i=De,a=Dt,o=je,c=o.key,l=o,f="L",s=.7;return t.x=function(n){return arguments.length?(e=r=n,t):r},t.x0=function(n){return arguments.length?(e=n,t):e},t.x1=function(n){return arguments.length?(r=n,t):r},t.y=function(n){return arguments.length?(u=i=n,t):i},t.y0=function(n){return arguments.length?(u=n,t):u},t.y1=function(n){return arguments.length?(i=n,t):i},t.defined=function(n){return arguments.length?(a=n,t):a},t.interpolate=function(n){return arguments.length?(c="function"==typeof n?o=n:(o=Do.get(n)||je).key,l=o.reverse||o,f=o.closed?"M":"L",t):c},t.tension=function(n){return arguments.length?(s=n,t):s},t}function fi(n){return n.radius}function si(n){return[n.x,n.y]}function hi(n){return function(){var t=n.apply(this,arguments),e=t[0],r=t[1]+Qo;return[e*Math.cos(r),e*Math.sin(r)]}}function gi(){return 64}function pi(){return"circle"}function di(n){var t=Math.sqrt(n/La);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function mi(n,t){return Ma(n,ic),n.id=t,n}function vi(n,t,e,r){var u=n.id;return D(n,"function"==typeof e?function(n,i,a){n.__transition__[u].tween.set(t,r(e.call(n,n.__data__,i,a)))}:(e=r(e),function(n){n.__transition__[u].tween.set(t,e)}))}function yi(n){return null==n&&(n=""),function(){this.textContent=n}}function Mi(n,t,e,r){var i=n.__transition__||(n.__transition__={active:0,count:0}),a=i[e];if(!a){var o=r.time;return a=i[e]={tween:new u,event:oa.dispatch("start","end"),time:o,ease:r.ease,delay:r.delay,duration:r.duration},++i.count,oa.timer(function(r){function u(r){return i.active>e?l():(i.active=e,h.start.call(n,f,t),a.tween.forEach(function(e,r){(r=r.call(n,f,t))&&d.push(r)}),c(r)||oa.timer(c,0,o),1)}function c(r){if(i.active!==e)return l();for(var u=(r-g)/p,a=s(u),o=d.length;o>0;)d[--o].call(n,a);return u>=1?(l(),h.end.call(n,f,t),1):void 0}function l(){return--i.count?delete i[e]:delete n.__transition__,1}var f=n.__data__,s=a.ease,h=a.event,g=a.delay,p=a.duration,d=[];return r>=g?u(r):oa.timer(u,g,o),1},0,o),a}}function xi(n,t){n.attr("transform",function(n){return"translate("+t(n)+",0)"})}function bi(n,t){n.attr("transform",function(n){return"translate(0,"+t(n)+")"})}function _i(n,t,e){if(r=[],e&&t.length>1){for(var r,u,i,a=ju(n.domain()),o=-1,c=t.length,l=(t[1]-t[0])/++e;++o<c;)for(u=e;--u>0;)(i=+t[o]-u*l)>=a[0]&&r.push(i);for(--o,u=0;++u<e&&(i=+t[o]+u*l)<a[1];)r.push(i)}return r}function wi(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Si(n,t,e){function r(t){var e=n(t),r=i(e,1);return r-t>t-e?e:r}function u(e){return t(e=n(new hc(e-1)),1),e}function i(n,e){return t(n=new hc(+n),e),n}function a(n,r,i){var a=u(n),o=[];if(i>1)for(;r>a;)e(a)%i||o.push(new Date(+a)),t(a,1);else for(;r>a;)o.push(new Date(+a)),t(a,1);return o}function o(n,t,e){try{hc=wi;var r=new wi;return r._=n,a(r,t,e)}finally{hc=Date}}n.floor=n,n.round=r,n.ceil=u,n.offset=i,n.range=a;var c=n.utc=Ei(n);return c.floor=c,c.round=Ei(r),c.ceil=Ei(u),c.offset=Ei(i),c.range=o,n}function Ei(n){return function(t,e){try{hc=wi;var r=new wi;return r._=t,n(r,e)._}finally{hc=Date}}}function ki(n,t,e,r){for(var u,i,a=0,o=t.length,c=e.length;o>a;){if(r>=c)return-1;if(u=t.charCodeAt(a++),37===u){if(i=Tc[t.charAt(a++)],!i||(r=i(n,e,r))<0)return-1}else if(u!=e.charCodeAt(r++))return-1}return r}function Ai(n){return RegExp("^(?:"+n.map(oa.requote).join("|")+")","i")}function qi(n){for(var t=new u,e=-1,r=n.length;++e<r;)t.set(n[e].toLowerCase(),e);return t}function Ni(n,t,e){n+="";var r=n.length;return e>r?Array(e-r+1).join(t)+n:n}function Ti(n,t,e){wc.lastIndex=0;var r=wc.exec(t.substring(e));return r?e+=r[0].length:-1}function Ci(n,t,e){_c.lastIndex=0;var r=_c.exec(t.substring(e));return r?e+=r[0].length:-1}function zi(n,t,e){kc.lastIndex=0;var r=kc.exec(t.substring(e));return r?(n.m=Ac.get(r[0].toLowerCase()),e+=r[0].length):-1}function Di(n,t,e){Sc.lastIndex=0;var r=Sc.exec(t.substring(e));return r?(n.m=Ec.get(r[0].toLowerCase()),e+=r[0].length):-1}function ji(n,t,e){return ki(n,""+Nc.c,t,e)}function Li(n,t,e){return ki(n,""+Nc.x,t,e)}function Fi(n,t,e){return ki(n,""+Nc.X,t,e)}function Hi(n,t,e){Cc.lastIndex=0;var r=Cc.exec(t.substring(e,e+4));return r?(n.y=+r[0],e+=r[0].length):-1}function Pi(n,t,e){Cc.lastIndex=0;var r=Cc.exec(t.substring(e,e+2));return r?(n.y=Ri(+r[0]),e+=r[0].length):-1}function Ri(n){return n+(n>68?1900:2e3)}function Oi(n,t,e){Cc.lastIndex=0;var r=Cc.exec(t.substring(e,e+2));return r?(n.m=r[0]-1,e+=r[0].length):-1}function Yi(n,t,e){Cc.lastIndex=0;var r=Cc.exec(t.substring(e,e+2));return r?(n.d=+r[0],e+=r[0].length):-1}function Ui(n,t,e){Cc.lastIndex=0;var r=Cc.exec(t.substring(e,e+2));return r?(n.H=+r[0],e+=r[0].length):-1}function Ii(n,t,e){Cc.lastIndex=0;var r=Cc.exec(t.substring(e,e+2));return r?(n.M=+r[0],e+=r[0].length):-1}function Vi(n,t,e){Cc.lastIndex=0;var r=Cc.exec(t.substring(e,e+2));return r?(n.S=+r[0],e+=r[0].length):-1}function Xi(n,t,e){Cc.lastIndex=0;var r=Cc.exec(t.substring(e,e+3));return r?(n.L=+r[0],e+=r[0].length):-1}function Zi(n,t,e){var r=zc.get(t.substring(e,e+=2).toLowerCase());return null==r?-1:(n.p=r,e)}function Bi(n){var t=n.getTimezoneOffset(),e=t>0?"-":"+",r=~~(Math.abs(t)/60),u=Math.abs(t)%60;return e+Ni(r,"0",2)+Ni(u,"0",2)}function $i(n){return n.toISOString()}function Ji(n,t,e){function r(t){return n(t)}return r.invert=function(t){return Ki(n.invert(t))},r.domain=function(t){return arguments.length?(n.domain(t),r):n.domain().map(Ki)},r.nice=function(n){return r.domain(Hu(r.domain(),function(){return n}))},r.ticks=function(e,u){var i=Gi(r.domain());if("function"!=typeof e){var a=i[1]-i[0],o=a/e,c=oa.bisect(jc,o);if(c==jc.length)return t.year(i,e);if(!c)return n.ticks(e).map(Ki);Math.log(o/jc[c-1])<Math.log(jc[c]/o)&&--c,e=t[c],u=e[1],e=e[0].range}return e(i[0],new Date(+i[1]+1),u)},r.tickFormat=function(){return e},r.copy=function(){return Ji(n.copy(),t,e)},oa.rebind(r,n,"range","rangeRound","interpolate","clamp")}function Gi(n){var t=n[0],e=n[n.length-1];return e>t?[t,e]:[e,t]}function Ki(n){return new Date(n)}function Wi(n){return function(t){for(var e=n.length-1,r=n[e];!r[1](t);)r=n[--e];return r[0](t)}}function Qi(n){var t=new Date(n,0,1);return t.setFullYear(n),t}function na(n){var t=n.getFullYear(),e=Qi(t),r=Qi(t+1);return t+(n-e)/(r-e)}function ta(n){var t=new Date(Date.UTC(n,0,1));return t.setUTCFullYear(n),t}function ea(n){var t=n.getUTCFullYear(),e=ta(t),r=ta(t+1);return t+(n-e)/(r-e)}function ra(n){return n.responseText}function ua(n){return JSON.parse(n.responseText)}function ia(n){var t=ca.createRange();return t.selectNode(ca.body),t.createContextualFragment(n.responseText)}function aa(n){return n.responseXML}var oa={version:"3.1.4"};Date.now||(Date.now=function(){return+new Date});var ca=document,la=window;try{ca.createElement("div").style.setProperty("opacity",0,"")}catch(fa){var sa=la.CSSStyleDeclaration.prototype,ha=sa.setProperty;sa.setProperty=function(n,t,e){ha.call(this,n,t+"",e)}}oa.ascending=function(n,t){return t>n?-1:n>t?1:n>=t?0:0/0},oa.descending=function(n,t){return n>t?-1:t>n?1:t>=n?0:0/0},oa.min=function(n,t){var e,r,u=-1,i=n.length;if(1===arguments.length){for(;++u<i&&(null==(e=n[u])||e!=e);)e=void 0;for(;++u<i;)null!=(r=n[u])&&e>r&&(e=r)}else{for(;++u<i&&(null==(e=t.call(n,n[u],u))||e!=e);)e=void 0;for(;++u<i;)null!=(r=t.call(n,n[u],u))&&e>r&&(e=r)}return e},oa.max=function(n,t){var e,r,u=-1,i=n.length;if(1===arguments.length){for(;++u<i&&(null==(e=n[u])||e!=e);)e=void 0;for(;++u<i;)null!=(r=n[u])&&r>e&&(e=r)}else{for(;++u<i&&(null==(e=t.call(n,n[u],u))||e!=e);)e=void 0;for(;++u<i;)null!=(r=t.call(n,n[u],u))&&r>e&&(e=r)}return e},oa.extent=function(n,t){var e,r,u,i=-1,a=n.length;if(1===arguments.length){for(;++i<a&&(null==(e=u=n[i])||e!=e);)e=u=void 0;for(;++i<a;)null!=(r=n[i])&&(e>r&&(e=r),r>u&&(u=r))}else{for(;++i<a&&(null==(e=u=t.call(n,n[i],i))||e!=e);)e=void 0;for(;++i<a;)null!=(r=t.call(n,n[i],i))&&(e>r&&(e=r),r>u&&(u=r))}return[e,u]},oa.sum=function(n,t){var e,r=0,u=n.length,i=-1;if(1===arguments.length)for(;++i<u;)isNaN(e=+n[i])||(r+=e);else for(;++i<u;)isNaN(e=+t.call(n,n[i],i))||(r+=e);return r},oa.mean=function(t,e){var r,u=t.length,i=0,a=-1,o=0;if(1===arguments.length)for(;++a<u;)n(r=t[a])&&(i+=(r-i)/++o);else for(;++a<u;)n(r=e.call(t,t[a],a))&&(i+=(r-i)/++o);return o?i:void 0},oa.quantile=function(n,t){var e=(n.length-1)*t+1,r=Math.floor(e),u=+n[r-1],i=e-r;return i?u+i*(n[r]-u):u},oa.median=function(t,e){return arguments.length>1&&(t=t.map(e)),t=t.filter(n),t.length?oa.quantile(t.sort(oa.ascending),.5):void 0},oa.bisector=function(n){return{left:function(t,e,r,u){for(arguments.length<3&&(r=0),arguments.length<4&&(u=t.length);u>r;){var i=r+u>>>1;n.call(t,t[i],i)<e?r=i+1:u=i}return r},right:function(t,e,r,u){for(arguments.length<3&&(r=0),arguments.length<4&&(u=t.length);u>r;){var i=r+u>>>1;e<n.call(t,t[i],i)?u=i:r=i+1}return r}}};var ga=oa.bisector(function(n){return n});oa.bisectLeft=ga.left,oa.bisect=oa.bisectRight=ga.right,oa.shuffle=function(n){for(var t,e,r=n.length;r;)e=Math.random()*r--|0,t=n[r],n[r]=n[e],n[e]=t;return n},oa.permute=function(n,t){for(var e=[],r=-1,u=t.length;++r<u;)e[r]=n[t[r]];return e},oa.zip=function(){if(!(u=arguments.length))return[];for(var n=-1,e=oa.min(arguments,t),r=Array(e);++n<e;)for(var u,i=-1,a=r[n]=Array(u);++i<u;)a[i]=arguments[i][n];return r},oa.transpose=function(n){return oa.zip.apply(oa,n)},oa.keys=function(n){var t=[];for(var e in n)t.push(e);return t},oa.values=function(n){var t=[];for(var e in n)t.push(n[e]);return t},oa.entries=function(n){var t=[];for(var e in n)t.push({key:e,value:n[e]});return t},oa.merge=function(n){return Array.prototype.concat.apply([],n)},oa.range=function(n,t,r){if(arguments.length<3&&(r=1,arguments.length<2&&(t=n,n=0)),1/0===(t-n)/r)throw Error("infinite range");var u,i=[],a=e(Math.abs(r)),o=-1;if(n*=a,t*=a,r*=a,0>r)for(;(u=n+r*++o)>t;)i.push(u/a);else for(;(u=n+r*++o)<t;)i.push(u/a);return i},oa.map=function(n){var t=new u;for(var e in n)t.set(e,n[e]);return t},r(u,{has:function(n){return pa+n in this},get:function(n){return this[pa+n]},set:function(n,t){return this[pa+n]=t},remove:function(n){return n=pa+n,n in this&&delete this[n]},keys:function(){var n=[];return this.forEach(function(t){n.push(t)}),n},values:function(){var n=[];return this.forEach(function(t,e){n.push(e)}),n},entries:function(){var n=[];return this.forEach(function(t,e){n.push({key:t,value:e})}),n},forEach:function(n){for(var t in this)t.charCodeAt(0)===da&&n.call(this,t.substring(1),this[t])}});var pa="\x00",da=pa.charCodeAt(0);oa.nest=function(){function n(t,o,c){if(c>=a.length)return r?r.call(i,o):e?o.sort(e):o;for(var l,f,s,h,g=-1,p=o.length,d=a[c++],m=new u;++g<p;)(h=m.get(l=d(f=o[g])))?h.push(f):m.set(l,[f]);return t?(f=t(),s=function(e,r){f.set(e,n(t,r,c))}):(f={},s=function(e,r){f[e]=n(t,r,c)}),m.forEach(s),f}function t(n,e){if(e>=a.length)return n;var r=[],u=o[e++];return n.forEach(function(n,u){r.push({key:n,values:t(u,e)})}),u?r.sort(function(n,t){return u(n.key,t.key)}):r}var e,r,i={},a=[],o=[];return i.map=function(t,e){return n(e,t,0)},i.entries=function(e){return t(n(oa.map,e,0),0)},i.key=function(n){return a.push(n),i},i.sortKeys=function(n){return o[a.length-1]=n,i},i.sortValues=function(n){return e=n,i},i.rollup=function(n){return r=n,i},i},oa.set=function(n){var t=new i;if(n)for(var e=0;e<n.length;e++)t.add(n[e]);return t},r(i,{has:function(n){return pa+n in this},add:function(n){return this[pa+n]=!0,n},remove:function(n){return n=pa+n,n in this&&delete this[n]},values:function(){var n=[];return this.forEach(function(t){n.push(t)}),n},forEach:function(n){for(var t in this)t.charCodeAt(0)===da&&n.call(this,t.substring(1))}}),oa.behavior={},oa.rebind=function(n,t){for(var e,r=1,u=arguments.length;++r<u;)n[e=arguments[r]]=a(n,t,t[e]);return n},oa.dispatch=function(){for(var n=new o,t=-1,e=arguments.length;++t<e;)n[arguments[t]]=c(n);return n},o.prototype.on=function(n,t){var e=n.indexOf("."),r="";if(e>=0&&(r=n.substring(e+1),n=n.substring(0,e)),n)return arguments.length<2?this[n].on(r):this[n].on(r,t);if(2===arguments.length){if(null==t)for(n in this)this.hasOwnProperty(n)&&this[n].on(r,null);return this}},oa.event=null,oa.mouse=function(n){return h(n,f())};var ma=/WebKit/.test(la.navigator.userAgent)?-1:0,va=p;try{va(ca.documentElement.childNodes)[0].nodeType}catch(ya){va=g}var Ma=[].__proto__?function(n,t){n.__proto__=t}:function(n,t){for(var e in t)n[e]=t[e]};oa.touches=function(n,t){return arguments.length<2&&(t=f().touches),t?va(t).map(function(t){var e=h(n,t);return e.identifier=t.identifier,e}):[]},oa.behavior.drag=function(){function n(){this.on("mousedown.drag",t).on("touchstart.drag",t)}function t(){function n(){var n=o.parentNode;return null!=s?oa.touches(n).filter(function(n){return n.identifier===s})[0]:oa.mouse(n)}function t(){if(!o.parentNode)return u();var t=n(),e=t[0]-h[0],r=t[1]-h[1];g|=e|r,h=t,l(),c({type:"drag",x:t[0]+a[0],y:t[1]+a[1],dx:e,dy:r})}function u(){c({type:"dragend"}),g&&(l(),oa.event.target===f&&p.on("click.drag",i,!0)),p.on(null!=s?"touchmove.drag-"+s:"mousemove.drag",null).on(null!=s?"touchend.drag-"+s:"mouseup.drag",null)}function i(){l(),p.on("click.drag",null)}var a,o=this,c=e.of(o,arguments),f=oa.event.target,s=oa.event.touches?oa.event.changedTouches[0].identifier:null,h=n(),g=0,p=oa.select(la).on(null!=s?"touchmove.drag-"+s:"mousemove.drag",t).on(null!=s?"touchend.drag-"+s:"mouseup.drag",u,!0);r?(a=r.apply(o,arguments),a=[a.x-h[0],a.y-h[1]]):a=[0,0],null==s&&l(),c({type:"dragstart"})}var e=s(n,"drag","dragstart","dragend"),r=null;return n.origin=function(t){return arguments.length?(r=t,n):r},oa.rebind(n,e,"on")};var xa=function(n,t){return t.querySelector(n)},ba=function(n,t){return t.querySelectorAll(n)},_a=ca.documentElement,wa=_a.matchesSelector||_a.webkitMatchesSelector||_a.mozMatchesSelector||_a.msMatchesSelector||_a.oMatchesSelector,Sa=function(n,t){return wa.call(n,t)};"function"==typeof Sizzle&&(xa=function(n,t){return Sizzle(n,t)[0]||null},ba=function(n,t){return Sizzle.uniqueSort(Sizzle(n,t))},Sa=Sizzle.matchesSelector);var Ea=[];oa.selection=function(){return Ta},oa.selection.prototype=Ea,Ea.select=function(n){var t,e,r,u,i=[];"function"!=typeof n&&(n=m(n));for(var a=-1,o=this.length;++a<o;){i.push(t=[]),t.parentNode=(r=this[a]).parentNode;for(var c=-1,l=r.length;++c<l;)(u=r[c])?(t.push(e=n.call(u,u.__data__,c)),e&&"__data__"in u&&(e.__data__=u.__data__)):t.push(null)}return d(i)},Ea.selectAll=function(n){var t,e,r=[];"function"!=typeof n&&(n=v(n));for(var u=-1,i=this.length;++u<i;)for(var a=this[u],o=-1,c=a.length;++o<c;)(e=a[o])&&(r.push(t=va(n.call(e,e.__data__,o))),t.parentNode=e);return d(r)};var ka={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};oa.ns={prefix:ka,qualify:function(n){var t=n.indexOf(":"),e=n;return t>=0&&(e=n.substring(0,t),n=n.substring(t+1)),ka.hasOwnProperty(e)?{space:ka[e],local:n}:n}},Ea.attr=function(n,t){if(arguments.length<2){if("string"==typeof n){var e=this.node();return n=oa.ns.qualify(n),n.local?e.getAttributeNS(n.space,n.local):e.getAttribute(n)}for(t in n)this.each(y(t,n[t]));return this}return this.each(y(n,t))},oa.requote=function(n){return n.replace(Aa,"\\$&")};var Aa=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;Ea.classed=function(n,t){if(arguments.length<2){if("string"==typeof n){var e=this.node(),r=(n=n.trim().split(/^|\s+/g)).length,u=-1;if(t=e.classList){for(;++u<r;)if(!t.contains(n[u]))return!1}else for(t=e.getAttribute("class");++u<r;)if(!x(n[u]).test(t))return!1;return!0}for(t in n)this.each(_(t,n[t]));return this}return this.each(_(n,t))},Ea.style=function(n,t,e){var r=arguments.length;if(3>r){if("string"!=typeof n){2>r&&(t="");for(e in n)this.each(S(e,n[e],t));return this}if(2>r)return la.getComputedStyle(this.node(),null).getPropertyValue(n);e=""}return this.each(S(n,t,e))},Ea.property=function(n,t){if(arguments.length<2){if("string"==typeof n)return this.node()[n];for(t in n)this.each(E(t,n[t]));return this}return this.each(E(n,t))},Ea.text=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);this.textContent=null==t?"":t}:null==n?function(){this.textContent=""}:function(){this.textContent=n}):this.node().textContent},Ea.html=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);this.innerHTML=null==t?"":t}:null==n?function(){this.innerHTML=""}:function(){this.innerHTML=n}):this.node().innerHTML},Ea.append=function(n){function t(){return this.appendChild(ca.createElementNS(this.namespaceURI,n))}function e(){return this.appendChild(ca.createElementNS(n.space,n.local))}return n=oa.ns.qualify(n),this.select(n.local?e:t)},Ea.insert=function(n,t){function e(e,r){return this.insertBefore(ca.createElementNS(this.namespaceURI,n),t.call(this,e,r))}function r(e,r){return this.insertBefore(ca.createElementNS(n.space,n.local),t.call(this,e,r))}return n=oa.ns.qualify(n),"function"!=typeof t&&(t=m(t)),this.select(n.local?r:e)},Ea.remove=function(){return this.each(function(){var n=this.parentNode;n&&n.removeChild(this)})},Ea.data=function(n,t){function e(n,e){var r,i,a,o=n.length,s=e.length,h=Math.min(o,s),g=Array(s),p=Array(s),d=Array(o);if(t){var m,v=new u,y=new u,M=[];for(r=-1;++r<o;)m=t.call(i=n[r],i.__data__,r),v.has(m)?d[r]=i:v.set(m,i),M.push(m);for(r=-1;++r<s;)m=t.call(e,a=e[r],r),(i=v.get(m))?(g[r]=i,i.__data__=a):y.has(m)||(p[r]=k(a)),y.set(m,a),v.remove(m);for(r=-1;++r<o;)v.has(M[r])&&(d[r]=n[r])}else{for(r=-1;++r<h;)i=n[r],a=e[r],i?(i.__data__=a,g[r]=i):p[r]=k(a);for(;s>r;++r)p[r]=k(e[r]);for(;o>r;++r)d[r]=n[r]}p.update=g,p.parentNode=g.parentNode=d.parentNode=n.parentNode,c.push(p),l.push(g),f.push(d)}var r,i,a=-1,o=this.length;if(!arguments.length){for(n=Array(o=(r=this[0]).length);++a<o;)(i=r[a])&&(n[a]=i.__data__);return n}var c=j([]),l=d([]),f=d([]);if("function"==typeof n)for(;++a<o;)e(r=this[a],n.call(r,r.parentNode.__data__,a));else for(;++a<o;)e(r=this[a],n);return l.enter=function(){return c},l.exit=function(){return f},l},Ea.datum=function(n){return arguments.length?this.property("__data__",n):this.property("__data__")},Ea.filter=function(n){var t,e,r,u=[];"function"!=typeof n&&(n=A(n));for(var i=0,a=this.length;a>i;i++){u.push(t=[]),t.parentNode=(e=this[i]).parentNode;for(var o=0,c=e.length;c>o;o++)(r=e[o])&&n.call(r,r.__data__,o)&&t.push(r)}return d(u)},Ea.order=function(){for(var n=-1,t=this.length;++n<t;)for(var e,r=this[n],u=r.length-1,i=r[u];--u>=0;)(e=r[u])&&(i&&i!==e.nextSibling&&i.parentNode.insertBefore(e,i),i=e);return this},Ea.sort=function(n){n=q.apply(this,arguments);for(var t=-1,e=this.length;++t<e;)this[t].sort(n);return this.order()},Ea.on=function(n,t,e){var r=arguments.length;if(3>r){if("string"!=typeof n){2>r&&(t=!1);for(e in n)this.each(T(e,n[e],t));return this}if(2>r)return(r=this.node()["__on"+n])&&r._;e=!1}return this.each(T(n,t,e))};var qa=oa.map({mouseenter:"mouseover",mouseleave:"mouseout"});qa.forEach(function(n){"on"+n in ca&&qa.remove(n)}),Ea.each=function(n){return D(this,function(t,e,r){n.call(t,t.__data__,e,r)})},Ea.call=function(n){var t=va(arguments);return n.apply(t[0]=this,t),this},Ea.empty=function(){return!this.node()},Ea.node=function(){for(var n=0,t=this.length;t>n;n++)for(var e=this[n],r=0,u=e.length;u>r;r++){var i=e[r];if(i)return i}return null};var Na=[];oa.selection.enter=j,oa.selection.enter.prototype=Na,Na.append=Ea.append,Na.insert=Ea.insert,Na.empty=Ea.empty,Na.node=Ea.node,Na.select=function(n){for(var t,e,r,u,i,a=[],o=-1,c=this.length;++o<c;){r=(u=this[o]).update,a.push(t=[]),t.parentNode=u.parentNode;for(var l=-1,f=u.length;++l<f;)(i=u[l])?(t.push(r[l]=e=n.call(u.parentNode,i.__data__,l)),e.__data__=i.__data__):t.push(null)}return d(a)},Ea.transition=function(){var n,t,e=ec||++ac,r=[],u=Object.create(oc);u.time=Date.now();for(var i=-1,a=this.length;++i<a;){r.push(n=[]);for(var o=this[i],c=-1,l=o.length;++c<l;)(t=o[c])&&Mi(t,c,e,u),n.push(t)}return mi(r,e)};var Ta=d([[ca]]);Ta[0].parentNode=_a,oa.select=function(n){return"string"==typeof n?Ta.select(n):d([[n]])},oa.selectAll=function(n){return"string"==typeof n?Ta.selectAll(n):d([va(n)])},oa.behavior.zoom=function(){function n(){this.on("mousedown.zoom",o).on("mousemove.zoom",f).on(Da+".zoom",c).on("dblclick.zoom",h).on("touchstart.zoom",g).on("touchmove.zoom",p).on("touchend.zoom",g)}function t(n){return[(n[0]-_[0])/w,(n[1]-_[1])/w]}function e(n){return[n[0]*w+_[0],n[1]*w+_[1]]}function r(n){w=Math.max(S[0],Math.min(S[1],n))}function u(n,t){t=e(t),_[0]+=n[0]-t[0],_[1]+=n[1]-t[1]}function i(){y&&y.domain(v.range().map(function(n){return(n-_[0])/w}).map(v.invert)),x&&x.domain(M.range().map(function(n){return(n-_[1])/w}).map(M.invert))}function a(n){i(),oa.event.preventDefault(),n({type:"zoom",scale:w,translate:_})}function o(){function n(){f=1,u(oa.mouse(i),h),a(o)}function e(){f&&l(),s.on("mousemove.zoom",null).on("mouseup.zoom",null),f&&oa.event.target===c&&s.on("click.zoom",r,!0)}function r(){l(),s.on("click.zoom",null)}var i=this,o=E.of(i,arguments),c=oa.event.target,f=0,s=oa.select(la).on("mousemove.zoom",n).on("mouseup.zoom",e),h=t(oa.mouse(i));la.focus(),l()}function c(){d||(d=t(oa.mouse(this))),r(Math.pow(2,.002*Ca())*w),u(oa.mouse(this),d),a(E.of(this,arguments))}function f(){d=null}function h(){var n=oa.mouse(this),e=t(n),i=Math.log(w)/Math.LN2;r(Math.pow(2,oa.event.shiftKey?Math.ceil(i)-1:Math.floor(i)+1)),u(n,e),a(E.of(this,arguments))}function g(){var n=oa.touches(this),e=Date.now();if(m=w,d={},n.forEach(function(n){d[n.identifier]=t(n)}),l(),1===n.length){if(500>e-b){var i=n[0],o=t(n[0]);r(2*w),u(i,o),a(E.of(this,arguments))}b=e}}function p(){var n=oa.touches(this),t=n[0],e=d[t.identifier];if(i=n[1]){var i,o=d[i.identifier];t=[(t[0]+i[0])/2,(t[1]+i[1])/2],e=[(e[0]+o[0])/2,(e[1]+o[1])/2],r(oa.event.scale*m)}u(t,e),b=null,a(E.of(this,arguments))}var d,m,v,y,M,x,b,_=[0,0],w=1,S=za,E=s(n,"zoom");return n.translate=function(t){return arguments.length?(_=t.map(Number),i(),n):_},n.scale=function(t){return arguments.length?(w=+t,i(),n):w},n.scaleExtent=function(t){return arguments.length?(S=null==t?za:t.map(Number),n):S},n.x=function(t){return arguments.length?(y=t,v=t.copy(),_=[0,0],w=1,n):y},n.y=function(t){return arguments.length?(x=t,M=t.copy(),_=[0,0],w=1,n):x},oa.rebind(n,E,"on")};var Ca,za=[0,1/0],Da="onwheel"in ca?(Ca=function(){return-oa.event.deltaY*(oa.event.deltaMode?120:1)},"wheel"):"onmousewheel"in ca?(Ca=function(){return oa.event.wheelDelta},"mousewheel"):(Ca=function(){return-oa.event.detail},"MozMousePixelScroll");L.prototype.toString=function(){return this.rgb()+""},oa.hsl=function(n,t,e){return 1===arguments.length?n instanceof H?F(n.h,n.s,n.l):ut(""+n,it,F):F(+n,+t,+e)};var ja=H.prototype=new L;ja.brighter=function(n){return n=Math.pow(.7,arguments.length?n:1),F(this.h,this.s,this.l/n)},ja.darker=function(n){return n=Math.pow(.7,arguments.length?n:1),F(this.h,this.s,n*this.l)},ja.rgb=function(){return P(this.h,this.s,this.l)};var La=Math.PI,Fa=1e-6,Ha=La/180,Pa=180/La;oa.hcl=function(n,t,e){return 1===arguments.length?n instanceof Z?X(n.h,n.c,n.l):n instanceof J?K(n.l,n.a,n.b):K((n=at((n=oa.rgb(n)).r,n.g,n.b)).l,n.a,n.b):X(+n,+t,+e)};var Ra=Z.prototype=new L;Ra.brighter=function(n){return X(this.h,this.c,Math.min(100,this.l+Oa*(arguments.length?n:1)))},Ra.darker=function(n){return X(this.h,this.c,Math.max(0,this.l-Oa*(arguments.length?n:1)))},Ra.rgb=function(){return B(this.h,this.c,this.l).rgb()},oa.lab=function(n,t,e){return 1===arguments.length?n instanceof J?$(n.l,n.a,n.b):n instanceof Z?B(n.l,n.c,n.h):at((n=oa.rgb(n)).r,n.g,n.b):$(+n,+t,+e)};var Oa=18,Ya=.95047,Ua=1,Ia=1.08883,Va=J.prototype=new L;Va.brighter=function(n){return $(Math.min(100,this.l+Oa*(arguments.length?n:1)),this.a,this.b)},Va.darker=function(n){return $(Math.max(0,this.l-Oa*(arguments.length?n:1)),this.a,this.b)},Va.rgb=function(){return G(this.l,this.a,this.b)},oa.rgb=function(n,t,e){return 1===arguments.length?n instanceof et?tt(n.r,n.g,n.b):ut(""+n,tt,P):tt(~~n,~~t,~~e)};var Xa=et.prototype=new L;Xa.brighter=function(n){n=Math.pow(.7,arguments.length?n:1);var t=this.r,e=this.g,r=this.b,u=30;return t||e||r?(t&&u>t&&(t=u),e&&u>e&&(e=u),r&&u>r&&(r=u),tt(Math.min(255,Math.floor(t/n)),Math.min(255,Math.floor(e/n)),Math.min(255,Math.floor(r/n)))):tt(u,u,u)},Xa.darker=function(n){return n=Math.pow(.7,arguments.length?n:1),tt(Math.floor(n*this.r),Math.floor(n*this.g),Math.floor(n*this.b))},Xa.hsl=function(){return it(this.r,this.g,this.b)},Xa.toString=function(){return"#"+rt(this.r)+rt(this.g)+rt(this.b)};var Za=oa.map({aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"});Za.forEach(function(n,t){Za.set(n,ut(t,tt,P))}),oa.functor=lt,oa.xhr=function(n,t,e){function r(){var n=c.status;!n&&c.responseText||n>=200&&300>n||304===n?i.load.call(u,o.call(u,c)):i.error.call(u,c)}var u={},i=oa.dispatch("progress","load","error"),a={},o=ft,c=new(la.XDomainRequest&&/^(http(s)?:)?\/\//.test(n)?XDomainRequest:XMLHttpRequest);return"onload"in c?c.onload=c.onerror=r:c.onreadystatechange=function(){c.readyState>3&&r()},c.onprogress=function(n){var t=oa.event;oa.event=n;try{i.progress.call(u,c)}finally{oa.event=t}},u.header=function(n,t){return n=(n+"").toLowerCase(),arguments.length<2?a[n]:(null==t?delete a[n]:a[n]=t+"",u)},u.mimeType=function(n){return arguments.length?(t=null==n?null:n+"",u):t},u.response=function(n){return o=n,u},["get","post"].forEach(function(n){u[n]=function(){return u.send.apply(u,[n].concat(va(arguments)))}}),u.send=function(e,r,i){if(2===arguments.length&&"function"==typeof r&&(i=r,r=null),c.open(e,n,!0),null==t||"accept"in a||(a.accept=t+",*/*"),c.setRequestHeader)for(var o in a)c.setRequestHeader(o,a[o]);return null!=t&&c.overrideMimeType&&c.overrideMimeType(t),null!=i&&u.on("error",i).on("load",function(n){i(null,n)}),c.send(null==r?null:r),u},u.abort=function(){return c.abort(),u},oa.rebind(u,i,"on"),2===arguments.length&&"function"==typeof t&&(e=t,t=null),null==e?u:u.get(st(e))},oa.csv=ht(",","text/csv"),oa.tsv=ht("	","text/tab-separated-values");var Ba,$a,Ja=0,Ga={},Ka=null;oa.timer=function(n,t,e){if(arguments.length<3){if(arguments.length<2)t=0;else if(!isFinite(t))return;e=Date.now()}var r=Ga[n.id];r&&r.callback===n?(r.then=e,r.delay=t):Ga[n.id=++Ja]=Ka={callback:n,then:e,delay:t,next:Ka},Ba||($a=clearTimeout($a),Ba=1,Wa(gt))},oa.timer.flush=function(){for(var n,t=Date.now(),e=Ka;e;)n=t-e.then,e.delay||(e.flush=e.callback(n)),e=e.next;pt()};var Wa=la.requestAnimationFrame||la.webkitRequestAnimationFrame||la.mozRequestAnimationFrame||la.oRequestAnimationFrame||la.msRequestAnimationFrame||function(n){setTimeout(n,17)},Qa=".",no=",",to=[3,3],eo=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"].map(dt);oa.formatPrefix=function(n,t){var e=0;return n&&(0>n&&(n*=-1),t&&(n=oa.round(n,mt(n,t))),e=1+Math.floor(1e-12+Math.log(n)/Math.LN10),e=Math.max(-24,Math.min(24,3*Math.floor((0>=e?e+1:e-1)/3)))),eo[8+e/3]},oa.round=function(n,t){return t?Math.round(n*(t=Math.pow(10,t)))/t:Math.round(n)},oa.format=function(n){var t=ro.exec(n),e=t[1]||" ",r=t[2]||">",u=t[3]||"",i=t[4]||"",a=t[5],o=+t[6],c=t[7],l=t[8],f=t[9],s=1,h="",g=!1;switch(l&&(l=+l.substring(1)),(a||"0"===e&&"="===r)&&(a=e="0",r="=",c&&(o-=Math.floor((o-1)/4))),f){case"n":c=!0,f="g";break;case"%":s=100,h="%",f="f";break;case"p":s=100,h="%",f="r";break;case"b":case"o":case"x":case"X":i&&(i="0"+f.toLowerCase());case"c":case"d":g=!0,l=0;break;case"s":s=-1,f="r"}"#"===i&&(i=""),"r"!=f||l||(f="g"),null!=l&&("g"==f?l=Math.max(1,Math.min(21,l)):("e"==f||"f"==f)&&(l=Math.max(0,Math.min(20,l)))),f=uo.get(f)||vt;var p=a&&c;return function(n){if(g&&n%1)return"";var t=0>n||0===n&&0>1/n?(n=-n,"-"):u;if(0>s){var d=oa.formatPrefix(n,l);n=d.scale(n),h=d.symbol}else n*=s;n=f(n,l),!a&&c&&(n=io(n));var m=i.length+n.length+(p?0:t.length),v=o>m?Array(m=o-m+1).join(e):"";return p&&(n=io(v+n)),Qa&&n.replace(".",Qa),t+=i,("<"===r?t+n+v:">"===r?v+t+n:"^"===r?v.substring(0,m>>=1)+t+n+v.substring(m):t+(p?n:v+n))+h}};var ro=/(?:([^{])?([<>=^]))?([+\- ])?(#)?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,uo=oa.map({b:function(n){return n.toString(2)},c:function(n){return String.fromCharCode(n)},o:function(n){return n.toString(8)},x:function(n){return n.toString(16)},X:function(n){return n.toString(16).toUpperCase()},g:function(n,t){return n.toPrecision(t)},e:function(n,t){return n.toExponential(t)},f:function(n,t){return n.toFixed(t)},r:function(n,t){return(n=oa.round(n,mt(n,t))).toFixed(Math.max(0,Math.min(20,mt(n*(1+1e-15),t))))}}),io=ft;if(to){var ao=to.length;io=function(n){for(var t=n.lastIndexOf("."),e=t>=0?"."+n.substring(t+1):(t=n.length,""),r=[],u=0,i=to[0];t>0&&i>0;)r.push(n.substring(t-=i,t+i)),i=to[u=(u+1)%ao];return r.reverse().join(no||"")+e}}oa.geo={},oa.geo.stream=function(n,t){oo.hasOwnProperty(n.type)?oo[n.type](n,t):yt(n,t)};var oo={Feature:function(n,t){yt(n.geometry,t)},FeatureCollection:function(n,t){for(var e=n.features,r=-1,u=e.length;++r<u;)yt(e[r].geometry,t)}},co={Sphere:function(n,t){t.sphere()
},Point:function(n,t){var e=n.coordinates;t.point(e[0],e[1])},MultiPoint:function(n,t){for(var e,r=n.coordinates,u=-1,i=r.length;++u<i;)e=r[u],t.point(e[0],e[1])},LineString:function(n,t){Mt(n.coordinates,t,0)},MultiLineString:function(n,t){for(var e=n.coordinates,r=-1,u=e.length;++r<u;)Mt(e[r],t,0)},Polygon:function(n,t){xt(n.coordinates,t)},MultiPolygon:function(n,t){for(var e=n.coordinates,r=-1,u=e.length;++r<u;)xt(e[r],t)},GeometryCollection:function(n,t){for(var e=n.geometries,r=-1,u=e.length;++r<u;)yt(e[r],t)}};oa.geo.area=function(n){return lo=0,oa.geo.stream(n,ho),lo};var lo,fo,so,ho={sphere:function(){lo+=4*La},point:N,lineStart:N,lineEnd:N,polygonStart:function(){fo=1,so=0,ho.lineStart=bt},polygonEnd:function(){var n=2*Math.atan2(so,fo);lo+=0>n?4*La+n:n,ho.lineStart=ho.lineEnd=ho.point=N}};oa.geo.bounds=_t(ft),oa.geo.centroid=function(n){go=po=mo=vo=yo=0,oa.geo.stream(n,Mo);var t;return po&&Math.abs(t=Math.sqrt(mo*mo+vo*vo+yo*yo))>Fa?[Math.atan2(vo,mo)*Pa,Math.asin(Math.max(-1,Math.min(1,yo/t)))*Pa]:void 0};var go,po,mo,vo,yo,Mo={sphere:function(){2>go&&(go=2,po=mo=vo=yo=0)},point:wt,lineStart:Et,lineEnd:kt,polygonStart:function(){2>go&&(go=2,po=mo=vo=yo=0),Mo.lineStart=St},polygonEnd:function(){Mo.lineStart=Et}},xo=Pt(Dt,It,Xt),bo=1e9;oa.geo.projection=Kt,oa.geo.projectionMutator=Wt,(oa.geo.equirectangular=function(){return Kt(ne)}).raw=ne.invert=ne,oa.geo.rotation=function(n){function t(t){return t=n(t[0]*Ha,t[1]*Ha),t[0]*=Pa,t[1]*=Pa,t}return n=te(n[0]%360*Ha,n[1]*Ha,n.length>2?n[2]*Ha:0),t.invert=function(t){return t=n.invert(t[0]*Ha,t[1]*Ha),t[0]*=Pa,t[1]*=Pa,t},t},oa.geo.circle=function(){function n(){var n="function"==typeof r?r.apply(this,arguments):r,t=te(-n[0]*Ha,-n[1]*Ha,0).invert,u=[];return e(null,null,1,{point:function(n,e){u.push(n=t(n,e)),n[0]*=Pa,n[1]*=Pa}}),{type:"Polygon",coordinates:[u]}}var t,e,r=[0,0],u=6;return n.origin=function(t){return arguments.length?(r=t,n):r},n.angle=function(r){return arguments.length?(e=ie((t=+r)*Ha,u*Ha),n):t},n.precision=function(r){return arguments.length?(e=ie(t*Ha,(u=+r)*Ha),n):u},n.angle(90)},oa.geo.distance=function(n,t){var e,r=(t[0]-n[0])*Ha,u=n[1]*Ha,i=t[1]*Ha,a=Math.sin(r),o=Math.cos(r),c=Math.sin(u),l=Math.cos(u),f=Math.sin(i),s=Math.cos(i);return Math.atan2(Math.sqrt((e=s*a)*e+(e=l*f-c*s*o)*e),c*f+l*s*o)},oa.geo.graticule=function(){function n(){return{type:"MultiLineString",coordinates:t()}}function t(){return oa.range(Math.ceil(i/m)*m,u,m).map(h).concat(oa.range(Math.ceil(l/v)*v,c,v).map(g)).concat(oa.range(Math.ceil(r/p)*p,e,p).filter(function(n){return Math.abs(n%m)>Fa}).map(f)).concat(oa.range(Math.ceil(o/d)*d,a,d).filter(function(n){return Math.abs(n%v)>Fa}).map(s))}var e,r,u,i,a,o,c,l,f,s,h,g,p=10,d=p,m=90,v=360,y=2.5;return n.lines=function(){return t().map(function(n){return{type:"LineString",coordinates:n}})},n.outline=function(){return{type:"Polygon",coordinates:[h(i).concat(g(c).slice(1),h(u).reverse().slice(1),g(l).reverse().slice(1))]}},n.extent=function(t){return arguments.length?n.majorExtent(t).minorExtent(t):n.minorExtent()},n.majorExtent=function(t){return arguments.length?(i=+t[0][0],u=+t[1][0],l=+t[0][1],c=+t[1][1],i>u&&(t=i,i=u,u=t),l>c&&(t=l,l=c,c=t),n.precision(y)):[[i,l],[u,c]]},n.minorExtent=function(t){return arguments.length?(r=+t[0][0],e=+t[1][0],o=+t[0][1],a=+t[1][1],r>e&&(t=r,r=e,e=t),o>a&&(t=o,o=a,a=t),n.precision(y)):[[r,o],[e,a]]},n.step=function(t){return arguments.length?n.majorStep(t).minorStep(t):n.minorStep()},n.majorStep=function(t){return arguments.length?(m=+t[0],v=+t[1],n):[m,v]},n.minorStep=function(t){return arguments.length?(p=+t[0],d=+t[1],n):[p,d]},n.precision=function(t){return arguments.length?(y=+t,f=oe(o,a,90),s=ce(r,e,y),h=oe(l,c,90),g=ce(i,u,y),n):y},n.majorExtent([[-180,-90+Fa],[180,90-Fa]]).minorExtent([[-180,-80-Fa],[180,80+Fa]])},oa.geo.greatArc=function(){function n(){return{type:"LineString",coordinates:[t||r.apply(this,arguments),e||u.apply(this,arguments)]}}var t,e,r=le,u=fe;return n.distance=function(){return oa.geo.distance(t||r.apply(this,arguments),e||u.apply(this,arguments))},n.source=function(e){return arguments.length?(r=e,t="function"==typeof e?null:e,n):r},n.target=function(t){return arguments.length?(u=t,e="function"==typeof t?null:t,n):u},n.precision=function(){return arguments.length?n:0},n},oa.geo.interpolate=function(n,t){return se(n[0]*Ha,n[1]*Ha,t[0]*Ha,t[1]*Ha)},oa.geo.length=function(n){return _o=0,oa.geo.stream(n,wo),_o};var _o,wo={sphere:N,point:N,lineStart:he,lineEnd:N,polygonStart:N,polygonEnd:N};(oa.geo.conicEqualArea=function(){return ge(pe)}).raw=pe,oa.geo.albersUsa=function(){function n(n){return t(n)(n)}function t(n){var t=n[0],e=n[1];return e>50?a:-140>t?o:21>e?c:i}var e,r,u,i=oa.geo.conicEqualArea().rotate([98,0]).center([0,38]).parallels([29.5,45.5]),a=oa.geo.conicEqualArea().rotate([160,0]).center([0,60]).parallels([55,65]),o=oa.geo.conicEqualArea().rotate([160,0]).center([0,20]).parallels([8,18]),c=oa.geo.conicEqualArea().rotate([60,0]).center([0,10]).parallels([8,18]);return n.invert=function(n){return e(n)||r(n)||u(n)||i.invert(n)},n.scale=function(t){return arguments.length?(i.scale(t),a.scale(.6*t),o.scale(t),c.scale(1.5*t),n.translate(i.translate())):i.scale()},n.translate=function(t){if(!arguments.length)return i.translate();var l=i.scale(),f=t[0],s=t[1];return i.translate(t),a.translate([f-.4*l,s+.17*l]),o.translate([f-.19*l,s+.2*l]),c.translate([f+.58*l,s+.43*l]),e=de(a,[[-180,50],[-130,72]]),r=de(o,[[-164,18],[-154,24]]),u=de(c,[[-67.5,17.5],[-65,19]]),n},n.scale(1e3)};var So,Eo,ko={point:N,lineStart:N,lineEnd:N,polygonStart:function(){Eo=0,ko.lineStart=me},polygonEnd:function(){ko.lineStart=ko.lineEnd=ko.point=N,So+=Math.abs(Eo/2)}},Ao={point:ye,lineStart:Me,lineEnd:xe,polygonStart:function(){Ao.lineStart=be},polygonEnd:function(){Ao.point=ye,Ao.lineStart=Me,Ao.lineEnd=xe}};oa.geo.path=function(){function n(n){return n&&oa.geo.stream(n,r(u.pointRadius("function"==typeof i?+i.apply(this,arguments):i))),u.result()}var t,e,r,u,i=4.5;return n.area=function(n){return So=0,oa.geo.stream(n,r(ko)),So},n.centroid=function(n){return go=mo=vo=yo=0,oa.geo.stream(n,r(Ao)),yo?[mo/yo,vo/yo]:void 0},n.bounds=function(n){return _t(r)(n)},n.projection=function(e){return arguments.length?(r=(t=e)?e.stream||Se(e):ft,n):t},n.context=function(t){return arguments.length?(u=null==(e=t)?new ve:new _e(t),n):e},n.pointRadius=function(t){return arguments.length?(i="function"==typeof t?t:+t,n):i},n.projection(oa.geo.albersUsa()).context(null)},oa.geo.albers=function(){return oa.geo.conicEqualArea().parallels([29.5,45.5]).rotate([98,0]).center([0,38]).scale(1e3)};var qo=Ee(function(n){return Math.sqrt(2/(1+n))},function(n){return 2*Math.asin(n/2)});(oa.geo.azimuthalEqualArea=function(){return Kt(qo)}).raw=qo;var No=Ee(function(n){var t=Math.acos(n);return t&&t/Math.sin(t)},ft);(oa.geo.azimuthalEquidistant=function(){return Kt(No)}).raw=No,(oa.geo.conicConformal=function(){return ge(ke)}).raw=ke,(oa.geo.conicEquidistant=function(){return ge(Ae)}).raw=Ae;var To=Ee(function(n){return 1/n},Math.atan);(oa.geo.gnomonic=function(){return Kt(To)}).raw=To,qe.invert=function(n,t){return[n,2*Math.atan(Math.exp(t))-La/2]},(oa.geo.mercator=function(){return Ne(qe)}).raw=qe;var Co=Ee(function(){return 1},Math.asin);(oa.geo.orthographic=function(){return Kt(Co)}).raw=Co;var zo=Ee(function(n){return 1/(1+n)},function(n){return 2*Math.atan(n)});(oa.geo.stereographic=function(){return Kt(zo)}).raw=zo,Te.invert=function(n,t){return[Math.atan2(U(n),Math.cos(t)),Y(Math.sin(t)/I(n))]},(oa.geo.transverseMercator=function(){return Ne(Te)}).raw=Te,oa.geom={},oa.svg={},oa.svg.line=function(){return Ce(ft)};var Do=oa.map({linear:je,"linear-closed":Le,"step-before":Fe,"step-after":He,basis:Ie,"basis-open":Ve,"basis-closed":Xe,bundle:Ze,cardinal:Oe,"cardinal-open":Pe,"cardinal-closed":Re,monotone:We});Do.forEach(function(n,t){t.key=n,t.closed=/-closed$/.test(n)});var jo=[0,2/3,1/3,0],Lo=[0,1/3,2/3,0],Fo=[0,1/6,2/3,1/6];oa.geom.hull=function(n){function t(n){if(n.length<3)return[];var t,u,i,a,o,c,l,f,s,h,g,p,d=lt(e),m=lt(r),v=n.length,y=v-1,M=[],x=[],b=0;if(d===ze&&r===De)t=n;else for(i=0,t=[];v>i;++i)t.push([+d.call(this,u=n[i],i),+m.call(this,u,i)]);for(i=1;v>i;++i)t[i][1]<t[b][1]?b=i:t[i][1]==t[b][1]&&(b=t[i][0]<t[b][0]?i:b);for(i=0;v>i;++i)i!==b&&(c=t[i][1]-t[b][1],o=t[i][0]-t[b][0],M.push({angle:Math.atan2(c,o),index:i}));for(M.sort(function(n,t){return n.angle-t.angle}),g=M[0].angle,h=M[0].index,s=0,i=1;y>i;++i)a=M[i].index,g==M[i].angle?(o=t[h][0]-t[b][0],c=t[h][1]-t[b][1],l=t[a][0]-t[b][0],f=t[a][1]-t[b][1],o*o+c*c>=l*l+f*f?M[i].index=-1:(M[s].index=-1,g=M[i].angle,s=i,h=a)):(g=M[i].angle,s=i,h=a);for(x.push(b),i=0,a=0;2>i;++a)-1!==M[a].index&&(x.push(M[a].index),i++);for(p=x.length;y>a;++a)if(-1!==M[a].index){for(;!Qe(x[p-2],x[p-1],M[a].index,t);)--p;x[p++]=M[a].index}var _=[];for(i=0;p>i;++i)_.push(n[x[i]]);return _}var e=ze,r=De;return arguments.length?t(n):(t.x=function(n){return arguments.length?(e=n,t):e},t.y=function(n){return arguments.length?(r=n,t):r},t)},oa.geom.polygon=function(n){return n.area=function(){for(var t=0,e=n.length,r=n[e-1][1]*n[0][0]-n[e-1][0]*n[0][1];++t<e;)r+=n[t-1][1]*n[t][0]-n[t-1][0]*n[t][1];return.5*r},n.centroid=function(t){var e,r,u=-1,i=n.length,a=0,o=0,c=n[i-1];for(arguments.length||(t=-1/(6*n.area()));++u<i;)e=c,c=n[u],r=e[0]*c[1]-c[0]*e[1],a+=(e[0]+c[0])*r,o+=(e[1]+c[1])*r;return[a*t,o*t]},n.clip=function(t){for(var e,r,u,i,a,o,c=-1,l=n.length,f=n[l-1];++c<l;){for(e=t.slice(),t.length=0,i=n[c],a=e[(u=e.length)-1],r=-1;++r<u;)o=e[r],nr(o,f,i)?(nr(a,f,i)||t.push(tr(a,o,f,i)),t.push(o)):nr(a,f,i)&&t.push(tr(a,o,f,i)),a=o;f=i}return t},n},oa.geom.delaunay=function(n){var t=n.map(function(){return[]}),e=[];return er(n,function(e){t[e.region.l.index].push(n[e.region.r.index])}),t.forEach(function(t,r){var u=n[r],i=u[0],a=u[1];t.forEach(function(n){n.angle=Math.atan2(n[0]-i,n[1]-a)}),t.sort(function(n,t){return n.angle-t.angle});for(var o=0,c=t.length-1;c>o;o++)e.push([u,t[o],t[o+1]])}),e},oa.geom.voronoi=function(n){function t(n){var t,r,a,o=n.map(function(){return[]}),c=lt(u),l=lt(i),f=n.length,s=1e6;if(c===ze&&l===De)t=n;else for(t=[],a=0;f>a;++a)t.push([+c.call(this,r=n[a],a),+l.call(this,r,a)]);if(er(t,function(n){var t,e,r,u,i,a;1===n.a&&n.b>=0?(t=n.ep.r,e=n.ep.l):(t=n.ep.l,e=n.ep.r),1===n.a?(i=t?t.y:-s,r=n.c-n.b*i,a=e?e.y:s,u=n.c-n.b*a):(r=t?t.x:-s,i=n.c-n.a*r,u=e?e.x:s,a=n.c-n.a*u);var c=[r,i],l=[u,a];o[n.region.l.index].push(c,l),o[n.region.r.index].push(c,l)}),o=o.map(function(n,e){var r=t[e][0],u=t[e][1],i=n.map(function(n){return Math.atan2(n[0]-r,n[1]-u)}),a=oa.range(n.length).sort(function(n,t){return i[n]-i[t]});return a.filter(function(n,t){return!t||i[n]-i[a[t-1]]>Fa}).map(function(t){return n[t]})}),o.forEach(function(n,e){var r=n.length;if(!r)return n.push([-s,-s],[-s,s],[s,s],[s,-s]);if(!(r>2)){var u=t[e],i=n[0],a=n[1],o=u[0],c=u[1],l=i[0],f=i[1],h=a[0],g=a[1],p=Math.abs(h-l),d=g-f;if(Math.abs(d)<Fa){var m=f>c?-s:s;n.push([-s,m],[s,m])}else if(Fa>p){var v=l>o?-s:s;n.push([v,-s],[v,s])}else{var m=(l-o)*(g-f)>(h-l)*(f-c)?s:-s,y=Math.abs(d)-p;Math.abs(y)<Fa?n.push([0>d?m:-m,m]):(y>0&&(m*=-1),n.push([-s,m],[s,m]))}}}),e)for(a=0;f>a;++a)e(o[a]);for(a=0;f>a;++a)o[a].point=n[a];return o}var e,r=null,u=ze,i=De;return arguments.length?t(n):(t.x=function(n){return arguments.length?(u=n,t):u},t.y=function(n){return arguments.length?(i=n,t):i},t.size=function(n){return arguments.length?(null==n?e=null:(r=[+n[0],+n[1]],e=oa.geom.polygon([[0,0],[0,r[1]],r,[r[0],0]]).clip),t):r},t.links=function(n){var t,e,r,a=n.map(function(){return[]}),o=[],c=lt(u),l=lt(i),f=n.length;if(c===ze&&l===De)t=n;else for(r=0;f>r;++r)t.push([+c.call(this,e=n[r],r),+l.call(this,e,r)]);return er(t,function(t){var e=t.region.l.index,r=t.region.r.index;a[e][r]||(a[e][r]=a[r][e]=!0,o.push({source:n[e],target:n[r]}))}),o},t.triangles=function(n){if(u===ze&&i===De)return oa.geom.delaunay(n);var t,e,r,a,o,c=lt(u),l=lt(i);for(a=0,t=[],o=n.length;o>a;++a)e=[+c.call(this,r=n[a],a),+l.call(this,r,a)],e.data=r,t.push(e);return oa.geom.delaunay(t).map(function(n){return n.map(function(n){return n.data})})},t)};var Ho={l:"r",r:"l"};oa.geom.quadtree=function(n,t,e,r,u){function i(n){function i(n,t,e,r,u,i,a,o){if(!isNaN(e)&&!isNaN(r))if(n.leaf){var c=n.x,f=n.y;if(null!=c)if(Math.abs(c-e)+Math.abs(f-r)<.01)l(n,t,e,r,u,i,a,o);else{var s=n.point;n.x=n.y=n.point=null,l(n,s,c,f,u,i,a,o),l(n,t,e,r,u,i,a,o)}else n.x=e,n.y=r,n.point=t}else l(n,t,e,r,u,i,a,o)}function l(n,t,e,r,u,a,o,c){var l=.5*(u+o),f=.5*(a+c),s=e>=l,h=r>=f,g=(h<<1)+s;n.leaf=!1,n=n.nodes[g]||(n.nodes[g]=ir()),s?u=l:o=l,h?a=f:c=f,i(n,t,e,r,u,a,o,c)}var f,s,h,g,p,d,m,v,y,M=lt(o),x=lt(c);if(null!=t)d=t,m=e,v=r,y=u;else if(v=y=-(d=m=1/0),s=[],h=[],p=n.length,a)for(g=0;p>g;++g)f=n[g],f.x<d&&(d=f.x),f.y<m&&(m=f.y),f.x>v&&(v=f.x),f.y>y&&(y=f.y),s.push(f.x),h.push(f.y);else for(g=0;p>g;++g){var b=+M(f=n[g],g),_=+x(f,g);d>b&&(d=b),m>_&&(m=_),b>v&&(v=b),_>y&&(y=_),s.push(b),h.push(_)}var w=v-d,S=y-m;w>S?y=m+w:v=d+S;var E=ir();if(E.add=function(n){i(E,n,+M(n,++g),+x(n,g),d,m,v,y)},E.visit=function(n){ar(n,E,d,m,v,y)},g=-1,null==t){for(;++g<p;)i(E,n[g],s[g],h[g],d,m,v,y);--g}else n.forEach(E.add);return s=h=n=f=null,E}var a,o=ze,c=De;return(a=arguments.length)?(o=rr,c=ur,3===a&&(u=e,r=t,e=t=0),i(n)):(i.x=function(n){return arguments.length?(o=n,i):o},i.y=function(n){return arguments.length?(c=n,i):c},i.size=function(n){return arguments.length?(null==n?t=e=r=u=null:(t=e=0,r=+n[0],u=+n[1]),i):null==t?null:[r,u]},i)},oa.interpolateRgb=or,oa.transform=function(n){var t=ca.createElementNS(oa.ns.prefix.svg,"g");return(oa.transform=function(n){t.setAttribute("transform",n);var e=t.transform.baseVal.consolidate();return new cr(e?e.matrix:Po)})(n)},cr.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var Po={a:1,b:0,c:0,d:1,e:0,f:0};oa.interpolateNumber=hr,oa.interpolateTransform=gr,oa.interpolateObject=pr,oa.interpolateString=dr;var Ro=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;oa.interpolate=mr,oa.interpolators=[pr,function(n,t){return Array.isArray(t)&&yr(n,t)},function(n,t){return("string"==typeof n||"string"==typeof t)&&dr(n+"",t+"")},function(n,t){return("string"==typeof t?Za.has(t)||/^(#|rgb\(|hsl\()/.test(t):t instanceof L)&&or(n,t)},function(n,t){return!isNaN(n=+n)&&!isNaN(t=+t)&&hr(n,t)}],oa.interpolateArray=yr;var Oo=function(){return ft},Yo=oa.map({linear:Oo,poly:Er,quad:function(){return _r},cubic:function(){return wr},sin:function(){return kr},exp:function(){return Ar},circle:function(){return qr},elastic:Nr,back:Tr,bounce:function(){return Cr}}),Uo=oa.map({"in":ft,out:xr,"in-out":br,"out-in":function(n){return br(xr(n))}});oa.ease=function(n){var t=n.indexOf("-"),e=t>=0?n.substring(0,t):n,r=t>=0?n.substring(t+1):"in";return e=Yo.get(e)||Oo,r=Uo.get(r)||ft,Mr(r(e.apply(null,Array.prototype.slice.call(arguments,1))))},oa.interpolateHcl=zr,oa.interpolateHsl=Dr,oa.interpolateLab=jr,oa.interpolateRound=Lr,oa.layout={},oa.layout.bundle=function(){return function(n){for(var t=[],e=-1,r=n.length;++e<r;)t.push(Pr(n[e]));return t}},oa.layout.chord=function(){function n(){var n,l,s,h,g,p={},d=[],m=oa.range(i),v=[];for(e=[],r=[],n=0,h=-1;++h<i;){for(l=0,g=-1;++g<i;)l+=u[h][g];d.push(l),v.push(oa.range(i)),n+=l}for(a&&m.sort(function(n,t){return a(d[n],d[t])}),o&&v.forEach(function(n,t){n.sort(function(n,e){return o(u[t][n],u[t][e])})}),n=(2*La-f*i)/n,l=0,h=-1;++h<i;){for(s=l,g=-1;++g<i;){var y=m[h],M=v[y][g],x=u[y][M],b=l,_=l+=x*n;p[y+"-"+M]={index:y,subindex:M,startAngle:b,endAngle:_,value:x}}r[y]={index:y,startAngle:s,endAngle:l,value:(l-s)/n},l+=f}for(h=-1;++h<i;)for(g=h-1;++g<i;){var w=p[h+"-"+g],S=p[g+"-"+h];(w.value||S.value)&&e.push(w.value<S.value?{source:S,target:w}:{source:w,target:S})}c&&t()}function t(){e.sort(function(n,t){return c((n.source.value+n.target.value)/2,(t.source.value+t.target.value)/2)})}var e,r,u,i,a,o,c,l={},f=0;return l.matrix=function(n){return arguments.length?(i=(u=n)&&u.length,e=r=null,l):u},l.padding=function(n){return arguments.length?(f=n,e=r=null,l):f},l.sortGroups=function(n){return arguments.length?(a=n,e=r=null,l):a},l.sortSubgroups=function(n){return arguments.length?(o=n,e=null,l):o},l.sortChords=function(n){return arguments.length?(c=n,e&&t(),l):c},l.chords=function(){return e||n(),e},l.groups=function(){return r||n(),r},l},oa.layout.force=function(){function n(n){return function(t,e,r,u){if(t.point!==n){var i=t.cx-n.x,a=t.cy-n.y,o=1/Math.sqrt(i*i+a*a);if(d>(u-e)*o){var c=t.charge*o*o;return n.px-=i*c,n.py-=a*c,!0}if(t.point&&isFinite(o)){var c=t.pointCharge*o*o;n.px-=i*c,n.py-=a*c}}return!t.charge}}function t(n){n.px=oa.event.x,n.py=oa.event.y,o.resume()}var e,r,u,i,a,o={},c=oa.dispatch("start","tick","end"),l=[1,1],f=.9,s=Io,h=Vo,g=-30,p=.1,d=.8,m=[],v=[];return o.tick=function(){if((r*=.99)<.005)return c.end({type:"end",alpha:r=0}),!0;var t,e,o,s,h,d,y,M,x,b=m.length,_=v.length;for(e=0;_>e;++e)o=v[e],s=o.source,h=o.target,M=h.x-s.x,x=h.y-s.y,(d=M*M+x*x)&&(d=r*i[e]*((d=Math.sqrt(d))-u[e])/d,M*=d,x*=d,h.x-=M*(y=s.weight/(h.weight+s.weight)),h.y-=x*y,s.x+=M*(y=1-y),s.y+=x*y);if((y=r*p)&&(M=l[0]/2,x=l[1]/2,e=-1,y))for(;++e<b;)o=m[e],o.x+=(M-o.x)*y,o.y+=(x-o.y)*y;if(g)for(Xr(t=oa.geom.quadtree(m),r,a),e=-1;++e<b;)(o=m[e]).fixed||t.visit(n(o));for(e=-1;++e<b;)o=m[e],o.fixed?(o.x=o.px,o.y=o.py):(o.x-=(o.px-(o.px=o.x))*f,o.y-=(o.py-(o.py=o.y))*f);c.tick({type:"tick",alpha:r})},o.nodes=function(n){return arguments.length?(m=n,o):m},o.links=function(n){return arguments.length?(v=n,o):v},o.size=function(n){return arguments.length?(l=n,o):l},o.linkDistance=function(n){return arguments.length?(s="function"==typeof n?n:+n,o):s},o.distance=o.linkDistance,o.linkStrength=function(n){return arguments.length?(h="function"==typeof n?n:+n,o):h},o.friction=function(n){return arguments.length?(f=+n,o):f},o.charge=function(n){return arguments.length?(g="function"==typeof n?n:+n,o):g},o.gravity=function(n){return arguments.length?(p=+n,o):p},o.theta=function(n){return arguments.length?(d=+n,o):d},o.alpha=function(n){return arguments.length?(n=+n,r?r=n>0?n:0:n>0&&(c.start({type:"start",alpha:r=n}),oa.timer(o.tick)),o):r},o.start=function(){function n(n,r){for(var u,i=t(e),a=-1,o=i.length;++a<o;)if(!isNaN(u=i[a][n]))return u;return Math.random()*r}function t(){if(!c){for(c=[],r=0;p>r;++r)c[r]=[];for(r=0;d>r;++r){var n=v[r];c[n.source.index].push(n.target),c[n.target.index].push(n.source)}}return c[e]}var e,r,c,f,p=m.length,d=v.length,y=l[0],M=l[1];for(e=0;p>e;++e)(f=m[e]).index=e,f.weight=0;for(e=0;d>e;++e)f=v[e],"number"==typeof f.source&&(f.source=m[f.source]),"number"==typeof f.target&&(f.target=m[f.target]),++f.source.weight,++f.target.weight;for(e=0;p>e;++e)f=m[e],isNaN(f.x)&&(f.x=n("x",y)),isNaN(f.y)&&(f.y=n("y",M)),isNaN(f.px)&&(f.px=f.x),isNaN(f.py)&&(f.py=f.y);if(u=[],"function"==typeof s)for(e=0;d>e;++e)u[e]=+s.call(this,v[e],e);else for(e=0;d>e;++e)u[e]=s;if(i=[],"function"==typeof h)for(e=0;d>e;++e)i[e]=+h.call(this,v[e],e);else for(e=0;d>e;++e)i[e]=h;if(a=[],"function"==typeof g)for(e=0;p>e;++e)a[e]=+g.call(this,m[e],e);else for(e=0;p>e;++e)a[e]=g;return o.resume()},o.resume=function(){return o.alpha(.1)},o.stop=function(){return o.alpha(0)},o.drag=function(){return e||(e=oa.behavior.drag().origin(ft).on("dragstart.force",Yr).on("drag.force",t).on("dragend.force",Ur)),arguments.length?void this.on("mouseover.force",Ir).on("mouseout.force",Vr).call(e):e},oa.rebind(o,c,"on")};var Io=20,Vo=1;oa.layout.hierarchy=function(){function n(t,a,o){var c=u.call(e,t,a);if(t.depth=a,o.push(t),c&&(l=c.length)){for(var l,f,s=-1,h=t.children=[],g=0,p=a+1;++s<l;)f=n(c[s],p,o),f.parent=t,h.push(f),g+=f.value;r&&h.sort(r),i&&(t.value=g)}else i&&(t.value=+i.call(e,t,a)||0);return t}function t(n,r){var u=n.children,a=0;if(u&&(o=u.length))for(var o,c=-1,l=r+1;++c<o;)a+=t(u[c],l);else i&&(a=+i.call(e,n,r)||0);return i&&(n.value=a),a}function e(t){var e=[];return n(t,0,e),e}var r=Jr,u=Br,i=$r;return e.sort=function(n){return arguments.length?(r=n,e):r},e.children=function(n){return arguments.length?(u=n,e):u},e.value=function(n){return arguments.length?(i=n,e):i},e.revalue=function(n){return t(n,0),n},e},oa.layout.partition=function(){function n(t,e,r,u){var i=t.children;if(t.x=e,t.y=t.depth*u,t.dx=r,t.dy=u,i&&(a=i.length)){var a,o,c,l=-1;for(r=t.value?r/t.value:0;++l<a;)n(o=i[l],e,c=o.value*r,u),e+=c}}function t(n){var e=n.children,r=0;if(e&&(u=e.length))for(var u,i=-1;++i<u;)r=Math.max(r,t(e[i]));return 1+r}function e(e,i){var a=r.call(this,e,i);return n(a[0],0,u[0],u[1]/t(a[0])),a}var r=oa.layout.hierarchy(),u=[1,1];return e.size=function(n){return arguments.length?(u=n,e):u},Zr(e,r)},oa.layout.pie=function(){function n(i){var a=i.map(function(e,r){return+t.call(n,e,r)}),o=+("function"==typeof r?r.apply(this,arguments):r),c=(("function"==typeof u?u.apply(this,arguments):u)-o)/oa.sum(a),l=oa.range(i.length);null!=e&&l.sort(e===Xo?function(n,t){return a[t]-a[n]}:function(n,t){return e(i[n],i[t])});var f=[];return l.forEach(function(n){var t;f[n]={data:i[n],value:t=a[n],startAngle:o,endAngle:o+=t*c}}),f}var t=Number,e=Xo,r=0,u=2*La;return n.value=function(e){return arguments.length?(t=e,n):t},n.sort=function(t){return arguments.length?(e=t,n):e},n.startAngle=function(t){return arguments.length?(r=t,n):r},n.endAngle=function(t){return arguments.length?(u=t,n):u},n};var Xo={};oa.layout.stack=function(){function n(o,c){var l=o.map(function(e,r){return t.call(n,e,r)}),f=l.map(function(t){return t.map(function(t,e){return[i.call(n,t,e),a.call(n,t,e)]})}),s=e.call(n,f,c);l=oa.permute(l,s),f=oa.permute(f,s);var h,g,p,d=r.call(n,f,c),m=l.length,v=l[0].length;for(g=0;v>g;++g)for(u.call(n,l[0][g],p=d[g],f[0][g][1]),h=1;m>h;++h)u.call(n,l[h][g],p+=f[h-1][g][1],f[h][g][1]);return o}var t=ft,e=nu,r=tu,u=Qr,i=Kr,a=Wr;return n.values=function(e){return arguments.length?(t=e,n):t},n.order=function(t){return arguments.length?(e="function"==typeof t?t:Zo.get(t)||nu,n):e},n.offset=function(t){return arguments.length?(r="function"==typeof t?t:Bo.get(t)||tu,n):r},n.x=function(t){return arguments.length?(i=t,n):i},n.y=function(t){return arguments.length?(a=t,n):a},n.out=function(t){return arguments.length?(u=t,n):u},n};var Zo=oa.map({"inside-out":function(n){var t,e,r=n.length,u=n.map(eu),i=n.map(ru),a=oa.range(r).sort(function(n,t){return u[n]-u[t]}),o=0,c=0,l=[],f=[];for(t=0;r>t;++t)e=a[t],c>o?(o+=i[e],l.push(e)):(c+=i[e],f.push(e));return f.reverse().concat(l)},reverse:function(n){return oa.range(n.length).reverse()},"default":nu}),Bo=oa.map({silhouette:function(n){var t,e,r,u=n.length,i=n[0].length,a=[],o=0,c=[];for(e=0;i>e;++e){for(t=0,r=0;u>t;t++)r+=n[t][e][1];r>o&&(o=r),a.push(r)}for(e=0;i>e;++e)c[e]=(o-a[e])/2;return c},wiggle:function(n){var t,e,r,u,i,a,o,c,l,f=n.length,s=n[0],h=s.length,g=[];for(g[0]=c=l=0,e=1;h>e;++e){for(t=0,u=0;f>t;++t)u+=n[t][e][1];for(t=0,i=0,o=s[e][0]-s[e-1][0];f>t;++t){for(r=0,a=(n[t][e][1]-n[t][e-1][1])/(2*o);t>r;++r)a+=(n[r][e][1]-n[r][e-1][1])/o;i+=a*n[t][e][1]}g[e]=c-=u?i/u*o:0,l>c&&(l=c)}for(e=0;h>e;++e)g[e]-=l;return g},expand:function(n){var t,e,r,u=n.length,i=n[0].length,a=1/u,o=[];for(e=0;i>e;++e){for(t=0,r=0;u>t;t++)r+=n[t][e][1];if(r)for(t=0;u>t;t++)n[t][e][1]/=r;else for(t=0;u>t;t++)n[t][e][1]=a}for(e=0;i>e;++e)o[e]=0;return o},zero:tu});oa.layout.histogram=function(){function n(n,i){for(var a,o,c=[],l=n.map(e,this),f=r.call(this,l,i),s=u.call(this,f,l,i),i=-1,h=l.length,g=s.length-1,p=t?1:1/h;++i<g;)a=c[i]=[],a.dx=s[i+1]-(a.x=s[i]),a.y=0;if(g>0)for(i=-1;++i<h;)o=l[i],o>=f[0]&&o<=f[1]&&(a=c[oa.bisect(s,o,1,g)-1],a.y+=p,a.push(n[i]));return c}var t=!0,e=Number,r=ou,u=iu;return n.value=function(t){return arguments.length?(e=t,n):e},n.range=function(t){return arguments.length?(r=lt(t),n):r},n.bins=function(t){return arguments.length?(u="number"==typeof t?function(n){return au(n,t)}:lt(t),n):u},n.frequency=function(e){return arguments.length?(t=!!e,n):t},n},oa.layout.tree=function(){function n(n,u){function i(n,t){var r=n.children,u=n._tree;if(r&&(a=r.length)){for(var a,c,l,f=r[0],s=f,h=-1;++h<a;)l=r[h],i(l,c),s=o(l,c,s),c=l;mu(n);var g=.5*(f._tree.prelim+l._tree.prelim);t?(u.prelim=t._tree.prelim+e(n,t),u.mod=u.prelim-g):u.prelim=g}else t&&(u.prelim=t._tree.prelim+e(n,t))}function a(n,t){n.x=n._tree.prelim+t;var e=n.children;if(e&&(r=e.length)){var r,u=-1;for(t+=n._tree.mod;++u<r;)a(e[u],t)}}function o(n,t,r){if(t){for(var u,i=n,a=n,o=t,c=n.parent.children[0],l=i._tree.mod,f=a._tree.mod,s=o._tree.mod,h=c._tree.mod;o=fu(o),i=lu(i),o&&i;)c=lu(c),a=fu(a),a._tree.ancestor=n,u=o._tree.prelim+s-i._tree.prelim-l+e(o,i),u>0&&(vu(yu(o,n,r),n,u),l+=u,f+=u),s+=o._tree.mod,l+=i._tree.mod,h+=c._tree.mod,f+=a._tree.mod;o&&!fu(a)&&(a._tree.thread=o,a._tree.mod+=s-f),i&&!lu(c)&&(c._tree.thread=i,c._tree.mod+=l-h,r=n)}return r}var c=t.call(this,n,u),l=c[0];du(l,function(n,t){n._tree={ancestor:n,prelim:0,mod:0,change:0,shift:0,number:t?t._tree.number+1:0}}),i(l),a(l,-l._tree.prelim);var f=su(l,gu),s=su(l,hu),h=su(l,pu),g=f.x-e(f,s)/2,p=s.x+e(s,f)/2,d=h.depth||1;return du(l,function(n){n.x=(n.x-g)/(p-g)*r[0],n.y=n.depth/d*r[1],delete n._tree}),c}var t=oa.layout.hierarchy().sort(null).value(null),e=cu,r=[1,1];return n.separation=function(t){return arguments.length?(e=t,n):e},n.size=function(t){return arguments.length?(r=t,n):r},Zr(n,t)},oa.layout.pack=function(){function n(n,u){var i=t.call(this,n,u),a=i[0];a.x=0,a.y=0,du(a,function(n){n.r=Math.sqrt(n.value)}),du(a,wu);var o=r[0],c=r[1],l=Math.max(2*a.r/o,2*a.r/c);if(e>0){var f=e*l/2;du(a,function(n){n.r+=f}),du(a,wu),du(a,function(n){n.r-=f}),l=Math.max(2*a.r/o,2*a.r/c)}return ku(a,o/2,c/2,1/l),i}var t=oa.layout.hierarchy().sort(Mu),e=0,r=[1,1];return n.size=function(t){return arguments.length?(r=t,n):r},n.padding=function(t){return arguments.length?(e=+t,n):e},Zr(n,t)},oa.layout.cluster=function(){function n(n,u){var i,a=t.call(this,n,u),o=a[0],c=0;du(o,function(n){var t=n.children;t&&t.length?(n.x=Nu(t),n.y=qu(t)):(n.x=i?c+=e(n,i):0,n.y=0,i=n)});var l=Tu(o),f=Cu(o),s=l.x-e(l,f)/2,h=f.x+e(f,l)/2;return du(o,function(n){n.x=(n.x-s)/(h-s)*r[0],n.y=(1-(o.y?n.y/o.y:1))*r[1]}),a}var t=oa.layout.hierarchy().sort(null).value(null),e=cu,r=[1,1];return n.separation=function(t){return arguments.length?(e=t,n):e},n.size=function(t){return arguments.length?(r=t,n):r},Zr(n,t)},oa.layout.treemap=function(){function n(n,t){for(var e,r,u=-1,i=n.length;++u<i;)r=(e=n[u]).value*(0>t?0:t),e.area=isNaN(r)||0>=r?0:r}function t(e){var i=e.children;if(i&&i.length){var a,o,c,l=s(e),f=[],h=i.slice(),p=1/0,d="slice"===g?l.dx:"dice"===g?l.dy:"slice-dice"===g?1&e.depth?l.dy:l.dx:Math.min(l.dx,l.dy);for(n(h,l.dx*l.dy/e.value),f.area=0;(c=h.length)>0;)f.push(a=h[c-1]),f.area+=a.area,"squarify"!==g||(o=r(f,d))<=p?(h.pop(),p=o):(f.area-=f.pop().area,u(f,d,l,!1),d=Math.min(l.dx,l.dy),f.length=f.area=0,p=1/0);f.length&&(u(f,d,l,!0),f.length=f.area=0),i.forEach(t)}}function e(t){var r=t.children;if(r&&r.length){var i,a=s(t),o=r.slice(),c=[];for(n(o,a.dx*a.dy/t.value),c.area=0;i=o.pop();)c.push(i),c.area+=i.area,null!=i.z&&(u(c,i.z?a.dx:a.dy,a,!o.length),c.length=c.area=0);r.forEach(e)}}function r(n,t){for(var e,r=n.area,u=0,i=1/0,a=-1,o=n.length;++a<o;)(e=n[a].area)&&(i>e&&(i=e),e>u&&(u=e));return r*=r,t*=t,r?Math.max(t*u*p/r,r/(t*i*p)):1/0}function u(n,t,e,r){var u,i=-1,a=n.length,o=e.x,l=e.y,f=t?c(n.area/t):0;if(t==e.dx){for((r||f>e.dy)&&(f=e.dy);++i<a;)u=n[i],u.x=o,u.y=l,u.dy=f,o+=u.dx=Math.min(e.x+e.dx-o,f?c(u.area/f):0);u.z=!0,u.dx+=e.x+e.dx-o,e.y+=f,e.dy-=f}else{for((r||f>e.dx)&&(f=e.dx);++i<a;)u=n[i],u.x=o,u.y=l,u.dx=f,l+=u.dy=Math.min(e.y+e.dy-l,f?c(u.area/f):0);u.z=!1,u.dy+=e.y+e.dy-l,e.x+=f,e.dx-=f}}function i(r){var u=a||o(r),i=u[0];return i.x=0,i.y=0,i.dx=l[0],i.dy=l[1],a&&o.revalue(i),n([i],i.dx*i.dy/i.value),(a?e:t)(i),h&&(a=u),u}var a,o=oa.layout.hierarchy(),c=Math.round,l=[1,1],f=null,s=zu,h=!1,g="squarify",p=.5*(1+Math.sqrt(5));return i.size=function(n){return arguments.length?(l=n,i):l},i.padding=function(n){function t(t){var e=n.call(i,t,t.depth);return null==e?zu(t):Du(t,"number"==typeof e?[e,e,e,e]:e)}function e(t){return Du(t,n)}if(!arguments.length)return f;var r;return s=null==(f=n)?zu:"function"==(r=typeof n)?t:"number"===r?(n=[n,n,n,n],e):e,i},i.round=function(n){return arguments.length?(c=n?Math.round:Number,i):c!=Number},i.sticky=function(n){return arguments.length?(h=n,a=null,i):h},i.ratio=function(n){return arguments.length?(p=n,i):p},i.mode=function(n){return arguments.length?(g=n+"",i):g},Zr(i,o)},oa.random={normal:function(n,t){var e=arguments.length;return 2>e&&(t=1),1>e&&(n=0),function(){var e,r,u;do e=2*Math.random()-1,r=2*Math.random()-1,u=e*e+r*r;while(!u||u>1);return n+t*e*Math.sqrt(-2*Math.log(u)/u)}},logNormal:function(){var n=oa.random.normal.apply(oa,arguments);return function(){return Math.exp(n())}},irwinHall:function(n){return function(){for(var t=0,e=0;n>e;e++)t+=Math.random();return t/n}}},oa.scale={},oa.scale.linear=function(){return Ru([0,1],[0,1],mr,!1)},oa.scale.log=function(){return Xu(oa.scale.linear().domain([0,Math.LN10]),10,Zu,Bu)};var $o=oa.format(".0e");oa.scale.pow=function(){return Ku(oa.scale.linear(),1)},oa.scale.sqrt=function(){return oa.scale.pow().exponent(.5)},oa.scale.ordinal=function(){return Qu([],{t:"range",a:[[]]})},oa.scale.category10=function(){return oa.scale.ordinal().range(Jo)},oa.scale.category20=function(){return oa.scale.ordinal().range(Go)},oa.scale.category20b=function(){return oa.scale.ordinal().range(Ko)},oa.scale.category20c=function(){return oa.scale.ordinal().range(Wo)};var Jo=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],Go=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],Ko=["#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6"],Wo=["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"];oa.scale.quantile=function(){return ni([],[])},oa.scale.quantize=function(){return ti(0,1,[0,1])},oa.scale.threshold=function(){return ei([.5],[0,1])},oa.scale.identity=function(){return ri([0,1])},oa.svg.arc=function(){function n(){var n=t.apply(this,arguments),i=e.apply(this,arguments),a=r.apply(this,arguments)+Qo,o=u.apply(this,arguments)+Qo,c=(a>o&&(c=a,a=o,o=c),o-a),l=La>c?"0":"1",f=Math.cos(a),s=Math.sin(a),h=Math.cos(o),g=Math.sin(o);return c>=nc?n?"M0,"+i+"A"+i+","+i+" 0 1,1 0,"+-i+"A"+i+","+i+" 0 1,1 0,"+i+"M0,"+n+"A"+n+","+n+" 0 1,0 0,"+-n+"A"+n+","+n+" 0 1,0 0,"+n+"Z":"M0,"+i+"A"+i+","+i+" 0 1,1 0,"+-i+"A"+i+","+i+" 0 1,1 0,"+i+"Z":n?"M"+i*f+","+i*s+"A"+i+","+i+" 0 "+l+",1 "+i*h+","+i*g+"L"+n*h+","+n*g+"A"+n+","+n+" 0 "+l+",0 "+n*f+","+n*s+"Z":"M"+i*f+","+i*s+"A"+i+","+i+" 0 "+l+",1 "+i*h+","+i*g+"L0,0Z"}var t=ui,e=ii,r=ai,u=oi;return n.innerRadius=function(e){return arguments.length?(t=lt(e),n):t},n.outerRadius=function(t){return arguments.length?(e=lt(t),n):e},n.startAngle=function(t){return arguments.length?(r=lt(t),n):r},n.endAngle=function(t){return arguments.length?(u=lt(t),n):u},n.centroid=function(){var n=(t.apply(this,arguments)+e.apply(this,arguments))/2,i=(r.apply(this,arguments)+u.apply(this,arguments))/2+Qo;return[Math.cos(i)*n,Math.sin(i)*n]},n};var Qo=-La/2,nc=2*La-1e-6;oa.svg.line.radial=function(){var n=Ce(ci);return n.radius=n.x,delete n.x,n.angle=n.y,delete n.y,n},Fe.reverse=He,He.reverse=Fe,oa.svg.area=function(){return li(ft)},oa.svg.area.radial=function(){var n=li(ci);return n.radius=n.x,delete n.x,n.innerRadius=n.x0,delete n.x0,n.outerRadius=n.x1,delete n.x1,n.angle=n.y,delete n.y,n.startAngle=n.y0,delete n.y0,n.endAngle=n.y1,delete n.y1,n
},oa.svg.chord=function(){function n(n,o){var c=t(this,i,n,o),l=t(this,a,n,o);return"M"+c.p0+r(c.r,c.p1,c.a1-c.a0)+(e(c,l)?u(c.r,c.p1,c.r,c.p0):u(c.r,c.p1,l.r,l.p0)+r(l.r,l.p1,l.a1-l.a0)+u(l.r,l.p1,c.r,c.p0))+"Z"}function t(n,t,e,r){var u=t.call(n,e,r),i=o.call(n,u,r),a=c.call(n,u,r)+Qo,f=l.call(n,u,r)+Qo;return{r:i,a0:a,a1:f,p0:[i*Math.cos(a),i*Math.sin(a)],p1:[i*Math.cos(f),i*Math.sin(f)]}}function e(n,t){return n.a0==t.a0&&n.a1==t.a1}function r(n,t,e){return"A"+n+","+n+" 0 "+ +(e>La)+",1 "+t}function u(n,t,e,r){return"Q 0,0 "+r}var i=le,a=fe,o=fi,c=ai,l=oi;return n.radius=function(t){return arguments.length?(o=lt(t),n):o},n.source=function(t){return arguments.length?(i=lt(t),n):i},n.target=function(t){return arguments.length?(a=lt(t),n):a},n.startAngle=function(t){return arguments.length?(c=lt(t),n):c},n.endAngle=function(t){return arguments.length?(l=lt(t),n):l},n},oa.svg.diagonal=function(){function n(n,u){var i=t.call(this,n,u),a=e.call(this,n,u),o=(i.y+a.y)/2,c=[i,{x:i.x,y:o},{x:a.x,y:o},a];return c=c.map(r),"M"+c[0]+"C"+c[1]+" "+c[2]+" "+c[3]}var t=le,e=fe,r=si;return n.source=function(e){return arguments.length?(t=lt(e),n):t},n.target=function(t){return arguments.length?(e=lt(t),n):e},n.projection=function(t){return arguments.length?(r=t,n):r},n},oa.svg.diagonal.radial=function(){var n=oa.svg.diagonal(),t=si,e=n.projection;return n.projection=function(n){return arguments.length?e(hi(t=n)):t},n},oa.svg.symbol=function(){function n(n,r){return(tc.get(t.call(this,n,r))||di)(e.call(this,n,r))}var t=pi,e=gi;return n.type=function(e){return arguments.length?(t=lt(e),n):t},n.size=function(t){return arguments.length?(e=lt(t),n):e},n};var tc=oa.map({circle:di,cross:function(n){var t=Math.sqrt(n/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z"},diamond:function(n){var t=Math.sqrt(n/(2*uc)),e=t*uc;return"M0,"+-t+"L"+e+",0 0,"+t+" "+-e+",0Z"},square:function(n){var t=Math.sqrt(n)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z"},"triangle-down":function(n){var t=Math.sqrt(n/rc),e=t*rc/2;return"M0,"+e+"L"+t+","+-e+" "+-t+","+-e+"Z"},"triangle-up":function(n){var t=Math.sqrt(n/rc),e=t*rc/2;return"M0,"+-e+"L"+t+","+e+" "+-t+","+e+"Z"}});oa.svg.symbolTypes=tc.keys();var ec,rc=Math.sqrt(3),uc=Math.tan(30*Ha),ic=[],ac=0,oc={ease:Sr,delay:0,duration:250};ic.call=Ea.call,ic.empty=Ea.empty,ic.node=Ea.node,oa.transition=function(n){return arguments.length?ec?n.transition():n:Ta.transition()},oa.transition.prototype=ic,ic.select=function(n){var t,e,r,u=this.id,i=[];"function"!=typeof n&&(n=m(n));for(var a=-1,o=this.length;++a<o;){i.push(t=[]);for(var c=this[a],l=-1,f=c.length;++l<f;)(r=c[l])&&(e=n.call(r,r.__data__,l))?("__data__"in r&&(e.__data__=r.__data__),Mi(e,l,u,r.__transition__[u]),t.push(e)):t.push(null)}return mi(i,u)},ic.selectAll=function(n){var t,e,r,u,i,a=this.id,o=[];"function"!=typeof n&&(n=v(n));for(var c=-1,l=this.length;++c<l;)for(var f=this[c],s=-1,h=f.length;++s<h;)if(r=f[s]){i=r.__transition__[a],e=n.call(r,r.__data__,s),o.push(t=[]);for(var g=-1,p=e.length;++g<p;)Mi(u=e[g],g,a,i),t.push(u)}return mi(o,a)},ic.filter=function(n){var t,e,r,u=[];"function"!=typeof n&&(n=A(n));for(var i=0,a=this.length;a>i;i++){u.push(t=[]);for(var e=this[i],o=0,c=e.length;c>o;o++)(r=e[o])&&n.call(r,r.__data__,o)&&t.push(r)}return mi(u,this.id,this.time).ease(this.ease())},ic.tween=function(n,t){var e=this.id;return arguments.length<2?this.node().__transition__[e].tween.get(n):D(this,null==t?function(t){t.__transition__[e].tween.remove(n)}:function(r){r.__transition__[e].tween.set(n,t)})},ic.attr=function(n,t){function e(){this.removeAttribute(i)}function r(){this.removeAttributeNS(i.space,i.local)}if(arguments.length<2){for(t in n)this.attr(t,n[t]);return this}var u=vr(n),i=oa.ns.qualify(n);return vi(this,"attr."+n,t,function(n){function t(){var t,e=this.getAttribute(i);return e!==n&&(t=u(e,n),function(n){this.setAttribute(i,t(n))})}function a(){var t,e=this.getAttributeNS(i.space,i.local);return e!==n&&(t=u(e,n),function(n){this.setAttributeNS(i.space,i.local,t(n))})}return null==n?i.local?r:e:(n+="",i.local?a:t)})},ic.attrTween=function(n,t){function e(n,e){var r=t.call(this,n,e,this.getAttribute(u));return r&&function(n){this.setAttribute(u,r(n))}}function r(n,e){var r=t.call(this,n,e,this.getAttributeNS(u.space,u.local));return r&&function(n){this.setAttributeNS(u.space,u.local,r(n))}}var u=oa.ns.qualify(n);return this.tween("attr."+n,u.local?r:e)},ic.style=function(n,t,e){function r(){this.style.removeProperty(n)}var u=arguments.length;if(3>u){if("string"!=typeof n){2>u&&(t="");for(e in n)this.style(e,n[e],t);return this}e=""}var i=vr(n);return vi(this,"style."+n,t,function(t){function u(){var r,u=la.getComputedStyle(this,null).getPropertyValue(n);return u!==t&&(r=i(u,t),function(t){this.style.setProperty(n,r(t),e)})}return null==t?r:(t+="",u)})},ic.styleTween=function(n,t,e){return arguments.length<3&&(e=""),this.tween("style."+n,function(r,u){var i=t.call(this,r,u,la.getComputedStyle(this,null).getPropertyValue(n));return i&&function(t){this.style.setProperty(n,i(t),e)}})},ic.text=function(n){return vi(this,"text",n,yi)},ic.remove=function(){return this.each("end.transition",function(){var n;!this.__transition__&&(n=this.parentNode)&&n.removeChild(this)})},ic.ease=function(n){var t=this.id;return arguments.length<1?this.node().__transition__[t].ease:("function"!=typeof n&&(n=oa.ease.apply(oa,arguments)),D(this,function(e){e.__transition__[t].ease=n}))},ic.delay=function(n){var t=this.id;return D(this,"function"==typeof n?function(e,r,u){e.__transition__[t].delay=0|n.call(e,e.__data__,r,u)}:(n|=0,function(e){e.__transition__[t].delay=n}))},ic.duration=function(n){var t=this.id;return D(this,"function"==typeof n?function(e,r,u){e.__transition__[t].duration=Math.max(1,0|n.call(e,e.__data__,r,u))}:(n=Math.max(1,0|n),function(e){e.__transition__[t].duration=n}))},ic.each=function(n,t){var e=this.id;if(arguments.length<2){var r=oc,u=ec;ec=e,D(this,function(t,r,u){oc=t.__transition__[e],n.call(t,t.__data__,r,u)}),oc=r,ec=u}else D(this,function(r){r.__transition__[e].event.on(n,t)});return this},ic.transition=function(){for(var n,t,e,r,u=this.id,i=++ac,a=[],o=0,c=this.length;c>o;o++){a.push(n=[]);for(var t=this[o],l=0,f=t.length;f>l;l++)(e=t[l])&&(r=Object.create(e.__transition__[u]),r.delay+=r.duration,Mi(e,l,i,r)),n.push(e)}return mi(a,i)},oa.svg.axis=function(){function n(n){n.each(function(){var n,s=oa.select(this),h=null==l?e.ticks?e.ticks.apply(e,c):e.domain():l,g=null==t?e.tickFormat?e.tickFormat.apply(e,c):String:t,p=_i(e,h,f),d=s.selectAll(".tick.minor").data(p,String),m=d.enter().insert("line",".tick").attr("class","tick minor").style("opacity",1e-6),v=oa.transition(d.exit()).style("opacity",1e-6).remove(),y=oa.transition(d).style("opacity",1),M=s.selectAll(".tick.major").data(h,String),x=M.enter().insert("g","path").attr("class","tick major").style("opacity",1e-6),b=oa.transition(M.exit()).style("opacity",1e-6).remove(),_=oa.transition(M).style("opacity",1),w=Lu(e),S=s.selectAll(".domain").data([0]),E=(S.enter().append("path").attr("class","domain"),oa.transition(S)),k=e.copy(),A=this.__chart__||k;this.__chart__=k,x.append("line"),x.append("text");var q=x.select("line"),N=_.select("line"),T=M.select("text").text(g),C=x.select("text"),z=_.select("text");switch(r){case"bottom":n=xi,m.attr("y2",i),y.attr("x2",0).attr("y2",i),q.attr("y2",u),C.attr("y",Math.max(u,0)+o),N.attr("x2",0).attr("y2",u),z.attr("x",0).attr("y",Math.max(u,0)+o),T.attr("dy",".71em").style("text-anchor","middle"),E.attr("d","M"+w[0]+","+a+"V0H"+w[1]+"V"+a);break;case"top":n=xi,m.attr("y2",-i),y.attr("x2",0).attr("y2",-i),q.attr("y2",-u),C.attr("y",-(Math.max(u,0)+o)),N.attr("x2",0).attr("y2",-u),z.attr("x",0).attr("y",-(Math.max(u,0)+o)),T.attr("dy","0em").style("text-anchor","middle"),E.attr("d","M"+w[0]+","+-a+"V0H"+w[1]+"V"+-a);break;case"left":n=bi,m.attr("x2",-i),y.attr("x2",-i).attr("y2",0),q.attr("x2",-u),C.attr("x",-(Math.max(u,0)+o)),N.attr("x2",-u).attr("y2",0),z.attr("x",-(Math.max(u,0)+o)).attr("y",0),T.attr("dy",".32em").style("text-anchor","end"),E.attr("d","M"+-a+","+w[0]+"H0V"+w[1]+"H"+-a);break;case"right":n=bi,m.attr("x2",i),y.attr("x2",i).attr("y2",0),q.attr("x2",u),C.attr("x",Math.max(u,0)+o),N.attr("x2",u).attr("y2",0),z.attr("x",Math.max(u,0)+o).attr("y",0),T.attr("dy",".32em").style("text-anchor","start"),E.attr("d","M"+a+","+w[0]+"H0V"+w[1]+"H"+a)}if(e.ticks)x.call(n,A),_.call(n,k),b.call(n,k),m.call(n,A),y.call(n,k),v.call(n,k);else{var D=k.rangeBand()/2,j=function(n){return k(n)+D};x.call(n,j),_.call(n,j)}})}var t,e=oa.scale.linear(),r=cc,u=6,i=6,a=6,o=3,c=[10],l=null,f=0;return n.scale=function(t){return arguments.length?(e=t,n):e},n.orient=function(t){return arguments.length?(r=t in lc?t+"":cc,n):r},n.ticks=function(){return arguments.length?(c=arguments,n):c},n.tickValues=function(t){return arguments.length?(l=t,n):l},n.tickFormat=function(e){return arguments.length?(t=e,n):t},n.tickSize=function(t,e){if(!arguments.length)return u;var r=arguments.length-1;return u=+t,i=r>1?+e:u,a=r>0?+arguments[r]:u,n},n.tickPadding=function(t){return arguments.length?(o=+t,n):o},n.tickSubdivide=function(t){return arguments.length?(f=+t,n):f},n};var cc="bottom",lc={top:1,right:1,bottom:1,left:1};oa.svg.brush=function(){function n(i){i.each(function(){var i,a=oa.select(this),l=a.selectAll(".background").data([0]),s=a.selectAll(".extent").data([0]),h=a.selectAll(".resize").data(f,String);a.style("pointer-events","all").on("mousedown.brush",u).on("touchstart.brush",u),l.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),s.enter().append("rect").attr("class","extent").style("cursor","move"),h.enter().append("g").attr("class",function(n){return"resize "+n}).style("cursor",function(n){return fc[n]}).append("rect").attr("x",function(n){return/[ew]$/.test(n)?-3:null}).attr("y",function(n){return/^[ns]/.test(n)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),h.style("display",n.empty()?"none":null),h.exit().remove(),o&&(i=Lu(o),l.attr("x",i[0]).attr("width",i[1]-i[0]),e(a)),c&&(i=Lu(c),l.attr("y",i[0]).attr("height",i[1]-i[0]),r(a)),t(a)})}function t(n){n.selectAll(".resize").attr("transform",function(n){return"translate("+h[+/e$/.test(n)][0]+","+h[+/^s/.test(n)][1]+")"})}function e(n){n.select(".extent").attr("x",h[0][0]),n.selectAll(".extent,.n>rect,.s>rect").attr("width",h[1][0]-h[0][0])}function r(n){n.select(".extent").attr("y",h[0][1]),n.selectAll(".extent,.e>rect,.w>rect").attr("height",h[1][1]-h[0][1])}function u(){function u(){var n=oa.event.changedTouches;return n?oa.touches(y,n)[0]:oa.mouse(y)}function f(){32==oa.event.keyCode&&(E||(m=null,k[0]-=h[1][0],k[1]-=h[1][1],E=2),l())}function s(){32==oa.event.keyCode&&2==E&&(k[0]+=h[1][0],k[1]+=h[1][1],E=0,l())}function g(){var n=u(),i=!1;v&&(n[0]+=v[0],n[1]+=v[1]),E||(oa.event.altKey?(m||(m=[(h[0][0]+h[1][0])/2,(h[0][1]+h[1][1])/2]),k[0]=h[+(n[0]<m[0])][0],k[1]=h[+(n[1]<m[1])][1]):m=null),w&&p(n,o,0)&&(e(b),i=!0),S&&p(n,c,1)&&(r(b),i=!0),i&&(t(b),x({type:"brush",mode:E?"move":"resize"}))}function p(n,t,e){var r,u,a=Lu(t),o=a[0],c=a[1],l=k[e],f=h[1][e]-h[0][e];return E&&(o-=l,c-=f+l),r=Math.max(o,Math.min(c,n[e])),E?u=(r+=l)+f:(m&&(l=Math.max(o,Math.min(c,2*m[e]-r))),r>l?(u=r,r=l):u=l),h[0][e]!==r||h[1][e]!==u?(i=null,h[0][e]=r,h[1][e]=u,!0):void 0}function d(){g(),b.style("pointer-events","all").selectAll(".resize").style("display",n.empty()?"none":null),oa.select("body").style("cursor",null),A.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),x({type:"brushend"}),l()}var m,v,y=this,M=oa.select(oa.event.target),x=a.of(y,arguments),b=oa.select(y),_=M.datum(),w=!/^(n|s)$/.test(_)&&o,S=!/^(e|w)$/.test(_)&&c,E=M.classed("extent"),k=u(),A=oa.select(la).on("mousemove.brush",g).on("mouseup.brush",d).on("touchmove.brush",g).on("touchend.brush",d).on("keydown.brush",f).on("keyup.brush",s);if(E)k[0]=h[0][0]-k[0],k[1]=h[0][1]-k[1];else if(_){var q=+/w$/.test(_),N=+/^n/.test(_);v=[h[1-q][0]-k[0],h[1-N][1]-k[1]],k[0]=h[q][0],k[1]=h[N][1]}else oa.event.altKey&&(m=k.slice());b.style("pointer-events","none").selectAll(".resize").style("display",null),oa.select("body").style("cursor",M.style("cursor")),x({type:"brushstart"}),g(),l()}var i,a=s(n,"brushstart","brush","brushend"),o=null,c=null,f=sc[0],h=[[0,0],[0,0]];return n.x=function(t){return arguments.length?(o=t,f=sc[!o<<1|!c],n):o},n.y=function(t){return arguments.length?(c=t,f=sc[!o<<1|!c],n):c},n.extent=function(t){var e,r,u,a,l;return arguments.length?(i=[[0,0],[0,0]],o&&(e=t[0],r=t[1],c&&(e=e[0],r=r[0]),i[0][0]=e,i[1][0]=r,o.invert&&(e=o(e),r=o(r)),e>r&&(l=e,e=r,r=l),h[0][0]=0|e,h[1][0]=0|r),c&&(u=t[0],a=t[1],o&&(u=u[1],a=a[1]),i[0][1]=u,i[1][1]=a,c.invert&&(u=c(u),a=c(a)),u>a&&(l=u,u=a,a=l),h[0][1]=0|u,h[1][1]=0|a),n):(t=i||h,o&&(e=t[0][0],r=t[1][0],i||(e=h[0][0],r=h[1][0],o.invert&&(e=o.invert(e),r=o.invert(r)),e>r&&(l=e,e=r,r=l))),c&&(u=t[0][1],a=t[1][1],i||(u=h[0][1],a=h[1][1],c.invert&&(u=c.invert(u),a=c.invert(a)),u>a&&(l=u,u=a,a=l))),o&&c?[[e,u],[r,a]]:o?[e,r]:c&&[u,a])},n.clear=function(){return i=null,h[0][0]=h[0][1]=h[1][0]=h[1][1]=0,n},n.empty=function(){return o&&h[0][0]===h[1][0]||c&&h[0][1]===h[1][1]},oa.rebind(n,a,"on")};var fc={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},sc=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]];oa.time={};var hc=Date,gc=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];wi.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){pc.setUTCDate.apply(this._,arguments)},setDay:function(){pc.setUTCDay.apply(this._,arguments)},setFullYear:function(){pc.setUTCFullYear.apply(this._,arguments)},setHours:function(){pc.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){pc.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){pc.setUTCMinutes.apply(this._,arguments)},setMonth:function(){pc.setUTCMonth.apply(this._,arguments)},setSeconds:function(){pc.setUTCSeconds.apply(this._,arguments)},setTime:function(){pc.setTime.apply(this._,arguments)}};var pc=Date.prototype,dc="%a %b %e %X %Y",mc="%m/%d/%Y",vc="%H:%M:%S",yc=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Mc=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],xc=["January","February","March","April","May","June","July","August","September","October","November","December"],bc=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];oa.time.year=Si(function(n){return n=oa.time.day(n),n.setMonth(0,1),n},function(n,t){n.setFullYear(n.getFullYear()+t)},function(n){return n.getFullYear()}),oa.time.years=oa.time.year.range,oa.time.years.utc=oa.time.year.utc.range,oa.time.day=Si(function(n){var t=new hc(1970,0);return t.setFullYear(n.getFullYear(),n.getMonth(),n.getDate()),t},function(n,t){n.setDate(n.getDate()+t)},function(n){return n.getDate()-1}),oa.time.days=oa.time.day.range,oa.time.days.utc=oa.time.day.utc.range,oa.time.dayOfYear=function(n){var t=oa.time.year(n);return Math.floor((n-t-6e4*(n.getTimezoneOffset()-t.getTimezoneOffset()))/864e5)},gc.forEach(function(n,t){n=n.toLowerCase(),t=7-t;var e=oa.time[n]=Si(function(n){return(n=oa.time.day(n)).setDate(n.getDate()-(n.getDay()+t)%7),n},function(n,t){n.setDate(n.getDate()+7*Math.floor(t))},function(n){var e=oa.time.year(n).getDay();return Math.floor((oa.time.dayOfYear(n)+(e+t)%7)/7)-(e!==t)});oa.time[n+"s"]=e.range,oa.time[n+"s"].utc=e.utc.range,oa.time[n+"OfYear"]=function(n){var e=oa.time.year(n).getDay();return Math.floor((oa.time.dayOfYear(n)+(e+t)%7)/7)}}),oa.time.week=oa.time.sunday,oa.time.weeks=oa.time.sunday.range,oa.time.weeks.utc=oa.time.sunday.utc.range,oa.time.weekOfYear=oa.time.sundayOfYear,oa.time.format=function(n){function t(t){for(var r,u,i,a=[],o=-1,c=0;++o<e;)37===n.charCodeAt(o)&&(a.push(n.substring(c,o)),null!=(u=qc[r=n.charAt(++o)])&&(r=n.charAt(++o)),(i=Nc[r])&&(r=i(t,null==u?"e"===r?" ":"0":u)),a.push(r),c=o+1);return a.push(n.substring(c,o)),a.join("")}var e=n.length;return t.parse=function(t){var e={y:1900,m:0,d:1,H:0,M:0,S:0,L:0},r=ki(e,n,t,0);if(r!=t.length)return null;"p"in e&&(e.H=e.H%12+12*e.p);var u=new hc;return u.setFullYear(e.y,e.m,e.d),u.setHours(e.H,e.M,e.S,e.L),u},t.toString=function(){return n},t};var _c=Ai(yc),wc=Ai(Mc),Sc=Ai(xc),Ec=qi(xc),kc=Ai(bc),Ac=qi(bc),qc={"-":"",_:" ",0:"0"},Nc={a:function(n){return Mc[n.getDay()]},A:function(n){return yc[n.getDay()]},b:function(n){return bc[n.getMonth()]},B:function(n){return xc[n.getMonth()]},c:oa.time.format(dc),d:function(n,t){return Ni(n.getDate(),t,2)},e:function(n,t){return Ni(n.getDate(),t,2)},H:function(n,t){return Ni(n.getHours(),t,2)},I:function(n,t){return Ni(n.getHours()%12||12,t,2)},j:function(n,t){return Ni(1+oa.time.dayOfYear(n),t,3)},L:function(n,t){return Ni(n.getMilliseconds(),t,3)},m:function(n,t){return Ni(n.getMonth()+1,t,2)},M:function(n,t){return Ni(n.getMinutes(),t,2)},p:function(n){return n.getHours()>=12?"PM":"AM"},S:function(n,t){return Ni(n.getSeconds(),t,2)},U:function(n,t){return Ni(oa.time.sundayOfYear(n),t,2)},w:function(n){return n.getDay()},W:function(n,t){return Ni(oa.time.mondayOfYear(n),t,2)},x:oa.time.format(mc),X:oa.time.format(vc),y:function(n,t){return Ni(n.getFullYear()%100,t,2)},Y:function(n,t){return Ni(n.getFullYear()%1e4,t,4)},Z:Bi,"%":function(){return"%"}},Tc={a:Ti,A:Ci,b:zi,B:Di,c:ji,d:Yi,e:Yi,H:Ui,I:Ui,L:Xi,m:Oi,M:Ii,p:Zi,S:Vi,x:Li,X:Fi,y:Pi,Y:Hi},Cc=/^\s*\d+/,zc=oa.map({am:0,pm:1});oa.time.format.utc=function(n){function t(n){try{hc=wi;var t=new hc;return t._=n,e(t)}finally{hc=Date}}var e=oa.time.format(n);return t.parse=function(n){try{hc=wi;var t=e.parse(n);return t&&t._}finally{hc=Date}},t.toString=e.toString,t};var Dc=oa.time.format.utc("%Y-%m-%dT%H:%M:%S.%LZ");oa.time.format.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?$i:Dc,$i.parse=function(n){var t=new Date(n);return isNaN(t)?null:t},$i.toString=Dc.toString,oa.time.second=Si(function(n){return new hc(1e3*Math.floor(n/1e3))},function(n,t){n.setTime(n.getTime()+1e3*Math.floor(t))},function(n){return n.getSeconds()}),oa.time.seconds=oa.time.second.range,oa.time.seconds.utc=oa.time.second.utc.range,oa.time.minute=Si(function(n){return new hc(6e4*Math.floor(n/6e4))},function(n,t){n.setTime(n.getTime()+6e4*Math.floor(t))},function(n){return n.getMinutes()}),oa.time.minutes=oa.time.minute.range,oa.time.minutes.utc=oa.time.minute.utc.range,oa.time.hour=Si(function(n){var t=n.getTimezoneOffset()/60;return new hc(36e5*(Math.floor(n/36e5-t)+t))},function(n,t){n.setTime(n.getTime()+36e5*Math.floor(t))},function(n){return n.getHours()}),oa.time.hours=oa.time.hour.range,oa.time.hours.utc=oa.time.hour.utc.range,oa.time.month=Si(function(n){return n=oa.time.day(n),n.setDate(1),n},function(n,t){n.setMonth(n.getMonth()+t)},function(n){return n.getMonth()}),oa.time.months=oa.time.month.range,oa.time.months.utc=oa.time.month.utc.range;var jc=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],Lc=[[oa.time.second,1],[oa.time.second,5],[oa.time.second,15],[oa.time.second,30],[oa.time.minute,1],[oa.time.minute,5],[oa.time.minute,15],[oa.time.minute,30],[oa.time.hour,1],[oa.time.hour,3],[oa.time.hour,6],[oa.time.hour,12],[oa.time.day,1],[oa.time.day,2],[oa.time.week,1],[oa.time.month,1],[oa.time.month,3],[oa.time.year,1]],Fc=[[oa.time.format("%Y"),Dt],[oa.time.format("%B"),function(n){return n.getMonth()}],[oa.time.format("%b %d"),function(n){return 1!=n.getDate()}],[oa.time.format("%a %d"),function(n){return n.getDay()&&1!=n.getDate()}],[oa.time.format("%I %p"),function(n){return n.getHours()}],[oa.time.format("%I:%M"),function(n){return n.getMinutes()}],[oa.time.format(":%S"),function(n){return n.getSeconds()}],[oa.time.format(".%L"),function(n){return n.getMilliseconds()}]],Hc=oa.scale.linear(),Pc=Wi(Fc);Lc.year=function(n,t){return Hc.domain(n.map(na)).ticks(t).map(Qi)},oa.time.scale=function(){return Ji(oa.scale.linear(),Lc,Pc)};var Rc=Lc.map(function(n){return[n[0].utc,n[1]]}),Oc=[[oa.time.format.utc("%Y"),Dt],[oa.time.format.utc("%B"),function(n){return n.getUTCMonth()}],[oa.time.format.utc("%b %d"),function(n){return 1!=n.getUTCDate()}],[oa.time.format.utc("%a %d"),function(n){return n.getUTCDay()&&1!=n.getUTCDate()}],[oa.time.format.utc("%I %p"),function(n){return n.getUTCHours()}],[oa.time.format.utc("%I:%M"),function(n){return n.getUTCMinutes()}],[oa.time.format.utc(":%S"),function(n){return n.getUTCSeconds()}],[oa.time.format.utc(".%L"),function(n){return n.getUTCMilliseconds()}]],Yc=Wi(Oc);return Rc.year=function(n,t){return Hc.domain(n.map(ea)).ticks(t).map(ta)},oa.time.scale.utc=function(){return Ji(oa.scale.linear(),Rc,Yc)},oa.text=function(){return oa.xhr.apply(oa,arguments).response(ra)},oa.json=function(n,t){return oa.xhr(n,"application/json",t).response(ua)},oa.html=function(n,t){return oa.xhr(n,"text/html",t).response(ia)},oa.xml=function(){return oa.xhr.apply(oa,arguments).response(aa)},oa}(),function(){this.HTMLModule=function(){function HTMLModule(element){this.element=element,this.el=$(this.element),JavascriptLoader.executeModuleScripts(this.el),Collapsible.setCollapsibles(this.el),"undefined"!=typeof MathJax&&null!==MathJax&&MathJax.Hub.Queue(["Typeset",MathJax.Hub,this.el[0]]),"undefined"!=typeof setupFullScreenModal&&null!==setupFullScreenModal&&setupFullScreenModal()}return HTMLModule.prototype.$=function(selector){return $(selector,this.el)},HTMLModule}()}.call(this),function(){this.PeerGradingProblemBackend=function(){function PeerGradingProblemBackend(ajax_url,mock_backend){this.mock_backend=mock_backend,this.ajax_url=ajax_url,this.mock_cnt=0}return PeerGradingProblemBackend.prototype.post=function(cmd,data,callback){return this.mock_backend?callback(this.mock(cmd,data)):$.post(this.ajax_url+cmd,data,callback).error(function(){return callback({success:!1,error:"Error occurred while performing this operation"})})},PeerGradingProblemBackend.prototype.mock=function(cmd){var response;return"is_student_calibrated"===cmd?response={success:!0,calibrated:this.mock_cnt>=2}:"show_calibration_essay"===cmd?(this.mock_cnt++,response={success:!0,submission_id:1,submission_key:"abcd",student_response:'Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source. Lorem Ipsum comes from sections 1.10.32 and 1.10.33 of "de Finibus Bonorum et Malorum" (The Extremes of Good and Evil) by Cicero, written in 45 BC. This book is a treatise on the theory of ethics, very popular during the Renaissance. The first line of Lorem Ipsum, "Lorem ipsum dolor sit amet..", comes from a line in section 1.10.32.\n\nThe standard chunk of Lorem Ipsum used since the 1500s is reproduced below for those interested. Sections 1.10.32 and 1.10.33 from "de Finibus Bonorum et Malorum" by Cicero are also reproduced in their exact original form, accompanied by English versions from the 1914 translation by H. Rackham.',prompt:"<h2>S11E3: Metal Bands</h2>\n<p>Shown below are schematic band diagrams for two different metals. Both diagrams appear different, yet both of the elements are undisputably metallic in nature.</p>\n<p>* Why is it that both sodium and magnesium behave as metals, even though the s-band of magnesium is filled? </p>\n<p>This is a self-assessed open response question. Please use as much space as you need in the box below to answer the question.</p>",rubric:'<table class="rubric"><tbody><tr><th>Purpose</th>\n\n<td>\n<input type="radio" class="score-selection" name="score-selection-0" id="score-0-0" value="0"><label for="score-0-0">No product</label>\n</td>\n\n<td>\n<input type="radio" class="score-selection" name="score-selection-0" id="score-0-1" value="1"><label for="score-0-1">Unclear purpose or main idea</label>\n</td>\n\n<td>\n<input type="radio" class="score-selection" name="score-selection-0" id="score-0-2" value="2"><label for="score-0-2">Communicates an identifiable purpose and/or main idea for an audience</label>\n</td>\n\n<td>\n<input type="radio" class="score-selection" name="score-selection-0" id="score-0-3" value="3"><label for="score-0-3">Achieves a clear and distinct purpose for a targeted audience and communicates main ideas with effectively used techniques to introduce and represent ideas and insights</label>\n</td>\n</tr><tr><th>Organization</th>\n\n<td>\n<input type="radio" class="score-selection" name="score-selection-1" id="score-1-0" value="0"><label for="score-1-0">No product</label>\n</td>\n\n<td>\n<input type="radio" class="score-selection" name="score-selection-1" id="score-1-1" value="1"><label for="score-1-1">Organization is unclear; introduction, body, and/or conclusion are underdeveloped, missing or confusing.</label>\n</td>\n\n<td>\n<input type="radio" class="score-selection" name="score-selection-1" id="score-1-2" value="2"><label for="score-1-2">Organization is occasionally unclear; introduction, body or conclusion may be underdeveloped.</label>\n</td>\n\n<td>\n<input type="radio" class="score-selection" name="score-selection-1" id="score-1-3" value="3"><label for="score-1-3">Organization is clear and easy to follow; introduction, body and conclusion are defined and aligned with purpose.</label>\n</td>\n</tr></tbody></table>',max_score:4}):"get_next_submission"===cmd?response={success:!0,submission_id:1,submission_key:"abcd",student_response:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed nec tristique ante. Proin at mauris sapien, quis varius leo. Morbi laoreet leo nisi. Morbi aliquam lacus ante. Cras iaculis velit sed diam mattis a fermentum urna luctus. Duis consectetur nunc vitae felis facilisis eget vulputate risus viverra. Cras consectetur ullamcorper lobortis. Nam eu gravida lorem. Nulla facilisi. Nullam quis felis enim. Mauris orci lectus, dictum id cursus in, vulputate in massa.\n\nPhasellus non varius sem. Nullam commodo lacinia odio sit amet egestas. Donec ullamcorper sapien sagittis arcu volutpat placerat. Phasellus ut pretium ante. Nam dictum pulvinar nibh dapibus tristique. Sed at tellus mi, fringilla convallis justo. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus tristique rutrum nulla sed eleifend. Praesent at nunc arcu. Mauris condimentum faucibus nibh, eget commodo quam viverra sed. Morbi in tincidunt dolor. Morbi sed augue et augue interdum fermentum.\n\nCurabitur tristique purus ac arcu consequat cursus. Cras diam felis, dignissim quis placerat at, aliquet ac metus. Mauris vulputate est eu nibh imperdiet varius. Cras aliquet rhoncus elit a laoreet. Mauris consectetur erat et erat scelerisque eu faucibus dolor consequat. Nam adipiscing sagittis nisl, eu mollis massa tempor ac. Nulla scelerisque tempus blandit. Phasellus ac ipsum eros, id posuere arcu. Nullam non sapien arcu. Vivamus sit amet lorem justo, ac tempus turpis. Suspendisse pharetra gravida imperdiet. Pellentesque lacinia mi eu elit luctus pellentesque. Sed accumsan libero a magna elementum varius. Nunc eget pellentesque metus. ",prompt:"<h2>S11E3: Metal Bands</h2>\n<p>Shown below are schematic band diagrams for two different metals. Both diagrams appear different, yet both of the elements are undisputably metallic in nature.</p>\n<p>* Why is it that both sodium and magnesium behave as metals, even though the s-band of magnesium is filled? </p>\n<p>This is a self-assessed open response question. Please use as much space as you need in the box below to answer the question.</p>",rubric:'<table class="rubric"><tbody><tr><th>Purpose</th>\n\n<td>\n<input type="radio" class="score-selection" name="score-selection-0" id="score-0-0" value="0"><label for="score-0-0">No product</label>\n</td>\n\n<td>\n<input type="radio" class="score-selection" name="score-selection-0" id="score-0-1" value="1"><label for="score-0-1">Unclear purpose or main idea</label>\n</td>\n\n<td>\n<input type="radio" class="score-selection" name="score-selection-0" id="score-0-2" value="2"><label for="score-0-2">Communicates an identifiable purpose and/or main idea for an audience</label>\n</td>\n\n<td>\n<input type="radio" class="score-selection" name="score-selection-0" id="score-0-3" value="3"><label for="score-0-3">Achieves a clear and distinct purpose for a targeted audience and communicates main ideas with effectively used techniques to introduce and represent ideas and insights</label>\n</td>\n</tr><tr><th>Organization</th>\n\n<td>\n<input type="radio" class="score-selection" name="score-selection-1" id="score-1-0" value="0"><label for="score-1-0">No product</label>\n</td>\n\n<td>\n<input type="radio" class="score-selection" name="score-selection-1" id="score-1-1" value="1"><label for="score-1-1">Organization is unclear; introduction, body, and/or conclusion are underdeveloped, missing or confusing.</label>\n</td>\n\n<td>\n<input type="radio" class="score-selection" name="score-selection-1" id="score-1-2" value="2"><label for="score-1-2">Organization is occasionally unclear; introduction, body or conclusion may be underdeveloped.</label>\n</td>\n\n<td>\n<input type="radio" class="score-selection" name="score-selection-1" id="score-1-3" value="3"><label for="score-1-3">Organization is clear and easy to follow; introduction, body and conclusion are defined and aligned with purpose.</label>\n</td>\n</tr></tbody></table>',max_score:4}:"save_calibration_essay"===cmd?response={success:!0,actual_score:2}:"save_grade"===cmd&&(response={success:!0}),response},PeerGradingProblemBackend}(),this.PeerGradingProblem=function(){function PeerGradingProblem(backend,el){var _this=this;this.scroll_to_top=function(){return PeerGradingProblem.prototype.scroll_to_top.apply(_this,arguments)},this.collapse_question=function(){return PeerGradingProblem.prototype.collapse_question.apply(_this,arguments)},this.gentle_alert=function(){return PeerGradingProblem.prototype.gentle_alert.apply(_this,arguments)},this.setup_score_selection=function(){return PeerGradingProblem.prototype.setup_score_selection.apply(_this,arguments)},this.show_submit_button=function(){return PeerGradingProblem.prototype.show_submit_button.apply(_this,arguments)},this.render_error=function(){return PeerGradingProblem.prototype.render_error.apply(_this,arguments)},this.render_calibration_interstitial_page=function(){return PeerGradingProblem.prototype.render_calibration_interstitial_page.apply(_this,arguments)},this.render_interstitial_page=function(){return PeerGradingProblem.prototype.render_interstitial_page.apply(_this,arguments)},this.render_calibration_feedback=function(){return PeerGradingProblem.prototype.render_calibration_feedback.apply(_this,arguments)},this.render_submission_data=function(){return PeerGradingProblem.prototype.render_submission_data.apply(_this,arguments)},this.render_submission=function(){return PeerGradingProblem.prototype.render_submission.apply(_this,arguments)},this.tracking_changes=function(){return PeerGradingProblem.prototype.tracking_changes.apply(_this,arguments)
},this.render_calibration=function(){return PeerGradingProblem.prototype.render_calibration.apply(_this,arguments)},this.keyup_handler=function(){return PeerGradingProblem.prototype.keyup_handler.apply(_this,arguments)},this.keydown_handler=function(){return PeerGradingProblem.prototype.keydown_handler.apply(_this,arguments)},this.graded_callback=function(){return PeerGradingProblem.prototype.graded_callback.apply(_this,arguments)},this.submission_callback=function(){return PeerGradingProblem.prototype.submission_callback.apply(_this,arguments)},this.calibration_callback=function(){return PeerGradingProblem.prototype.calibration_callback.apply(_this,arguments)},this.calibration_check_callback=function(){return PeerGradingProblem.prototype.calibration_check_callback.apply(_this,arguments)},this.flag_box_checked=function(){return PeerGradingProblem.prototype.flag_box_checked.apply(_this,arguments)},this.close_dialog_box=function(){return PeerGradingProblem.prototype.close_dialog_box.apply(_this,arguments)},this.remove_flag=function(){return PeerGradingProblem.prototype.remove_flag.apply(_this,arguments)},this.submit_grade=function(){return PeerGradingProblem.prototype.submit_grade.apply(_this,arguments)},this.submit_calibration_essay=function(){return PeerGradingProblem.prototype.submit_calibration_essay.apply(_this,arguments)},this.fetch_submission_essay=function(){return PeerGradingProblem.prototype.fetch_submission_essay.apply(_this,arguments)},this.fetch_calibration_essay=function(){return PeerGradingProblem.prototype.fetch_calibration_essay.apply(_this,arguments)},this.is_calibrated_check=function(){return PeerGradingProblem.prototype.is_calibrated_check.apply(_this,arguments)},this.el=el,this.prompt_wrapper=$(this.prompt_wrapper_sel),this.backend=backend,this.is_ctrl=!1,this.el=$(this.peer_grading_container_sel),this.location=$(".peer-grading").data("location"),this.location&&(this.submission_container=this.$(this.submission_container_sel),this.prompt_container=this.$(this.prompt_container_sel),this.rubric_container=this.$(this.rubric_container_sel),this.flag_student_container=this.$(this.flag_student_container_sel),this.calibration_panel=this.$(this.calibration_panel_sel),this.grading_panel=this.$(this.grading_panel_sel),this.content_panel=this.$(this.content_panel_sel),this.grading_message=this.$(this.grading_message_sel),this.grading_message.hide(),this.question_header=this.$(this.question_header_sel),this.question_header.click(this.collapse_question),this.flag_submission_confirmation=this.$(this.flag_submission_confirmation_sel),this.flag_submission_confirmation_button=this.$(this.flag_submission_confirmation_button_sel),this.flag_submission_removal_button=this.$(this.flag_submission_removal_button_sel),this.flag_submission_confirmation_button.click(this.close_dialog_box),this.flag_submission_removal_button.click(this.remove_flag),this.grading_wrapper=this.$(this.grading_wrapper_sel),this.calibration_feedback_panel=this.$(this.calibration_feedback_sel),this.interstitial_page=this.$(this.interstitial_page_sel),this.interstitial_page.hide(),this.calibration_interstitial_page=this.$(this.calibration_interstitial_page_sel),this.calibration_interstitial_page.hide(),this.error_container=this.$(this.error_container_sel),this.submission_key_input=$("input[name='submission-key']"),this.essay_id_input=this.$("input[name='essay-id']"),this.peer_grading_instructions=this.$(this.peer_grading_instructions_sel),this.feedback_area=this.$(this.feedback_area_sel),this.ice_legend=this.$(this.ice_legend_sel),this.score_selection_container=this.$(this.score_selection_container_sel),this.rubric_selection_container=this.$(this.rubric_selection_container_sel),this.grade=null,this.calibration=null,this.submit_button=this.$(this.submit_button_sel),this.action_button=this.$(this.action_button_sel),this.calibration_feedback_button=this.$(this.calibration_feedback_button_sel),this.interstitial_page_button=this.$(this.interstitial_page_button_sel),this.calibration_interstitial_page_button=this.$(this.calibration_interstitial_page_button_sel),this.flag_student_checkbox=this.$(this.flag_checkbox_sel),$(window).keydown(this.keydown_handler),$(window).keyup(this.keyup_handler),Collapsible.setCollapsibles(this.content_panel),this.action_button.click(function(){return history.back()}),this.calibration_feedback_button.click(function(){return _this.calibration_feedback_panel.hide(),_this.grading_wrapper.show(),_this.gentle_alert("Calibration essay saved.  Fetching the next essay."),_this.is_calibrated_check()}),this.interstitial_page_button.click(function(){return _this.interstitial_page.hide(),_this.is_calibrated_check()}),this.calibration_interstitial_page_button.click(function(){return _this.calibration_interstitial_page.hide(),_this.is_calibrated_check()}),this.flag_student_checkbox.click(function(){return _this.flag_box_checked()}),this.calibration_feedback_button.hide(),this.calibration_feedback_panel.hide(),this.error_container.hide(),this.flag_submission_confirmation.hide(),this.tracking_changes()&&(this.change_tracker=new TrackChanges(this.el)),this.is_calibrated_check())}return PeerGradingProblem.prototype.prompt_wrapper_sel=".prompt-wrapper",PeerGradingProblem.prototype.peer_grading_container_sel=".peer-grading-container",PeerGradingProblem.prototype.submission_container_sel=".submission-container",PeerGradingProblem.prototype.prompt_container_sel=".prompt-container",PeerGradingProblem.prototype.rubric_container_sel=".rubric-container",PeerGradingProblem.prototype.flag_student_container_sel=".flag-student-container",PeerGradingProblem.prototype.calibration_panel_sel=".calibration-panel",PeerGradingProblem.prototype.grading_panel_sel=".grading-panel",PeerGradingProblem.prototype.content_panel_sel=".content-panel",PeerGradingProblem.prototype.grading_message_sel=".grading-message",PeerGradingProblem.prototype.question_header_sel=".question-header",PeerGradingProblem.prototype.flag_submission_confirmation_sel=".flag-submission-confirmation",PeerGradingProblem.prototype.flag_submission_confirmation_button_sel=".flag-submission-confirmation-button",PeerGradingProblem.prototype.flag_submission_removal_button_sel=".flag-submission-removal-button",PeerGradingProblem.prototype.grading_wrapper_sel=".grading-wrapper",PeerGradingProblem.prototype.calibration_feedback_sel=".calibration-feedback",PeerGradingProblem.prototype.interstitial_page_sel=".interstitial-page",PeerGradingProblem.prototype.calibration_interstitial_page_sel=".calibration-interstitial-page",PeerGradingProblem.prototype.error_container_sel=".error-container",PeerGradingProblem.prototype.peer_grading_instructions_sel=".peer-grading-instructions",PeerGradingProblem.prototype.feedback_area_sel=".feedback-area",PeerGradingProblem.prototype.ice_legend_sel=".ice-legend",PeerGradingProblem.prototype.score_selection_container_sel=".score-selection-container",PeerGradingProblem.prototype.rubric_selection_container_sel=".rubric-selection-container",PeerGradingProblem.prototype.submit_button_sel=".submit-button",PeerGradingProblem.prototype.action_button_sel=".action-button",PeerGradingProblem.prototype.calibration_feedback_button_sel=".calibration-feedback-button",PeerGradingProblem.prototype.interstitial_page_button_sel=".interstitial-page-button",PeerGradingProblem.prototype.calibration_interstitial_page_button_sel=".calibration-interstitial-page-button",PeerGradingProblem.prototype.flag_checkbox_sel=".flag-checkbox",PeerGradingProblem.prototype.calibration_text_sel=".calibration-text",PeerGradingProblem.prototype.grading_text_sel=".grading-text",PeerGradingProblem.prototype.calibration_feedback_wrapper_sel=".calibration-feedback-wrapper",PeerGradingProblem.prototype.$=function(selector){return $(selector,this.el)},PeerGradingProblem.prototype.is_calibrated_check=function(){return this.backend.post("is_student_calibrated",{location:this.location},this.calibration_check_callback)},PeerGradingProblem.prototype.fetch_calibration_essay=function(){return this.backend.post("show_calibration_essay",{location:this.location},this.render_calibration)},PeerGradingProblem.prototype.fetch_submission_essay=function(){return this.backend.post("get_next_submission",{location:this.location},this.render_submission)},PeerGradingProblem.prototype.construct_data=function(){var data,feedback_content;return feedback_content=this.tracking_changes()?this.feedback_area.html():this.feedback_area.val(),data={rubric_scores:this.rub.get_score_list(),score:this.rub.get_total_score(),location:this.location,submission_id:this.essay_id_input.val(),submission_key:this.submission_key_input.val(),feedback:feedback_content,submission_flagged:this.flag_student_checkbox.is(":checked"),answer_unknown:!1}},PeerGradingProblem.prototype.submit_calibration_essay=function(){var data;return data=this.construct_data(),this.submit_button.hide(),this.backend.post("save_calibration_essay",data,this.calibration_callback)},PeerGradingProblem.prototype.submit_grade=function(){var data;return data=this.construct_data(),this.submit_button.hide(),this.backend.post("save_grade",data,this.submission_callback)},PeerGradingProblem.prototype.remove_flag=function(){return this.flag_student_checkbox.removeAttr("checked"),this.close_dialog_box(),this.submit_button.attr("disabled",!0)},PeerGradingProblem.prototype.close_dialog_box=function(){return $(this.flag_submission_confirmation_sel).dialog("close")},PeerGradingProblem.prototype.flag_box_checked=function(){return this.flag_student_checkbox.is(":checked")?(this.$(this.flag_submission_confirmation_sel).dialog({height:400,width:400}),this.submit_button.attr("disabled",!1)):void 0},PeerGradingProblem.prototype.calibration_check_callback=function(response){return response.success?!response.calibrated||null!==this.calibration&&this.calibration!==!1?response.calibrated&&this.calibration===!0?(this.calibration=!1,this.render_interstitial_page()):response.calibrated||null!==this.calibration?(this.calibration=!0,this.fetch_calibration_essay()):(this.calibration=!0,this.render_calibration_interstitial_page()):(this.calibration=!1,this.fetch_submission_essay()):this.render_error(response.error?response.error:"Error contacting the grading service")},PeerGradingProblem.prototype.calibration_callback=function(response){return response.success?this.render_calibration_feedback(response):this.render_error(response.error?response.error:"Error saving calibration score")},PeerGradingProblem.prototype.submission_callback=function(response){var message;return response.success?(this.is_calibrated_check(),this.grading_message.fadeIn(),message="<p>Successfully saved your feedback. Fetching the next essay.",response.required_done&&(message+=" You have done the required number of peer assessments but may continue grading if you like."),message+="</p>",this.grading_message.html(message)):this.render_error(response.error?response.error:"Error occurred while submitting grade")},PeerGradingProblem.prototype.graded_callback=function(event){var ev,ul;return ev=this.$(event.target).parent().parent(),ul=ev.parent().parent(),ul.find(".rubric-label-selected").removeClass("rubric-label-selected"),ev.addClass("rubric-label-selected"),this.rub.check_complete()?(this.grading_message.hide(),this.show_submit_button(),this.grade=this.rub.get_total_score()):void 0},PeerGradingProblem.prototype.keydown_handler=function(event){return 17===event.which&&this.is_ctrl===!1?this.is_ctrl=!0:13===event.which&&this.submit_button.is(":visible")&&this.is_ctrl===!0?this.calibration?this.submit_calibration_essay():this.submit_grade():void 0},PeerGradingProblem.prototype.keyup_handler=function(event){return 17===event.which&&this.is_ctrl===!0?this.is_ctrl=!1:void 0},PeerGradingProblem.prototype.render_calibration=function(response){var feedback_text;return response.success?(this.submission_container.html(""),this.render_submission_data(response),this.calibration_panel.addClass("current-state"),this.grading_panel.removeClass("current-state"),this.calibration_panel.find(this.calibration_text_sel).show(),this.grading_panel.find(this.calibration_text_sel).show(),this.calibration_panel.find(this.grading_text_sel).hide(),this.grading_panel.find(this.grading_text_sel).hide(),this.flag_student_container.hide(),this.peer_grading_instructions.hide(),this.feedback_area.attr("disabled",!0),feedback_text="Once you are done learning to grade, and are grading your peers' work, you will be asked to share written feedback with them in addition to scoring them.",this.tracking_changes()?(this.ice_legend.hide(),this.feedback_area.attr("contenteditable",!1),this.feedback_area.text(feedback_text)):this.feedback_area.val(feedback_text),this.submit_button.show(),this.submit_button.unbind("click"),this.submit_button.click(this.submit_calibration_essay),this.submit_button.attr("disabled",!0),this.scroll_to_top()):this.render_error(response.error?response.error:"An error occurred while retrieving the next calibration essay")},PeerGradingProblem.prototype.tracking_changes=function(){return this.grading_wrapper.data("track-changes")===!0},PeerGradingProblem.prototype.render_submission=function(response){return response.success?(this.submit_button.hide(),this.submission_container.html(""),this.render_submission_data(response),this.calibration_panel.removeClass("current-state"),this.grading_panel.addClass("current-state"),this.calibration_panel.find(this.calibration_text_sel).hide(),this.grading_panel.find(this.calibration_text_sel).hide(),this.calibration_panel.find(this.grading_text_sel).show(),this.grading_panel.find(this.grading_text_sel).show(),this.flag_student_container.show(),this.peer_grading_instructions.show(),this.tracking_changes()?(this.ice_legend.show(),this.feedback_area.html(this.make_paragraphs(response.student_response)),this.change_tracker.rebindTracker()):this.feedback_area.val(""),this.feedback_area.attr("disabled",!1),this.flag_student_checkbox.removeAttr("checked"),this.submit_button.show(),this.submit_button.unbind("click"),this.submit_button.click(this.submit_grade),this.submit_button.attr("disabled",!0),this.scroll_to_top()):this.render_error(response.error?response.error:"An error occurred when retrieving the next submission.")},PeerGradingProblem.prototype.make_paragraphs=function(text){var new_text,paragraph,paragraph_split,_i,_len;for(paragraph_split=text.split(/\n\s*\n/),new_text="",_i=0,_len=paragraph_split.length;_len>_i;_i++)paragraph=paragraph_split[_i],new_text+="<p>"+paragraph+"</p>";return new_text},PeerGradingProblem.prototype.render_submission_data=function(response){return this.content_panel.show(),this.error_container.hide(),this.submission_container.append(this.make_paragraphs(response.student_response)),this.prompt_container.html(response.prompt),this.rubric_selection_container.html(response.rubric),this.submission_key_input.val(response.submission_key),this.essay_id_input.val(response.submission_id),this.setup_score_selection(response.max_score),this.submit_button.hide(),this.action_button.hide(),this.calibration_feedback_panel.hide(),this.rub=new Rubric(this.el),this.rub.initialize(this.location)},PeerGradingProblem.prototype.render_calibration_feedback=function(response){var actual_score,calibration_wrapper,score;return this.calibration_feedback_panel.slideDown(),calibration_wrapper=this.$(this.calibration_feedback_wrapper_sel),calibration_wrapper.html("<p>The score you gave was: "+this.grade+". The instructor score is: "+response.actual_score+"</p>"),score=parseInt(this.grade),actual_score=parseInt(response.actual_score),calibration_wrapper.append(score===actual_score?"<p>Your score matches the instructor score!</p>":"<p>You may want to review the rubric again.</p>"),void 0!==response.actual_rubric&&calibration_wrapper.append("<div>Instructor Scored Rubric: "+response.actual_rubric+"</div>"),void 0!==response.actual_feedback.feedback&&calibration_wrapper.append("<div>Instructor Feedback: "+response.actual_feedback+"</div>"),this.$("input[name='score-selection']").attr("disabled",!0),this.submit_button.hide(),this.calibration_feedback_button.show()},PeerGradingProblem.prototype.render_interstitial_page=function(){return this.content_panel.hide(),this.grading_message.hide(),this.interstitial_page.show()},PeerGradingProblem.prototype.render_calibration_interstitial_page=function(){return this.content_panel.hide(),this.action_button.hide(),this.calibration_interstitial_page.show()},PeerGradingProblem.prototype.render_error=function(error_message){return this.error_container.show(),this.calibration_feedback_panel.hide(),this.error_container.html(error_message),this.content_panel.hide(),this.action_button.show()},PeerGradingProblem.prototype.show_submit_button=function(){return this.submit_button.attr("disabled",!1),this.submit_button.show()},PeerGradingProblem.prototype.setup_score_selection=function(){return this.$("input[class='score-selection']").change(this.graded_callback)},PeerGradingProblem.prototype.gentle_alert=function(msg){return this.grading_message.fadeIn(),this.grading_message.html("<p>"+msg+"</p>")},PeerGradingProblem.prototype.collapse_question=function(){var new_text;return this.prompt_container.slideToggle(),this.prompt_container.toggleClass("open"),"Hide Question"===this.question_header.text()?(new_text="Show Question",Logger.log("oe_hide_question",{location:this.location})):(Logger.log("oe_show_question",{location:this.location}),new_text="Hide Question"),this.question_header.text(new_text),!1},PeerGradingProblem.prototype.scroll_to_top=function(){return $("html, body").animate({scrollTop:$(".peer-grading").offset().top},200)},PeerGradingProblem}()}.call(this),function(){"use strict";function setCollapsibles(el){var linkBottom,linkTop,short_custom;linkTop='<a href="#" class="full full-top">See full output</a>',linkBottom='<a href="#" class="full full-bottom">See full output</a>',el.find(".longform").hide(),el.find(".shortform").append(linkTop,linkBottom),short_custom=el.find(".shortform-custom"),short_custom.each(function(index,elt){var close_text,open_text;open_text=$(elt).data("open-text"),close_text=$(elt).data("close-text"),$(elt).append("<a href='#' class='full-custom'>"+open_text+"</a>"),$(elt).find(".full-custom").click(function(event){Collapsible.toggleFull(event,open_text,close_text)})}),el.find(".collapsible header + section").hide(),el.find(".full").click(function(event){Collapsible.toggleFull(event,"See full output","Hide output")}),el.find(".collapsible header a").click(Collapsible.toggleHint)}function toggleFull(event,open_text,close_text){var el,new_text,parent;event.preventDefault(),parent=$(event.target).parent(),parent.siblings().slideToggle(),parent.parent().toggleClass("open"),new_text=$(event.target).text()===open_text?close_text:open_text,el=$(event.target).hasClass("full")?parent.find(".full"):$(event.target),el.text(new_text)}function toggleHint(event){event.preventDefault(),$(event.target).parent().siblings().slideToggle(),$(event.target).parent().parent().toggleClass("open")}this.Collapsible={setCollapsibles:setCollapsibles,toggleFull:toggleFull,toggleHint:toggleHint}}.call(this),function(define){"use strict";define("video/00_component.js",[],function(){var inherit=Object.create||function(){var F=function(){};return function(o){if(arguments.length>1)throw Error("Second argument not supported");if(_.isNull(o)||_.isUndefined(o))throw Error("Cannot set a null [[Prototype]]");if(!_.isObject(o))throw TypeError("Argument must be an object");return F.prototype=o,new F}}(),Component=function(){return $.isFunction(this.initialize)?this.initialize.apply(this,arguments):void 0};return Component.extend=function(protoProps,staticProps){var Parent=this,Child=function(){return $.isFunction(this.initialize)?this.initialize.apply(this,arguments):void 0};return Child.prototype=inherit(Parent.prototype),Child.constructor=Parent,Child.__super__=Parent.prototype,protoProps&&$.extend(Child.prototype,protoProps),$.extend(Child,Parent,staticProps),Child},Component})}(RequireJS.define),function(){this.Annotatable=function(){function Annotatable(el){var _this=this;this.onMoveTip=function(){return Annotatable.prototype.onMoveTip.apply(_this,arguments)},this.onShowTip=function(){return Annotatable.prototype.onShowTip.apply(_this,arguments)},this.onClickReturn=function(){return Annotatable.prototype.onClickReturn.apply(_this,arguments)},this.onClickReply=function(){return Annotatable.prototype.onClickReply.apply(_this,arguments)},this.onClickToggleInstructions=function(){return Annotatable.prototype.onClickToggleInstructions.apply(_this,arguments)},this.onClickToggleAnnotations=function(){return Annotatable.prototype.onClickToggleAnnotations.apply(_this,arguments)},this._debug&&console.log("loaded Annotatable"),this.el=el,this.$el=$(el),this.init()}return Annotatable.prototype._debug=!1,Annotatable.prototype.wrapperSelector=".annotatable-wrapper",Annotatable.prototype.toggleAnnotationsSelector=".annotatable-toggle-annotations",Annotatable.prototype.toggleInstructionsSelector=".annotatable-toggle-instructions",Annotatable.prototype.instructionsSelector=".annotatable-instructions",Annotatable.prototype.sectionSelector=".annotatable-section",Annotatable.prototype.spanSelector=".annotatable-span",Annotatable.prototype.replySelector=".annotatable-reply",Annotatable.prototype.problemXModuleSelector=".xmodule_CapaModule",Annotatable.prototype.problemSelector="div.problem",Annotatable.prototype.problemInputSelector="div.problem .annotation-input",Annotatable.prototype.problemReturnSelector="div.problem .annotation-return",Annotatable.prototype.$=function(selector){return $(selector,this.el)},Annotatable.prototype.init=function(){return this.initEvents(),this.initTips()},Annotatable.prototype.initEvents=function(){var _ref;return _ref=[!1,!1],this.annotationsHidden=_ref[0],this.instructionsHidden=_ref[1],this.$(this.toggleAnnotationsSelector).bind("click",this.onClickToggleAnnotations),this.$(this.toggleInstructionsSelector).bind("click",this.onClickToggleInstructions),this.$el.delegate(this.replySelector,"click",this.onClickReply),$("body").delegate(this.problemReturnSelector,"click",this.onClickReturn)},Annotatable.prototype.initTips=function(){var _this=this;return this.$(this.spanSelector).each(function(index,el){return $(el).qtip(_this.getSpanTipOptions(el))})},Annotatable.prototype.getSpanTipOptions=function(el){return{content:{title:{text:this.makeTipTitle(el)},text:this.makeTipContent(el)},position:{my:"bottom center",at:"top center",target:$(el),container:this.$(this.wrapperSelector),adjust:{y:-5}},show:{event:"click mouseenter",solo:!0},hide:{event:"click mouseleave",delay:500,fixed:!0},style:{classes:"ui-tooltip-annotatable"},events:{show:this.onShowTip,move:this.onMoveTip}}},Annotatable.prototype.onClickToggleAnnotations=function(){return this.toggleAnnotations()},Annotatable.prototype.onClickToggleInstructions=function(){return this.toggleInstructions()},Annotatable.prototype.onClickReply=function(e){return this.replyTo(e.currentTarget)},Annotatable.prototype.onClickReturn=function(e){return this.returnFrom(e.currentTarget)},Annotatable.prototype.onShowTip=function(event){return this.annotationsHidden?event.preventDefault():void 0},Annotatable.prototype.onMoveTip=function(event,api,position){var adjust_y,container,container_offset,focus_rect,is_non_overlapping,offset_left,offset_top,rect_center,rect_top,rects,target,tip,tip_height,tip_left,tip_top,tip_width,win_width,_ref,_ref1,_ref2;return tip=api.elements.tooltip,adjust_y=(null!=(_ref=api.options.position)&&null!=(_ref1=_ref.adjust)?_ref1.y:void 0)||0,container=(null!=(_ref2=api.options.position)?_ref2.container:void 0)||$("body"),target=api.elements.target,rects=$(target).get(0).getClientRects(),is_non_overlapping=2===(null!=rects?rects.length:void 0)&&rects[0].left>rects[1].right,is_non_overlapping?(focus_rect=rects[0].width>rects[1].width?rects[0]:rects[1],rect_center=focus_rect.left+focus_rect.width/2,rect_top=focus_rect.top,tip_width=$(tip).width(),tip_height=$(tip).height(),container_offset=$(container).offset(),offset_left=-container_offset.left,offset_top=$(document).scrollTop()-container_offset.top,tip_left=offset_left+rect_center-tip_width/2,tip_top=offset_top+rect_top-tip_height+adjust_y,win_width=$(window).width(),offset_left>tip_left?tip_left=offset_left:tip_left+tip_width>win_width+offset_left&&(tip_left=win_width+offset_left-tip_width),$.extend(position,{left:tip_left,top:tip_top})):void 0},Annotatable.prototype.getSpanForProblemReturn=function(el){var problem_id;return problem_id=$(this.problemReturnSelector).index(el),this.$(this.spanSelector).filter("[data-problem-id='"+problem_id+"']")},Annotatable.prototype.getProblem=function(el){var problem_id;return problem_id=this.getProblemId(el),$(this.problemSelector).has(this.problemInputSelector).eq(problem_id)},Annotatable.prototype.getProblemId=function(el){return $(el).data("problem-id")},Annotatable.prototype.toggleAnnotations=function(){var hide;return hide=this.annotationsHidden=!this.annotationsHidden,this.toggleAnnotationButtonText(hide),this.toggleSpans(hide),this.toggleTips(hide)},Annotatable.prototype.toggleTips=function(){var visible;return visible=this.findVisibleTips(),this.hideTips(visible)},Annotatable.prototype.toggleAnnotationButtonText=function(hide){var buttonText;return buttonText=gettext(hide?"Show Annotations":"Hide Annotations"),this.$(this.toggleAnnotationsSelector).text(buttonText)},Annotatable.prototype.toggleInstructions=function(){var hide;return hide=this.instructionsHidden=!this.instructionsHidden,this.toggleInstructionsButton(hide),this.toggleInstructionsText(hide)},Annotatable.prototype.toggleInstructionsButton=function(hide){var cls,txt;return txt=gettext(hide?"Expand Instructions":"Collapse Instructions"),cls=hide?["expanded","collapsed"]:["collapsed","expanded"],this.$(this.toggleInstructionsSelector).text(txt).removeClass(cls[0]).addClass(cls[1])},Annotatable.prototype.toggleInstructionsText=function(hide){var slideMethod;return slideMethod=hide?"slideUp":"slideDown",this.$(this.instructionsSelector)[slideMethod]()},Annotatable.prototype.toggleSpans=function(hide){return this.$(this.spanSelector).toggleClass("hide",hide,250)},Annotatable.prototype.replyTo=function(buttonEl){var el,offset;return offset=-20,el=this.getProblem(buttonEl),el.length>0?this.scrollTo(el,this.afterScrollToProblem,offset):this._debug?console.log("problem not found. event: ",e):void 0},Annotatable.prototype.returnFrom=function(buttonEl){var el,offset;return offset=-200,el=this.getSpanForProblemReturn(buttonEl),el.length>0?this.scrollTo(el,this.afterScrollToSpan,offset):this._debug?console.log("span not found. event:",e):void 0},Annotatable.prototype.scrollTo=function(el,after,offset){var _this=this;return null==offset&&(offset=-20),$(el).length>0?$("html,body").scrollTo(el,{duration:500,onAfter:this._once(function(){return null!=after?after.call(_this,el):void 0}),offset:offset}):void 0},Annotatable.prototype.afterScrollToProblem=function(problem_el){return problem_el.effect("highlight",{},500)},Annotatable.prototype.afterScrollToSpan=function(span_el){return span_el.addClass("selected",400,"swing",function(){return span_el.removeClass("selected",400,"swing")})},Annotatable.prototype.makeTipContent=function(el){var _this=this;return function(){var comment,problem_id,reply,text;return text=$(el).data("comment-body"),comment=_this.createComment(text),problem_id=_this.getProblemId(el),reply=_this.createReplyLink(problem_id),$(comment).add(reply)}},Annotatable.prototype.makeTipTitle=function(el){return function(){var title;return title=$(el).data("comment-title"),title?title:gettext("Commentary")}},Annotatable.prototype.createComment=function(text){return $('<div class="annotatable-comment">'+text+"</div>")},Annotatable.prototype.createReplyLink=function(problem_id){var linktxt;return linktxt=gettext("Reply to Annotation"),$('<a class="annotatable-reply" href="javascript:void(0);" data-problem-id="'+problem_id+'">'+linktxt+"</a>")},Annotatable.prototype.findVisibleTips=function(){var visible;return visible=[],this.$(this.spanSelector).each(function(index,el){var api,tip;return api=$(el).qtip("api"),tip=$(null!=api?api.elements.tooltip:void 0),tip.is(":visible")?visible.push(el):void 0}),visible},Annotatable.prototype.hideTips=function(elements){return $(elements).qtip("hide")},Annotatable.prototype._once=function(fn){var done,_this=this;return done=!1,function(){return done||fn.call(_this),done=!0}},Annotatable}()}.call(this);var setupFullScreenModal=function(){function closeModal(imageModal){imageModal.removeClass("image-is-fit-to-screen").removeClass("image-is-zoomed"),$(".wrapper-modal-image .image-content .image-controls .modal-ui-icon.action-zoom-in").removeClass("is-disabled"),$(".wrapper-modal-image .image-content .image-controls .modal-ui-icon.action-zoom-out").addClass("is-disabled");var currentDraggie=imageModal.data("draggie");currentDraggie.disable(),$("body").css("overflow","auto")}$("a.modal-content").each(function(){var smallImageObject=$(this).children(),largeImageSRC=$(this).attr("href");if(smallImageObject.is("img")&&largeImageSRC){var data={smallHTML:$(this).html(),largeALT:smallImageObject.attr("alt"),largeSRC:largeImageSRC},html=_.template($("#image-modal-tpl").text(),data);$(this).replaceWith(html)}}),$(".wrapper-modal-image .image-wrapper img").each(function(){var draggie=new Draggabilly(this,{containment:!0});draggie.disable(),$(this).closest(".image-modal").data("draggie",draggie)}),$(".wrapper-modal-image .image-link").click(function(){$(this).siblings(".image-modal").addClass("image-is-fit-to-screen"),$("body").css("overflow","hidden")});var imageModalImageHover=!1;$(".wrapper-modal-image .image-content img, .wrapper-modal-image .image-content .image-controls").hover(function(){imageModalImageHover=!0},function(){imageModalImageHover=!1}),$(".modal-ui-icon").click(function(event){event.preventDefault()}),$(".wrapper-modal-image .image-modal").click(function(){imageModalImageHover||closeModal($(this))}),$(".wrapper-modal-image .image-content .action-remove").click(function(){closeModal($(this).closest(".image-modal"))}),$(".wrapper-modal-image .image-content .image-controls .modal-ui-icon").click(function(){if(!$(this).hasClass("is-disabled")){var mask=$(this).closest(".image-content"),imageModal=$(this).closest(".image-modal"),img=imageModal.find("img"),currentDraggie=imageModal.data("draggie");if($(this).hasClass("action-zoom-in")){imageModal.removeClass("image-is-fit-to-screen").addClass("image-is-zoomed");var imgWidth=img.width(),imgHeight=img.height(),imgContainerOffsetLeft=imgWidth-mask.width(),imgContainerOffsetTop=imgHeight-mask.height(),imgContainerWidth=imgWidth+imgContainerOffsetLeft,imgContainerHeight=imgHeight+imgContainerOffsetTop;img.parent().css({left:-imgContainerOffsetLeft,top:-imgContainerOffsetTop,width:imgContainerWidth,height:imgContainerHeight}),img.css({top:imgContainerOffsetTop/2,left:imgContainerOffsetLeft/2}),currentDraggie.enable()}else $(this).hasClass("action-zoom-out")&&(imageModal.removeClass("image-is-zoomed").addClass("image-is-fit-to-screen"),currentDraggie.disable());$(".wrapper-modal-image .image-content .image-controls .modal-ui-icon").toggleClass("is-disabled")}})};(function(){this.JavascriptLoader=function(){function JavascriptLoader(){}return JavascriptLoader.executeModuleScripts=function(el,callback){var callbackCalled,completed,completionHandlerGenerator,completionHandlerGeneratorIE,i,loaded,placeholders;return null==callback&&(callback=null),placeholders=el.find(".script_placeholder"),0===placeholders.length?void(null!=callback&&callback()):(completed=function(){var _i,_ref,_results;for(_results=[],i=_i=1,_ref=placeholders.length;_ref>=1?_ref>=_i:_i>=_ref;i=_ref>=1?++_i:--_i)_results.push(!1);return _results}(),callbackCalled=!1,completionHandlerGeneratorIE=function(index){return function(){return"complete"===this.readyState||"loaded"===this.readyState?completionHandlerGenerator(index)():void 0
}},completionHandlerGenerator=function(index){return function(){var allComplete,flag,_i,_len;for(allComplete=!0,completed[index]=!0,_i=0,_len=completed.length;_len>_i;_i++)if(flag=completed[_i],!flag){allComplete=!1;break}return allComplete&&!callbackCalled&&(callbackCalled=!0,null!=callback)?callback():void 0}},loaded={},placeholders.each(function(index,placeholder){var s,src;return src=$(placeholder).attr("data-src"),src in loaded?completionHandlerGenerator(index)():(loaded[src]=!0,s=document.createElement("script"),s.setAttribute("src",src),s.setAttribute("type","text/javascript"),s.onload=completionHandlerGenerator(index),s.onreadystatechange=completionHandlerGeneratorIE(index),$("head")[0].appendChild(s)),$(placeholder).remove()}))},JavascriptLoader}()}).call(this),function(requirejs,require,define){define("PollMain",[],function(){function PollMain(el){var _this;if(this.questionEl=$(el).find(".poll_question"),1!==this.questionEl.length)return void console.log("ERROR: PollMain constructor requires one question DOM element.");if("true"===this.questionEl.attr("poll_main_processed"))return void console.log("ERROR: PolMain JS constructor was called on a DOM element that has already been processed once.");this.questionEl.attr("poll_main_processed","true"),_this=this,this.wrapperSectionEl=null,function(tempEl,c1){for(;"body"!==tempEl.tagName.toLowerCase();){if(tempEl=$(tempEl).parent()[0],c1+=1,"div"===tempEl.tagName.toLowerCase()&&$(tempEl).hasClass("xmodule_WrapperModule")===!0){_this.wrapperSectionEl=tempEl;break}if(c1>50)break}}($(el)[0],0);try{return this.jsonConfig=JSON.parse(this.questionEl.children(".poll_question_div").html()),void $.postWithPrefix(""+this.questionEl.data("ajax-url")+"/get_state",{},function(response){_this.jsonConfig.poll_answer=response.poll_answer,_this.jsonConfig.total=response.total,$.each(response.poll_answers,function(index,value){_this.jsonConfig.poll_answers[index]=value}),_this.questionEl.children(".poll_question_div").html(JSON.stringify(_this.jsonConfig)),_this.postInit()})}catch(err){return void console.log('ERROR: Invalid JSON config for poll ID "'+this.id+'".','Error messsage: "'+err.message+'".')}}return PollMain.prototype={showAnswerGraph:function(poll_answers,total){var _this,totalValue;totalValue=parseFloat(total),isFinite(totalValue)!==!1&&(_this=this,$.each(poll_answers,function(index,value){var numValue,percentValue;numValue=parseFloat(value),isFinite(numValue)!==!1&&(percentValue=numValue/totalValue*100,_this.answersObj[index].statsEl.show(),_this.answersObj[index].numberEl.html(""+value+" ("+percentValue.toFixed(1)+"%)"),_this.answersObj[index].percentEl.css({width:""+percentValue.toFixed(1)+"%"}))}))},submitAnswer:function(answer,answerObj){var _this;this.questionAnswered!==!0&&(this.questionAnswered=!0,_this=this,console.log("submit answer"),answerObj.buttonEl.addClass("answered"),$.postWithPrefix(_this.ajax_url+"/"+answer,{},function(response){console.log("success! response = "),console.log(response),_this.showAnswerGraph(response.poll_answers,response.total),_this.canReset===!0&&_this.resetButton.show(),null!==_this.wrapperSectionEl&&$(_this.wrapperSectionEl).find(".xmodule_ConditionalModule").each(function(index,value){new window.Conditional(value,_this.id.replace(/^poll_/,""))})}))},submitReset:function(){var _this;_this=this,console.log("submit reset"),$.postWithPrefix(this.ajax_url+"/reset_poll",{},function(response){console.log("success! response = "),console.log(response),response.hasOwnProperty("status")===!0&&"string"==typeof response.status&&"success"===response.status.toLowerCase()&&(_this.questionAnswered=!1,_this.questionEl.find(".button.answered").removeClass("answered"),_this.questionEl.find(".stats").hide(),_this.resetButton.hide(),null!==_this.wrapperSectionEl&&$(_this.wrapperSectionEl).find(".xmodule_ConditionalModule").each(function(index,value){new window.Conditional(value,_this.id.replace(/^poll_/,""))}))})},postInit:function(){var _this;return _this=this,this.jsonConfig.poll_answer.length>0&&this.jsonConfig.answers.hasOwnProperty(this.jsonConfig.poll_answer)===!1?void this.questionEl.append("<h3>Error!</h3><p>XML data format changed. List of answers was modified, but poll data was not updated.</p>"):(this.id=this.questionEl.attr("id"),this.ajax_url=this.questionEl.data("ajax-url"),this.questionHtmlMarkup=$("<div />").html(this.jsonConfig.question).text(),this.questionEl.append(this.questionHtmlMarkup),this.questionAnswered=!1,this.answersObj={},this.shortVersion=!0,$.each(this.jsonConfig.answers,function(index,value){value.length>=18&&(_this.shortVersion=!1)}),$.each(this.jsonConfig.answers,function(index,value){var answer;answer={},_this.answersObj[index]=answer,answer.el=$('<div class="poll_answer"></div>'),answer.questionEl=$('<div class="question"></div>'),answer.buttonEl=$('<div class="button"></div>'),answer.textEl=$('<div class="text"></div>'),answer.questionEl.append(answer.buttonEl),answer.questionEl.append(answer.textEl),answer.el.append(answer.questionEl),answer.statsEl=$('<div class="stats"></div>'),answer.barEl=$('<div class="bar"></div>'),answer.percentEl=$('<div class="percent"></div>'),answer.barEl.append(answer.percentEl),answer.numberEl=$('<div class="number"></div>'),answer.statsEl.append(answer.barEl),answer.statsEl.append(answer.numberEl),answer.statsEl.hide(),answer.el.append(answer.statsEl),answer.textEl.html(value),_this.shortVersion===!0&&$.each(answer,function(index,value){value instanceof jQuery&&value.addClass("short")}),answer.el.appendTo(_this.questionEl),answer.textEl.on("click",function(){_this.submitAnswer(index,answer)}),answer.buttonEl.on("click",function(){_this.submitAnswer(index,answer)}),index===_this.jsonConfig.poll_answer&&(answer.buttonEl.addClass("answered"),_this.questionAnswered=!0)}),console.log(this.jsonConfig.reset),"string"==typeof this.jsonConfig.reset&&"true"===this.jsonConfig.reset.toLowerCase()?(this.canReset=!0,this.resetButton=$('<div class="button reset-button">Change your vote</div>'),this.questionAnswered===!1&&this.resetButton.hide(),this.resetButton.appendTo(this.questionEl),this.resetButton.on("click",function(){_this.submitReset()})):this.canReset=!1,void(this.questionAnswered===!0&&this.showAnswerGraph(this.jsonConfig.poll_answers,this.jsonConfig.total)))}},PollMain})}(RequireJS.requirejs,RequireJS.require,RequireJS.define),function(requirejs,require,define){define("video/00_video_storage.js",[],function(){"use strict";var VideoStorage=function(namespace,id){var setItem=function(name,value,instanceSpecific){name&&(instanceSpecific?window[namespace][id][name]=value:window[namespace][name]=value)},getItem=function(name,instanceSpecific){return instanceSpecific?window[namespace][id][name]:window[namespace][name]},removeItem=function(name,instanceSpecific){instanceSpecific?delete window[namespace][id][name]:delete window[namespace][name]},clear=function(){window[namespace]={},window[namespace][id]={}};return function(){namespace||(namespace="VideoStorage"),id||(id=Math.random().toString(36).slice(2)),window[namespace]=window[namespace]||{},window[namespace][id]=window[namespace][id]||{}}(),{clear:clear,getItem:getItem,removeItem:removeItem,setItem:setItem}};return VideoStorage})}(RequireJS.requirejs,RequireJS.require,RequireJS.define),function(exports){function cloud(){function place(board,tag,bounds){for(var dxdy,dx,dy,startX=([{x:0,y:0},{x:size[0],y:size[1]}],tag.x),startY=tag.y,maxDelta=Math.sqrt(size[0]*size[0]+size[1]*size[1]),s=spiral(size),dt=Math.random()<.5?1:-1,t=-dt;(dxdy=s(t+=dt))&&(dx=~~dxdy[0],dy=~~dxdy[1],!(Math.min(dx,dy)>maxDelta));)if(tag.x=startX+dx,tag.y=startY+dy,!(tag.x+tag.x0<0||tag.y+tag.y0<0||tag.x+tag.x1>size[0]||tag.y+tag.y1>size[1]||bounds&&cloudCollide(tag,board,size[0])||bounds&&!collideRects(tag,bounds))){for(var last,sprite=tag.sprite,w=tag.width>>5,sw=size[0]>>5,lx=tag.x-(w<<4),sx=127&lx,msx=32-sx,h=tag.y1-tag.y0,x=(tag.y+tag.y0)*sw+(lx>>5),j=0;h>j;j++){last=0;for(var i=0;w>=i;i++)board[x+i]|=last<<msx|(w>i?(last=sprite[j*w+i])>>>sx:0);x+=sw}return delete tag.sprite,!0}return!1}var size=[256,256],text=cloudText,font=cloudFont,fontSize=cloudFontSize,fontStyle=cloudFontNormal,fontWeight=cloudFontNormal,rotate=cloudRotate,padding=cloudPadding,spiral=archimedeanSpiral,words=[],timeInterval=1/0,event=d3.dispatch("word","end"),timer=null,cloud={};return cloud.start=function(){function step(){for(var d,start=+new Date;+new Date-start<timeInterval&&++i<n&&timer;)d=data[i],d.x=size[0]*(Math.random()+.5)>>1,d.y=size[1]*(Math.random()+.5)>>1,cloudSprite(d,data,i),place(board,d,bounds)&&(tags.push(d),event.word(d),bounds?cloudBounds(bounds,d):bounds=[{x:d.x+d.x0,y:d.y+d.y0},{x:d.x+d.x1,y:d.y+d.y1}],d.x-=size[0]>>1,d.y-=size[1]>>1);i>=n&&(cloud.stop(),event.end(tags,bounds))}var board=zeroArray((size[0]>>5)*size[1]),bounds=null,n=words.length,i=-1,tags=[],data=words.map(function(d,i){return d.text=text.call(this,d,i),d.font=font.call(this,d,i),d.style=fontStyle.call(this,d,i),d.weight=fontWeight.call(this,d,i),d.rotate=rotate.call(this,d,i),d.size=~~fontSize.call(this,d,i),d.padding=cloudPadding.call(this,d,i),d}).sort(function(a,b){return b.size-a.size});return timer&&clearInterval(timer),timer=setInterval(step,0),step(),cloud},cloud.stop=function(){return timer&&(clearInterval(timer),timer=null),cloud},cloud.timeInterval=function(x){return arguments.length?(timeInterval=null==x?1/0:x,cloud):timeInterval},cloud.words=function(x){return arguments.length?(words=x,cloud):words},cloud.size=function(x){return arguments.length?(size=[+x[0],+x[1]],cloud):size},cloud.font=function(x){return arguments.length?(font=d3.functor(x),cloud):font},cloud.fontStyle=function(x){return arguments.length?(fontStyle=d3.functor(x),cloud):fontStyle},cloud.fontWeight=function(x){return arguments.length?(fontWeight=d3.functor(x),cloud):fontWeight},cloud.rotate=function(x){return arguments.length?(rotate=d3.functor(x),cloud):rotate},cloud.text=function(x){return arguments.length?(text=d3.functor(x),cloud):text},cloud.spiral=function(x){return arguments.length?(spiral=spirals[x+""]||x,cloud):spiral},cloud.fontSize=function(x){return arguments.length?(fontSize=d3.functor(x),cloud):fontSize},cloud.padding=function(x){return arguments.length?(padding=d3.functor(x),cloud):padding},d3.rebind(cloud,event,"on")}function cloudText(d){return d.text}function cloudFont(){return"serif"}function cloudFontNormal(){return"normal"}function cloudFontSize(d){return Math.sqrt(d.value)}function cloudRotate(){return 30*(~~(6*Math.random())-3)}function cloudPadding(){return 1}function cloudSprite(d,data,di){if(!d.sprite){c.clearRect(0,0,(cw<<5)/ratio,ch/ratio);var x=0,y=0,maxh=0,n=data.length;for(di--;++di<n;){d=data[di],c.save(),c.font=d.style+" "+d.weight+" "+~~((d.size+1)/ratio)+"px "+d.font;var w=c.measureText(d.text+"m").width*ratio,h=d.size<<1;if(d.rotate){var sr=Math.sin(d.rotate*cloudRadians),cr=Math.cos(d.rotate*cloudRadians),wcr=w*cr,wsr=w*sr,hcr=h*cr,hsr=h*sr;w=Math.max(Math.abs(wcr+hsr),Math.abs(wcr-hsr))+31>>5<<5,h=~~Math.max(Math.abs(wsr+hcr),Math.abs(wsr-hcr))}else w=w+31>>5<<5;if(h>maxh&&(maxh=h),x+w>=cw<<5&&(x=0,y+=maxh,maxh=0),y+h>=ch)break;c.translate((x+(w>>1))/ratio,(y+(h>>1))/ratio),d.rotate&&c.rotate(d.rotate*cloudRadians),c.fillText(d.text,0,0),c.restore(),d.width=w,d.height=h,d.xoff=x,d.yoff=y,d.x1=w>>1,d.y1=h>>1,d.x0=-d.x1,d.y0=-d.y1,x+=w}for(var pixels=c.getImageData(0,0,(cw<<5)/ratio,ch/ratio).data,sprite=[];--di>=0;){d=data[di];for(var w=d.width,w32=w>>5,h=d.y1-d.y0,p=d.padding,i=0;h*w32>i;i++)sprite[i]=0;if(x=d.xoff,null==x)return;y=d.yoff;for(var seen=0,seenRow=-1,j=0;h>j;j++){for(var i=0;w>i;i++){var k=w32*j+(i>>5),m=pixels[(y+j)*(cw<<5)+(x+i)<<2]?1<<31-i%32:0;p&&(j&&(sprite[k-w32]|=m),w-1>j&&(sprite[k+w32]|=m),m|=m<<1|m>>1),sprite[k]|=m,seen|=m}seen?seenRow=j:(d.y0++,h--,j--,y++)}d.y1=d.y0+seenRow,d.sprite=sprite.slice(0,(d.y1-d.y0)*w32)}}}function cloudCollide(tag,board,sw){sw>>=5;for(var last,sprite=tag.sprite,w=tag.width>>5,lx=tag.x-(w<<4),sx=127&lx,msx=32-sx,h=tag.y1-tag.y0,x=(tag.y+tag.y0)*sw+(lx>>5),j=0;h>j;j++){last=0;for(var i=0;w>=i;i++)if((last<<msx|(w>i?(last=sprite[j*w+i])>>>sx:0))&board[x+i])return!0;x+=sw}return!1}function cloudBounds(bounds,d){var b0=bounds[0],b1=bounds[1];d.x+d.x0<b0.x&&(b0.x=d.x+d.x0),d.y+d.y0<b0.y&&(b0.y=d.y+d.y0),d.x+d.x1>b1.x&&(b1.x=d.x+d.x1),d.y+d.y1>b1.y&&(b1.y=d.y+d.y1)}function collideRects(a,b){return a.x+a.x1>b[0].x&&a.x+a.x0<b[1].x&&a.y+a.y1>b[0].y&&a.y+a.y0<b[1].y}function archimedeanSpiral(size){var e=size[0]/size[1];return function(t){return[e*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function rectangularSpiral(size){var dy=4,dx=dy*size[0]/size[1],x=0,y=0;return function(t){var sign=0>t?-1:1;switch(Math.sqrt(1+4*sign*t)-sign&3){case 0:x+=dx;break;case 1:y+=dy;break;case 2:x-=dx;break;default:y-=dy}return[x,y]}}function zeroArray(n){for(var a=[],i=-1;++i<n;)a[i]=0;return a}var canvas,cloudRadians=Math.PI/180,cw=64,ch=2048,ratio=1;if("undefined"!=typeof document)canvas=document.createElement("canvas"),canvas.width=1,canvas.height=1,ratio=Math.sqrt(canvas.getContext("2d").getImageData(0,0,1,1).data.length>>2),canvas.width=(cw<<5)/ratio,canvas.height=ch/ratio;else{var Canvas=require("canvas");canvas=new Canvas(cw<<5,ch)}var c=canvas.getContext("2d"),spirals={archimedean:archimedeanSpiral,rectangular:rectangularSpiral};c.fillStyle="red",c.textAlign="center",exports.cloud=cloud}("undefined"==typeof exports?d3.layout||(d3.layout={}):exports),function(requirejs,require,define){define("State",[],function(){function State(gstId,config){function getAllParameterNames(){return allParameterNames}function getAllParameterValues(){return allParameterValues}function getParamObj(paramName){return parameters.hasOwnProperty(paramName)===!1?void console.log('ERROR: Object parameters does not have a property named "'+paramName+'".'):parameters[paramName]}function bindUpdatePlotEvent(newPlotDiv,callback){plotDiv=newPlotDiv,plotDiv.bind("update_plot",callback)}function addDynamicEl(el,func,elId,updateOnEvent){var newLength;newLength=dynamicEl.push({el:el,func:func,elId:elId,updateOnEvent:updateOnEvent}),"undefined"!=typeof dynamicElByElId[elId]?console.log('ERROR: Duplicate dynamic element ID "'+elId+'" found.'):dynamicElByElId[elId]=dynamicEl[newLength-1]}function getParameterValue(paramName){return parameters.hasOwnProperty(paramName)===!1?void console.log('ERROR: Object parameters does not have a property named "'+paramName+'".'):parameters[paramname].value}function setParameterValue(paramName,paramValue,element,slider,updateOnEvent){var paramValueNum,c1;if(parameters.hasOwnProperty(paramName)===!1)return void console.log('ERROR: Object parameters does not have a property named "'+paramName+'".');if(paramValueNum=parseFloat(paramValue),isFinite(paramValueNum)===!1)return console.log("ERROR: New parameter value is not a floating-point number."),void console.log("paramValue = ",paramValue);for(paramValueNum<parameters[paramName].min?paramValueNum=parameters[paramName].min:paramValueNum>parameters[paramName].max&&(paramValueNum=parameters[paramName].max),parameters[paramName].value=paramValueNum,c1=0;c1<parameters[paramName].inputDivs.length;c1+=1)parameters[paramName].inputDivs[c1].val(paramValueNum);for(slider===!1&&null!==parameters[paramName].sliderDiv&&parameters[paramName].sliderDiv.slider("value",paramValueNum),allParameterValues[parameters[paramName].helperArrayIndex]=paramValueNum,c1=0;c1<dynamicEl.length;c1++)(void 0!==updateOnEvent&&dynamicEl[c1].updateOnEvent===updateOnEvent||void 0===updateOnEvent)&&(null!==dynamicEl[c1].el?dynamicEl[c1].el.html(dynamicEl[c1].func.apply(window,allParameterValues)):dynamicEl[c1].func.apply(window,allParameterValues));return void 0!==plotDiv&&plotDiv.trigger("update_plot"),!0}function processParameter(obj){function processFloat(attrName,newAttrName){var attrValue;return"string"!=typeof obj[attrName]?(console.log('ERROR: Expected obj["'+attrName+'"] to be a string. It is not.'),console.log('obj["'+attrName+'"] = ',obj[attrName]),!1):(attrValue=parseFloat(obj[attrName]),isFinite(attrValue)===!1?(console.log('ERROR: Expected obj["'+attrName+'"] to be a valid floating-point number. It is not.'),console.log('obj["'+attrName+'"] = ',obj[attrName]),!1):(newParamObj[newAttrName]=attrValue,!0))}var paramName,newParamObj;return"string"!=typeof obj["@var"]?(console.log('ERROR: Expected obj["@var"] to be a string. It is not.'),void console.log('obj["@var"] = ',obj["@var"])):(paramName=obj["@var"],newParamObj={},processFloat("@min","min")===!1||processFloat("@max","max")===!1||processFloat("@step","step")===!1||processFloat("@initial","value")===!1?void console.log('ERROR: A required property is missing. Not creating parameter "'+paramName+'"'):(newParamObj.inputDivs=[],newParamObj.sliderDiv=null,void(parameters[paramName]=newParamObj)))}function generateHelperArrays(){var paramName,c1;c1=0;for(paramName in parameters)allParameterNames.push(paramName),allParameterValues.push(parameters[paramName].value),parameters[paramName].helperArrayIndex=c1,c1+=1}var parameters,allParameterNames,allParameterValues,plotDiv,dynamicEl,dynamicElByElId;if(dynamicEl=[],dynamicElByElId={},stateInst+=1,parameters={},$.isPlainObject(config.parameters)===!1)return console.log("ERROR: Expected config.parameters to be an object. It is not."),void console.log("config.parameters = ",config.parameters);if($.isArray(config.parameters.param)===!0)!function(c1){for(;c1<config.parameters.param.length;)processParameter(config.parameters.param[c1]),c1+=1}(0);else{if($.isPlainObject(config.parameters.param)!==!0)return console.log("ERROR: config.parameters.param is of an unsupported type."),void console.log("config.parameters.param = ",config.parameters.param);processParameter(config.parameters.param)}return allParameterNames=[],allParameterValues=[],generateHelperArrays(),{getParameterValue:getParameterValue,setParameterValue:setParameterValue,getParamObj:getParamObj,getAllParameterNames:getAllParameterNames,getAllParameterValues:getAllParameterValues,bindUpdatePlotEvent:bindUpdatePlotEvent,addDynamicEl:addDynamicEl,plde:[]}}var stateInst;return stateInst=0,State})}(RequireJS.requirejs,RequireJS.require,RequireJS.define),window.ImageInput=function($){function ImageInputConstructor(elementId){this.el=$("#imageinput_"+elementId),this.crossEl=$("#cross_"+elementId),this.inputEl=$("#input_"+elementId),this.el.on("click",this.clickHandler.bind(this))}function clickHandler(event){var offset=this.el.offset(),posX=event.offsetX?event.offsetX:event.pageX-offset.left,posY=event.offsetY?event.offsetY:event.pageY-offset.top,result="["+Math.round(posX)+","+Math.round(posY)+"]";this.crossEl.css({left:posX-15,top:posY-15,visibility:"visible"}),this.inputEl.val(result)}var ImageInput=ImageInputConstructor;return ImageInput.prototype={constructor:ImageInputConstructor,clickHandler:clickHandler},ImageInput}.call(this,window.jQuery);var cktsim=function(){function Circuit(){this.node_map=[],this.ntypes=[],this.initial_conditions=[],this.devices=[],this.device_map=[],this.voltage_sources=[],this.current_sources=[],this.finalized=!1,this.diddc=!1,this.node_index=-1,this.periods=1}function mat_make(N,M){for(var mat=new Array(N),i=N-1;i>=0;--i){mat[i]=new Array(M);for(var j=M-1;j>=0;--j)mat[i][j]=0}return mat}function mat_v_mult(M,x,b,scale){var n=M.length,m=M[0].length;if(n!=b.length||m!=x.length)throw"Rows of M mismatched to b or cols mismatch to x.";for(var i=0;n>i;i++){for(var temp=0,j=0;m>j;j++)temp+=M[i][j]*x[j];b[i]=scale*temp}}function mat_scale_add(A,B,scalea,scaleb,C){var n=A.length,m=A[0].length;if(n>B.length||m>B[0].length)throw"Row or columns of A to large for B";if(n>C.length||m>C[0].length)throw"Row or columns of A to large for C";if("number"==typeof scalea&&"number"==typeof scaleb)for(var i=0;n>i;i++)for(var j=0;m>j;j++)C[i][j]=scalea*A[i][j]+scaleb*B[i][j];else if("number"==typeof scaleb&&scalea instanceof Array)for(var i=0;n>i;i++)for(var j=0;m>j;j++)C[i][j]=scalea[i]*A[i][j]+scaleb*B[i][j];else{if(!(typeof scaleb instanceof Array&&scalea instanceof Array))throw"scalea and scaleb must be scalars or Arrays";for(var i=0;n>i;i++)for(var j=0;m>j;j++)C[i][j]=scalea[i]*A[i][j]+scaleb[i]*B[i][j]}}function mat_copy(src,dest){var n=src.length,m=src[0].length;if(n>dest.length||m>dest[0].length)throw"Rows or cols > rows or cols of dest";for(var i=0;n>i;i++)for(var j=0;m>j;j++)dest[i][j]=src[i][j]}function mat_rank(Mo){var temp,i,j,Nr=Mo.length,Nc=Mo[0].length,M=mat_make(Nr,Nc);mat_copy(Mo,M);for(var max_abs_entry=0,row=Nr-1;row>=0;--row)for(var col=Nr-1;col>=0;--col)Math.abs(M[row][col])>max_abs_entry&&(max_abs_entry=Math.abs(M[row][col]));for(var the_rank=0,start_col=0,row=0;Nr>row;row++)for(var col=start_col;Nc>col;col++){for(var max_v=Math.abs(M[row][col]),max_row=row,i=row+1;Nr>i;i++)temp=Math.abs(M[i][col]),temp>max_v&&(max_v=temp,max_row=i);if(Math.abs(max_v)>eps*max_abs_entry){start_col=col+1,the_rank+=1,temp=M[row],M[row]=M[max_row],M[max_row]=temp;for(var i=row+1;Nr>i;i++)if(temp=M[i][col]/M[row][col],0!=temp)for(var j=col;Nc>j;j++)M[i][j]-=M[row][j]*temp;break}}return the_rank}function mat_solve_rq(M,rhs){var scale,Nr=M.length,Nc=M[0].length;if(null!=rhs)for(var row=Nr-1;row>=0;--row)M[row][Nc-1]=rhs[row];for(var mat_scale=0,max_nonzero_row=Nr-1,row=0;Nr>row;row++){for(var max_row=row,maxsumsq=0,rowp=row;Nr>rowp;rowp++){for(var Mr=M[rowp],sumsq=0,col=Nc-2;col>=0;--col)sumsq+=Mr[col]*Mr[col];(row==rowp||sumsq>maxsumsq)&&(max_row=rowp,maxsumsq=sumsq)}if(max_row>row){var temp=M[row];M[row]=M[max_row],M[max_row]=temp}var row_norm=Math.sqrt(maxsumsq);if(0==row&&(mat_scale=row_norm),!(row_norm>mat_scale*eps)){max_nonzero_row=row-1;break}scale=1/row_norm;for(var Mr=M[row],col=Nc-1;col>=0;--col)Mr[col]*=scale;for(var rowp=row+1;Nr>rowp;rowp++){for(var Mrp=M[rowp],inner=0,col=Nc-2;col>=0;--col)inner+=Mr[col]*Mrp[col];for(var col=Nc-1;col>=0;--col)Mrp[col]-=inner*Mr[col]}}for(var x=new Array(Nc-1),col=Nc-2;col>=0;--col)x[col]=0;for(var row=max_nonzero_row;row>=0;--row){Mr=M[row];for(var col=Nc-2;col>=0;--col)x[col]+=Mr[col]*Mr[Nc-1]}return x}function mat_solve(M,rhs){var temp,i,j,N=M.length;if(null!=rhs)for(var row=0;N>row;row++)M[row][N]=rhs[row];for(var col=0;N>col;col++){var max_v=Math.abs(M[col][col]),max_col=col;for(i=col+1;N>i;i++)temp=Math.abs(M[i][col]),temp>max_v&&(max_v=temp,max_col=i);for(0==max_v?M[col][col]=eps:(temp=M[col],M[col]=M[max_col],M[max_col]=temp),i=col+1;N>i;i++)if(temp=M[i][col]/M[col][col],0!=temp)for(j=col;N>=j;j++)M[i][j]-=M[col][j]*temp}var x=new Array(N);for(i=N-1;i>=0;--i){for(temp=M[i][N],j=N-1;j>i;--j)temp-=M[i][j]*x[j];x[i]=temp/M[i][i]}return x}function Device(){}function ord(ch){return ch.charCodeAt(0)}function parse_number(s,default_v){for(var slen=s.length,multiplier=1,result=0,index=0;slen>index&&s.charAt(index)<=" ";)index+=1;if(index==slen)return default_v;"-"==s.charAt(index)?(multiplier=-1,index+=1):"+"==s.charAt(index)&&(index+=1);var start=index;if(index>=slen)return default_v;if("0"==s.charAt(index)){if(index+=1,index>=slen)return 0;if("x"==s.charAt(index)||"X"==s.charAt(index)){for(;;){if(index+=1,index>=slen)break;if(s.charAt(index)>="0"&&s.charAt(index)<="9")result=16*result+ord(s.charAt(index))-ord("0");else if(s.charAt(index)>="A"&&s.charAt(index)<="F")result=16*result+ord(s.charAt(index))-ord("A")+10;else{if(!(s.charAt(index)>="a"&&s.charAt(index)<="f"))break;result=16*result+ord(s.charAt(index))-ord("a")+10}}return result*multiplier}if("b"==s.charAt(index)||"B"==s.charAt(index)){for(;;){if(index+=1,index>=slen)break;if(!(s.charAt(index)>="0"&&s.charAt(index)<="1"))break;result=2*result+ord(s.charAt(index))-ord("0")}return result*multiplier}if("."!=s.charAt(index)){for(;;){if(!(s.charAt(index)>="0"&&s.charAt(index)<="7"))break;if(result=8*result+ord(s.charAt(index))-ord("0"),index+=1,index>=slen)break}return result*multiplier}}for(;;){if(!(s.charAt(index)>="0"&&s.charAt(index)<="9"))break;if(result=10*result+ord(s.charAt(index))-ord("0"),index+=1,index>=slen)break}if(slen>index&&"."==s.charAt(index))for(;;){if(index+=1,index>=slen)break;if(!(s.charAt(index)>="0"&&s.charAt(index)<="9"))break;result=10*result+ord(s.charAt(index))-ord("0"),multiplier*=.1}if(index==start)return default_v;if(result*=multiplier,slen>index){var scale=s.charAt(index);if(index+=1,"e"==scale||"E"==scale){var exponent=0;for(multiplier=10,slen>index&&("+"==s.charAt(index)?index+=1:"-"==s.charAt(index)&&(index+=1,multiplier=.1));slen>index&&s.charAt(index)>="0"&&s.charAt(index)<="9";)exponent=10*exponent+ord(s.charAt(index))-ord("0"),index+=1;for(;exponent>0;)exponent-=1,result*=multiplier}else"t"==scale||"T"==scale?result*=1e12:"g"==scale||"G"==scale?result*=1e9:"M"==scale?result*=1e6:"k"==scale||"K"==scale?result*=1e3:"m"==scale?result*=.001:"u"==scale||"U"==scale?result*=1e-6:"n"==scale||"N"==scale?result*=1e-9:"p"==scale||"P"==scale?result*=1e-12:("f"==scale||"F"==scale)&&(result*=1e-15)}return result}function parse_source(v){var src={};src.period=0,src.value=function(){return 0},src.inflection_point=function(){return void 0};var ch,index=v.indexOf("(");if(index>=0){src.fun=v.slice(0,index),src.args=[];var end=v.indexOf(")",index);for(-1==end&&(end=v.length),index+=1;end>index;)if(ch=v.charAt(index)," ">=ch)index++;else{var arg_end=v.indexOf(",",index);-1==arg_end&&(arg_end=end),src.args.push(parse_number(v.slice(index,arg_end),void 0)),index=arg_end+1}}else src.fun="dc",src.args=[parse_number(v,0)];if("dc"==src.fun){var v=arg_value(src.args,0,0);src.args=[v],src.value=function(){return v}}else if("impulse"==src.fun){var h=arg_value(src.args,0,1),w=Math.abs(arg_value(src.args,2,1e-9));src.args=[h,w],pwl_source(src,[0,0,w/2,h,w,0],!1)}else if("step"==src.fun){var v1=arg_value(src.args,0,0),v2=arg_value(src.args,1,1),td=Math.max(0,arg_value(src.args,2,0)),tr=Math.abs(arg_value(src.args,3,1e-9));src.args=[v1,v2,td,tr],pwl_source(src,[td,v1,td+tr,v2],!1)}else if("square"==src.fun){var v1=arg_value(src.args,0,0),v2=arg_value(src.args,1,1),freq=Math.abs(arg_value(src.args,2,1)),duty_cycle=Math.min(100,Math.abs(arg_value(src.args,3,50)));src.args=[v1,v2,freq,duty_cycle];var per=0==freq?1/0:1/freq,t_change=.01*per,t_pw=.01*duty_cycle*.98*per;pwl_source(src,[0,v1,t_change,v2,t_change+t_pw,v2,t_change+t_pw+t_change,v1,per,v1],!0)}else if("triangle"==src.fun){var v1=arg_value(src.args,0,0),v2=arg_value(src.args,1,1),freq=Math.abs(arg_value(src.args,2,1));src.args=[v1,v2,freq];var per=0==freq?1/0:1/freq;pwl_source(src,[0,v1,per/2,v2,per,v1],!0)}else if("pwl"==src.fun||"pwl_repeating"==src.fun)pwl_source(src,src.args,"pwl_repeating"==src.fun);else if("pulse"==src.fun){var v1=arg_value(src.args,0,0),v2=arg_value(src.args,1,1),td=Math.max(0,arg_value(src.args,2,0)),tr=Math.abs(arg_value(src.args,3,1e-9)),tf=Math.abs(arg_value(src.args,4,1e-9)),pw=Math.abs(arg_value(src.args,5,1e9)),per=Math.abs(arg_value(src.args,6,1e9));src.args=[v1,v2,td,tr,tf,pw,per];var t1=td,t2=t1+tr,t3=t2+pw,t4=t3+tf;pwl_source(src,[t1,v1,t2,v2,t3,v2,t4,v1,per,v1],!0)}else if("sin"==src.fun){var voffset=arg_value(src.args,0,0),va=arg_value(src.args,1,1),freq=Math.abs(arg_value(src.args,2,1));src.period=1/freq;var td=Math.max(0,arg_value(src.args,3,0)),phase=arg_value(src.args,4,0);src.args=[voffset,va,freq,td,phase],phase/=360,src.value=function(t){return td>t?voffset+va*Math.sin(2*Math.PI*phase):voffset+va*Math.sin(2*Math.PI*(freq*(t-td)+phase))},src.inflection_point=function(t){return td>t?td:void 0}}return src.dc=src.value(0),src}function pwl_source(src,tv_pairs,repeat){var nvals=tv_pairs.length;repeat&&(src.period=tv_pairs[nvals-2]),nvals%2==1&&(npts-=1),2>=nvals?(src.value=function(){return 2==nvals?tv_pairs[1]:0},src.inflection_point=function(){return void 0}):(src.value=function(t){repeat&&(t=Math.fmod(t,tv_pairs[nvals-2]));var last_t=tv_pairs[0],last_v=tv_pairs[1];if(t>last_t)for(var next_t,next_v,i=2;nvals>i;i+=2){if(next_t=tv_pairs[i],next_v=tv_pairs[i+1],next_t>last_t&&next_t>t)return last_v+(next_v-last_v)*(t-last_t)/(next_t-last_t);last_t=next_t,last_v=next_v}return last_v},src.inflection_point=function(t){repeat&&(t=Math.fmod(t,tv_pairs[nvals-2]));for(var i=0;nvals>i;i+=2){var next_t=tv_pairs[i];if(next_t>t)return next_t}return void 0})}function arg_value(args,index,default_v){if(index<args.length){var result=args[index];return void 0===result&&(result=default_v),result}return default_v}function VSource(npos,nneg,branch,v){Device.call(this),this.src=parse_source(v),this.npos=npos,this.nneg=nneg,this.branch=branch}function ISource(npos,nneg,v){Device.call(this),this.src=parse_source(v),this.npos=npos,this.nneg=nneg}function Resistor(n1,n2,v){Device.call(this),this.n1=n1,this.n2=n2,this.g=1/v}function Diode(n1,n2,v,type){Device.call(this),this.anode=n1,this.cathode=n2,this.area=v,this.type=type,this.is=1e-14,this.ais=this.area*this.is,this.vt="normal"==type?.0258:1e-4,this.exp_arg_max=50,this.exp_max=Math.exp(this.exp_arg_max)}function Capacitor(n1,n2,v){Device.call(this),this.n1=n1,this.n2=n2,this.value=v}function Inductor(n1,n2,branch,v){Device.call(this),this.n1=n1,this.n2=n2,this.branch=branch,this.value=v}function Opamp(np,nn,no,ng,branch,A,name){Device.call(this),this.np=np,this.nn=nn,this.no=no,this.ng=ng,this.branch=branch,this.gain=A,this.name=name}function Fet(d,g,s,ratio,name,type){if(Device.call(this),this.d=d,this.g=g,this.s=s,this.name=name,this.ratio=ratio,"n"!=type&&"p"!=type)throw"fet type is not n or p";this.type_sign="n"==type?1:-1,this.vt=.5,this.kp=2e-5,this.beta=this.kp*this.ratio,this.lambda=.05}var T_VOLTAGE=0,T_CURRENT=1,v_newt_lim=.3,v_abstol=1e-6,i_abstol=1e-12,eps=1e-12,dc_max_iters=1e3,max_tran_iters=20,time_step_increase_factor=2,lte_step_decrease_factor=8,nr_step_decrease_factor=4,reltol=1e-4,lterel=10,res_check_abs=Math.sqrt(i_abstol),res_check_rel=Math.sqrt(reltol);Circuit.prototype.gnd_node=function(){return-1},Circuit.prototype.node=function(name,ntype,ic){return this.node_index+=1,name&&(this.node_map[name]=this.node_index),this.ntypes.push(ntype),this.initial_conditions.push(ic),this.node_index},Circuit.prototype.finalize=function(){if(!this.finalized){this.finalized=!0,this.N=this.node_index+1;for(var i=this.devices.length-1;i>=0;--i)this.devices[i].finalize(this);this.matrix=mat_make(this.N,this.N+1),this.Gl=mat_make(this.N,this.N),this.G=mat_make(this.N,this.N),this.C=mat_make(this.N,this.N),this.soln_max=new Array(this.N),this.abstol=new Array(this.N),this.solution=new Array(this.N),this.rhs=new Array(this.N);for(var i=this.N-1;i>=0;--i)this.soln_max[i]=0,this.abstol[i]=this.ntypes[i]==T_VOLTAGE?v_abstol:i_abstol,this.solution[i]=0,this.rhs[i]=0;for(var i=this.devices.length-1;i>=0;--i)this.devices[i].load_linear(this);var n_vsrc=this.voltage_sources.length;if(n_vsrc>0){for(var GV=mat_make(n_vsrc,this.N),i=n_vsrc-1;i>=0;--i)for(var branch=this.voltage_sources[i].branch,j=this.N-1;j>=0;j--)GV[i][j]=this.Gl[branch][j];var rGV=mat_rank(GV);if(n_vsrc>rGV)return alert("Warning!!! Circuit has a voltage source loop or a source or current probe shorted by a wire, please remove the source or the wire causing the short."),alert("Warning!!! Simulator might produce meaningless results or no result with illegal circuits."),!1}}return!0},Circuit.prototype.load_netlist=function(netlist){for(var i=netlist.length-1;i>=0;--i){var component=netlist[i],type=component[0];if("g"==type){var connections=component[3];this.node_map[connections[0]]=this.gnd_node()}}for(var found_ground=!1,i=netlist.length-1;i>=0;--i){var component=netlist[i],type=component[0];if("view"!=type&&"w"!=type&&"g"!=type&&"s"!=type&&"L"!=type){var properties=component[2],name=properties.name;(void 0==name||""==name)&&(name="_"+properties._json_.toString());for(var connections=component[3],j=connections.length-1;j>=0;--j){var node=connections[j],index=this.node_map[node];void 0==index?index=this.node(node,T_VOLTAGE):index==this.gnd_node()&&(found_ground=!0),connections[j]=index}"r"==type?this.r(connections[0],connections[1],properties.r,name):"d"==type?this.d(connections[0],connections[1],properties.area,properties.type,name):"c"==type?this.c(connections[0],connections[1],properties.c,name):"l"==type?this.l(connections[0],connections[1],properties.l,name):"v"==type?this.v(connections[0],connections[1],properties.value,name):"i"==type?this.i(connections[0],connections[1],properties.value,name):"o"==type?this.opamp(connections[0],connections[1],connections[2],connections[3],properties.A,name):"n"==type?this.n(connections[0],connections[1],connections[2],properties["W/L"],name):"p"==type?this.p(connections[0],connections[1],connections[2],properties["W/L"],name):"a"==type&&this.v(connections[0],connections[1],"0",name)
}}return found_ground?!0:(alert("Please make at least one connection to ground  (inverted T symbol)"),!1)},Circuit.prototype.find_solution=function(load,maxiters){for(var abssum_compare,converged,abssum_rhs,thresh,soln=this.solution,rhs=this.rhs,d_sol=[],abssum_old=0,use_limiting=!1,down_count=0,iter=0;maxiters>iter;iter++){load(this,soln,rhs),abssum_rhs=0;for(var i=this.N-1;i>=0;--i)this.ntypes[i]==T_VOLTAGE&&(abssum_rhs+=Math.abs(rhs[i]));if(iter>0&&0==use_limiting&&abssum_rhs>abssum_old){for(var i=this.N-1;i>=0;--i)soln[i]-=d_sol[i];iter-=1,use_limiting=!0}else d_sol=mat_solve_rq(this.matrix,rhs),abssum_old>abssum_rhs?down_count+=1:down_count=0,down_count>10&&(use_limiting=!1,down_count=0),abssum_old=abssum_rhs;(0==iter||abssum_rhs>abssum_compare)&&(abssum_compare=abssum_rhs),converged=maxiters-1>iter&&abssum_rhs>res_check_abs+res_check_rel*abssum_compare?!1:!0;for(var i=this.N-1;i>=0;--i)use_limiting&&this.ntypes[i]==T_VOLTAGE&&(d_sol[i]=d_sol[i]>v_newt_lim?v_newt_lim:d_sol[i],d_sol[i]=d_sol[i]<-v_newt_lim?-v_newt_lim:d_sol[i]),soln[i]+=d_sol[i],thresh=this.abstol[i]+reltol*this.soln_max[i],Math.abs(d_sol[i])>thresh&&(converged=!1,this.problem_node=i);if(1==converged){for(var i=this.N-1;i>=0;--i)Math.abs(soln[i])>this.soln_max[i]&&(this.soln_max[i]=Math.abs(soln[i]));return iter+1}}return void 0},Circuit.prototype.dc=function(){function load_dc(ckt,soln,rhs){mat_v_mult(ckt.Gl,soln,rhs,-1),mat_copy(ckt.Gl,ckt.G);for(var i=ckt.devices.length-1;i>=0;--i)ckt.devices[i].load_dc(ckt,soln,rhs);mat_copy(ckt.G,ckt.matrix)}if(0==this.finalize())return void 0;var iterations=this.find_solution(load_dc,dc_max_iters);if("undefined"==typeof iterations)return void alert(this.current_sources.length>0?"Newton Method Failed, do your current sources have a conductive path to ground?":"Newton Method Failed, it may be your circuit or it may be our simulator.");this.diddc=!0;var result=[];for(var name in this.node_map){var index=this.node_map[name];result[name]=-1==index?0:this.solution[index]}for(var i=this.voltage_sources.length-1;i>=0;--i){var v=this.voltage_sources[i];result["I("+v.name+")"]=this.solution[v.branch]}return result},Circuit.prototype.tran=function(ntpts,tstart,tstop,probenames,no_dc){function load_tran(ckt,soln,rhs){mat_v_mult(ckt.Gl,soln,ckt.c,-1),mat_copy(ckt.Gl,ckt.G);for(var i=ckt.devices.length-1;i>=0;--i)ckt.devices[i].load_tran(ckt,soln,ckt.c,ckt.time);mat_v_mult(ckt.C,soln,ckt.q,1);for(var i=ckt.N-1;i>=0;--i){var dqdt=ckt.alpha0*ckt.q[i]+ckt.alpha1*ckt.oldq[i]+ckt.alpha2*ckt.old2q[i];rhs[i]=ckt.beta0[i]*ckt.c[i]+ckt.beta1[i]*ckt.oldc[i]-dqdt}mat_scale_add(ckt.G,ckt.C,ckt.beta0,ckt.alpha0,ckt.matrix)}function interp_coeffs(t,t0,t1,t2){var dtt0=t-t0,dtt1=t-t1,dtt2=t-t2,dt0dt1=t0-t1,dt0dt2=t0-t2,dt1dt2=t1-t2;return p[0]=dtt1*dtt2/(dt0dt1*dt0dt2),p[1]=dtt0*dtt2/(-dt0dt1*dt1dt2),p[2]=dtt0*dtt1/(dt0dt2*dt1dt2),p}function pick_step(ckt){for(var min_shrink_factor=1/lte_step_decrease_factor,max_growth_factor=time_step_increase_factor,p=(ckt.N,interp_coeffs(ckt.time,ckt.oldt,ckt.old2t,ckt.old3t)),trapcoeff=.5*(ckt.time-ckt.oldt)/(ckt.time-ckt.old3t),maxlteratio=0,i=ckt.N-1;i>=0;--i)if(ckt.ltecheck[i]){var pred=p[0]*ckt.oldsol[i]+p[1]*ckt.old2sol[i]+p[2]*ckt.old3sol[i],lte=Math.abs(ckt.solution[i]-pred)*trapcoeff,lteratio=lte/(lterel*(ckt.abstol[i]+reltol*ckt.soln_max[i]));maxlteratio=Math.max(maxlteratio,lteratio)}var new_step,lte_step_ratio=1/Math.pow(maxlteratio,1/3);return 1>lte_step_ratio?(lte_step_ratio=Math.max(lte_step_ratio,min_shrink_factor),new_step=.75*(ckt.time-ckt.oldt)*lte_step_ratio,new_step=Math.max(new_step,ckt.min_step)):(lte_step_ratio=Math.min(lte_step_ratio,max_growth_factor),new_step=lte_step_ratio>1.2?(ckt.time-ckt.oldt)*lte_step_ratio/1.2:ckt.time-ckt.oldt,new_step=Math.min(new_step,ckt.max_step)),new_step}var p=new Array(3);if(no_dc=!1,0==this.diddc&&0==no_dc){if(void 0==this.dc()&&(alert("DC failed, trying transient analysis from zero."),this.finalized=!1,0==this.finalize()))return void 0}else if(0==this.finalize())return void 0;for(var N=this.N,response=new Array(N+1),i=N;i>=0;--i)response[i]=[];this.old3sol=new Array(this.N),this.old3q=new Array(this.N),this.old2sol=new Array(this.N),this.old2q=new Array(this.N),this.oldsol=new Array(this.N),this.oldq=new Array(this.N),this.q=new Array(this.N),this.oldc=new Array(this.N),this.c=new Array(this.N),this.alpha0=1,this.alpha1=0,this.alpha2=0,this.beta0=new Array(this.N),this.beta1=new Array(this.N),this.ar=this.algebraic(this.C),this.ltecheck=new Array(this.N);for(var i=N;i>=0;--i)this.ltecheck[i]=0==this.ar[i];for(var name in this.node_map)for(var index=this.node_map[name],i=probenames.length;i>=0;--i)if(name==probenames[i]){this.ltecheck[index]=!0;break}for(var period=tstop-tstart,i=this.voltage_sources.length-1;i>=0;--i){var per=this.voltage_sources[i].src.period;per>0&&(period=Math.min(period,per))}for(var i=this.current_sources.length-1;i>=0;--i){var per=this.current_sources[i].src.period;per>0&&(period=Math.min(period,per))}this.periods=Math.ceil((tstop-tstart)/period),this.time=tstart,this.max_step=(tstop-tstart)/(this.periods*ntpts),this.min_step=this.max_step/1e8;var new_step=this.max_step/1e6;this.oldt=this.time-new_step,load_tran(this,this.solution,this.rhs);for(var i=N-1;i>=0;--i)this.old3sol[i]=this.solution[i],this.old2sol[i]=this.solution[i],this.oldsol[i]=this.solution[i],this.old3q[i]=this.q[i],this.old2q[i]=this.q[i],this.oldq[i]=this.q[i],this.oldc[i]=this.c[i];for(var beta0,beta1,max_nsteps=5e4*this.periods,step_index=-3;max_nsteps>step_index;step_index++){for(var i=this.N-1;i>=0;--i)step_index>=0&&response[i].push(this.solution[i]),this.oldc[i]=this.c[i],this.old3sol[i]=this.old2sol[i],this.old2sol[i]=this.oldsol[i],this.oldsol[i]=this.solution[i],this.old3q[i]=this.oldq[i],this.old2q[i]=this.oldq[i],this.oldq[i]=this.q[i];if(0>step_index)this.old3t=this.old2t-(this.oldt-this.old2t),this.old2t=this.oldt-(tstart-this.oldt),this.oldt=tstart-(this.time-this.oldt),this.time=tstart,beta0=1,beta1=0;else{if(response[this.N].push(this.time),this.old3t=this.old2t,this.old2t=this.oldt,this.oldt=this.time,this.time>=tstop)break;this.time+new_step>tstop?this.time=tstop:this.time+=this.time+1.5*new_step>tstop?2/3*(tstop-this.time):new_step,beta0=.5,beta1=.5}for(var i=this.N-1;i>=0;--i)this.beta0[i]=beta0+this.ar[i]*beta1,this.beta1[i]=(1-this.ar[i])*beta1;for(;;){if(this.alpha0=1/(this.time-this.oldt),this.alpha1=-this.alpha0,this.alpha2=0,this.time-this.oldt<1e-4*tstop)for(var i=this.N-1;i>=0;--i)this.beta0[i]=1,this.beta1[i]=0;var iterations=this.find_solution(load_tran,max_tran_iters);if(void 0!=iterations&&(0>=step_index||this.time-this.oldt<(1+reltol)*this.min_step)){step_index>0&&(new_step=time_step_increase_factor*this.min_step);break}if(void 0==iterations)this.time=this.oldt+(this.time-this.oldt)/nr_step_decrease_factor;else{if(new_step=pick_step(this,step_index),!(new_step<(1-reltol)*(this.time-this.oldt)))break;this.time=this.oldt+new_step}}}var result=[];for(var name in this.node_map){var index=this.node_map[name];result[name]=-1==index?0:response[index]}for(var i=this.voltage_sources.length-1;i>=0;--i){var v=this.voltage_sources[i];result["I("+v.name+")"]=response[v.branch]}return result._time_=response[this.N],result},Circuit.prototype.ac=function(npts,fstart,fstop,source_name){if(void 0==this.dc())return void 0;var N=this.N,G=this.G,C=this.C,matrixac=mat_make(2*N,2*N+1);if(void 0===this.device_map[source_name])return alert("AC analysis refers to unknown source "+source_name),"AC analysis failed, unknown source";this.device_map[source_name].load_ac(this,this.rhs);for(var response=new Array(2*N+1),i=2*N;i>=0;--i)response[i]=[];for(var delta_f=Math.exp(Math.LN10/npts),phase_offset=new Array(N),i=N-1;i>=0;--i)phase_offset[i]=0;var f=fstart;for(fstop*=1.0001;fstop>=f;){var omega=2*Math.PI*f;response[2*N].push(f);for(var i=N-1;i>=0;--i){matrixac[i][2*N]=this.rhs[i],matrixac[i+N][2*N]=0;for(var j=N-1;j>=0;--j)matrixac[i][j]=G[i][j],matrixac[i+N][j+N]=G[i][j],matrixac[i][j+N]=-omega*C[i][j],matrixac[i+N][j]=omega*C[i][j]}for(var solac=mat_solve(matrixac),i=N-1;i>=0;--i){var mag=Math.sqrt(solac[i]*solac[i]+solac[i+N]*solac[i+N]);response[i].push(mag);var phase=180*(Math.atan2(solac[i+N],solac[i])/Math.PI),phasei=response[i+N],L=phasei.length;if(L>1){var phase_jump=phase+phase_offset[i]-phasei[L-1];phase_jump>90?phase_offset[i]-=360:-90>phase_jump&&(phase_offset[i]+=360)}response[i+N].push(phase+phase_offset[i])}f*=delta_f}var result=[];for(var name in this.node_map){var index=this.node_map[name];result[name]=-1==index?0:response[index],result[name+"_phase"]=-1==index?0:response[index+N]}return result._frequencies_=response[2*N],result},Circuit.prototype.add_device=function(d,name){return this.devices.push(d),d.name=name,name&&(void 0===this.device_map[name]?this.device_map[name]=d:(alert("Warning: two circuit elements share the same name "+name),this.device_map[name]=d)),d},Circuit.prototype.r=function(n1,n2,v,name){if("string"==typeof v&&(v=parse_number(v,void 0),void 0===v))return void 0;if(0!=v){var d=new Resistor(n1,n2,v);return this.add_device(d,name)}return this.v(n1,n2,"0",name)},Circuit.prototype.d=function(n1,n2,area,type,name){if("string"==typeof area&&(area=parse_number(area,void 0),void 0===area))return void 0;if(0!=area){var d=new Diode(n1,n2,area,type);return this.add_device(d,name)}},Circuit.prototype.c=function(n1,n2,v,name){if("string"==typeof v&&(v=parse_number(v,void 0),void 0===v))return void 0;var d=new Capacitor(n1,n2,v);return this.add_device(d,name)},Circuit.prototype.l=function(n1,n2,v,name){if("string"==typeof v&&(v=parse_number(v,void 0),void 0===v))return void 0;var branch=this.node(void 0,T_CURRENT),d=new Inductor(n1,n2,branch,v);return this.add_device(d,name)},Circuit.prototype.v=function(n1,n2,v,name){var branch=this.node(void 0,T_CURRENT),d=new VSource(n1,n2,branch,v);return this.voltage_sources.push(d),this.add_device(d,name)},Circuit.prototype.i=function(n1,n2,v,name){var d=new ISource(n1,n2,v);return this.current_sources.push(d),this.add_device(d,name)},Circuit.prototype.opamp=function(np,nn,no,ng,A,name){var ratio;if("string"==typeof A&&(ratio=parse_number(A,void 0),void 0===A))return void 0;var branch=this.node(void 0,T_CURRENT),d=new Opamp(np,nn,no,ng,branch,A,name);return this.add_device(d,name)},Circuit.prototype.n=function(d,g,s,ratio,name){if("string"==typeof ratio&&(ratio=parse_number(ratio,void 0),void 0===ratio))return void 0;var d=new Fet(d,g,s,ratio,name,"n");return this.add_device(d,name)},Circuit.prototype.p=function(d,g,s,ratio,name){if("string"==typeof ratio&&(ratio=parse_number(ratio,void 0),void 0===ratio))return void 0;var d=new Fet(d,g,s,ratio,name,"p");return this.add_device(d,name)},Circuit.prototype.add_two_terminal=function(i,j,g,M){i>=0?(M[i][i]+=g,j>=0&&(M[i][j]-=g,M[j][i]-=g,M[j][j]+=g)):j>=0&&(M[j][j]+=g)},Circuit.prototype.get_two_terminal=function(i,j,x){var xi_minus_xj=0;return i>=0&&(xi_minus_xj=x[i]),j>=0&&(xi_minus_xj-=x[j]),xi_minus_xj},Circuit.prototype.add_conductance_l=function(i,j,g){this.add_two_terminal(i,j,g,this.Gl)},Circuit.prototype.add_conductance=function(i,j,g){this.add_two_terminal(i,j,g,this.G)},Circuit.prototype.add_capacitance=function(i,j,c){this.add_two_terminal(i,j,c,this.C)},Circuit.prototype.add_to_Gl=function(i,j,g){i>=0&&j>=0&&(this.Gl[i][j]+=g)},Circuit.prototype.add_to_G=function(i,j,g){i>=0&&j>=0&&(this.G[i][j]+=g)},Circuit.prototype.add_to_C=function(i,j,c){i>=0&&j>=0&&(this.C[i][j]+=c)},Circuit.prototype.add_to_rhs=function(i,v,rhs){i>=0&&(rhs[i]+=v)},Circuit.prototype.algebraic=function(M){var Nr=M.length,Mc=mat_make(Nr,Nr);mat_copy(M,Mc);for(var R=mat_rank(Mc),one_if_alg=new Array(Nr),row=0;Nr>row;row++){for(var col=Nr-1;col>=0;--col)Mc[row][col]=0;if(mat_rank(Mc)==R)one_if_alg[row]=1;else{for(var col=Nr-1;col>=0;--col)Mc[row][col]=M[row][col];one_if_alg[row]=0}}return one_if_alg},Device.prototype.finalize=function(){},Device.prototype.load_linear=function(){},Device.prototype.load_dc=function(){},Device.prototype.load_tran=function(){},Device.prototype.load_ac=function(){},Device.prototype.breakpoint=function(){return void 0},Circuit.prototype.parse_number=parse_number,Math.fmod=function(numerator,denominator){var quotient=Math.floor(numerator/denominator);return numerator-quotient*denominator},VSource.prototype=new Device,VSource.prototype.constructor=VSource,VSource.prototype.load_linear=function(ckt){ckt.add_to_Gl(this.branch,this.npos,1),ckt.add_to_Gl(this.branch,this.nneg,-1),ckt.add_to_Gl(this.npos,this.branch,1),ckt.add_to_Gl(this.nneg,this.branch,-1)},VSource.prototype.load_dc=function(ckt,soln,rhs){ckt.add_to_rhs(this.branch,this.src.dc,rhs)},VSource.prototype.load_tran=function(ckt,soln,rhs,time){ckt.add_to_rhs(this.branch,this.src.value(time),rhs)},VSource.prototype.breakpoint=function(time){return this.src.inflection_point(time)},VSource.prototype.load_ac=function(ckt,rhs){ckt.add_to_rhs(this.branch,1,rhs)},ISource.prototype=new Device,ISource.prototype.constructor=ISource,ISource.prototype.load_linear=function(){},ISource.prototype.load_dc=function(ckt,soln,rhs){var is=this.src.dc;ckt.add_to_rhs(this.npos,-is,rhs),ckt.add_to_rhs(this.nneg,is,rhs)},ISource.prototype.load_tran=function(ckt,soln,rhs,time){var is=this.src.value(time);ckt.add_to_rhs(this.npos,-is,rhs),ckt.add_to_rhs(this.nneg,is,rhs)},ISource.prototype.breakpoint=function(time){return this.src.inflection_point(time)},ISource.prototype.load_ac=function(ckt,rhs){ckt.add_to_rhs(this.npos,-1,rhs),ckt.add_to_rhs(this.nneg,1,rhs)},Resistor.prototype=new Device,Resistor.prototype.constructor=Resistor,Resistor.prototype.load_linear=function(ckt){ckt.add_conductance_l(this.n1,this.n2,this.g)},Resistor.prototype.load_dc=function(){},Resistor.prototype.load_tran=function(){},Resistor.prototype.load_ac=function(){},Diode.prototype=new Device,Diode.prototype.constructor=Diode,Diode.prototype.load_linear=function(){},Diode.prototype.load_dc=function(ckt,soln,rhs){var temp1,temp2,vd=ckt.get_two_terminal(this.anode,this.cathode,soln),exp_arg=vd/this.vt,abs_exp_arg=Math.abs(exp_arg),d_arg=abs_exp_arg-this.exp_arg_max;if(d_arg>0){var quad=1+d_arg+.5*d_arg*d_arg;temp1=this.exp_max*quad,temp2=this.exp_max*(1+d_arg)}else temp1=Math.exp(abs_exp_arg),temp2=temp1;0>exp_arg&&(temp1=1/temp1,temp2=temp1*temp2*temp1);var id=this.ais*(temp1-1),gd=this.ais*(temp2/this.vt);ckt.add_to_rhs(this.anode,-id,rhs),ckt.add_to_rhs(this.cathode,id,rhs),ckt.add_conductance(this.anode,this.cathode,gd)},Diode.prototype.load_tran=function(ckt,soln,rhs){this.load_dc(ckt,soln,rhs)},Diode.prototype.load_ac=function(){},Capacitor.prototype=new Device,Capacitor.prototype.constructor=Capacitor,Capacitor.prototype.load_linear=function(ckt){ckt.add_capacitance(this.n1,this.n2,this.value)},Capacitor.prototype.load_dc=function(){},Capacitor.prototype.load_ac=function(){},Capacitor.prototype.load_tran=function(){},Inductor.prototype=new Device,Inductor.prototype.constructor=Inductor,Inductor.prototype.load_linear=function(ckt){ckt.add_to_Gl(this.n1,this.branch,1),ckt.add_to_Gl(this.n2,this.branch,-1),ckt.add_to_Gl(this.branch,this.n1,-1),ckt.add_to_Gl(this.branch,this.n2,1),ckt.add_to_C(this.branch,this.branch,this.value)},Inductor.prototype.load_dc=function(){},Inductor.prototype.load_ac=function(){},Inductor.prototype.load_tran=function(){},Opamp.prototype=new Device,Opamp.prototype.constructor=Opamp,Opamp.prototype.load_linear=function(ckt){var invA=1/this.gain;ckt.add_to_Gl(this.no,this.branch,1),ckt.add_to_Gl(this.ng,this.branch,-1),ckt.add_to_Gl(this.branch,this.no,invA),ckt.add_to_Gl(this.branch,this.ng,-invA),ckt.add_to_Gl(this.branch,this.np,-1),ckt.add_to_Gl(this.branch,this.nn,1)},Opamp.prototype.load_dc=function(){},Opamp.prototype.load_ac=function(){},Opamp.prototype.load_tran=function(){},Fet.prototype=new Device,Fet.prototype.constructor=Fet,Fet.prototype.load_linear=function(){},Fet.prototype.load_dc=function(ckt,soln,rhs){var vds=this.type_sign*ckt.get_two_terminal(this.d,this.s,soln);if(0>vds){var temp=this.d;this.d=this.s,this.s=temp,vds=this.type_sign*ckt.get_two_terminal(this.d,this.s,soln)}var vgs=this.type_sign*ckt.get_two_terminal(this.g,this.s,soln),vgst=vgs-this.vt;with(this){var gmgs,ids,gds;vgst>0&&(vds>vgst?(gmgs=beta*(1+lambda*vds)*vgst,ids=.5*type_sign*gmgs*vgst,gds=.5*beta*vgst*vgst*lambda):(gmgs=beta*(1+lambda*vds),ids=type_sign*gmgs*vds*(vgst-.5*vds),gds=gmgs*(vgst-vds)+beta*lambda*vds*(vgst-.5*vds),gmgs*=vds),ckt.add_to_rhs(d,-ids,rhs),ckt.add_to_rhs(s,ids,rhs),ckt.add_conductance(d,s,gds),ckt.add_to_G(s,s,gmgs),ckt.add_to_G(d,s,-gmgs),ckt.add_to_G(d,g,gmgs),ckt.add_to_G(s,g,-gmgs))}},Fet.prototype.load_tran=function(ckt,soln,rhs){this.load_dc(ckt,soln,rhs)},Fet.prototype.load_ac=function(){};var module={Circuit:Circuit,parse_number:parse_number,parse_source:parse_source};return module}();window.update_schematics=update_schematics,schematic=function(){function Schematic(input){this.show_grid=!0,this.grid=8,this.scale=2,this.origin_x=input.getAttribute("origin_x"),void 0==this.origin_x&&(this.origin_x=0),this.origin_y=input.getAttribute("origin_y"),void 0==this.origin_y&&(this.origin_y=0),this.cursor_x=0,this.cursor_y=0,this.window_list=[],this.edits_allowed=!0;var parts=input.getAttribute("parts");if(void 0==parts||"None"==parts){parts=[];for(var p in parts_map)parts.push(p)}else""==parts?(this.edits_allowed=!1,parts=[]):parts=parts.split(",");this.parts_bin=[];for(var i=0;i<parts.length;i++){var part=new Part(this),pm=parts_map[parts[i]];part.set_component(new pm[0](0,0,0),pm[1]),this.parts_bin.push(part)}var analyses=input.getAttribute("analyses");analyses=void 0==analyses||"None"==analyses?["dc","ac","tran"]:""==analyses?[]:analyses.split(","),this.diagram_only=0==parts.length&&0==analyses.length?!0:!1;var submit=input.getAttribute("submit_analyses");this.submit_analyses=submit&&-1!=submit.indexOf("{")?JSON.parse(submit):void 0,this.tools=[],this.toolbar=[],this.edits_allowed&&(this.tools.grid=this.add_tool(grid_icon,"Grid: toggle grid display",this.toggle_grid),this.enable_tool("grid",!0),this.tools.cut=this.add_tool(cut_icon,"Cut: move selected components from diagram to the clipboard",this.cut),this.tools.copy=this.add_tool(copy_icon,"Copy: copy selected components into the clipboard",this.copy),this.tools.paste=this.add_tool(paste_icon,"Paste: copy clipboard into the diagram",this.paste),this.toolbar.push(null)),"undefined"!=typeof cktsim&&(-1!=analyses.indexOf("dc")&&(this.tools.dc=this.add_tool("DC","DC Analysis",this.dc_analysis),this.enable_tool("dc",!0),this.dc_max_iters="1000"),-1!=analyses.indexOf("ac")&&(this.tools.ac=this.add_tool("AC","AC Small-Signal Analysis",this.setup_ac_analysis),this.enable_tool("ac",!0),this.ac_npts="50",this.ac_fstart="10",this.ac_fstop="1G",this.ac_source_name=void 0),-1!=analyses.indexOf("tran")&&(this.tools.tran=this.add_tool("TRAN","Transient Analysis",this.transient_analysis),this.enable_tool("tran",!0),this.tran_npts="100",this.tran_tstop="1")),this.canvas=document.createElement("canvas"),this.width=input.getAttribute("width"),this.width=parseInt(void 0==this.width?"400":this.width),this.canvas.width=this.width,this.height=input.getAttribute("height"),this.height=parseInt(void 0==this.height?"300":this.height),this.canvas.height=this.height,this.sctl_r=16,this.sctl_x=this.sctl_r+8,this.sctl_y=this.sctl_r+8,this.zctl_left=this.sctl_x-8,this.zctl_top=this.sctl_y+this.sctl_r+8,this.bg_image=document.createElement("canvas"),this.bg_image.width=this.width,this.bg_image.height=this.height,this.diagram_only||(this.canvas.tabIndex=1,this.canvas.style.borderStyle="solid",this.canvas.style.borderWidth="1px",this.canvas.style.borderColor=grid_style,this.canvas.style.outline="none"),this.canvas.schematic=this,this.edits_allowed&&(this.canvas.addEventListener("mousemove",schematic_mouse_move,!1),this.canvas.addEventListener("mouseover",schematic_mouse_enter,!1),this.canvas.addEventListener("mouseout",schematic_mouse_leave,!1),this.canvas.addEventListener("mousedown",schematic_mouse_down,!1),this.canvas.addEventListener("mouseup",schematic_mouse_up,!1),this.canvas.addEventListener("mousewheel",schematic_mouse_wheel,!1),this.canvas.addEventListener("DOMMouseScroll",schematic_mouse_wheel,!1),this.canvas.addEventListener("dblclick",schematic_double_click,!1),this.canvas.addEventListener("keydown",schematic_key_down,!1),this.canvas.addEventListener("keyup",schematic_key_up,!1)),this.diagram_only?this.status_div=void 0:(this.status_div=document.createElement("div"),this.status=document.createTextNode(""),this.status_div.appendChild(this.status),this.status_div.style.height=status_height+"px"),this.connection_points=[],this.components=[],this.dragging=!1,this.select_rect=void 0,this.wire=void 0,this.operating_point=void 0,this.dc_results=void 0,this.ac_results=void 0,this.transient_results=void 0,this.ctrlKey=!1,this.shiftKey=!1,this.altKey=!1,this.cmdKey=!1,input.schematic=this,this.input=input;var table,tr,td;if(table=document.createElement("table"),table.rules="none",this.diagram_only||(table.frame="box",table.style.borderStyle="solid",table.style.borderWidth="2px",table.style.borderColor=normal_style,table.style.backgroundColor=background_style),this.toolbar.length>0){tr=document.createElement("tr"),table.appendChild(tr),td=document.createElement("td"),td.style.verticalAlign="top",td.colSpan=2,tr.appendChild(td);for(var i=0;i<this.toolbar.length;++i){var tool=this.toolbar[i];null!=tool&&td.appendChild(tool)}}tr=document.createElement("tr"),table.appendChild(tr),td=document.createElement("td"),tr.appendChild(td);var wrapper=document.createElement("div");td.appendChild(wrapper),wrapper.style.position="relative",wrapper.appendChild(this.canvas),td=document.createElement("td"),td.style.verticalAlign="top",tr.appendChild(td);var parts_table=document.createElement("table");td.appendChild(parts_table),parts_table.rules="none",parts_table.frame="void",parts_table.cellPadding="0",parts_table.cellSpacing="0";for(var parts_per_column=Math.floor(this.height/(part_h+5)),i=0;parts_per_column>i;++i){tr=document.createElement("tr"),parts_table.appendChild(tr);for(var j=i;j<this.parts_bin.length;j+=parts_per_column)td=document.createElement("td"),tr.appendChild(td),td.appendChild(this.parts_bin[j].canvas)}void 0!=this.status_div&&(tr=document.createElement("tr"),table.appendChild(tr),td=document.createElement("td"),tr.appendChild(td),td.colSpan=2,td.appendChild(this.status_div));var toplevel=document.createElement("div");toplevel.onselectstart=function(){return!1},toplevel.appendChild(table),this.input.parentNode.insertBefore(toplevel,this.input.nextSibling),this.load_schematic(this.input.getAttribute("value"),this.input.getAttribute("initial_value")),this.zoomall()}function interpolate(t,times,values){if(void 0==values)return void 0;for(var i=0;i<times.length;i++)if(t<times[i]){var t1=0==i?times[0]:times[i-1],t2=times[i];if(void 0==t2)return void 0;var v1=0==i?values[0]:values[i-1],v2=values[i],v=v1;return t!=t1&&(v+=(t-t1)*(v2-v1)/(t2-t1)),v}}function schematic_key_down(event){event||(event=window.event);var sch=window.event?event.srcElement.schematic:event.target.schematic,code=event.keyCode;if(16==code)sch.shiftKey=!0;else if(17==code)sch.ctrlKey=!0;else if(18==code)sch.altKey=!0;else{if(91!=code){if(8==code||46==code){for(var i=sch.components.length-1;i>=0;--i){var component=sch.components[i];component.selected&&component.remove()}return sch.clean_up_wires(),sch.redraw_background(),event.preventDefault(),!1}if((sch.ctrlKey||sch.cmdKey)&&88==code)return sch.cut(),event.preventDefault(),!1;if((sch.ctrlKey||sch.cmdKey)&&67==code)return sch.copy(),event.preventDefault(),!1;if((sch.ctrlKey||sch.cmdKey)&&86==code)return sch.paste(),event.preventDefault(),!1;if(sch.ctrlKey||sch.altKey||sch.cmdKey||82!=code)return!0;for(var i=sch.components.length-1;i>=0;--i){var component=sch.components[i];component.selected&&(component.rotate(1),sch.check_wires(component))}return sch.clean_up_wires(),sch.redraw_background(),event.preventDefault(),!1}sch.cmdKey=!0}return sch.redraw(),event.preventDefault(),!1}function schematic_key_up(event){event||(event=window.event);var sch=window.event?event.srcElement.schematic:event.target.schematic,code=event.keyCode;16==code?sch.shiftKey=!1:17==code?sch.ctrlKey=!1:18==code?sch.altKey=!1:91==code&&(sch.cmdKey=!1)}function schematic_mouse_enter(event){event||(event=window.event);var sch=window.event?event.srcElement.schematic:event.target.schematic;if(sch.new_part){var part=sch.new_part;sch.new_part=void 0,part.select(!1),sch.unselect_all(-1),sch.redraw_background(),part=part.component.clone(sch.cursor_x,sch.cursor_y),part.add(sch),part.set_select(!0),sch.drag_begin()}return sch.drawCursor=!0,sch.redraw(),sch.canvas.focus(),!1}function schematic_mouse_leave(event){event||(event=window.event);var sch=window.event?event.srcElement.schematic:event.target.schematic;return sch.drawCursor=!1,sch.redraw(),!1}function schematic_mouse_down(event){event?event.preventDefault():event=window.event;var sch=window.event?event.srcElement.schematic:event.target.schematic;sch.canvas.relMouseCoords(event);var mx=sch.canvas.mouse_x,my=sch.canvas.mouse_y,sx=mx-sch.sctl_x,sy=my-sch.sctl_y,zx=mx-sch.zctl_left,zy=my-sch.zctl_top;if(sx*sx+sy*sy<=sch.sctl_r*sch.sctl_r)if(Math.abs(sy)>Math.abs(sx)){var delta=this.height/8;sy>0&&(delta=-delta);var temp=sch.origin_y-delta;temp>origin_min*sch.grid&&temp<origin_max*sch.grid&&(sch.origin_y=temp)}else{var delta=this.width/8;0>sx&&(delta=-delta);var temp=sch.origin_x+delta;temp>origin_min*sch.grid&&temp<origin_max*sch.grid&&(sch.origin_x=temp)}else if(zx>=0&&16>zx&&zy>=0&&48>zy)16>zy?sch.zoomin():32>zy?sch.zoomout():sch.zoomall();else{var x=mx/sch.scale+sch.origin_x,y=my/sch.scale+sch.origin_y;sch.cursor_x=Math.round(x/sch.grid)*sch.grid,sch.cursor_y=Math.round(y/sch.grid)*sch.grid;var cplist=sch.connection_points[sch.cursor_x+","+sch.cursor_y];if(cplist&&!event.shiftKey)sch.unselect_all(-1),sch.wire=[sch.cursor_x,sch.cursor_y,sch.cursor_x,sch.cursor_y];else{for(var which=-1,i=sch.components.length-1;i>=0;--i)if(sch.components[i].select(x,y,event.shiftKey)){sch.components[i].selected&&(sch.drag_begin(),which=i);break}var reselect=-1!=which&&sch.components[which].was_previously_selected;event.shiftKey||(reselect||sch.unselect_all(which),sch.dragging||(sch.select_rect=[sch.canvas.mouse_x,sch.canvas.mouse_y,sch.canvas.mouse_x,sch.canvas.mouse_y]))}}return sch.redraw_background(),!1}function schematic_mouse_move(event){event||(event=window.event);var sch=window.event?event.srcElement.schematic:event.target.schematic;sch.canvas.relMouseCoords(event);var x=sch.canvas.mouse_x/sch.scale+sch.origin_x,y=sch.canvas.mouse_y/sch.scale+sch.origin_y;if(sch.cursor_x=Math.round(x/sch.grid)*sch.grid,sch.cursor_y=Math.round(y/sch.grid)*sch.grid,sch.wire)sch.wire[2]=sch.cursor_x,sch.wire[3]=sch.cursor_y;else if(sch.dragging){var dx=sch.cursor_x-sch.drag_x,dy=sch.cursor_y-sch.drag_y;if(0!=dx||0!=dy){sch.drag_x=sch.cursor_x,sch.drag_y=sch.cursor_y;for(var i=sch.components.length-1;i>=0;--i){var component=sch.components[i];component.selected&&component.move(dx,dy)}}}else sch.select_rect&&(sch.select_rect[2]=sch.canvas.mouse_x,sch.select_rect[3]=sch.canvas.mouse_y);return sch.redraw(),!1}function schematic_mouse_up(event){event?event.preventDefault():event=window.event;var sch=window.event?event.srcElement.schematic:event.target.schematic;if(sch.wire){var r=sch.wire;sch.wire=void 0,r[0]!=r[2]||r[1]!=r[3]?(sch.add_wire(r[0],r[1],r[2],r[3]),sch.clean_up_wires(),sch.redraw_background()):sch.redraw()}if(sch.dragging&&sch.drag_end(),sch.select_rect){var r=sch.select_rect;if(r[0]!=r[2]||r[1]!=r[3]){var s=[r[0]/sch.scale+sch.origin_x,r[1]/sch.scale+sch.origin_y,r[2]/sch.scale+sch.origin_x,r[3]/sch.scale+sch.origin_y];canonicalize(s),event.shiftKey||sch.unselect_all();for(var i=sch.components.length-1;i>=0;--i)sch.components[i].select_rect(s,event.shiftKey)}sch.select_rect=void 0,sch.redraw_background()}return!1}function schematic_mouse_wheel(event){event?event.preventDefault():event=window.event;var sch=window.event?event.srcElement.schematic:event.target.schematic,delta=0;if(event.wheelDelta?delta=event.wheelDelta:event.detail&&(delta=-event.detail),delta){var nscale=delta>0?sch.scale*zoom_factor:sch.scale/zoom_factor;if(nscale>zoom_min&&zoom_max>nscale){sch.canvas.relMouseCoords(event);var s=1/sch.scale-1/nscale;sch.origin_x+=sch.canvas.mouse_x*s,sch.origin_y+=sch.canvas.mouse_y*s,sch.scale=nscale,sch.redraw_background()}}}function schematic_double_click(event){event?event.preventDefault():event=window.event;var sch=window.event?event.srcElement.schematic:event.target.schematic;sch.canvas.relMouseCoords(event);var x=sch.canvas.mouse_x/sch.scale+sch.origin_x,y=sch.canvas.mouse_y/sch.scale+sch.origin_y;sch.cursor_x=Math.round(x/sch.grid)*sch.grid,sch.cursor_y=Math.round(y/sch.grid)*sch.grid;for(var i=sch.components.length-1;i>=0&&!sch.components[i].edit_properties(x,y);--i);return!1}function dialog_cancel(event){event||(event=window.event);var dialog=window.event?event.srcElement.dialog:event.target.dialog;window_close(dialog.win)}function dialog_okay(event){event||(event=window.event);var dialog=window.event?event.srcElement.dialog:event.target.dialog;window_close(dialog.win),dialog.callback&&dialog.callback(dialog.content)}function dialog_check_for_ENTER(event){var key=window.event?window.event.keyCode:event.keyCode;13==key&&dialog_okay(event)}function build_table(a){var tbl=document.createElement("table");for(var i in a){var label=document.createTextNode(i+": "),col1=document.createElement("td");col1.appendChild(label);var col2=document.createElement("td");col2.appendChild(a[i]);var row=document.createElement("tr");row.appendChild(col1),row.appendChild(col2),row.style.verticalAlign="center",tbl.appendChild(row)}return tbl}function build_input(type,size,value){var input=document.createElement("input");return input.type=type,input.size=size,input.className="property",input.value=void 0==value?"":value.toString(),input}function build_select(options,selected){for(var select=document.createElement("select"),i=0;i<options.length;i++){var option=document.createElement("option");option.text=options[i],select.add(option),options[i]==selected&&(select.selectedIndex=i)}return select}function bring_to_front(win,insert){var wlist=win.sch.window_list,i=wlist.indexOf(win);for(-1!=i&&wlist.splice(i,1),insert&&wlist.push(win),i=0;i<wlist.length;i+=1)wlist[i].style.zIndex=1e3+i}function window_close(win){win.parentNode.removeChild(win),bring_to_front(win,!1)}function window_close_button(event){event||(event=window.event);var src=window.event?event.srcElement:event.target;window_close(src.win)}function window_mouse_down(event){event||(event=window.event);var src=window.event?event.srcElement:event.target,win=src.win;return bring_to_front(win,!0),document.addEventListener("mousemove",window_mouse_move,!1),document.addEventListener("mouseup",window_mouse_up,!1),document.tracking_window=win,win.drag_x=event.pageX,win.drag_y=event.pageY,!1}function window_mouse_up(){var win=document.tracking_window;return document.removeEventListener("mousemove",window_mouse_move,!1),document.removeEventListener("mouseup",window_mouse_up,!1),document.tracking_window=void 0,win.drag_x=void 0,win.drag_y=void 0,!0}function window_mouse_move(event){var win=document.tracking_window;if(win.drag_x){var dx=event.pageX-win.drag_x,dy=event.pageY-win.drag_y;return win.left+=dx,win.top+=dy,win.style.left=win.left+"px",win.style.top=win.top+"px",win.drag_x+=dx,win.drag_y+=dy,!0}}function tool_enter(event){event||(event=window.event);var tool=window.event?event.srcElement:event.target;tool.enabled&&(tool.style.borderColor=normal_style,tool.sch.message(tool.tip),tool.opacity=1)}function tool_leave(event){event||(event=window.event);var tool=window.event?event.srcElement:event.target;tool.enabled&&(tool.style.borderColor=background_style,tool.sch.message(""))}function tool_click(event){event||(event=window.event);
var tool=window.event?event.srcElement:event.target;tool.enabled&&(tool.sch.canvas.relMouseCoords(event),tool.callback.call(tool.sch))}function view_limits(vmin,vmax){vmin==vmax&&(0==vmin?(vmin=-.5,vmax=.5):(vmin=vmin>0?.9*vmin:1.1*vmin,vmax=vmax>0?1.1*vmax:.9*vmax));var log_range=Math.log(vmax-vmin)/Math.LN10,exponent=Math.floor(log_range),scale=Math.pow(10,-exponent);return vmin=Math.floor(scale*vmin)/scale,vmax=Math.ceil(scale*vmax)/scale,[vmin,vmax,1/scale]}function engineering_notation(n,nplaces,trim){if(0==n)return"0";if(void 0==n)return"undefined";void 0==trim&&(trim=!0);var sign=0>n?-1:1,log10=Math.log(sign*n)/Math.LN10,exp=Math.floor(log10/3),mantissa=sign*Math.pow(10,log10-3*exp),mstring=(mantissa+.5*sign*Math.pow(10,-nplaces)).toString(),mlen=mstring.length,endindex=mstring.indexOf(".");if(-1!=endindex){if(nplaces>0&&(endindex+=nplaces+1,endindex>mlen&&(endindex=mlen),trim)){for(;"0"==mstring.charAt(endindex-1);)endindex-=1;"."==mstring.charAt(endindex-1)&&(endindex-=1)}mlen>endindex&&(mstring=mstring.substring(0,endindex))}switch(exp){case-5:return mstring+"f";case-4:return mstring+"p";case-3:return mstring+"n";case-2:return mstring+"u";case-1:return mstring+"m";case 0:return mstring;case 1:return mstring+"K";case 2:return mstring+"M";case 3:return mstring+"G"}return n.toString()}function array_max(a){for(var max=-1/0,i=a.length-1;i>=0;--i)a[i]>max&&(max=a[i]);return max}function array_min(a){for(var min=1/0,i=a.length-1;i>=0;--i)a[i]<min&&(min=a[i]);return min}function plot_cursor(c,graph,cursor_x,left_margin){var x=graph.left_margin+cursor_x,end_y=graph.top_margin+graph.pheight+graph.tick_length;c.strokeStyle=grid_style,c.lineWidth=1,c.beginPath(),c.dashedLineTo(x,graph.top_margin,x,end_y,cursor_pattern),c.stroke();var graph_x=cursor_x/graph.x_scale+graph.x_min;c.font="10pt sans-serif",c.textAlign="center",c.textBaseline="top",c.fillStyle=background_style,c.fillText("",x,end_y),c.fillStyle=normal_style,c.fillText(engineering_notation(graph_x,3,!1),x,end_y);for(var x_values=graph.x_values,len=x_values.length,index=0;len>index&&graph_x>=x_values[index];)index+=1;var x1=0==index?x_values[0]:x_values[index-1],x2=x_values[index];if(void 0!=x2){c.textAlign="left";var tx=graph.left_margin+left_margin,ty=graph.top_margin;if(void 0!=graph.y_values)for(var plot=0;plot<graph.y_values.length;plot++){var values=graph.y_values[plot][2],color=probe_colors_rgb[graph.y_values[plot][0]];if(void 0!=values&&void 0!=color){var y1=0==index?values[0]:values[index-1],y2=values[index],y=y1;graph_x!=x1&&(y+=(graph_x-x1)*(y2-y1)/(x2-x1)),c.fillStyle=element_style,c.fillText("",tx-3,ty),c.fillStyle=color,c.fillText(engineering_notation(y,3,!1),tx,ty),ty+=14}}if(c.textAlign="right",void 0!=graph.z_values)for(var tx=graph.left_margin+graph.pwidth-left_margin,ty=graph.top_margin,plot=0;plot<graph.z_values.length;plot++){var values=graph.z_values[plot][2],color=probe_colors_rgb[graph.z_values[plot][0]];if(void 0!=values&&void 0!=color){var z1=0==index?values[0]:values[index-1],z2=values[index],z=z1;graph_x!=x1&&(z+=(graph_x-x1)*(z2-z1)/(x2-x1)),c.fillStyle=element_style,c.fillText("",tx+3,ty),c.fillStyle=color,c.fillText(engineering_notation(z,3,!1),tx,ty),ty+=14}}}}function redraw_plot(graph){var c=graph.getContext("2d");c.drawImage(graph.bg_image,0,0),void 0!=graph.cursor1_x&&plot_cursor(c,graph,graph.cursor1_x,4),void 0!=graph.cursor2_x&&plot_cursor(c,graph,graph.cursor2_x,30)}function graph_mouse_move(event){event||(event=window.event);var g=window.event?event.srcElement:event.target;g.relMouseCoords(event);var gx=g.mouse_x-g.left_margin-3,gy=g.pheight-(g.mouse_y-g.top_margin)+3;gx>=0&&gx<=g.pwidth&&gy>=0&&gy<=g.pheight?g.cursor1_x=gx:(g.cursor1_x=void 0,g.cursor2_x=void 0),redraw_plot(g)}function Part(sch){this.sch=sch,this.component=void 0,this.selected=!1,this.canvas=document.createElement("canvas"),this.canvas.style.borderStyle="solid",this.canvas.style.borderWidth="1px",this.canvas.style.borderColor=background_style,this.canvas.style.cursor="default",this.canvas.height=part_w,this.canvas.width=part_h,this.canvas.part=this,this.canvas.addEventListener("mouseover",part_enter,!1),this.canvas.addEventListener("mouseout",part_leave,!1),this.canvas.addEventListener("mousedown",part_mouse_down,!1),this.canvas.addEventListener("mouseup",part_mouse_up,!1),this.canvas.addEventListener("click",function(){},!1)}function part_enter(event){event||(event=window.event);var canvas=window.event?event.srcElement:event.target,part=canvas.part;return canvas.style.borderColor=normal_style,part.sch.message(part.tip+": drag onto diagram to insert"),!1}function part_leave(event){event||(event=window.event);var canvas=window.event?event.srcElement:event.target,part=canvas.part;return"undefined"==typeof part.sch.new_part,canvas.style.borderColor=background_style,part.sch.message(""),!1}function part_mouse_down(event){event||(event=window.event);var part=window.event?event.srcElement.part:event.target.part;return part.select(!0),part.sch.new_part=part,!1}function part_mouse_up(event){event||(event=window.event);var part=window.event?event.srcElement.part:event.target.part;return part.select(!1),part.sch.new_part=void 0,!1}function canonicalize(r){var temp;r[0]>r[2]&&(temp=r[0],r[0]=r[2],r[2]=temp),r[1]>r[3]&&(temp=r[1],r[1]=r[3],r[3]=temp)}function between(x,x1,x2){return x>=x1&&x2>=x}function inside(rect,x,y){return between(x,rect[0],rect[2])&&between(y,rect[1],rect[3])}function intersect(r1,r2){var result=!(r2[0]>r1[2]||r2[2]<r1[0]||r2[1]>r1[3]||r2[3]<r1[1]);return result}function Component(type,x,y,rotation){this.sch=void 0,this.type=type,this.x=x,this.y=y,this.rotation=rotation,this.selected=!1,this.properties=[],this.bounding_box=[0,0,0,0],this.bbox=this.bounding_box,this.connections=[]}function ConnectionPoint(parent,x,y){this.parent=parent,this.offset_x=x,this.offset_y=y,this.location="",this.update_location(),this.label=void 0}function collinear(p1,p2,p3){var area=p1.x*(p2.y-p3.y)+p2.x*(p3.y-p1.y)+p3.x*(p1.y-p2.y);return 0==area}function Wire(x1,y1,x2,y2){Component.call(this,"w",x1,y1,0),this.dx=x2-x1,this.dy=y2-y1,this.add_connection(0,0),this.add_connection(this.dx,this.dy);var r=[0,0,this.dx,this.dy];canonicalize(r),r[0]-=near_distance,r[1]-=near_distance,r[2]+=near_distance,r[3]+=near_distance,this.bounding_box=r,this.update_coords(),this.len=Math.sqrt(this.dx*this.dx+this.dy*this.dy)}function Ground(x,y,rotation){Component.call(this,"g",x,y,rotation),this.add_connection(0,0),this.bounding_box=[-6,0,6,8],this.update_coords()}function Label(x,y,rotation,label){Component.call(this,"L",x,y,rotation),this.properties.label=label?label:"???",this.add_connection(0,0),this.bounding_box=[-2,0,2,8],this.update_coords()}function Probe(x,y,rotation,color,offset){Component.call(this,"s",x,y,rotation),this.add_connection(0,0),this.properties.color=color?color:"cyan",this.properties.offset=void 0==offset||""==offset?"0":offset,this.bounding_box=[0,0,27,-21],this.update_coords()}function Ammeter(x,y,rotation,color,offset){Component.call(this,"a",x,y,rotation),this.add_connection(0,0),this.add_connection(16,0),this.properties.color=color?color:"magenta",this.properties.offset=void 0==offset||""==offset?"0":offset,this.bounding_box=[-3,0,16,3],this.update_coords()}function Resistor(x,y,rotation,name,r){Component.call(this,"r",x,y,rotation),this.properties.name=name,this.properties.r=r?r:"1",this.add_connection(0,0),this.add_connection(0,48),this.bounding_box=[-5,0,5,48],this.update_coords()}function Capacitor(x,y,rotation,name,c){Component.call(this,"c",x,y,rotation),this.properties.name=name,this.properties.c=c?c:"1p",this.add_connection(0,0),this.add_connection(0,48),this.bounding_box=[-8,0,8,48],this.update_coords()}function Inductor(x,y,rotation,name,l){Component.call(this,"l",x,y,rotation),this.properties.name=name,this.properties.l=l?l:"1n",this.add_connection(0,0),this.add_connection(0,48),this.bounding_box=[-4,0,5,48],this.update_coords()}function Diode(x,y,rotation,name,area,type){Component.call(this,"d",x,y,rotation),this.properties.name=name,this.properties.area=area?area:"1",this.properties.type=type?type:"normal",this.add_connection(0,0),this.add_connection(0,48),this.bounding_box="ideal"==type?[-12,0,12,48]:[-8,0,8,48],this.update_coords()}function NFet(x,y,rotation,name,w_over_l){Component.call(this,"n",x,y,rotation),this.properties.name=name,this.properties["W/L"]=w_over_l?w_over_l:"2",this.add_connection(0,0),this.add_connection(-24,24),this.add_connection(0,48),this.bounding_box=[-24,0,8,48],this.update_coords()}function PFet(x,y,rotation,name,w_over_l){Component.call(this,"p",x,y,rotation),this.properties.name=name,this.properties["W/L"]=w_over_l?w_over_l:"2",this.add_connection(0,0),this.add_connection(-24,24),this.add_connection(0,48),this.bounding_box=[-24,0,8,48],this.update_coords()}function OpAmp(x,y,rotation,name,A){Component.call(this,"o",x,y,rotation),this.properties.name=name,this.properties.A=A?A:"30000",this.add_connection(0,0),this.add_connection(0,16),this.add_connection(48,8),this.add_connection(24,32),this.bounding_box=[0,-8,48,32],this.update_coords()}function Source(x,y,rotation,name,type,value){Component.call(this,type,x,y,rotation),this.properties.name=name,void 0==value&&(value="dc(1)"),this.properties.value=value,this.add_connection(0,0),this.add_connection(0,48),this.bounding_box=[-12,0,12,48],this.update_coords(),this.content=document.createElement("div")}function source_type_changed(event){event||(event=window.event);var select=window.event?event.srcElement:event.target,type=select.options[select.selectedIndex].value,src=void 0;void 0!=this.src&&type==this.src.fun?src=this.src:"undefined"!=typeof cktsim&&(src=cktsim.parse_source(type+"()")),select.component.build_content(src)}function VSource(x,y,rotation,name,value){Source.call(this,x,y,rotation,name,"v",value),this.type="v"}function ISource(x,y,rotation,name,value){Source.call(this,x,y,rotation,name,"i",value),this.type="i"}function component_slider(event,ui){var sname=$(this).slider("option","schematic"),cname=$(this).slider("option","component"),pname=$(this).slider("option","property"),suffix=$(this).slider("option","suffix");"string"!=typeof suffix&&(suffix="");var v=ui.value;$(this).slider("value",v);var choices=$(this).slider("option","choices");choices instanceof Array&&(v=choices[v]),$("."+sname).each(function(index,element){element.schematic.set_property(cname,pname,v.toString()+suffix)});var analysis=$(this).slider("option","analysis");return"dc"==analysis&&$("."+sname).each(function(index,element){element.schematic.dc_analysis()}),!1}var background_style="rgb(220,220,220)",element_style="rgb(255,255,255)",normal_style="rgb(0,0,0)",component_style="rgb(64,64,255)",selected_style="rgb(64,255,64)",grid_style="rgb(128,128,128)",annotation_style="rgb(255,64,64)",property_size=5,annotation_size=6,parts_map={g:[Ground,"Ground connection"],L:[Label,"Node label"],v:[VSource,"Voltage source"],i:[ISource,"Current source"],r:[Resistor,"Resistor"],c:[Capacitor,"Capacitor"],l:[Inductor,"Inductor"],o:[OpAmp,"Op Amp"],d:[Diode,"Diode"],n:[NFet,"NFet"],p:[PFet,"PFet"],s:[Probe,"Voltage Probe"],a:[Ammeter,"Current Probe"]};"undefined"==typeof sch_clipboard&&(sch_clipboard=[]);var part_w=42,part_h=42,status_height=18;Schematic.prototype.add_component=function(new_c){this.components.push(new_c)},Schematic.prototype.remove_component=function(c){var index=this.components.indexOf(c);-1!=index&&this.components.splice(index,1)},Schematic.prototype.find_connections=function(cp){return this.connection_points[cp.location]},Schematic.prototype.add_connection_point=function(cp){var cplist=this.connection_points[cp.location];return cplist?cplist.push(cp):(cplist=[cp],this.connection_points[cp.location]=cplist),cplist},Schematic.prototype.remove_connection_point=function(cp,old_location){var cplist=this.connection_points[old_location];if(cplist){var index=cplist.indexOf(cp);-1!=index&&(cplist.splice(index,1),0==cplist.length&&delete this.connection_points[old_location])}},Schematic.prototype.update_connection_point=function(cp,old_location){return this.remove_connection_point(cp,old_location),this.add_connection_point(cp)},Schematic.prototype.add_wire=function(x1,y1,x2,y2){var new_wire=new Wire(x1,y1,x2,y2);return new_wire.add(this),new_wire.move_end(),new_wire},Schematic.prototype.split_wire=function(w,cp){w.remove(),this.add_wire(w.x,w.y,cp.x,cp.y),this.add_wire(w.x+w.dx,w.y+w.dy,cp.x,cp.y)},Schematic.prototype.check_wires=function(c){for(var i=0;i<this.components.length;i++){var cc=this.components[i];if(cc!=c){var cp=cc.bisect(c);cp&&(this.split_wire(cc,cp),this.redraw_background())}}},Schematic.prototype.check_connection_points=function(w){for(var locn in this.connection_points){var cplist=this.connection_points[locn];if(cplist&&w.bisect_cp(cplist[0]))return this.split_wire(w,cplist[0]),void this.redraw_background()}},Schematic.prototype.clean_up_wires=function(){for(var locn in this.connection_points){var cplist=this.connection_points[locn];if(cplist&&2==cplist.length){var c1=cplist[0].parent,c2=cplist[1].parent;if("w"==c1.type&&"w"==c2.type){var e1=c1.other_end(cplist[0]),e2=c2.other_end(cplist[1]),e3=cplist[0];collinear(e1,e2,e3)&&(c1.remove(),c2.remove(),this.add_wire(e1.x,e1.y,e2.x,e2.y))}}}},Schematic.prototype.unselect_all=function(which){this.operating_point=void 0;for(var i=this.components.length-1;i>=0;--i)i!=which&&this.components[i].set_select(!1)},Schematic.prototype.drag_begin=function(){for(var i=this.components.length-1;i>=0;--i){var component=this.components[i];component.selected&&component.move_begin()}this.drag_x=this.cursor_x,this.drag_y=this.cursor_y,this.dragging=!0},Schematic.prototype.drag_end=function(){for(var i=this.components.length-1;i>=0;--i){var component=this.components[i];component.selected&&component.move_end()}this.dragging=!1,this.clean_up_wires(),this.redraw_background()},Schematic.prototype.help=function(){window.open("/static/handouts/schematic_tutorial.pdf")},Schematic.prototype.rescale=function(nscale,cx,cy){void 0==cx&&(cx=this.origin_x+this.width/(2*this.scale),cy=this.origin_y+this.height/(2*this.scale)),this.origin_x+=cx*(this.scale-nscale),this.origin_y+=cy*(this.scale-nscale),this.scale=nscale,this.redraw_background()},Schematic.prototype.toggle_grid=function(){this.show_grid=!this.show_grid,this.redraw_background()};var zoom_factor=1.25,zoom_min=.5,zoom_max=4,origin_min=-200,origin_max=200;Schematic.prototype.zoomin=function(){var nscale=this.scale*zoom_factor;zoom_max>nscale&&(this.origin_x+=this.width/2*(1/this.scale-1/nscale),this.origin_y+=this.height/2*(1/this.scale-1/nscale),this.scale=nscale,this.redraw_background())},Schematic.prototype.zoomout=function(){var nscale=this.scale/zoom_factor;nscale>zoom_min&&(this.origin_x+=this.width/2*(1/this.scale-1/nscale),this.origin_y+=this.height/2*(1/this.scale-1/nscale),this.scale=nscale,this.redraw_background())},Schematic.prototype.zoomall=function(){var sch_w=1.5*(this.bbox[2]-this.bbox[0]),sch_h=1.5*(this.bbox[3]-this.bbox[1]);if(0==sch_w&&0==sch_h)this.origin_x=0,this.origin_y=0,this.scale=2;else{var scale_x=this.width/sch_w,scale_y=this.height/sch_h;this.scale=Math.pow(zoom_factor,Math.ceil(Math.log(Math.min(scale_x,scale_y))/Math.log(zoom_factor))),this.scale<zoom_min?this.scale=zoom_min:this.scale>zoom_max&&(this.scale=zoom_max),this.origin_x=(this.bbox[2]+this.bbox[0])/2-this.width/(2*this.scale),this.origin_y=(this.bbox[3]+this.bbox[1])/2-this.height/(2*this.scale)}this.redraw_background()},Schematic.prototype.cut=function(){sch_clipboard=[];for(var i=this.components.length-1;i>=0;--i){var c=this.components[i];c.selected&&(c.remove(),sch_clipboard.push(c))}this.redraw()},Schematic.prototype.copy=function(){sch_clipboard=[];for(var i=this.components.length-1;i>=0;--i){var c=this.components[i];c.selected&&sch_clipboard.push(c.clone(c.x,c.y))}},Schematic.prototype.paste=function(){for(var left=void 0,top=void 0,i=sch_clipboard.length-1;i>=0;--i){var c=sch_clipboard[i];left=left?Math.min(left,c.x):c.x,top=top?Math.min(top,c.y):c.y}this.message("cursor "+this.cursor_x+","+this.cursor_y),this.unselect_all(-1),this.redraw_background();for(var i=sch_clipboard.length-1;i>=0;--i){var c=sch_clipboard[i],new_c=c.clone(this.cursor_x+(c.x-left),this.cursor_y+(c.y-top));new_c.set_select(!0),new_c.add(this)}this.redraw()},Schematic.prototype.load_schematic=function(value,initial_value){if((void 0==value||-1==value.indexOf("["))&&(value=initial_value),value&&-1!=value.indexOf("["))for(var json=JSON.parse(value),i=json.length-1;i>=0;--i){var c=json[i];if("view"==c[0])this.ac_fstart=c[5],this.ac_fstop=c[6],this.ac_source_name=c[7],this.tran_npts=c[8],this.tran_tstop=c[9],this.dc_max_iters=c[10];else if("w"==c[0])this.add_wire(c[1][0],c[1][1],c[1][2],c[1][3]);else if("dc"==c[0])this.dc_results=c[1];else if("transient"==c[0])this.transient_results=c[1];else if("ac"==c[0])this.ac_results=c[1];else{var type=c[0],coords=c[1],properties=c[2],part=new parts_map[type][0](coords[0],coords[1],coords[2]);for(var name in properties)part.properties[name]=properties[name];part.add(this)}}this.redraw_background()},Schematic.prototype.label_connection_points=function(){for(var i=this.components.length-1;i>=0;--i)this.components[i].clear_labels();for(var i=this.components.length-1;i>=0;--i)this.components[i].add_default_labels();this.next_label=0;for(var i=this.components.length-1;i>=0;--i)this.components[i].label_connections()},Schematic.prototype.get_next_label=function(){return this.next_label+=1,this.next_label.toString()},Schematic.prototype.propagate_label=function(label,location){for(var cplist=this.connection_points[location],i=cplist.length-1;i>=0;--i)cplist[i].propagate_label(label)},Schematic.prototype.update_value=function(){this.label_connection_points(),this.input.value=JSON.stringify(this.json_with_analyses())},Schematic.prototype.json=function(){for(var json=[],n=this.components.length,i=0;n>i;i++)json.push(this.components[i].json(i));return json.push(["view",this.origin_x,this.origin_y,this.scale,this.ac_npts,this.ac_fstart,this.ac_fstop,this.ac_source_name,this.tran_npts,this.tran_tstop,this.dc_max_iters]),json},Schematic.prototype.json_with_analyses=function(){var json=this.json();return void 0!=this.dc_results&&json.push(["dc",this.dc_results]),void 0!=this.ac_results&&json.push(["ac",this.ac_results]),void 0!=this.transient_results&&json.push(["transient",this.transient_results]),json},Schematic.prototype.extract_circuit=function(){this.label_connection_points();var netlist=this.json();this.input.value=JSON.stringify(netlist);var ckt=new cktsim.Circuit;return ckt.load_netlist(netlist)?ckt:null},Schematic.prototype.dc_analysis=function(){this.unselect_all(-1),this.redraw_background();var ckt=this.extract_circuit();if(null!==ckt&&(this.operating_point=ckt.dc(),void 0!=this.operating_point)){this.dc_results={};for(var i in this.operating_point)this.dc_results[i]=this.operating_point[i];this.redraw()}},Schematic.prototype.find_probes=function(){for(var result=[],result=[],i=this.components.length-1;i>=0;--i){var c=this.components[i],info=c.probe_info();void 0!=info&&result.push(c.probe_info())}return result},Schematic.prototype.setup_ac_analysis=function(){this.unselect_all(-1),this.redraw_background();var fstart_lbl="Starting frequency (Hz)",fstop_lbl="Ending frequency (Hz)",source_name_lbl="Name of V or I source for ac";if(0==this.find_probes().length)return void alert("AC Analysis: there are no voltage probes in the diagram!");var fields=[];fields[fstart_lbl]=build_input("text",10,this.ac_fstart),fields[fstop_lbl]=build_input("text",10,this.ac_fstop),fields[source_name_lbl]=build_input("text",10,this.ac_source_name);var content=build_table(fields);content.fields=fields,content.sch=this,this.dialog("AC Analysis",content,function(content){var sch=content.sch;sch.ac_fstart=content.fields[fstart_lbl].value,sch.ac_fstop=content.fields[fstop_lbl].value,sch.ac_source_name=content.fields[source_name_lbl].value,sch.ac_analysis(cktsim.parse_number(sch.ac_npts),cktsim.parse_number(sch.ac_fstart),cktsim.parse_number(sch.ac_fstop),sch.ac_source_name)})},Schematic.prototype.ac_analysis=function(npts,fstart,fstop,ac_source_name){var ckt=this.extract_circuit();if(null!==ckt){var results=ckt.ac(npts,fstart,fstop,ac_source_name);if("string"==typeof results)this.message(results);else{for(var x_values=results._frequencies_,i=x_values.length-1;i>=0;--i)x_values[i]=Math.log(x_values[i])/Math.LN10;if(void 0!=this.submit_analyses){var submit=this.submit_analyses.ac;if(void 0!=submit){this.ac_results={};for(var j=0;j<submit.length;j++){for(var flist=submit[j],node=flist[0],values=results[node],fvlist=[],k=1;k<flist.length;k++){var f=flist[k],v=interpolate(f,x_values,values);fvlist.push([f,void 0==v?"undefined":20*Math.log(v)/Math.LN10])}this.ac_results[node]=fvlist}}}for(var y_values=[],z_values=[],probes=this.find_probes(),probe_maxv=[],probe_color=[],i=probes.length-1;i>=0;--i)if("voltage"==probes[i][3]){probe_color[i]=probes[i][0];var label=probes[i][1],v=results[label];probe_maxv[i]=array_max(v)}var all_max=array_max(probe_maxv);if(1e-16>all_max)alert("Zero ac response, -infinity on DB scale.");else for(var i=probes.length-1;i>=0;--i)if("voltage"==probes[i][3]&&probe_maxv[i]/all_max<1e-10)return void alert("Near zero ac response, remove "+probe_color[i]+" probe");for(var i=probes.length-1;i>=0;--i)if("voltage"==probes[i][3]){for(var color=probes[i][0],label=probes[i][1],offset=cktsim.parse_number(probes[i][2]),v=results[label],v_max=1,j=v.length-1;j>=0;--j)v[j]=20*Math.log(v[j]/v_max)/Math.LN10;y_values.push([color,offset,v]);var v=results[label+"_phase"];z_values.push([color,0,v])}var graph2=this.graph(x_values,"log(Frequency in Hz)",z_values,"degrees");this.window("AC Analysis - Phase",graph2);var graph1=this.graph(x_values,"log(Frequency in Hz)",y_values,"dB");this.window("AC Analysis - Magnitude",graph1,50)}}},Schematic.prototype.transient_analysis=function(){this.unselect_all(-1),this.redraw_background();var tstop_lbl="Stop Time (seconds)",probes=this.find_probes();if(0==probes.length)return void alert("Transient Analysis: there are no probes in the diagram!");var fields=[];fields[tstop_lbl]=build_input("text",10,this.tran_tstop);var content=build_table(fields);content.fields=fields,content.sch=this,this.dialog("Transient Analysis",content,function(content){var sch=content.sch,ckt=sch.extract_circuit();if(null!==ckt){sch.tran_tstop=content.fields[tstop_lbl].value;for(var probe_list=sch.find_probes(),probe_names=new Array(probe_list.length),i=probe_list.length-1;i>=0;--i)probe_names[i]=probe_list[i][1];var results=ckt.tran(ckt.parse_number(sch.tran_npts),0,ckt.parse_number(sch.tran_tstop),probe_names,!1);if("string"==typeof results)sch.message(results);else{if(void 0!=sch.submit_analyses){var submit=sch.submit_analyses.tran;if(void 0!=submit){sch.transient_results={};for(var times=results._time_,j=0;j<submit.length;j++){for(var tlist=submit[j],node=tlist[0],values=results[node],tvlist=[],k=1;k<tlist.length;k++){var t=tlist[k],v=interpolate(t,times,values);tvlist.push([t,void 0==v?"undefined":v])}sch.transient_results[node]=tvlist}}}for(var x_values=results._time_,x_legend="Time",v_values=[],i_values=[],probes=sch.find_probes(),i=probes.length-1;i>=0;--i){var color=probes[i][0],label=probes[i][1],offset=cktsim.parse_number(probes[i][2]),v=results[label];void 0==v?alert("The "+color+' probe is connected to node "'+label+'" which is not an actual circuit node'):"voltage"==probes[i][3]?"x-axis"==color?(x_values=v,x_legend="Voltage"):v_values.push([color,offset,v]):"x-axis"==color?(x_values=v,x_legend="Current"):i_values.push([color,offset,v])}var graph=sch.graph(x_values,x_legend,v_values,"Voltage",i_values,"Current");sch.window("Results of Transient Analysis",graph)}}})},Schematic.prototype.set_property=function(component_name,property,value){this.unselect_all(-1);for(var i=this.components.length-1;i>=0;--i){var component=this.components[i];if(component.properties.name==component_name){component.properties[property]=value.toString();break}}this.redraw_background()},Schematic.prototype.redraw_background=function(){var c=this.bg_image.getContext("2d");if(c.lineCap="round",c.fillStyle=element_style,c.fillRect(0,0,this.width,this.height),!this.diagram_only&&this.show_grid){c.strokeStyle=grid_style;for(var first_x=this.origin_x,last_x=first_x+this.width/this.scale,first_y=this.origin_y,last_y=first_y+this.height/this.scale,i=this.grid*Math.ceil(first_x/this.grid);last_x>i;i+=this.grid)this.draw_line(c,i,first_y,i,last_y,.1);for(var i=this.grid*Math.ceil(first_y/this.grid);last_y>i;i+=this.grid)this.draw_line(c,first_x,i,last_x,i,.1)}for(var min_x=1/0,max_x=-1/0,min_y=1/0,max_y=-1/0,i=this.components.length-1;i>=0;--i){var component=this.components[i];component.selected||(component.draw(c),min_x=Math.min(component.bbox[0],min_x),max_x=Math.max(component.bbox[2],max_x),min_y=Math.min(component.bbox[1],min_y),max_y=Math.max(component.bbox[3],max_y))}this.unsel_bbox=[min_x,min_y,max_x,max_y],this.redraw()},Schematic.prototype.redraw=function(){var c=this.canvas.getContext("2d");c.drawImage(this.bg_image,0,0);for(var min_x=this.unsel_bbox[0],max_x=this.unsel_bbox[2],min_y=this.unsel_bbox[1],max_y=this.unsel_bbox[3],selections=!1,i=this.components.length-1;i>=0;--i){var component=this.components[i];component.selected&&(component.draw(c),selections=!0,min_x=Math.min(component.bbox[0],min_x),max_x=Math.max(component.bbox[2],max_x),min_y=Math.min(component.bbox[1],min_y),max_y=Math.max(component.bbox[3],max_y))}this.bbox=1/0==min_x?[0,0,0,0]:[min_x,min_y,max_x,max_y],this.enable_tool("cut",selections),this.enable_tool("copy",selections),this.enable_tool("paste",sch_clipboard.length>0);for(var location in this.connection_points){var cplist=this.connection_points[location];cplist[0].draw(c,cplist.length)}if(this.wire){var r=this.wire;c.strokeStyle=selected_style,this.draw_line(c,r[0],r[1],r[2],r[3],1)}if(this.select_rect){var r=this.select_rect;c.lineWidth=1,c.strokeStyle=selected_style,c.beginPath(),c.moveTo(r[0],r[1]),c.lineTo(r[0],r[3]),c.lineTo(r[2],r[3]),c.lineTo(r[2],r[1]),c.lineTo(r[0],r[1]),c.stroke()}if(this.operating_point)if("string"==typeof this.operating_point)this.message(this.operating_point);else{var temp=[];for(var i in this.operating_point)temp[i]=this.operating_point[i];for(var location in this.connection_points)this.connection_points[location][0].display_voltage(c,temp);for(var i=this.components.length-1;i>=0;--i)this.components[i].display_current(c,temp)}if(!this.diagram_only){var r=this.sctl_r,x=this.sctl_x,y=this.sctl_y;c.fillStyle=element_style,c.beginPath(),c.arc(x,y,r,0,2*Math.PI),c.fill(),c.strokeStyle=grid_style,c.lineWidth=.5,c.beginPath(),c.arc(x,y,r,0,2*Math.PI),c.stroke(),c.lineWidth=3,c.beginPath(),c.moveTo(x+4,y-r+8),c.lineTo(x,y-r+4),c.lineTo(x-4,y-r+8),c.moveTo(x+r-8,y+4),c.lineTo(x+r-4,y),c.lineTo(x+r-8,y-4),c.moveTo(x+4,y+r-8),c.lineTo(x,y+r-4),c.lineTo(x-4,y+r-8),c.moveTo(x-r+8,y+4),c.lineTo(x-r+4,y),c.lineTo(x-r+8,y-4),c.stroke(),x=this.zctl_left,y=this.zctl_top,c.lineWidth=.5,c.fillStyle=element_style,c.fillRect(x,y,16,48),c.strokeStyle=grid_style,c.strokeRect(x,y,16,48),c.lineWidth=1,c.beginPath(),c.moveTo(x+4,y+8),c.lineTo(x+12,y+8),c.moveTo(x+8,y+4),c.lineTo(x+8,y+12),c.moveTo(x+4,y+24),c.lineTo(x+12,y+24),c.strokeRect(x+4,y+36,8,8),c.stroke()}},Schematic.prototype.cross_cursor=function(c,x,y){this.draw_line(c,x-this.grid,y,x+this.grid,y,1),this.draw_line(c,x,y-this.grid,x,y+this.grid,1)},Schematic.prototype.moveTo=function(c,x,y){c.moveTo((x-this.origin_x)*this.scale,(y-this.origin_y)*this.scale)},Schematic.prototype.lineTo=function(c,x,y){c.lineTo((x-this.origin_x)*this.scale,(y-this.origin_y)*this.scale)},Schematic.prototype.draw_line=function(c,x1,y1,x2,y2,width){c.lineWidth=width*this.scale,c.beginPath(),c.moveTo((x1-this.origin_x)*this.scale,(y1-this.origin_y)*this.scale),c.lineTo((x2-this.origin_x)*this.scale,(y2-this.origin_y)*this.scale),c.stroke()},Schematic.prototype.draw_arc=function(c,x,y,radius,start_radians,end_radians,anticlockwise,width,filled){c.lineWidth=width*this.scale,c.beginPath(),c.arc((x-this.origin_x)*this.scale,(y-this.origin_y)*this.scale,radius*this.scale,start_radians,end_radians,anticlockwise),filled?c.fill():c.stroke()},Schematic.prototype.draw_text=function(c,text,x,y,size){c.font=size*this.scale+"pt sans-serif",c.fillText(text,(x-this.origin_x)*this.scale,(y-this.origin_y)*this.scale)};try{HTMLCanvasElement&&(HTMLCanvasElement.prototype.relMouseCoords=function(event){var totalOffsetX=0,totalOffsetY=0,currentElement=this;do totalOffsetX+=currentElement.offsetLeft,totalOffsetY+=currentElement.offsetTop;while(currentElement=currentElement.offsetParent);this.mouse_x=event.pageX-totalOffsetX,this.mouse_y=event.pageY-totalOffsetY,this.page_x=event.pageX,this.page_y=event.pageY})}catch(err){}Schematic.prototype.message=function(message){this.status.nodeValue=message},Schematic.prototype.append_message=function(message){this.status.nodeValue+=" / "+message},Schematic.prototype.dialog=function(title,content,callback){var dialog=document.createElement("div");dialog.sch=this,dialog.content=content,dialog.callback=callback;for(var plist=content.getElementsByClassName("property"),i=plist.length-1;i>=0;--i){var field=plist[i];field.dialog=dialog,field.addEventListener("keypress",dialog_check_for_ENTER,!1)}var body=document.createElement("div");content.style.marginBotton="5px",body.appendChild(content),body.style.padding="5px",dialog.appendChild(body);var ok_button=document.createElement("span");ok_button.appendChild(document.createTextNode("OK")),ok_button.dialog=dialog,ok_button.addEventListener("click",dialog_okay,!1),ok_button.style.display="inline",ok_button.style.border="1px solid",ok_button.style.padding="5px",ok_button.style.margin="10px";var cancel_button=document.createElement("span");cancel_button.appendChild(document.createTextNode("Cancel")),cancel_button.dialog=dialog,cancel_button.addEventListener("click",dialog_cancel,!1),cancel_button.style.display="inline",cancel_button.style.border="1px solid",cancel_button.style.padding="5px",cancel_button.style.margin="10px";var buttons=document.createElement("div");buttons.style.textAlign="center",buttons.appendChild(ok_button),buttons.appendChild(cancel_button),buttons.style.padding="5px",buttons.style.margin="10px",dialog.appendChild(buttons),this.window(title,dialog)},Schematic.prototype.window=function(title,content,offset){var win=document.createElement("div");win.sch=this,win.content=content,win.drag_x=void 0,win.draw_y=void 0;var head=document.createElement("div");head.style.backgroundColor="black",head.style.color="white",head.style.textAlign="center",head.style.padding="5px",head.appendChild(document.createTextNode(title)),head.win=win,win.head=head;var close_button=new Image;close_button.src=close_icon,close_button.style.cssFloat="right",close_button.addEventListener("click",window_close_button,!1),close_button.win=win,head.appendChild(close_button),win.appendChild(head),head.addEventListener("mousedown",window_mouse_down,!1),win.appendChild(content),content.win=win,void 0==offset&&(offset=0),win.left=this.canvas.mouse_x+offset,win.top=this.canvas.mouse_y+offset,win.style.background="white",win.style.position="absolute",win.style.left=win.left+"px",win.style.top=win.top+"px",win.style.border="2px solid",this.canvas.parentNode.insertBefore(win,this.canvas),bring_to_front(win,!0)},Schematic.prototype.add_tool=function(icon,tip,callback){var tool;if(-1!=icon.search("data:image"))tool=document.createElement("img"),tool.src=icon;else{tool=document.createElement("span"),tool.style.font="small-caps small sans-serif";var label=document.createTextNode(icon);tool.appendChild(label)}return tool.style.borderWidth="1px",tool.style.borderStyle="solid",tool.style.borderColor=background_style,tool.style.padding="2px",tool.style.verticalAlign="middle",tool.style.cursor="default",tool.addEventListener("mouseover",tool_enter,!1),tool.addEventListener("mouseout",tool_leave,!1),tool.addEventListener("click",tool_click,!1),tool.sch=this,tool.tip=tip,tool.callback=callback,this.toolbar.push(tool),tool.enabled=!1,tool.style.opacity=.2,tool
},Schematic.prototype.enable_tool=function(tname,which){var tool=this.tools[tname];void 0!=tool&&(tool.style.opacity=which?1:.2,tool.enabled=which,which||(tool.style.borderColor=background_style,tool.sch.message("")))};var cut_icon="data:image/gif;base64,R0lGODlhEAAQALMAAAAAAIAAAACAAICAAAAAgIAAgACAgMDAwICAgP8AAAD/AP//AAAA//8A/wD//////yH5BAEAAAcALAAAAAAQABAAAAQu8MhJqz1g5qs7lxv2gRkQfuWomarXEgDRHjJhf3YtyRav0xcfcFgR0nhB5OwTAQA7",copy_icon="data:image/gif;base64,R0lGODlhEAAQALMAAAAAAIAAAACAAICAAAAAgIAAgACAgMDAwICAgP8AAAD/AP//AAAA//8A/wD//////yH5BAEAAAcALAAAAAAQABAAAAQ+8MhJ6wE4Wwqef9gmdV8HiKZJrCz3ecS7TikWfzExvk+M9a0a4MbTkXCgTMeoHPJgG5+yF31SLazsTMTtViIAOw==",paste_icon="data:image/gif;base64,R0lGODlhEAAQALMAAAAAAIAAAACAAICAAAAAgIAAgACAgMDAwICAgP8AAAD/AP//AAAA//8A/wD//////yH5BAEAAAcALAAAAAAQABAAAARL8MhJqwUYWJnxWp3GDcgAgCdQIqLKXmVLhhnyHiqpr7rME8AgocVDEB5IJHD0SyofBFzxGIQGAbvB0ZkcTq1CKK6z5YorwnR0w44AADs=",close_icon="data:image/gif;base64,R0lGODlhEAAQAMQAAGtra/f3/62tre/v9+bm787O1pycnHNzc6WlpcXFxd7e3tbW1nt7e7W1te/v74SEhMXFzmNjY+bm5v///87OzgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAAAAAAALAAAAAAQABAAAAVt4DRMZGmSwRQQBUS9MAwRIyQ5Uq7neEFSDtxOF4T8cobIQaE4RAQ5yjHHiCCSD510QtFGvoCFdppDfBu7bYzy+D7WP5ggAgA8Y3FKwi5IAhIweW1vbBGEWy5rilsFi2tGAwSJixAFBCkpJ5ojIQA7",grid_icon="data:image/gif;base64,R0lGODlhEAAQAMQAAAAAAP///zAwYT09bpGRqZ6et5iYsKWlvbi40MzM5cXF3czM5OHh5tTU2fDw84uMom49DbWKcfLy8g0NDcDAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAABQALAAAAAAQABAAAAUtICWOZGmeKDCqIlu68AvMdO2ueHvGuslTN6Bt6MsBd8Zg77hsDW3FpRJFrYpCADs=";try{CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.dashedLineTo=function(fromX,fromY,toX,toY,pattern){var lt=function(a,b){return b>=a},gt=function(a,b){return a>=b},capmin=function(a,b){return Math.min(a,b)},capmax=function(a,b){return Math.max(a,b)},checkX={thereYet:gt,cap:capmin},checkY={thereYet:gt,cap:capmin};fromY-toY>0&&(checkY.thereYet=lt,checkY.cap=capmax),fromX-toX>0&&(checkX.thereYet=lt,checkX.cap=capmax),this.moveTo(fromX,fromY);for(var offsetX=fromX,offsetY=fromY,idx=0,dash=!0;!checkX.thereYet(offsetX,toX)||!checkY.thereYet(offsetY,toY);){var ang=Math.atan2(toY-fromY,toX-fromX),len=pattern[idx];offsetX=checkX.cap(toX,offsetX+Math.cos(ang)*len),offsetY=checkY.cap(toY,offsetY+Math.sin(ang)*len),dash?this.lineTo(offsetX,offsetY):this.moveTo(offsetX,offsetY),idx=(idx+1)%pattern.length,dash=!dash}})}catch(err){}var grid_pattern=[1,2],cursor_pattern=[5,5];Schematic.prototype.graph=function(x_values,x_legend,y_values,y_legend,z_values,z_legend){function plot_x(x){return(x-x_min)*x_scale+left_margin}function plot_y(y){return(y_max-y)*y_scale+top_margin}function plot_z(z){return(z_max-z)*z_scale+top_margin}var pwidth=400,pheight=300,left_margin=void 0!=y_values&&y_values.length>0?55:25,top_margin=25,right_margin=void 0!=z_values&&z_values.length>0?55:25,bottom_margin=45,tick_length=5,w=pwidth+left_margin+right_margin,h=pheight+top_margin+bottom_margin,canvas=document.createElement("canvas");canvas.width=w,canvas.height=h;var bg_image=document.createElement("canvas");bg_image.width=w,bg_image.height=h,canvas.bg_image=bg_image;var c=bg_image.getContext("2d");c.fillStyle=background_style,c.fillRect(0,0,w,h),c.fillStyle=element_style,c.fillRect(left_margin,top_margin,pwidth,pheight);var x_min=array_min(x_values),x_max=array_max(x_values),x_limits=view_limits(x_min,x_max);x_min=x_limits[0],x_max=x_limits[1];var x_scale=pwidth/(x_max-x_min);c.strokeStyle=grid_style,c.lineWidth=1,c.fillStyle=normal_style,c.font="10pt sans-serif",c.textAlign="center",c.textBaseline="top";for(var end=top_margin+pheight,x=x_min;x_max>=x;x+=x_limits[2]){var temp=plot_x(x)+.5;c.beginPath(),x==x_min?(c.moveTo(temp,top_margin),c.lineTo(temp,end)):c.dashedLineTo(temp,top_margin,temp,end,grid_pattern),c.stroke(),c.beginPath(),c.moveTo(temp,end),c.lineTo(temp,end+tick_length),c.stroke(),c.fillText(engineering_notation(x,2),temp,end+tick_length)}if(void 0!=y_values&&y_values.length>0){var plot,y_min=1/0,y_max=-1/0;for(plot=y_values.length-1;plot>=0;--plot){var values=y_values[plot][2];if(void 0!=values){var offset=y_values[plot][1],temp=array_min(values)+offset;y_min>temp&&(y_min=temp),temp=array_max(values)+offset,temp>y_max&&(y_max=temp)}}var y_limits=view_limits(y_min,y_max);y_min=y_limits[0],y_max=y_limits[1];var y_scale=pheight/(y_max-y_min);c.textAlign="right",c.textBaseline="middle";for(var y=y_min;y_max>=y;y+=y_limits[2]){Math.abs(y/y_max)<.001&&(y=0);var temp=plot_y(y)+.5;c.beginPath(),y==y_min?(c.moveTo(left_margin,temp),c.lineTo(left_margin+pwidth,temp)):c.dashedLineTo(left_margin,temp,left_margin+pwidth,temp,grid_pattern),c.stroke(),c.beginPath(),c.moveTo(left_margin-tick_length,temp),c.lineTo(left_margin,temp),c.stroke(),c.fillText(engineering_notation(y,2),left_margin-tick_length-2,temp)}var x,y,nx,ny;for(c.lineWidth=3,c.lineCap="round",plot=y_values.length-1;plot>=0;--plot){var color=probe_colors_rgb[y_values[plot][0]];if(void 0!=color){c.strokeStyle=color;var values=y_values[plot][2];if(void 0!=values){var offset=y_values[plot][1];x=plot_x(x_values[0]),y=plot_y(values[0]+offset),c.beginPath(),c.moveTo(x,y);for(var i=1;i<x_values.length;i++)nx=plot_x(x_values[i]),ny=plot_y(values[i]+offset),c.lineTo(nx,ny),x=nx,y=ny,i%100==99&&(c.stroke(),c.beginPath(),c.moveTo(x,y));c.stroke()}}}}if(void 0!=z_values&&z_values.length>0){var z_min=1/0,z_max=-1/0;for(plot=z_values.length-1;plot>=0;--plot){var values=z_values[plot][2];if(void 0!=values){var offset=z_values[plot][1],temp=array_min(values)+offset;z_min>temp&&(z_min=temp),temp=array_max(values)+offset,temp>z_max&&(z_max=temp)}}var z_limits=view_limits(z_min,z_max);z_min=z_limits[0],z_max=z_limits[1];var z_scale=pheight/(z_max-z_min);c.textAlign="left",c.textBaseline="middle",c.lineWidth=1,c.strokeStyle=normal_style;for(var tick_length_half=Math.floor(tick_length/2),tick_delta=tick_length-tick_length_half,z=z_min;z_max>=z;z+=z_limits[2]){Math.abs(z/z_max)<.001&&(z=0);var temp=plot_z(z)+.5;c.beginPath(),c.moveTo(left_margin+pwidth-tick_length_half,temp),c.lineTo(left_margin+pwidth+tick_delta,temp),c.stroke(),c.fillText(engineering_notation(z,2),left_margin+pwidth+tick_length+2,temp)}var z,nz;for(c.lineWidth=3,plot=z_values.length-1;plot>=0;--plot){var color=probe_colors_rgb[z_values[plot][0]];if(void 0!=color){c.strokeStyle=color;var values=z_values[plot][2];if(void 0!=values){var offset=z_values[plot][1];x=plot_x(x_values[0]),z=plot_z(values[0]+offset),c.beginPath(),c.moveTo(x,z);for(var i=1;i<x_values.length;i++)nx=plot_x(x_values[i]),nz=plot_z(values[i]+offset),c.lineTo(nx,nz),x=nx,z=nz,i%100==99&&(c.stroke(),c.beginPath(),c.moveTo(x,z));c.stroke()}}}}return c.font="12pt sans-serif",c.textAlign="center",c.textBaseline="bottom",c.fillText(x_legend,left_margin+pwidth/2,h-5),void 0!=y_values&&y_values.length>0&&(c.textBaseline="top",c.save(),c.translate(5,top_margin+pheight/2),c.rotate(-Math.PI/2),c.fillText(y_legend,0,0),c.restore()),void 0!=z_values&&z_values.length>0&&(c.textBaseline="bottom",c.save(),c.translate(w-5,top_margin+pheight/2),c.rotate(-Math.PI/2),c.fillText(z_legend,0,0),c.restore()),canvas.x_values=x_values,canvas.y_values=y_values,canvas.z_values=z_values,canvas.x_legend=x_legend,canvas.y_legend=y_legend,canvas.z_legend=y_legend,canvas.x_min=x_min,canvas.x_scale=x_scale,canvas.y_min=y_min,canvas.y_scale=y_scale,canvas.z_min=z_min,canvas.z_scale=z_scale,canvas.left_margin=left_margin,canvas.top_margin=top_margin,canvas.pwidth=pwidth,canvas.pheight=pheight,canvas.tick_length=tick_length,canvas.cursor1_x=void 0,canvas.cursor2_x=void 0,canvas.sch=this,canvas.addEventListener("mousemove",graph_mouse_move,!1),redraw_plot(canvas),canvas},Part.prototype.set_location=function(left,top){this.canvas.style.left=left+"px",this.canvas.style.top=top+"px"},Part.prototype.right=function(){return this.canvas.offsetLeft+this.canvas.offsetWidth},Part.prototype.bottom=function(){return this.canvas.offsetTop+this.canvas.offsetHeight},Part.prototype.set_component=function(component,tip){component.sch=this,this.component=component,this.tip=tip;var b=component.bounding_box,dx=b[2]-b[0],dy=b[3]-b[1];this.scale=.8,this.origin_x=b[0]+dx/2-part_w/(2*this.scale),this.origin_y=b[1]+dy/2-part_h/(2*this.scale),this.redraw()},Part.prototype.redraw=function(){var c=this.canvas.getContext("2d");c.fillStyle=this.selected?selected_style:background_style,c.fillRect(0,0,part_w,part_h),this.component&&this.component.draw(c)},Part.prototype.select=function(which){this.selected=which,this.redraw()},Part.prototype.update_connection_point=function(){},Part.prototype.moveTo=function(c,x,y){c.moveTo((x-this.origin_x)*this.scale,(y-this.origin_y)*this.scale)},Part.prototype.lineTo=function(c,x,y){c.lineTo((x-this.origin_x)*this.scale,(y-this.origin_y)*this.scale)},Part.prototype.draw_line=function(c,x1,y1,x2,y2,width){c.lineWidth=width*this.scale,c.beginPath(),c.moveTo((x1-this.origin_x)*this.scale,(y1-this.origin_y)*this.scale),c.lineTo((x2-this.origin_x)*this.scale,(y2-this.origin_y)*this.scale),c.stroke()},Part.prototype.draw_arc=function(c,x,y,radius,start_radians,end_radians,anticlockwise,width,filled){c.lineWidth=width*this.scale,c.beginPath(),c.arc((x-this.origin_x)*this.scale,(y-this.origin_y)*this.scale,radius*this.scale,start_radians,end_radians,anticlockwise),filled?c.fill():c.stroke()},Part.prototype.draw_text=function(){},Component.prototype.json=function(index){this.properties._json_=index;var props={};for(var p in this.properties)props[p]=this.properties[p];for(var conns=[],i=0;i<this.connections.length;i++)conns.push(this.connections[i].json());var json=[this.type,[this.x,this.y,this.rotation],props,conns];return json},Component.prototype.add_connection=function(offset_x,offset_y){this.connections.push(new ConnectionPoint(this,offset_x,offset_y))},Component.prototype.update_coords=function(){var x=this.x,y=this.y,b=this.bounding_box;this.bbox[0]=this.transform_x(b[0],b[1])+x,this.bbox[1]=this.transform_y(b[0],b[1])+y,this.bbox[2]=this.transform_x(b[2],b[3])+x,this.bbox[3]=this.transform_y(b[2],b[3])+y,canonicalize(this.bbox);for(var i=this.connections.length-1;i>=0;--i)this.connections[i].update_location()},Component.prototype.rotate=function(amount){this.rotation;this.rotation=(this.rotation+amount)%8,this.update_coords()},Component.prototype.move_begin=function(){this.move_x=this.x,this.move_y=this.y},Component.prototype.move=function(dx,dy){this.x+=dx,this.y+=dy,this.update_coords()},Component.prototype.move_end=function(){var dx=this.x-this.move_x,dy=this.y-this.move_y;(0!=dx||0!=dy)&&this.sch.check_wires(this)},Component.prototype.add=function(sch){this.sch=sch,sch.add_component(this),this.update_coords()},Component.prototype.remove=function(){for(var i=this.connections.length-1;i>=0;--i){var cp=this.connections[i];this.sch.remove_connection_point(cp,cp.location)}this.sch.remove_component(this),this.sch=void 0},Component.prototype.transform_x=function(x,y){var rot=this.rotation;return 0==rot||6==rot?x:1==rot||5==rot?-y:2==rot||4==rot?-x:y},Component.prototype.transform_y=function(x,y){var rot=this.rotation;return 1==rot||7==rot?x:2==rot||6==rot?-y:3==rot||5==rot?-x:y},Component.prototype.moveTo=function(c,x,y){var nx=this.transform_x(x,y)+this.x,ny=this.transform_y(x,y)+this.y;this.sch.moveTo(c,nx,ny)},Component.prototype.lineTo=function(c,x,y){var nx=this.transform_x(x,y)+this.x,ny=this.transform_y(x,y)+this.y;this.sch.lineTo(c,nx,ny)},Component.prototype.draw_line=function(c,x1,y1,x2,y2){c.strokeStyle=this.selected?selected_style:"w"==this.type?normal_style:component_style;var nx1=this.transform_x(x1,y1)+this.x,ny1=this.transform_y(x1,y1)+this.y,nx2=this.transform_x(x2,y2)+this.x,ny2=this.transform_y(x2,y2)+this.y;this.sch.draw_line(c,nx1,ny1,nx2,ny2,1)},Component.prototype.draw_circle=function(c,x,y,radius,filled){filled?c.fillStyle=this.selected?selected_style:normal_style:c.strokeStyle=this.selected?selected_style:"w"==this.type?normal_style:component_style;var nx=this.transform_x(x,y)+this.x,ny=this.transform_y(x,y)+this.y;this.sch.draw_arc(c,nx,ny,radius,0,2*Math.PI,!1,1,filled)};var rot_angle=[0,Math.PI/2,Math.PI,3*Math.PI/2,0,Math.PI/2,Math.PI,3*Math.PI/2];Component.prototype.draw_arc=function(c,x,y,radius,start_radians,end_radians){c.strokeStyle=this.selected?selected_style:"w"==this.type?normal_style:component_style;var nx=this.transform_x(x,y)+this.x,ny=this.transform_y(x,y)+this.y;this.sch.draw_arc(c,nx,ny,radius,start_radians+rot_angle[this.rotation],end_radians+rot_angle[this.rotation],!1,1,!1)},Component.prototype.draw=function(){};var aOrient=[0,1,2,3,4,5,6,7,8,2,5,8,1,4,7,0,3,6,8,7,6,5,4,3,2,1,0,6,3,0,7,4,1,8,5,3,2,1,0,5,4,3,8,7,6,8,5,2,7,4,1,6,3,0,6,7,8,3,4,5,0,1,2,0,3,6,1,4,7,2,5,8],textAlign=["left","center","right","left","center","right","left","center","right"],textBaseline=["top","top","top","middle","middle","middle","bottom","bottom","bottom"];Component.prototype.draw_text=function(c,text,x,y,alignment,size,fill){var a=aOrient[9*this.rotation+alignment];c.textAlign=textAlign[a],c.textBaseline=textBaseline[a],c.fillStyle=void 0==fill?this.selected?selected_style:normal_style:fill,this.sch.draw_text(c,text,this.transform_x(x,y)+this.x,this.transform_y(x,y)+this.y,size)},Component.prototype.set_select=function(which){which!=this.selected&&(this.selected=which)},Component.prototype.select=function(x,y,shiftKey){return this.was_previously_selected=this.selected,this.near(x,y)?(this.set_select(shiftKey?!this.selected:!0),!0):!1},Component.prototype.select_rect=function(s){this.was_previously_selected=this.selected,intersect(this.bbox,s)&&this.set_select(!0)},Component.prototype.bisect=function(){return null},Component.prototype.near=function(x,y){return inside(this.bbox,x,y)},Component.prototype.edit_properties=function(x,y){if(this.near(x,y)){var fields=[];for(var i in this.properties)"_"!=i.charAt(0)&&(fields[i]=build_input("text",10,this.properties[i]));var content=build_table(fields);return content.fields=fields,content.component=this,this.sch.dialog("Edit Properties",content,function(content){for(var i in content.fields)content.component.properties[i]=content.fields[i].value;content.component.sch.redraw_background()}),!0}return!1},Component.prototype.clear_labels=function(){for(var i=this.connections.length-1;i>=0;--i)this.connections[i].clear_label()},Component.prototype.propagate_label=function(){},Component.prototype.add_default_labels=function(){},Component.prototype.label_connections=function(){for(var i=this.connections.length-1;i>=0;--i){var cp=this.connections[i];cp.label||cp.propagate_label(this.sch.get_next_label())}},Component.prototype.probe_info=function(){return void 0},Component.prototype.display_current=function(){};var connection_point_radius=2;ConnectionPoint.prototype.toString=function(){return"<ConnectionPoint ("+this.offset_x+","+this.offset_y+") "+this.parent.toString()+">"},ConnectionPoint.prototype.json=function(){return this.label},ConnectionPoint.prototype.clear_label=function(){this.label=void 0},ConnectionPoint.prototype.propagate_label=function(label){void 0===this.label?(this.label=label,this.parent.sch.propagate_label(label,this.location),this.parent.propagate_label(label)):"0"!=this.label&&"0"!=label&&this.label!=label&&alert("Node has two conflicting labels: "+this.label+", "+label)},ConnectionPoint.prototype.update_location=function(){var old_location=this.location,parent=this.parent,nx=parent.transform_x(this.offset_x,this.offset_y)+parent.x,ny=parent.transform_y(this.offset_x,this.offset_y)+parent.y;this.x=nx,this.y=ny,this.location=nx+","+ny,parent.sch&&parent.sch.update_connection_point(this,old_location)},ConnectionPoint.prototype.coincident=function(x,y){return this.x==x&&this.y==y},ConnectionPoint.prototype.draw=function(c,n){2!=n&&this.parent.draw_circle(c,this.offset_x,this.offset_y,connection_point_radius,n>2)},ConnectionPoint.prototype.draw_x=function(c){this.parent.draw_line(c,this.offset_x-2,this.offset_y-2,this.offset_x+2,this.offset_y+2,grid_style),this.parent.draw_line(c,this.offset_x+2,this.offset_y-2,this.offset_x-2,this.offset_y+2,grid_style)},ConnectionPoint.prototype.display_voltage=function(c,vmap){var v=vmap[this.label];if(void 0!=v){var label=v.toFixed(2)+"V";c.globalAlpha=.85,this.parent.draw_text(c,"",this.offset_x,this.offset_y,4,annotation_size,element_style),c.globalAlpha=1,this.parent.draw_text(c,label,this.offset_x,this.offset_y,4,annotation_size,annotation_style),delete vmap[this.label]}};var near_distance=2;Wire.prototype=new Component,Wire.prototype.constructor=Wire,Wire.prototype.toString=function(){return"<Wire ("+this.x+","+this.y+") ("+(this.x+this.dx)+","+(this.y+this.dy)+")>"},Wire.prototype.other_end=function(cp){return cp==this.connections[0]?this.connections[1]:cp==this.connections[1]?this.connections[0]:void 0},Wire.prototype.json=function(){var json=["w",[this.x,this.y,this.x+this.dx,this.y+this.dy]];return json},Wire.prototype.draw=function(c){this.draw_line(c,0,0,this.dx,this.dy)},Wire.prototype.clone=function(x,y){return new Wire(x,y,x+this.dx,y+this.dy)},Wire.prototype.near=function(x,y){if(inside(this.bbox,x,y)){var D=Math.abs((x-this.x)*this.dy-(y-this.y)*this.dx)/this.len;if(near_distance>=D)return!0}return!1},Wire.prototype.select_rect=function(s){this.was_previously_selected=this.selected,(inside(s,this.x,this.y)||inside(s,this.x+this.dx,this.y+this.dy))&&this.set_select(!0)},Wire.prototype.bisect_cp=function(cp){var x=cp.x,y=cp.y;if(inside(this.bbox,x,y)){var D=Math.abs((x-this.x)*this.dy-(y-this.y)*this.dx)/this.len;if(1>D&&!this.connections[0].coincident(x,y)&&!this.connections[1].coincident(x,y))return!0}return!1},Wire.prototype.bisect=function(c){if(void 0!=c){for(var i=c.connections.length-1;i>=0;--i){var cp=c.connections[i];if(this.bisect_cp(cp))return cp}return null}},Wire.prototype.move_end=function(){this.sch.check_wires(this),this.sch.check_connection_points(this)},Wire.prototype.propagate_label=function(label){this.connections[0].propagate_label(label),this.connections[1].propagate_label(label)},Wire.prototype.edit_properties=function(){return!1},Wire.prototype.label_connections=function(){},Ground.prototype=new Component,Ground.prototype.constructor=Ground,Ground.prototype.toString=function(){return"<Ground ("+this.x+","+this.y+")>"},Ground.prototype.draw=function(c){Component.prototype.draw.call(this,c),this.draw_line(c,0,0,0,8),this.draw_line(c,-6,8,6,8)},Ground.prototype.clone=function(x,y){return new Ground(x,y,this.rotation)},Ground.prototype.edit_properties=function(){return!1},Ground.prototype.add_default_labels=function(){this.connections[0].propagate_label("0")},Label.prototype=new Component,Label.prototype.constructor=Label,Label.prototype.toString=function(){return"<Label ("+this.x+","+this.y+")>"},Label.prototype.draw=function(c){Component.prototype.draw.call(this,c),this.draw_line(c,0,0,0,8),this.draw_text(c,this.properties.label,0,9,1,property_size)},Label.prototype.clone=function(x,y){return new Label(x,y,this.rotation,this.properties.label)},Label.prototype.add_default_labels=function(){this.connections[0].propagate_label(this.properties.label)};var probe_colors=["red","green","blue","cyan","magenta","yellow","black","x-axis"],probe_colors_rgb={red:"rgb(255,64,64)",green:"rgb(64,255,64)",blue:"rgb(64,64,255)",cyan:"rgb(64,255,255)",magenta:"rgb(255,64,255)",yellow:"rgb(255,255,64)",black:"rgb(0,0,0)","x-axis":void 0};Probe.prototype=new Component,Probe.prototype.constructor=Probe,Probe.prototype.toString=function(){return"<Probe ("+this.x+","+this.y+")>"},Probe.prototype.draw=function(c){this.draw_line(c,0,0,4,-4),this.draw_line(c,2,-6,6,-2),this.draw_line(c,2,-6,17,-21),this.draw_line(c,6,-2,21,-17),this.draw_line(c,17,-21,21,-17),this.draw_arc(c,19,-11,8,3*Math.PI/2,0);var color=probe_colors_rgb[this.properties.color];void 0!=color?(c.fillStyle=color,c.beginPath(),this.moveTo(c,2,-6),this.lineTo(c,6,-2),this.lineTo(c,21,-17),this.lineTo(c,17,-21),this.lineTo(c,2,-6),c.fill()):this.draw_text(c,this.properties.color,27,-11,1,property_size)},Probe.prototype.clone=function(x,y){return new Probe(x,y,this.rotation,this.properties.color,this.properties.offset)},Probe.prototype.edit_properties=function(x,y){if(inside(this.bbox,x,y)){var fields=[];fields["Plot color"]=build_select(probe_colors,this.properties.color),fields["Plot offset"]=build_input("text",10,this.properties.offset);var content=build_table(fields);return content.fields=fields,content.component=this,this.sch.dialog("Edit Properties",content,function(content){var color_choice=content.fields["Plot color"];content.component.properties.color=probe_colors[color_choice.selectedIndex],content.component.properties.offset=content.fields["Plot offset"].value,content.component.sch.redraw_background()}),!0}return!1},Probe.prototype.probe_info=function(){var color=this.properties.color,offset=this.properties.offset;return(void 0==offset||""==offset)&&(offset="0"),[color,this.connections[0].label,offset,"voltage"]},Ammeter.prototype=new Component,Ammeter.prototype.constructor=Ammeter,Ammeter.prototype.toString=function(){return"<Ammeter ("+this.x+","+this.y+")>"},Ammeter.prototype.move_end=function(){Component.prototype.move_end.call(this);for(var e1=this.connections[0].location,e2=this.connections[1].location,cplist=this.sch.find_connections(this.connections[0]),i=cplist.length-1;i>=0;--i){var c=cplist[i].parent;if("w"==c.type){var c_e1=c.connections[0].location,c_e2=c.connections[1].location;if(e1==c_e1&&c2==c_e2||e1==c_e2&&e2==c_e1){c.remove();break}}}},Ammeter.prototype.draw=function(c){this.draw_line(c,0,0,16,0),c.strokeStyle=probe_colors_rgb[this.properties.color],void 0!=c.strokeStyle&&(c.beginPath(),this.moveTo(c,6,-3),this.lineTo(c,10,0),this.lineTo(c,6,3),c.stroke())},Ammeter.prototype.clone=function(x,y){return new Ammeter(x,y,this.rotation,this.properties.color,this.properties.offset)},Ammeter.prototype.edit_properties=Probe.prototype.edit_properties,Ammeter.prototype.label=function(){var name=this.properties.name,label="I("+(name?name:"_"+this.properties._json_)+")";return label},Ammeter.prototype.display_current=function(c,vmap){var label=this.label(),v=vmap[label];if(void 0!=v){var i=engineering_notation(v,2)+"A";this.draw_text(c,i,8,-5,7,annotation_size,annotation_style),delete vmap[label]}},Ammeter.prototype.probe_info=function(){var color=this.properties.color,offset=this.properties.offset;return(void 0==offset||""==offset)&&(offset="0"),[color,this.label(),offset,"current"]},Resistor.prototype=new Component,Resistor.prototype.constructor=Resistor,Resistor.prototype.toString=function(){return"<Resistor "+this.properties.r+" ("+this.x+","+this.y+")>"},Resistor.prototype.draw=function(c){Component.prototype.draw.call(this,c),this.draw_line(c,0,0,0,12),this.draw_line(c,0,12,4,14),this.draw_line(c,4,14,-4,18),this.draw_line(c,-4,18,4,22),this.draw_line(c,4,22,-4,26),this.draw_line(c,-4,26,4,30),this.draw_line(c,4,30,-4,34),this.draw_line(c,-4,34,0,36),this.draw_line(c,0,36,0,48),this.properties.r&&this.draw_text(c,this.properties.r+"",5,24,3,property_size),this.properties.name&&this.draw_text(c,this.properties.name,-5,24,5,property_size)},Resistor.prototype.clone=function(x,y){return new Resistor(x,y,this.rotation,this.properties.name,this.properties.r)},Capacitor.prototype=new Component,Capacitor.prototype.constructor=Capacitor,Capacitor.prototype.toString=function(){return"<Capacitor "+this.properties.r+" ("+this.x+","+this.y+")>"},Capacitor.prototype.draw=function(c){Component.prototype.draw.call(this,c),this.draw_line(c,0,0,0,22),this.draw_line(c,-8,22,8,22),this.draw_line(c,-8,26,8,26),this.draw_line(c,0,26,0,48),this.properties.c&&this.draw_text(c,this.properties.c+"F",9,24,3,property_size),this.properties.name&&this.draw_text(c,this.properties.name,-9,24,5,property_size)},Capacitor.prototype.clone=function(x,y){return new Capacitor(x,y,this.rotation,this.properties.name,this.properties.c)},Inductor.prototype=new Component,Inductor.prototype.constructor=Inductor,Inductor.prototype.toString=function(){return"<Inductor "+this.properties.l+" ("+this.x+","+this.y+")>"},Inductor.prototype.draw=function(c){Component.prototype.draw.call(this,c),this.draw_line(c,0,0,0,14),this.draw_arc(c,0,18,4,6*Math.PI/4,3*Math.PI/4),this.draw_arc(c,0,24,4,5*Math.PI/4,3*Math.PI/4),this.draw_arc(c,0,30,4,5*Math.PI/4,2*Math.PI/4),this.draw_line(c,0,34,0,48),this.properties.l&&this.draw_text(c,this.properties.l+"H",6,24,3,property_size),this.properties.name&&this.draw_text(c,this.properties.name,-3,24,5,property_size)},Inductor.prototype.clone=function(x,y){return new Inductor(x,y,this.rotation,this.properties.name,this.properties.l)};var diode_types=["normal","ideal"];Diode.prototype=new Component,Diode.prototype.constructor=Diode,Diode.prototype.toString=function(){return"<Diode "+this.properties.area+" ("+this.x+","+this.y+")>"},Diode.prototype.draw=function(c){Component.prototype.draw.call(this,c),this.draw_line(c,0,0,0,16),this.draw_line(c,-8,16,8,16),this.draw_line(c,-8,16,0,32),this.draw_line(c,8,16,0,32),this.draw_line(c,-8,32,8,32),this.draw_line(c,0,32,0,48),"ideal"==this.properties.type&&(this.draw_line(c,-10,12,10,12),this.draw_line(c,-10,12,-10,36),this.draw_line(c,10,12,10,36),this.draw_line(c,-10,36,10,36)),this.properties.area&&this.draw_text(c,this.properties.area,10,24,3,property_size),this.properties.name&&this.draw_text(c,this.properties.name,-10,24,5,property_size)},Diode.prototype.clone=function(x,y){return new Diode(x,y,this.rotation,this.properties.name,this.properties.area,this.properties.type)},Diode.prototype.edit_properties=function(x,y){if(inside(this.bbox,x,y)){var fields=[];fields.name=build_input("text",10,this.properties.name),fields.area=build_input("text",10,this.properties.area),fields.type=build_select(diode_types,this.properties.type);var content=build_table(fields);return content.fields=fields,content.component=this,this.sch.dialog("Edit Properties",content,function(content){content.component.properties.name=content.fields.name.value,content.component.properties.area=content.fields.area.value,content.component.properties.type=diode_types[content.fields.type.selectedIndex],content.component.sch.redraw_background()}),!0}return!1},NFet.prototype=new Component,NFet.prototype.constructor=NFet,NFet.prototype.toString=function(){return"<NFet "+this.properties["W/L"]+" ("+this.x+","+this.y+")>"},NFet.prototype.draw=function(c){Component.prototype.draw.call(this,c),this.draw_line(c,0,0,0,16),this.draw_line(c,-8,16,0,16),this.draw_line(c,-8,16,-8,32),this.draw_line(c,-8,32,0,32),this.draw_line(c,0,32,0,48),this.draw_line(c,-24,24,-12,24),this.draw_line(c,-12,16,-12,32);var dim=this.properties["W/L"];this.properties.name?(this.draw_text(c,this.properties.name,2,22,6,property_size),this.draw_text(c,dim,2,26,0,property_size)):this.draw_text(c,dim,2,24,3,property_size)},NFet.prototype.clone=function(x,y){return new NFet(x,y,this.rotation,this.properties.name,this.properties["W/L"])},PFet.prototype=new Component,PFet.prototype.constructor=PFet,PFet.prototype.toString=function(){return"<PFet "+this.properties["W/L"]+" ("+this.x+","+this.y+")>"},PFet.prototype.draw=function(c){Component.prototype.draw.call(this,c),this.draw_line(c,0,0,0,16),this.draw_line(c,-8,16,0,16),this.draw_line(c,-8,16,-8,32),this.draw_line(c,-8,32,0,32),this.draw_line(c,0,32,0,48),this.draw_line(c,-24,24,-16,24),this.draw_circle(c,-14,24,2,!1),this.draw_line(c,-12,16,-12,32);var dim=this.properties["W/L"];this.properties.name?(this.draw_text(c,this.properties.name,2,22,6,property_size),this.draw_text(c,dim,2,26,0,property_size)):this.draw_text(c,dim,2,24,3,property_size)},PFet.prototype.clone=function(x,y){return new PFet(x,y,this.rotation,this.properties.name,this.properties["W/L"])},OpAmp.prototype=new Component,OpAmp.prototype.constructor=OpAmp,OpAmp.prototype.toString=function(){return"<OpAmp"+this.properties.A+" ("+this.x+","+this.y+")>"},OpAmp.prototype.draw=function(c){Component.prototype.draw.call(this,c),this.draw_line(c,8,-8,8,24),this.draw_line(c,8,-8,40,8),this.draw_line(c,8,24,40,8),this.draw_line(c,0,0,8,0),this.draw_line(c,0,16,8,16),this.draw_text(c,"gnd",37,18,property_size),this.draw_line(c,40,8,48,8),this.draw_line(c,24,16,24,32),this.draw_line(c,10,0,16,0),this.draw_line(c,13,-3,13,3),this.draw_line(c,10,16,16,16),this.properties.name&&this.draw_text(c,this.properties.name,32,16,0,property_size)},OpAmp.prototype.clone=function(x,y){return new OpAmp(x,y,this.rotation,this.properties.name,this.properties.A)},Source.prototype=new Component,Source.prototype.constructor=Source,Source.prototype.toString=function(){return"<"+this.type+"source "+this.properties.params+" ("+this.x+","+this.y+")>"},Source.prototype.draw=function(c){Component.prototype.draw.call(this,c),this.draw_line(c,0,0,0,12),this.draw_circle(c,0,24,12,!1),this.draw_line(c,0,36,0,48),"v"==this.type?(this.draw_line(c,0,15,0,21),this.draw_line(c,-3,18,3,18),this.draw_line(c,-3,30,3,30)):"i"==this.type&&(this.draw_line(c,0,15,0,32),this.draw_line(c,-3,26,0,32),this.draw_line(c,3,26,0,32)),this.properties.name&&this.draw_text(c,this.properties.name,-13,24,5,property_size),this.properties.value&&this.draw_text(c,this.properties.value,13,24,3,property_size)};var source_functions={dc:["DC value"],impulse:["Height","Width (secs)"],step:["Initial value","Plateau value","Delay until step (secs)","Rise time (secs)"],square:["Initial value","Plateau value","Frequency (Hz)","Duty cycle (%)"],triangle:["Initial value","Plateau value","Frequency (Hz)"],pwl:["Comma-separated list of alternating times and values"],pwl_repeating:["Comma-separated list of alternating times and values"],pulse:["Initial value","Plateau value","Delay until pulse (secs)","Time for first transition (secs)","Time for second transition (secs)","Pulse width (secs)","Period (secs)"],sin:["Offset value","Amplitude","Frequency (Hz)","Delay until sin starts (secs)","Phase offset (degrees)"]};Source.prototype.build_content=function(src){var fields=[];if(fields.name=build_input("text",10,this.properties.name),void 0==src)fields.value=this.properties.value;else{var src_types=[];for(var t in source_functions)src_types.push(t);var type_select=build_select(src_types,src.fun);if(type_select.component=this,type_select.addEventListener("change",source_type_changed,!1),fields.type=type_select,"pwl"==src.fun||"pwl_repeating"==src.run){for(var v="",first=!0,i=0;i<src.args.length;i++)first?first=!1:v+=",",v+=engineering_notation(src.args[i],3),i%2==0&&(v+="s");fields[source_functions[src.fun][0]]=build_input("text",30,v)}else for(var labels=source_functions[src.fun],i=0;i<labels.length;i++){var v=engineering_notation(src.args[i],3);fields[labels[i]]=build_input("text",10,v)}}var div=this.content;return div.hasChildNodes()&&div.removeChild(div.firstChild),div.appendChild(build_table(fields)),div.fields=fields,div.component=this,div},Source.prototype.edit_properties=function(x,y){if(this.near(x,y)){this.src=void 0,"undefined"!=typeof cktsim&&(this.src=cktsim.parse_source(this.properties.value));var content=this.build_content(this.src);return this.sch.dialog("Edit Properties",content,function(content){var c=content.component,fields=content.fields,first=!0,value="";for(var label in fields)if("name"==label)c.properties.name=fields.name.value;else{if("value"==label)return value=fields.value.value,void c.sch.redraw_background();if("type"==label){var select=fields.type;value=select.options[select.selectedIndex].value+"("}else first?first=!1:value+=",",value+=fields[label].value}c.properties.value=value+")",c.sch.redraw_background()}),!0}return!1},VSource.prototype=new Component,VSource.prototype.constructor=VSource,VSource.prototype.toString=Source.prototype.toString,VSource.prototype.draw=Source.prototype.draw,VSource.prototype.clone=Source.prototype.clone,VSource.prototype.build_content=Source.prototype.build_content,VSource.prototype.edit_properties=Source.prototype.edit_properties,VSource.prototype.display_current=function(c,vmap){var name=this.properties.name,label="I("+(name?name:"_"+this.properties._json_)+")",v=vmap[label];
if(void 0!=v){c.globalAlpha=.5,this.draw_text(c,"",-8,8,4,annotation_size,element_style),c.globalAlpha=1;var i=engineering_notation(v,2)+"A";this.draw_text(c,i,-3,5,5,annotation_size,annotation_style),this.draw_line(c,-3,4,0,8),this.draw_line(c,3,4,0,8),delete vmap[label]}},VSource.prototype.clone=function(x,y){return new VSource(x,y,this.rotation,this.properties.name,this.properties.value)},ISource.prototype=new Component,ISource.prototype.constructor=ISource,ISource.prototype.toString=Source.prototype.toString,ISource.prototype.draw=Source.prototype.draw,ISource.prototype.clone=Source.prototype.clone,ISource.prototype.build_content=Source.prototype.build_content,ISource.prototype.edit_properties=Source.prototype.edit_properties,ISource.prototype.clone=function(x,y){return new ISource(x,y,this.rotation,this.properties.name,this.properties.value)};var module={Schematic:Schematic,component_slider:component_slider};return module}(),function(requirejs,require,define){define("GeneralMethods",[],function(){return String.prototype.trim||(String.prototype.trim=function(str){return str.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}),{module_name:"GeneralMethods",module_status:"OK"}})}(RequireJS.requirejs,RequireJS.require,RequireJS.define),function(requirejs,require,define){define("video/00_resizer.js",[],function(){var Resizer=function(){var config,defaults={container:window,element:null,containerRatio:null,elementRatio:null},callbacksList=[],delta={height:0,width:0},module={},mode=null,initialize=function(params){return config||(config=defaults),config=$.extend(!0,{},config,params),config.element||console.log("Required parameter `element` is not passed."),module},getData=function(){var container=$(config.container),containerWidth=container.width()+delta.width,containerHeight=container.height()+delta.height,containerRatio=config.containerRatio,element=$(config.element),elementRatio=config.elementRatio;return containerRatio||(containerRatio=containerWidth/containerHeight),elementRatio||(elementRatio=element.width()/element.height()),{containerWidth:containerWidth,containerHeight:containerHeight,containerRatio:containerRatio,element:element,elementRatio:elementRatio}},align=function(){var data=getData();switch(mode){case"height":alignByHeightOnly();break;case"width":alignByWidthOnly();break;default:data.containerRatio>=data.elementRatio?alignByHeightOnly():alignByWidthOnly()}return fireCallbacks(),module},alignByWidthOnly=function(){var data=getData(),height=data.containerWidth/data.elementRatio;return data.element.css({height:height,width:data.containerWidth,top:.5*(data.containerHeight-height),left:0}),module},alignByHeightOnly=function(){var data=getData(),width=data.containerHeight*data.elementRatio;return data.element.css({height:data.containerHeight,width:data.containerHeight*data.elementRatio,top:0,left:.5*(data.containerWidth-width)}),module},setMode=function(param){return _.isString(param)&&(mode=param,align()),module},setElement=function(element){return config.element=element,module},addCallback=function(func){return $.isFunction(func)?callbacksList.push(func):console.error("[Video info]: TypeError: Argument is not a function."),module},addOnceCallback=function(func){if($.isFunction(func)){var decorator=function(){func(),removeCallback(func)};addCallback(decorator)}else console.error("TypeError: Argument is not a function.");return module},fireCallbacks=function(){$.each(callbacksList,function(index,callback){callback()})},removeCallbacks=function(){return callbacksList.length=0,module},removeCallback=function(func){var index=$.inArray(func,callbacksList);return-1!==index?callbacksList.splice(index,1):void 0},cleanDelta=function(){return delta.height=0,delta.width=0,module},addDelta=function(value,side){return _.isNumber(value)&&_.isNumber(delta[side])&&(delta[side]+=value),module},substractDelta=function(value,side){return _.isNumber(value)&&_.isNumber(delta[side])&&(delta[side]-=value),module};return initialize.apply(module,arguments),$.extend(!0,module,{align:align,alignByWidthOnly:alignByWidthOnly,alignByHeightOnly:alignByHeightOnly,setParams:initialize,setMode:setMode,setElement:setElement,callbacks:{add:addCallback,once:addOnceCallback,remove:removeCallback,removeAll:removeCallbacks},delta:{add:addDelta,substract:substractDelta,reset:cleanDelta}})};return Resizer})}(RequireJS.requirejs,RequireJS.require,RequireJS.define),window.WordCloud=function(el){RequireJS.require(["WordCloudMain"],function(WordCloudMain){new WordCloudMain(el)})},function(window){"use strict";function classReg(className){return new RegExp("(^|\\s+)"+className+"(\\s+|$)")}function toggleClass(elem,c){var fn=hasClass(elem,c)?removeClass:addClass;fn(elem,c)}var hasClass,addClass,removeClass;"classList"in document.documentElement?(hasClass=function(elem,c){return elem.classList.contains(c)},addClass=function(elem,c){elem.classList.add(c)},removeClass=function(elem,c){elem.classList.remove(c)}):(hasClass=function(elem,c){return classReg(c).test(elem.className)},addClass=function(elem,c){hasClass(elem,c)||(elem.className=elem.className+" "+c)},removeClass=function(elem,c){elem.className=elem.className.replace(classReg(c)," ")});var classie={hasClass:hasClass,addClass:addClass,removeClass:removeClass,toggleClass:toggleClass,has:hasClass,add:addClass,remove:removeClass,toggle:toggleClass};"function"==typeof define&&define.amd?define("classie",classie):window.classie=classie}(window),function(window){"use strict";var docElem=document.documentElement,bind=function(){};docElem.addEventListener?bind=function(obj,type,fn){obj.addEventListener(type,fn,!1)}:docElem.attachEvent&&(bind=function(obj,type,fn){obj[type+fn]=fn.handleEvent?function(){var event=window.event;event.target=event.target||event.srcElement,fn.handleEvent.call(fn,event)}:function(){var event=window.event;event.target=event.target||event.srcElement,fn.call(obj,event)},obj.attachEvent("on"+type,obj[type+fn])});var unbind=function(){};docElem.removeEventListener?unbind=function(obj,type,fn){obj.removeEventListener(type,fn,!1)}:docElem.detachEvent&&(unbind=function(obj,type,fn){obj.detachEvent("on"+type,obj[type+fn]);try{delete obj[type+fn]}catch(err){obj[type+fn]=void 0}});var eventie={bind:bind,unbind:unbind};"function"==typeof define&&define.amd?define("eventie",eventie):window.eventie=eventie}(this),function(){"use strict";function EventEmitter(){}function indexOfListener(listeners,listener){for(var i=listeners.length;i--;)if(listeners[i].listener===listener)return i;return-1}function alias(name){return function(){return this[name].apply(this,arguments)}}var proto=EventEmitter.prototype;proto.getListeners=function(evt){var response,key,events=this._getEvents();if("object"==typeof evt){response={};for(key in events)events.hasOwnProperty(key)&&evt.test(key)&&(response[key]=events[key])}else response=events[evt]||(events[evt]=[]);return response},proto.flattenListeners=function(listeners){var i,flatListeners=[];for(i=0;i<listeners.length;i+=1)flatListeners.push(listeners[i].listener);return flatListeners},proto.getListenersAsObject=function(evt){var response,listeners=this.getListeners(evt);return listeners instanceof Array&&(response={},response[evt]=listeners),response||listeners},proto.addListener=function(evt,listener){var key,listeners=this.getListenersAsObject(evt),listenerIsWrapped="object"==typeof listener;for(key in listeners)listeners.hasOwnProperty(key)&&-1===indexOfListener(listeners[key],listener)&&listeners[key].push(listenerIsWrapped?listener:{listener:listener,once:!1});return this},proto.on=alias("addListener"),proto.addOnceListener=function(evt,listener){return this.addListener(evt,{listener:listener,once:!0})},proto.once=alias("addOnceListener"),proto.defineEvent=function(evt){return this.getListeners(evt),this},proto.defineEvents=function(evts){for(var i=0;i<evts.length;i+=1)this.defineEvent(evts[i]);return this},proto.removeListener=function(evt,listener){var index,key,listeners=this.getListenersAsObject(evt);for(key in listeners)listeners.hasOwnProperty(key)&&(index=indexOfListener(listeners[key],listener),-1!==index&&listeners[key].splice(index,1));return this},proto.off=alias("removeListener"),proto.addListeners=function(evt,listeners){return this.manipulateListeners(!1,evt,listeners)},proto.removeListeners=function(evt,listeners){return this.manipulateListeners(!0,evt,listeners)},proto.manipulateListeners=function(remove,evt,listeners){var i,value,single=remove?this.removeListener:this.addListener,multiple=remove?this.removeListeners:this.addListeners;if("object"!=typeof evt||evt instanceof RegExp)for(i=listeners.length;i--;)single.call(this,evt,listeners[i]);else for(i in evt)evt.hasOwnProperty(i)&&(value=evt[i])&&("function"==typeof value?single.call(this,i,value):multiple.call(this,i,value));return this},proto.removeEvent=function(evt){var key,type=typeof evt,events=this._getEvents();if("string"===type)delete events[evt];else if("object"===type)for(key in events)events.hasOwnProperty(key)&&evt.test(key)&&delete events[key];else delete this._events;return this},proto.removeAllListeners=alias("removeEvent"),proto.emitEvent=function(evt,args){var listener,i,key,response,listeners=this.getListenersAsObject(evt);for(key in listeners)if(listeners.hasOwnProperty(key))for(i=listeners[key].length;i--;)listener=listeners[key][i],listener.once===!0&&this.removeListener(evt,listener.listener),response=listener.listener.apply(this,args||[]),response===this._getOnceReturnValue()&&this.removeListener(evt,listener.listener);return this},proto.trigger=alias("emitEvent"),proto.emit=function(evt){var args=Array.prototype.slice.call(arguments,1);return this.emitEvent(evt,args)},proto.setOnceReturnValue=function(value){return this._onceReturnValue=value,this},proto._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},proto._getEvents=function(){return this._events||(this._events={})},"function"==typeof define&&define.amd?define("EventEmitter",function(){return EventEmitter}):"object"==typeof module&&module.exports?module.exports=EventEmitter:this.EventEmitter=EventEmitter}.call(this),function(window){"use strict";function getStyleProperty(propName){if(propName){if("string"==typeof docElemStyle[propName])return propName;propName=propName.charAt(0).toUpperCase()+propName.slice(1);for(var prefixed,i=0,len=prefixes.length;len>i;i++)if(prefixed=prefixes[i]+propName,"string"==typeof docElemStyle[prefixed])return prefixed}}var prefixes="Webkit Moz ms Ms O".split(" "),docElemStyle=document.documentElement.style;"function"==typeof define&&define.amd?define("getStyleProperty",function(){return getStyleProperty}):window.getStyleProperty=getStyleProperty}(window),function(window){"use strict";function getStyleSize(value){var num=parseFloat(value),isValid=-1===value.indexOf("%")&&!isNaN(num);return isValid&&num}function getZeroSize(){for(var size={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},i=0,len=measurements.length;len>i;i++){var measurement=measurements[i];size[measurement]=0}return size}function defineGetSize(getStyleProperty){function getSize(elem){if("string"==typeof elem&&(elem=document.querySelector(elem)),elem&&"object"==typeof elem&&elem.nodeType){var style=getStyle(elem);if("none"===style.display)return getZeroSize();var size={};size.width=elem.offsetWidth,size.height=elem.offsetHeight;for(var isBorderBox=size.isBorderBox=!(!boxSizingProp||!style[boxSizingProp]||"border-box"!==style[boxSizingProp]),i=0,len=measurements.length;len>i;i++){var measurement=measurements[i],value=style[measurement],num=parseFloat(value);size[measurement]=isNaN(num)?0:num}var paddingWidth=size.paddingLeft+size.paddingRight,paddingHeight=size.paddingTop+size.paddingBottom,marginWidth=size.marginLeft+size.marginRight,marginHeight=size.marginTop+size.marginBottom,borderWidth=size.borderLeftWidth+size.borderRightWidth,borderHeight=size.borderTopWidth+size.borderBottomWidth,isBorderBoxSizeOuter=isBorderBox&&isBoxSizeOuter,styleWidth=getStyleSize(style.width);styleWidth!==!1&&(size.width=styleWidth+(isBorderBoxSizeOuter?0:paddingWidth+borderWidth));var styleHeight=getStyleSize(style.height);return styleHeight!==!1&&(size.height=styleHeight+(isBorderBoxSizeOuter?0:paddingHeight+borderHeight)),size.innerWidth=size.width-(paddingWidth+borderWidth),size.innerHeight=size.height-(paddingHeight+borderHeight),size.outerWidth=size.width+marginWidth,size.outerHeight=size.height+marginHeight,size}}var isBoxSizeOuter,boxSizingProp=getStyleProperty("boxSizing");return function(){if(boxSizingProp){var div=document.createElement("div");div.style.width="200px",div.style.padding="1px 2px 3px 4px",div.style.borderStyle="solid",div.style.borderWidth="1px 2px 3px 4px",div.style[boxSizingProp]="border-box";var body=document.body||document.documentElement;body.appendChild(div);var style=getStyle(div);isBoxSizeOuter=200===getStyleSize(style.width),body.removeChild(div)}}(),getSize}var defView=document.defaultView,getStyle=defView&&defView.getComputedStyle?function(elem){return defView.getComputedStyle(elem,null)}:function(elem){return elem.currentStyle},measurements=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"];"function"==typeof define&&define.amd?define("getSize",["getStyleProperty"],defineGetSize):window.getSize=defineGetSize(window.getStyleProperty)}(window),function(window){"use strict";function extend(a,b){for(var prop in b)a[prop]=b[prop];return a}function noop(){}function draggabillyDefinition(classie,EventEmitter,eventie,getStyleProperty,getSize){function Draggabilly(element,options){this.element=element,this.options=extend({},this.options),extend(this.options,options),this._create()}function noDragStart(){return!1}function setPointerPoint(point,pointer){point.x=void 0!==pointer.pageX?pointer.pageX:pointer.clientX,point.y=void 0!==pointer.pageY?pointer.pageY:pointer.clientY}var transformProperty=getStyleProperty("transform"),is3d=!!getStyleProperty("perspective");extend(Draggabilly.prototype,EventEmitter.prototype),Draggabilly.prototype.options={},Draggabilly.prototype._create=function(){this.position={},this._getPosition(),this.startPoint={x:0,y:0},this.dragPoint={x:0,y:0},this.startPosition=extend({},this.position);var style=getStyle(this.element);"relative"!==style.position&&"absolute"!==style.position&&(this.element.style.position="relative"),this.enable(),this.setHandles()},Draggabilly.prototype.setHandles=function(){this.handles=this.options.handle?this.element.querySelectorAll(this.options.handle):[this.element];for(var i=0,len=this.handles.length;len>i;i++){var handle=this.handles[i];eventie.bind(handle,"mousedown",this),eventie.bind(handle,"touchstart",this),disableImgOndragstart(handle)}};var isIE8="attachEvent"in document.documentElement,disableImgOndragstart=isIE8?function(handle){"IMG"===handle.nodeName&&(handle.ondragstart=noDragStart);for(var images=handle.querySelectorAll("img"),i=0,len=images.length;len>i;i++){var img=images[i];img.ondragstart=noDragStart}}:noop;Draggabilly.prototype._getPosition=function(){var style=getStyle(this.element),x=parseInt(style.left,10),y=parseInt(style.top,10);this.position.x=isNaN(x)?0:x,this.position.y=isNaN(y)?0:y,this._addTransformPosition(style)},Draggabilly.prototype._addTransformPosition=function(style){if(transformProperty){var transform=style[transformProperty];if(0===transform.indexOf("matrix")){var matrixValues=transform.split(","),xIndex=0===transform.indexOf("matrix3d")?12:4,translateX=parseInt(matrixValues[xIndex],10),translateY=parseInt(matrixValues[xIndex+1],10);this.position.x+=translateX,this.position.y+=translateY}}},Draggabilly.prototype.handleEvent=function(event){var method="on"+event.type;this[method]&&this[method](event)},Draggabilly.prototype.getTouch=function(touches){for(var i=0,len=touches.length;len>i;i++){var touch=touches[i];if(touch.identifier===this.pointerIdentifier)return touch}},Draggabilly.prototype.onmousedown=function(event){this.dragStart(event,event)},Draggabilly.prototype.ontouchstart=function(event){this.isDragging||this.dragStart(event,event.changedTouches[0])},Draggabilly.prototype.dragStart=function(event,pointer){if(this.isEnabled){event.preventDefault?event.preventDefault():event.returnValue=!1;var isTouch="touchstart"===event.type;this.pointerIdentifier=pointer.identifier,this._getPosition(),this.measureContainment(),setPointerPoint(this.startPoint,pointer),this.startPosition.x=this.position.x,this.startPosition.y=this.position.y,this.setLeftTop(),this.dragPoint.x=0,this.dragPoint.y=0,this._bindEvents({events:isTouch?["touchmove","touchend","touchcancel"]:["mousemove","mouseup"],node:event.preventDefault?window:document}),classie.add(this.element,"is-dragging"),this.isDragging=!0,this.emitEvent("dragStart",[this,event,pointer]),this.animate()}},Draggabilly.prototype._bindEvents=function(args){for(var i=0,len=args.events.length;len>i;i++){var event=args.events[i];eventie.bind(args.node,event,this)}this._boundEvents=args},Draggabilly.prototype._unbindEvents=function(){for(var args=this._boundEvents,i=0,len=args.events.length;len>i;i++){var event=args.events[i];eventie.unbind(args.node,event,this)}delete this._boundEvents},Draggabilly.prototype.measureContainment=function(){var containment=this.options.containment;if(containment){this.size=getSize(this.element);var elemRect=this.element.getBoundingClientRect(),container=isElement(containment)?containment:"string"==typeof containment?document.querySelector(containment):this.element.parentNode;this.containerSize=getSize(container);var containerRect=container.getBoundingClientRect();this.relativeStartPosition={x:elemRect.left-containerRect.left,y:elemRect.top-containerRect.top}}},Draggabilly.prototype.onmousemove=function(event){this.dragMove(event,event)},Draggabilly.prototype.ontouchmove=function(event){var touch=this.getTouch(event.changedTouches);touch&&this.dragMove(event,touch)},Draggabilly.prototype.dragMove=function(event,pointer){if(setPointerPoint(this.dragPoint,pointer),this.dragPoint.x-=this.startPoint.x,this.dragPoint.y-=this.startPoint.y,this.options.containment){var relX=this.relativeStartPosition.x,relY=this.relativeStartPosition.y;this.dragPoint.x=Math.max(this.dragPoint.x,-relX),this.dragPoint.y=Math.max(this.dragPoint.y,-relY),this.dragPoint.x=Math.min(this.dragPoint.x,this.containerSize.width-relX-this.size.width),this.dragPoint.y=Math.min(this.dragPoint.y,this.containerSize.height-relY-this.size.height)}this.position.x=this.startPosition.x+this.dragPoint.x,this.position.y=this.startPosition.y+this.dragPoint.y,this.emitEvent("dragMove",[this,event,pointer])},Draggabilly.prototype.onmouseup=function(event){this.dragEnd(event,event)},Draggabilly.prototype.ontouchend=function(event){var touch=this.getTouch(event.changedTouches);touch&&this.dragEnd(event,touch)},Draggabilly.prototype.dragEnd=function(event,pointer){this.isDragging=!1,delete this.pointerIdentifier,transformProperty&&(this.element.style[transformProperty]="",this.setLeftTop()),this._unbindEvents(),classie.remove(this.element,"is-dragging"),this.emitEvent("dragEnd",[this,event,pointer])},Draggabilly.prototype.ontouchcancel=function(event){var touch=this.getTouch(event.changedTouches);this.dragEnd(event,touch)},Draggabilly.prototype.animate=function(){if(this.isDragging){this.positionDrag();var _this=this;requestAnimationFrame(function(){_this.animate()})}};var translate=is3d?function(x,y){return"translate3d( "+x+"px, "+y+"px, 0)"}:function(x,y){return"translate( "+x+"px, "+y+"px)"};return Draggabilly.prototype.setLeftTop=function(){this.element.style.left=this.position.x+"px",this.element.style.top=this.position.y+"px"},Draggabilly.prototype.positionDrag=transformProperty?function(){this.element.style[transformProperty]=translate(this.dragPoint.x,this.dragPoint.y)}:Draggabilly.prototype.setLeftTop,Draggabilly.prototype.enable=function(){this.isEnabled=!0},Draggabilly.prototype.disable=function(){this.isEnabled=!1,this.isDragging&&this.dragEnd()},Draggabilly}for(var prefix,document=window.document,defView=document.defaultView,getStyle=defView&&defView.getComputedStyle?function(elem){return defView.getComputedStyle(elem,null)}:function(elem){return elem.currentStyle},isElement="object"==typeof HTMLElement?function(obj){return obj instanceof HTMLElement}:function(obj){return obj&&"object"==typeof obj&&1===obj.nodeType&&"string"==typeof obj.nodeName},lastTime=0,prefixes="webkit moz ms o".split(" "),requestAnimationFrame=window.requestAnimationFrame,cancelAnimationFrame=window.cancelAnimationFrame,i=0;i<prefixes.length&&(!requestAnimationFrame||!cancelAnimationFrame);i++)prefix=prefixes[i],requestAnimationFrame=requestAnimationFrame||window[prefix+"RequestAnimationFrame"],cancelAnimationFrame=cancelAnimationFrame||window[prefix+"CancelAnimationFrame"]||window[prefix+"CancelRequestAnimationFrame"];requestAnimationFrame&&cancelAnimationFrame||(requestAnimationFrame=function(callback){var currTime=(new Date).getTime(),timeToCall=Math.max(0,16-(currTime-lastTime)),id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);return lastTime=currTime+timeToCall,id},cancelAnimationFrame=function(id){window.clearTimeout(id)}),"function"==typeof define&&define.amd?define("draggabilly",["classie","EventEmitter","eventie","getStyleProperty","getSize"],draggabillyDefinition):window.Draggabilly=draggabillyDefinition(window.classie,window.EventEmitter,window.eventie,window.getStyleProperty,window.getSize)}(window),function(define){define("video/00_async_process.js",[],function(){"use strict";var AsyncProcess={array:function(list,process){if(!_.isArray(list))return $.Deferred().reject().promise();if(!_.isFunction(process)||!list.length)return $.Deferred().resolve(list).promise();var MAX_DELAY=50,dfd=$.Deferred(),result=[],index=0,len=list.length,getCurrentTime=function(){return(new Date).getTime()},handler=function(){var start=getCurrentTime();do result[index]=process(list[index],index),index++;while(len>index&&getCurrentTime()-start<MAX_DELAY);len>index?setTimeout(handler,25):dfd.resolve(result)};return setTimeout(handler,25),dfd.promise()}};return AsyncProcess})}(RequireJS.define),function(requirejs,require,define){define("WordCloudMain",[],function(){var WordCloudMain=function(el){var _this=this;this.wordCloudEl=$(el).find(".word_cloud"),this.ajax_url=this.wordCloudEl.data("ajax-url"),this.width=635,this.height=635,this.wordCloudEl.hide(),$.postWithPrefix(_this.ajax_url+"/get_state",null,function(response){return"success"!==response.status?void console.log("ERROR: "+response.error):void(_this.configJson=response)}).done(function(){return _this.wordCloudEl.show(),_this.configJson&&_this.configJson.submitted?void _this.showWordCloud(_this.configJson):void 0}),$(el).find("input.save").on("click",function(){_this.submitAnswer()})};return WordCloudMain.prototype.submitAnswer=function(){var _this=this,data={student_words:[]};this.wordCloudEl.find("input.input-cloud").each(function(index,value){data.student_words.push($(value).val())}),$.postWithPrefix(_this.ajax_url+"/submit",$.param(data),function(response){return"success"!==response.status?void console.log("ERROR: "+response.error):void _this.showWordCloud(response)})},WordCloudMain.prototype.showWordCloud=function(response){var words,maxSize,minSize,scaleFactor,maxFontSize,minFontSize,_this=this;this.wordCloudEl.find(".input_cloud_section").hide(),words=response.top_words,maxSize=0,minSize=1e4,scaleFactor=1,maxFontSize=200,minFontSize=15,$.each(words,function(index,word){word.size>maxSize&&(maxSize=word.size),word.size<minSize&&(minSize=word.size)}),$.each(words,function(index,word){var tempScaleFactor=1,size=word.size/maxSize*maxFontSize;.7*size*word.text.length>_this.width&&(tempScaleFactor=_this.width/word.text.length/.7/size),scaleFactor>tempScaleFactor&&(scaleFactor=tempScaleFactor)}),maxFontSize*=scaleFactor,d3.layout.cloud().size([this.width,this.height]).words(words).rotate(function(){return 90*Math.floor(2*Math.random())}).font("Impact").fontSize(function(d){var size=d.size/maxSize*maxFontSize;return size=size>=minFontSize?size:minFontSize}).on("end",function(words,bounds){_this.drawWordCloud(response,words,bounds)}).start()},WordCloudMain.prototype.drawWordCloud=function(response,words,bounds){var studentWordsStr,groupEl,fill=d3.scale.category20(),studentWordsKeys=[],scale=1,cloudSectionEl=this.wordCloudEl.find(".result_cloud_section");bounds&&(scale=.5*Math.min(this.width/Math.abs(bounds[1].x-this.width/2),this.width/Math.abs(bounds[0].x-this.width/2),this.height/Math.abs(bounds[1].y-this.height/2),this.height/Math.abs(bounds[0].y-this.height/2))),$.each(response.student_words,function(word,stat){var percent=response.display_student_percents?" "+Math.round(100*(stat/response.total_count))+"%":"";studentWordsKeys.push("<strong>"+word+"</strong>"+percent)}),studentWordsStr=""+studentWordsKeys.join(", "),cloudSectionEl.addClass("active").find(".your_words").html(studentWordsStr).end().find(".total_num_words").html(response.total_count),$(cloudSectionEl.attr("id")+" .word_cloud").empty(),groupEl=d3.select("#"+cloudSectionEl.attr("id")+" .word_cloud").append("svg").attr("width",this.width).attr("height",this.height).append("g").attr("transform","translate("+.5*this.width+","+.5*this.height+")").selectAll("text").data(words).enter().append("g"),groupEl.append("title").text(function(d){var res="";return $.each(response.top_words,function(index,value){return value.text===d.text?void(res=value.percent+"%"):void 0}),res}),groupEl.append("text").style("font-size",function(d){return d.size+"px"}).style("font-family","Impact").style("fill",function(d,i){return fill(i)}).attr("text-anchor","middle").attr("transform",function(d){return"translate("+[d.x,d.y]+")rotate("+d.rotate+")scale("+scale+")"}).text(function(d){return d.text})},WordCloudMain})}(RequireJS.requirejs,RequireJS.require,RequireJS.define),function(requirejs,require,define){define("Sliders",[],function(){function Sliders(gstId,state){function createSlider(sliderDiv,paramName){function sliderOnSlide(event,ui){void 0===state.setParameterValue(paramName,ui.value,sliderDiv,!0,"slide")&&console.log('ERROR: Could not update the parameter named "'+paramName+'" with the value "'+ui.value+'".')}function sliderOnChange(event,ui){void 0===state.setParameterValue(paramName,ui.value,sliderDiv,!0,"change")&&console.log('ERROR: Could not update the parameter named "'+paramName+'" with the value "'+ui.value+'".')}var paramObj;return paramObj=state.getParamObj(paramName),void 0===paramObj?void console.log('ERROR: Could not get a paramObj for parameter "'+paramName+'".'):(sliderDiv.slider({min:paramObj.min,max:paramObj.max,value:paramObj.value,step:paramObj.step}),paramObj.sliderDiv=sliderDiv,paramObj.sliderDiv.on("slide",sliderOnSlide),void paramObj.sliderDiv.on("slidechange",sliderOnChange))}var c1,paramName,allParamNames,sliderDiv;for(allParamNames=state.getAllParameterNames(),c1=0;c1<allParamNames.length;c1+=1)paramName=allParamNames[c1],sliderDiv=$("#"+gstId+"_slider_"+paramName),1===sliderDiv.length?createSlider(sliderDiv,paramName):sliderDiv.length>1&&(console.log('ERROR: Found more than one slider for the parameter "'+paramName+'".'),console.log("sliderDiv.length = ",sliderDiv.length))}return Sliders})}(RequireJS.requirejs,RequireJS.require,RequireJS.define),function(requirejs,require,define){define("Inputs",[],function(){function Inputs(gstId,gstClass,state){function createInput(inputDiv,paramName){function inputOnChange(){var inputDiv;inputDiv=$(this),state.setParameterValue(paramName,inputDiv.val(),inputDiv)}var paramObj;return paramObj=state.getParamObj(paramName),void 0===paramObj?void console.log('ERROR: Could not get a paramObj for parameter "'+paramName+'".'):(inputDiv.bind("change",inputOnChange),inputDiv.val(paramObj.value),inputDiv.button().css({font:"inherit",color:"inherit","text-align":"left",outline:"none",cursor:"text",height:"15px"}),void paramObj.inputDivs.push(inputDiv))}var c1,allParamNames;for(allParamNames=state.getAllParameterNames(),c1=0;c1<allParamNames.length;c1+=1)$("#"+gstId).find("."+gstClass+"_input").each(function(index,value){var inputDiv,paramName;paramName=allParamNames[c1],inputDiv=$(value),paramName===inputDiv.data("var")&&createInput(inputDiv,paramName)})}return Inputs})}(RequireJS.requirejs,RequireJS.require,RequireJS.define),function(define){"use strict";define("video/00_i18n.js",[],function(){return{Play:gettext("Play"),Pause:gettext("Pause"),Mute:gettext("Mute"),Unmute:gettext("Unmute"),"Exit full browser":gettext("Exit full browser"),"Fill browser":gettext("Fill browser"),Speed:gettext("Speed"),Volume:gettext("Volume"),Muted:gettext("Muted"),"Very low":gettext("Very low"),Low:gettext("Low"),Average:gettext("Average"),Loud:gettext("Loud"),"Very loud":gettext("Very loud"),Maximum:gettext("Maximum")}})}(RequireJS.define),function(requirejs,require,define){define("Graph",[],function(){function Graph(gstId,config,state){function getBarWidth(){return config.plot.hasOwnProperty("bar_width")!==!1?"string"!=typeof config.plot.bar_width?void console.log("ERROR: The parameter config.plot.bar_width must be a string."):isFinite(graphBarWidth=parseFloat(config.plot.bar_width))===!1?(console.log("ERROR: The parameter config.plot.bar_width is not a valid floating number."),void(graphBarWidth=1)):void 0:void 0}function getBarAlign(){return config.plot.hasOwnProperty("bar_align")!==!1?"string"!=typeof config.plot.bar_align?void console.log("ERROR: The parameter config.plot.bar_align must be a string."):"left"!==config.plot.bar_align.toLowerCase()&&"center"!==config.plot.bar_align.toLowerCase()?void console.log('ERROR: Property config.plot.bar_align can be one of "left", or "center".'):void(graphBarAlign=config.plot.bar_align.toLowerCase()):void 0}function createMovingLabelFunctions(){var c1,returnStatus;if(returnStatus=!0,movingLabels=[],config.plot.hasOwnProperty("moving_label")!==!0)returnStatus=!0;else if($.isPlainObject(config.plot.moving_label)===!0)processMovingLabel(config.plot.moving_label)===!1&&(returnStatus=!1);else if($.isArray(config.plot.moving_label)===!0)for(c1=0;c1<config.plot.moving_label.length;c1++)processMovingLabel(config.plot.moving_label[c1])===!1&&(returnStatus=!1);return returnStatus}function processMovingLabel(obj){var labelText,funcString,disableAutoReturn,paramNames,func,fontWeight,fontColor;if(obj.hasOwnProperty("@text")===!1)return console.log('ERROR: You did not define a "text" attribute for the moving_label.'),!1;if("string"!=typeof obj["@text"])return console.log('ERROR: "text" attribute is not a string.'),!1;if(labelText=obj["@text"],obj.hasOwnProperty("#text")===!1)return console.log("ERROR: moving_label is missing function declaration."),!1;if("string"!=typeof obj["#text"])return console.log("ERROR: Function declaration is not a string."),!1;funcString=obj["#text"],fontColor="black",obj.hasOwnProperty("@color")===!0&&"string"==typeof obj["@color"]&&(fontColor=obj["@color"]),fontWeight="normal",obj.hasOwnProperty("@weight")===!0&&"string"==typeof obj["@weight"]&&("normal"===obj["@weight"].toLowerCase()||"bold"===obj["@weight"].toLowerCase()?fontWeight=obj["@weight"]:console.log('ERROR: Moving label can have a weight property of "normal" or "bold".')),disableAutoReturn=obj["@disable_auto_return"],funcString=$("<div>").html(funcString).text(),void 0===disableAutoReturn||"string"==typeof disableAutoReturn&&"true"!==disableAutoReturn.toLowerCase()?-1===funcString.search(/return/i)&&(funcString="return "+funcString):-1===funcString.search(/return/i)&&console.log('ERROR: You have specified a JavaScript function without a "return" statemnt. Your function will return "undefined" by default.'),paramNames=state.getAllParameterNames(),paramNames.push(funcString);try{func=Function.apply(null,paramNames)}catch(err){return console.log('ERROR: The function body "'+funcString+'" was not converted by the Function constructor.'),console.log('Error message: "'+err.message+'"'),state.showDebugInfo&&($("#"+gstId).html('<div style="color: red;">ERROR IN XML: Could not create a function from the string "'+funcString+'".</div>'),$("#"+gstId).append('<div style="color: red;">Error message: "'+err.message+'".</div>')),paramNames.pop(),!1
}return paramNames.pop(),movingLabels.push({labelText:labelText,func:func,el:null,fontColor:fontColor,fontWeight:fontWeight}),!0}function createMarkingsFunctions(){function processAsymptote(asyObj){var newAsyObj,funcString,func;if(newAsyObj={},"string"!=typeof asyObj["@type"])return console.log('ERROR: Attribute "type" for asymptote is not specified.'),!1;if("x"===asyObj["@type"].toLowerCase())newAsyObj.type="x";else{if("y"!==asyObj["@type"].toLowerCase())return console.log('ERROR: Attribute "type" for asymptote can be "x" or "y".'),!1;newAsyObj.type="y"}if("string"!=typeof asyObj["#text"])return console.log("ERROR: Function body for asymptote is not specified."),!1;funcString=asyObj["#text"],newAsyObj.color="#000","string"==typeof asyObj["@color"]&&(newAsyObj.color=asyObj["@color"]),newAsyObj.label=!1,asyObj.hasOwnProperty("@label")===!0&&"string"==typeof asyObj["@label"]&&(newAsyObj.label=asyObj["@label"]),funcString=$("<div>").html(funcString).text(),disableAutoReturn=asyObj["@disable_auto_return"],void 0===disableAutoReturn||"string"==typeof disableAutoReturn&&"true"!==disableAutoReturn.toLowerCase()?-1===funcString.search(/return/i)&&(funcString="return "+funcString):-1===funcString.search(/return/i)&&console.log('ERROR: You have specified a JavaScript function without a "return" statemnt. Your function will return "undefined" by default.'),paramNames.push(funcString);try{func=Function.apply(null,paramNames)}catch(err){return console.log("ERROR: Asymptote function body could not be converted to function object."),console.log('Error message: "".'+err.message),!1}return paramNames.pop(),newAsyObj.func=func,asymptotes.push(newAsyObj),!0}var c1,paramNames,returnStatus;if(returnStatus=!0,asymptotes=[],paramNames=state.getAllParameterNames(),$.isPlainObject(config.plot.asymptote))processAsymptote(config.plot.asymptote)===!1&&(returnStatus=!1);else if($.isArray(config.plot.asymptote))for(c1=0;c1<config.plot.asymptote.length;c1+=1)processAsymptote(config.plot.asymptote[c1])===!1&&(returnStatus=!1);return returnStatus}function setGraphAxes(){function checkForTicksNames(axisName){var tmpObj;if("x"!==axisName&&"y"!==axisName)return!0;if(config.plot.hasOwnProperty(axisName+"ticks_names")===!0||"string"==typeof config.plot[axisName+"ticks_names"]){try{tmpObj=JSON.parse(config.plot[axisName+"ticks_names"])}catch(err){return console.log("ERROR: plot."+axisName+"ticks_names is not a valid JSON string.",'Error message: "'+err.message+'".'),!1}"x"===axisName?(xTicksNames=tmpObj,xaxis.tickFormatter=xAxisTickFormatter):(yTicksNames=tmpObj,yaxis.tickFormatter=yAxisTickFormatter)}}function processTicks(ticksStr,ticksObj,unitsType){function roundToPrec(num,prec){var c1,tn1,tn2,digitsBefore,digitsAfter;for(tn1=Math.abs(num),tn2=Math.abs(prec),c1=0,tn1=Math.abs(num);tn1>=1;)c1+=1,tn1/=10;for(digitsBefore=c1,c1=0,tn1=Math.abs(num);Math.round(tn1)!==tn1;)c1+=1,tn1*=10;for(digitsAfter=c1,c1=0;Math.round(tn2)!==tn2;)c1+=1,tn2*=10;return 0===c1?num:(tn1=Math.abs(num),tn1=tn1.toFixed(c1),0>num?-tn1:tn1)}var ticksBlobs,tempFloat,tempTicks,c1,c2;if(ticksBlobs=ticksStr.split(","),3!==ticksBlobs.length)return console.log('ERROR: Did not get 3 blobs from ticksStr = "'+ticksStr+'".'),!1;if(tempFloat=parseFloat(ticksBlobs[0]),isNaN(tempFloat)!==!1)return console.log('ERROR: Invalid "min". ticksBlobs[0] = ',ticksBlobs[0]),!1;if(ticksObj.min=tempFloat,tempFloat=parseFloat(ticksBlobs[1]),isNaN(tempFloat)!==!1)return console.log('ERROR: Invalid "tickSize". ticksBlobs[1] = ',ticksBlobs[1]),!1;if(ticksObj.tickSize=tempFloat,tempFloat=parseFloat(ticksBlobs[2]),isNaN(tempFloat)!==!1)return console.log('ERROR: Invalid "max". ticksBlobs[2] = ',ticksBlobs[2]),!1;if(ticksObj.max=tempFloat,ticksObj.min>=ticksObj.max)return console.log("ERROR: Ticks min >= max."),!1;if(ticksObj.tickSize>ticksObj.max-ticksObj.min)return console.log("ERROR: tickSize > max - min."),!1;if("string"==typeof config.plot[unitsType]){for(tempTicks=[],c1=ticksObj.min;c1<=ticksObj.max;c1+=ticksObj.tickSize)c2=roundToPrec(c1,ticksObj.tickSize),tempTicks.push([c2,c2]);tempTicks.pop(),tempTicks.push([roundToPrec(ticksObj.max,ticksObj.tickSize),config.plot[unitsType]]),ticksObj.tickSize=null,ticksObj.ticks=tempTicks}return!0}return xaxis={tickFormatter:null},"string"!=typeof config.plot.xticks?!1:processTicks(config.plot.xticks,xaxis,"xunits")===!1?(console.log("ERROR: Could not process the ticks for x-axis."),!1):(yaxis={tickFormatter:null},"string"!=typeof config.plot.yticks?!1:processTicks(config.plot.yticks,yaxis,"yunits")===!1?(console.log("ERROR: Could not process the ticks for y-axis."),!1):(xTicksNames=null,yTicksNames=null,checkForTicksNames("x")===!1?!1:checkForTicksNames("y")===!1?!1:!0))}function setGraphXRange(){var tempNum,allParamNames,funcString,disableAutoReturn;if(xrange={},$.isPlainObject(config.plot.xrange)===!1)return console.log("ERROR: Expected config.plot.xrange to be an object. It is not."),console.log("config.plot.xrange = ",config.plot.xrange),!1;if(config.plot.xrange.hasOwnProperty("min")===!1)return console.log("ERROR: Expected config.plot.xrange.min to be present. It is not."),!1;if(disableAutoReturn=!1,"string"==typeof config.plot.xrange.min)funcString=config.plot.xrange.min;else{if($.isPlainObject(config.plot.xrange.min)!==!0||config.plot.xrange.min.hasOwnProperty("#text")!==!0||"string"!=typeof config.plot.xrange.min["#text"])return console.log("ERROR: Could not get a function definition for xrange.min property."),!1;funcString=config.plot.xrange.min["#text"],disableAutoReturn=config.plot.xrange.min["@disable_auto_return"],disableAutoReturn=void 0===disableAutoReturn||"string"==typeof disableAutoReturn&&"true"!==disableAutoReturn.toLowerCase()?!1:!0}funcString=$("<div>").html(funcString).text(),disableAutoReturn===!1?-1===funcString.search(/return/i)&&(funcString="return "+funcString):-1===funcString.search(/return/i)&&console.log('ERROR: You have specified a JavaScript function without a "return" statemnt. Your function will return "undefined" by default.'),allParamNames=state.getAllParameterNames(),allParamNames.push(funcString);try{xrange.min=Function.apply(null,allParamNames)}catch(err){return console.log('ERROR: could not create a function from the string "'+funcString+'" for xrange.min.'),console.log('Error message: "'+err.message+'"'),state.showDebugInfo&&($("#"+gstId).html('<div style="color: red;">ERROR IN XML: Could not create a function from the string "'+funcString+'" for xrange.min.</div>'),$("#"+gstId).append('<div style="color: red;">Error message: "'+err.message+'".</div>')),!1}if(allParamNames.pop(),config.plot.xrange.hasOwnProperty("max")===!1)return console.log("ERROR: Expected config.plot.xrange.max to be present. It is not."),!1;if(disableAutoReturn=!1,"string"==typeof config.plot.xrange.max)funcString=config.plot.xrange.max;else{if($.isPlainObject(config.plot.xrange.max)!==!0||config.plot.xrange.max.hasOwnProperty("#text")!==!0||"string"!=typeof config.plot.xrange.max["#text"])return console.log("ERROR: Could not get a function definition for xrange.max property."),!1;funcString=config.plot.xrange.max["#text"],disableAutoReturn=config.plot.xrange.max["@disable_auto_return"],disableAutoReturn=void 0===disableAutoReturn||"string"==typeof disableAutoReturn&&"true"!==disableAutoReturn.toLowerCase()?!1:!0}funcString=$("<div>").html(funcString).text(),disableAutoReturn===!1?-1===funcString.search(/return/i)&&(funcString="return "+funcString):-1===funcString.search(/return/i)&&console.log('ERROR: You have specified a JavaScript function without a "return" statemnt. Your function will return "undefined" by default.'),allParamNames.push(funcString);try{xrange.max=Function.apply(null,allParamNames)}catch(err){return console.log('ERROR: could not create a function from the string "'+funcString+'" for xrange.max.'),console.log('Error message: "'+err.message+'"'),state.showDebugInfo&&($("#"+gstId).html('<div style="color: red;">ERROR IN XML: Could not create a function from the string "'+funcString+'" for xrange.max.</div>'),$("#"+gstId).append('<div style="color: red;">Error message: "'+err.message+'".</div>')),!1}return allParamNames.pop(),tempNum=parseInt(config.plot.num_points,10),isFinite(tempNum)===!1&&(tempNum=plotDiv.width()/5),2>tempNum&&tempNum>1e3?(console.log("ERROR: Number of points is outside the allowed range [2, 1000]"),console.log("config.plot.num_points = "+tempNum),!1):(numPoints=tempNum,!0)}function createFunctions(){function callAddFunction(obj){if(obj.hasOwnProperty("@output")&&"string"==typeof obj["@output"]){if("element"===obj["@output"].toLowerCase()||"none"===obj["@output"].toLowerCase())return;if("plot_label"===obj["@output"].toLowerCase())return;if("graph"!==obj["@output"].toLowerCase())return void console.log('ERROR: Function "output" attribute can be either "element", "plot_label", "none" or "graph".')}addFunction(obj["#text"],obj["@color"],obj["@line"],obj["@dot"],obj["@label"],obj["@point_size"],obj["@fill_area"],obj["@bar"],obj["@disable_auto_return"])}function addFunction(funcString,color,line,dot,label,pointSize,fillArea,bar,disableAutoReturn){var newFunctionObject,func,paramNames,c1,rgxp;if("string"==typeof funcString){funcString=$("<div>").html(funcString).text(),void 0===disableAutoReturn||"string"==typeof disableAutoReturn&&"true"!==disableAutoReturn.toLowerCase()?-1===funcString.search(/return/i)&&(funcString="return "+funcString):-1===funcString.search(/return/i)&&console.log('ERROR: You have specified a JavaScript function without a "return" statemnt. Your function will return "undefined" by default.'),newFunctionObject={line:!0,dot:!1,bars:!1},paramNames=state.getAllParameterNames(),paramNames.push("x"),paramNames.push(funcString);try{func=Function.apply(null,paramNames)}catch(err){return console.log('ERROR: The function body "'+funcString+'" was not converted by the Function constructor.'),console.log('Error message: "'+err.message+'"'),state.showDebugInfo&&($("#"+gstId).html('<div style="color: red;">ERROR IN XML: Could not create a function from the string "'+funcString+'".</div>'),$("#"+gstId).append('<div style="color: red;">Error message: "'+err.message+'".</div>')),paramNames.pop(),void paramNames.pop()}if(paramNames.pop(),paramNames.pop(),newFunctionObject.func=func,"string"==typeof color&&(newFunctionObject.color=color),"string"==typeof line&&("true"===line.toLowerCase()?newFunctionObject.line=!0:"false"===line.toLowerCase()&&(newFunctionObject.line=!1)),"string"==typeof dot&&("true"===dot.toLowerCase()?newFunctionObject.dot=!0:"false"===dot.toLowerCase()&&(newFunctionObject.dot=!1)),"string"==typeof pointSize&&(newFunctionObject.pointSize=pointSize),"string"==typeof bar&&("true"===bar.toLowerCase()?newFunctionObject.bars=!0:"false"===bar.toLowerCase()&&(newFunctionObject.bars=!1)),newFunctionObject.bars===!0?(newFunctionObject.line=!1,newFunctionObject.dot=!1):newFunctionObject.dot===!1&&newFunctionObject.line===!1&&(newFunctionObject.line=!0),newFunctionObject.line===!0&&"string"==typeof fillArea)if("true"===fillArea.toLowerCase())newFunctionObject.fillArea=!0;else{if("false"!==fillArea.toLowerCase())return console.log('ERROR: The attribute fill_area should be either "true" or "false".'),void console.log('fill_area = "'+fillArea+'".');newFunctionObject.fillArea=!1}if("string"==typeof label){for(newFunctionObject.specialLabel=!1,newFunctionObject.pldeHash=[],c1=0;c1<state.plde.length;c1+=1)rgxp=new RegExp(state.plde[c1].elId,"g"),rgxp.test(label)===!0&&(newFunctionObject.specialLabel=!0,newFunctionObject.pldeHash.push(state.plde[c1]));newFunctionObject.label=label}else newFunctionObject.label=!1;functions.push(newFunctionObject)}}var c1;if(functions=[],"undefined"==typeof config.functions)return void console.log("ERROR: config.functions is undefined.");if("string"==typeof config.functions["function"])addFunction(config.functions["function"]);else if($.isPlainObject(config.functions["function"])===!0)callAddFunction(config.functions["function"]);else{if(!$.isArray(config.functions["function"]))return void console.log("ERROR: config.functions.function is of an unsupported type.");for(c1=0;c1<config.functions["function"].length;c1+=1)"string"==typeof config.functions["function"][c1]?addFunction(config.functions["function"][c1]):$.isPlainObject(config.functions["function"][c1])&&callAddFunction(config.functions["function"][c1])}}function onUpdatePlot(){generateData()===!0&&updatePlot()}function generateData(){var c0,c1,c3,functionObj,seriesObj,dataPoints,paramValues,x,y,start,end,step,numNotUndefined;for(paramValues=state.getAllParameterValues(),dataSeries=[],c0=0;c0<functions.length;c0+=1){functionObj=functions[c0];try{start=xrange.min.apply(window,paramValues)}catch(err){return console.log("ERROR: Could not determine xrange start."),console.log('Error message: "'+err.message+'".'),state.showDebugInfo&&($("#"+gstId).html('<div style="color: red;">ERROR IN XML: Could not determine xrange start from defined function.</div>'),$("#"+gstId).append('<div style="color: red;">Error message: "'+err.message+'".</div>')),!1}try{end=xrange.max.apply(window,paramValues)}catch(err){return console.log("ERROR: Could not determine xrange end."),console.log('Error message: "'+err.message+'".'),state.showDebugInfo&&($("#"+gstId).html('<div style="color: red;">ERROR IN XML: Could not determine xrange end from defined function.</div>'),$("#"+gstId).append('<div style="color: red;">Error message: "'+err.message+'".</div>')),!1}for(seriesObj={},dataPoints=[],c1=0,step=(end-start)/(numPoints-1),x=start;end>=x;x+=step){paramValues.push(x);try{y=functionObj.func.apply(window,paramValues)}catch(err){return console.log("ERROR: Could not generate data."),console.log('Error message: "'+err.message+'".'),state.showDebugInfo&&($("#"+gstId).html('<div style="color: red;">ERROR IN XML: Could not generate data from defined function.</div>'),$("#"+gstId).append('<div style="color: red;">Error message: "'+err.message+'".</div>')),!1}paramValues.pop(),dataPoints.push([x,y]),c1+=1}if(c1!=numPoints){x=end,paramValues.push(x);try{y=functionObj.func.apply(window,paramValues)}catch(err){return console.log("ERROR: Could not generate data."),console.log('Error message: "'+err.message+'".'),state.showDebugInfo&&($("#"+gstId).html('<div style="color: red;">ERROR IN XML: Could not generate data from function.</div>'),$("#"+gstId).append('<div style="color: red;">Error message: "'+err.message+'".</div>')),!1}paramValues.pop(),dataPoints.push([x,y])}seriesObj.data=dataPoints,functionObj.hasOwnProperty("color")===!0&&(seriesObj.color=functionObj.color),functionObj.label!==!1&&(functionObj.specialLabel===!0?!function(c1){var tempLabel;for(tempLabel=functionObj.label;c1<functionObj.pldeHash.length;)tempLabel=tempLabel.replace(functionObj.pldeHash[c1].elId,functionObj.pldeHash[c1].func.apply(window,state.getAllParameterValues())),c1+=1;seriesObj.label=tempLabel}(0):seriesObj.label=functionObj.label),seriesObj.lines={show:functionObj.line},functionObj.hasOwnProperty("fillArea")===!0&&(seriesObj.lines.fill=functionObj.fillArea),seriesObj.points={show:functionObj.dot},seriesObj.bars={show:functionObj.bars,barWidth:graphBarWidth},null!==graphBarAlign&&(seriesObj.bars.align=graphBarAlign),functionObj.hasOwnProperty("pointSize")&&(seriesObj.points.radius=functionObj.pointSize),dataSeries.push(seriesObj)}if(null===graphBarAlign)for(c0=0;numPoints>c0;c0+=1){for(numNotUndefined=0,c1=0;c1<dataSeries.length;c1+=1)dataSeries[c1].bars.show!==!1&&isFinite(parseInt(dataSeries[c1].data[c0][1]))===!0&&(numNotUndefined+=1);for(c3=0,c1=0;c1<dataSeries.length;c1+=1)dataSeries[c1].bars.show!==!1&&(dataSeries[c1].data[c0][0]-=graphBarWidth*(.5*numNotUndefined-c3),isFinite(parseInt(dataSeries[c1].data[c0][1]))===!0&&(c3+=1))}for(c0=0;c0<asymptotes.length;c0+=1)asymptotes[c0].label!==!1&&dataSeries.push({data:[],label:asymptotes[c0].label,color:asymptotes[c0].color});return!0}function updatePlot(){function updateMovingLabels(){var c1,labelCoord,pointOffset;for(c1=0;c1<movingLabels.length;c1+=1)null===movingLabels[c1].el?(movingLabels[c1].el=$("<div>"+movingLabels[c1].labelText+"</div>"),movingLabels[c1].el.css("position","absolute"),movingLabels[c1].el.css("color",movingLabels[c1].fontColor),movingLabels[c1].el.css("font-weight",movingLabels[c1].fontWeight),movingLabels[c1].el.appendTo(plotDiv),movingLabels[c1].elWidth=movingLabels[c1].el.width(),movingLabels[c1].elHeight=movingLabels[c1].el.height()):(movingLabels[c1].el.detach(),movingLabels[c1].el.appendTo(plotDiv)),labelCoord=movingLabels[c1].func.apply(window,paramValues),pointOffset=plotObj.pointOffset({x:labelCoord.x,y:labelCoord.y}),movingLabels[c1].el.css("left",pointOffset.left-.5*movingLabels[c1].elWidth),movingLabels[c1].el.css("top",pointOffset.top-.5*movingLabels[c1].elHeight)}function generateMarkings(){var c1,asymptote,markings,val;for(markings=[],c1=0;c1<asymptotes.length;c1+=1){asymptote=asymptotes[c1];try{val=asymptote.func.apply(window,paramValues)}catch(err){console.log("ERROR: Could not generate value from asymptote function."),console.log("Error message: ",err.message);continue}markings.push("x"===asymptote.type?{color:asymptote.color,lineWidth:2,xaxis:{from:val,to:val}}:{color:asymptote.color,lineWidth:2,yaxis:{from:val,to:val}})}return markings}var paramValues,plotObj;paramValues=state.getAllParameterValues(),null!==xaxis.tickFormatter&&(xaxis.ticks=null),null!==yaxis.tickFormatter&&(yaxis.ticks=null),plotObj=$.plot(plotDiv,dataSeries,{xaxis:xaxis,yaxis:yaxis,legend:{show:!0,backgroundOpacity:0},grid:{markings:generateMarkings()}}),updateMovingLabels(),MathJax.Hub.Queue(["Typeset",MathJax.Hub,plotDiv.attr("id")])}function xAxisTickFormatter(val,axis){return xTicksNames.hasOwnProperty(val.toFixed(axis.tickDecimals))===!0?xTicksNames[val.toFixed(axis.tickDecimals)]:""}function yAxisTickFormatter(val,axis){return yTicksNames.hasOwnProperty(val.toFixed(axis.tickDecimals))===!0?yTicksNames[val.toFixed(axis.tickDecimals)]:""}var plotDiv,dataSeries,functions,xaxis,yaxis,numPoints,xrange,asymptotes,movingLabels,xTicksNames,yTicksNames,graphBarWidth,graphBarAlign;if($.isPlainObject(config.plot)!==!1)return plotDiv=$("#"+gstId+"_plot"),0===plotDiv.length?void console.log('ERROR: Could not find the plot DIV with ID "'+gstId+'_plot".'):(0===plotDiv.width()&&plotDiv.width(300),0===plotDiv.height()&&plotDiv.height(plotDiv.width()),plotDiv.css("position","relative"),setGraphXRange()===!1?void console.log("ERROR: Could not configure the xrange. Will not continue."):setGraphAxes()===!1?void console.log("ERROR: Could not process configuration for the axes."):(graphBarWidth=1,graphBarAlign=null,getBarWidth(),getBarAlign(),createFunctions(),0===functions.length?void console.log("ERROR: No functions were specified, or something went wrong."):void(createMarkingsFunctions()!==!1&&createMovingLabelFunctions()!==!1&&(generateData()===!0&&updatePlot(),state.bindUpdatePlotEvent(plotDiv,onUpdatePlot)))))}return Graph})}(RequireJS.requirejs,RequireJS.require,RequireJS.define),function(define){define("video/00_sjson.js",[],function(){"use strict";var Sjson=function(data){var sjson={start:data.start.concat(),text:data.text.concat()},getter=function(propertyName){return function(){return sjson[propertyName]}},getStartTimes=getter("start"),getCaptions=getter("text"),size=function(){return sjson.text.length},search=function(time){var index,start=getStartTimes(),max=size()-1,min=0;if(time<start[min])return-1;for(;max>min;)index=Math.ceil((max+min)/2),time<start[index]&&(max=index-1),time>=start[index]&&(min=index);return min};return{getCaptions:getCaptions,getStartTimes:getStartTimes,getSize:size,search:search}};return Sjson})}(RequireJS.define),function(define){define("video/00_iterator.js",[],function(){"use strict";var Iterator=function(list){this.list=list,this.index=0,this.size=this.list.length,this.lastIndex=this.list.length-1};return Iterator.prototype={_isValid:function(index){return _.isNumber(index)&&index<this.size&&index>=0},next:function(index){return this._isValid(index)||(index=this.index),this.index=index>=this.lastIndex?0:index+1,this.list[this.index]},prev:function(index){return this._isValid(index)||(index=this.index),this.index=1>index?this.lastIndex:index-1,this.list[this.index]},last:function(){return this.list[this.lastIndex]},first:function(){return this.list[0]},isEnd:function(){return this.index===this.lastIndex}},Iterator})}(RequireJS.define),function(requirejs,require,define){define("ElOutput",[],function(){function ElOutput(config,state){function processFuncObj(obj){var paramNames,funcString,func,el,disableAutoReturn,updateOnEvent;if("string"==typeof obj["@output"]&&("element"===obj["@output"].toLowerCase()||"none"===obj["@output"].toLowerCase())){if("string"!=typeof obj["@el_id"])return void console.log('ERROR: You specified "output" as "element", but did not spify "el_id".');if("string"!=typeof obj["#text"])return void console.log("ERROR: Function body is not defined.");updateOnEvent="slide",obj.hasOwnProperty("@update_on")!==!0||"string"!=typeof obj["@update_on"]||"slide"!==obj["@update_on"].toLowerCase()&&"change"!==obj["@update_on"].toLowerCase()||(updateOnEvent=obj["@update_on"].toLowerCase()),disableAutoReturn=obj["@disable_auto_return"],funcString=obj["#text"],void 0===disableAutoReturn||"string"==typeof disableAutoReturn&&"true"!==disableAutoReturn.toLowerCase()?-1===funcString.search(/return/i)&&(funcString="return "+funcString):-1===funcString.search(/return/i)&&console.log('ERROR: You have specified a JavaScript function without a "return" statemnt. Your function will return "undefined" by default.'),funcString=$("<div>").html(funcString).text(),paramNames=state.getAllParameterNames(),paramNames.push(funcString);try{func=Function.apply(null,paramNames)}catch(err){return console.log('ERROR: The function body "'+funcString+'" was not converted by the Function constructor.'),console.log('Error message: "'+err.message+'".'),state.showDebugInfo&&($("#"+gstId).html('<div style="color: red;">ERROR IN XML: Could not create a function from string "'+funcString+'".</div>'),$("#"+gstId).append('<div style="color: red;">Error message: "'+err.message+'".</div>')),void paramNames.pop()}if(paramNames.pop(),"none"!==obj["@output"].toLowerCase()){if(el=$("#"+obj["@el_id"]),1!==el.length)return void console.log('ERROR: DOM element with ID "'+obj["@el_id"]+'" not found. Dynamic element not created.');el.html(func.apply(window,state.getAllParameterValues()))}else el=null,func.apply(window,state.getAllParameterValues());state.addDynamicEl(el,func,obj["@el_id"],updateOnEvent)}}$.isPlainObject(config.functions["function"])?processFuncObj(config.functions["function"]):$.isArray(config.functions["function"])&&!function(c1){for(;c1<config.functions["function"].length;)$.isPlainObject(config.functions["function"][c1])&&processFuncObj(config.functions["function"][c1]),c1+=1}(0)}return ElOutput})}(RequireJS.requirejs,RequireJS.require,RequireJS.define),function(requirejs,require,define){define("video/01_initialize.js",["video/03_video_player.js","video/00_video_storage.js","video/00_i18n.js"],function(VideoPlayer,VideoStorage,i18n){function _makeFunctionsPublic(state){bindTo(methodsDict,state,state)}function _renderElements(state){var video,onYTApiReady,setupOnYouTubeIframeAPIReady;"youtube"===state.videoType?(state.youtubeApiAvailable=!1,onYTApiReady=function(){console.log("[Video info]: YouTube API is available and is loaded."),video=VideoPlayer(state),state.modules.push(video),state.__dfd__.resolve(),state.youtubeApiAvailable=!0},window.YT?(_youtubeApiDeferred&&_youtubeApiDeferred.resolve(),window.YT.ready(function(){onYTApiReady()})):(setupOnYouTubeIframeAPIReady=function(){_oldOnYouTubeIframeAPIReady=window.onYouTubeIframeAPIReady||void 0,window.onYouTubeIframeAPIReady=function(){window.onYouTubeIframeAPIReady.resolve()},window.onYouTubeIframeAPIReady.resolve=_youtubeApiDeferred.resolve,window.onYouTubeIframeAPIReady.done=_youtubeApiDeferred.done,_oldOnYouTubeIframeAPIReady&&window.onYouTubeIframeAPIReady.done(_oldOnYouTubeIframeAPIReady)},_youtubeApiDeferred?window.onYouTubeIframeAPIReady&&window.onYouTubeIframeAPIReady.done||setupOnYouTubeIframeAPIReady():(_youtubeApiDeferred=$.Deferred(),setupOnYouTubeIframeAPIReady(),_loadYoutubeApi(state)),window.onYouTubeIframeAPIReady.done(function(){window.YT.ready(function(){onYTApiReady()})}))):(video=VideoPlayer(state),state.modules.push(video),state.__dfd__.resolve())}function _loadYoutubeApi(state){console.log("[Video info]: YouTube API is not loaded. Will try to load..."),window.setTimeout(function(){_reportToServer(state,state.youtubeApiAvailable)},state.config.ytTestTimeout),$.getScript(document.location.protocol+"//"+state.config.ytApiUrl)}function _reportToServer(state,youtubeIsAvailable){youtubeIsAvailable||console.log("[Video info]: YouTube API is not available."),state.saveState(!0,{youtube_is_available:youtubeIsAvailable})}function _configureCaptions(state){state.config.showCaptions?state.hide_captions="true"===$.cookie("hide_captions"):(state.hide_captions=!0,$.cookie("hide_captions",state.hide_captions,{expires:3650,path:"/"}),state.el.addClass("closed"))}function _parseYouTubeIDs(state){return state.parseYoutubeStreams(state.config.streams)?(state.videoType="youtube",!0):(console.log("[Video info]: Youtube Video IDs are incorrect or absent."),!1)}function _prepareHTML5Video(state){return state.speeds=["0.75","1.0","1.25","1.50"],state.config.sources.length?(state.videoType="html5",state.config.sub&&state.config.sub.length||(state.config.sub="",state.config.showCaptions=!1),state.setSpeed(state.speed),!0):(_hideWaitPlaceholder(state),state.el.find(".video-player div").addClass("hidden").end().find(".video-player h3").removeClass("hidden"),!1)}function _hideWaitPlaceholder(state){state.el.addClass("is-initialized").find(".spinner").attr({"aria-hidden":"true",tabindex:-1})}function _setConfigurations(state){_configureCaptions(state),state.setPlayerMode(state.config.mode),state.controlState="visible",state.controlHideTimeout=null,state.captionState="invisible",state.captionHideTimeout=null}function _initializeModules(state,i18n){var dfd=$.Deferred(),modulesList=$.map(state.modules,function(module){return $.isFunction(module)?module(state,i18n):$.isPlainObject(module)?module:void 0});return $.when.apply(null,modulesList).done(dfd.resolve),dfd.promise()}function _getConfiguration(data,storage){var isBoolean=function(value){var regExp=/^true$/i;return regExp.test(value.toString())},extractKeys=[],compatKeys={start:"startTime",end:"endTime"},conversions={showCaptions:isBoolean,autoplay:isBoolean,autohideHtml5:isBoolean,savedVideoPosition:function(value){return storage.getItem("savedVideoPosition",!0)||Number(value)||0},speed:function(value){return storage.getItem("speed",!0)||value},generalSpeed:function(value){return storage.getItem("general_speed")||value||"1.0"},transcriptLanguage:function(value){return storage.getItem("language")||value||"en"},ytTestTimeout:function(value){return value=parseInt(value,10),isFinite(value)||(value=1500),value},startTime:function(value){return value=parseInt(value,10),!isFinite(value)||0>value?0:value},endTime:function(value){return value=parseInt(value,10),isFinite(value)&&0!==value?value:null}},config={};return $.each(data,function(option,value){if(-1===$.inArray(option,extractKeys)){if(compatKeys[option]&&(option=compatKeys[option]),conversions[option]){if(!$.isFunction(conversions[option]))throw new TypeError(option+" is not a function.");value=conversions[option].call(this,value)}config[option]=value}}),config}function bindTo(methodsDict,obj,context,rewrite){$.each(methodsDict,function(name,method){_.isFunction(method)&&(_.isUndefined(rewrite)&&(rewrite=!0),(_.isUndefined(obj[name])||rewrite)&&(obj[name]=_.bind(method,context)))})}function initialize(element){var self=this,el=$(element).find(".video"),container=el.find(".video-wrapper"),id=el.attr("id").replace(/video_/,""),__dfd__=$.Deferred(),isTouch=onTouchBasedDevice()||"",storage=VideoStorage("VideoState",id);if(isTouch&&el.addClass("is-touch"),$.extend(this,{__dfd__:__dfd__,el:el,container:container,id:id,isFullScreen:!1,isTouch:isTouch,storage:storage}),console.log('[Video info]: Initializing video with id "'+id+'".'),this.config=$.extend({},_getConfiguration(el.data(),storage),{element:element,fadeOutTimeout:1400,captionsFreezeTime:1e4,mode:$.cookie("edX_video_player_mode"),availableHDQualities:[]}),this.config.endTime<this.config.startTime&&(this.config.endTime=null),this.lang=this.config.transcriptLanguage,this.speed=this.speedToString(this.config.speed||this.config.generalSpeed),_parseYouTubeIDs(this))this.youtubeXhr||(this.youtubeXhr=this.getVideoMetadata()),this.youtubeXhr.always(function(json,status){var err=$.isPlainObject(json.error)||"success"!==status&&"notmodified"!==status;err?(console.log('[Video info]: YouTube returned an error for video with id "'+id+'".'),_prepareHTML5Video(self)?(console.log("[Video info]: Change player mode to HTML5."),el.find("a.quality_control").hide()):(console.log("[Video info]: Continue loading YouTube video."),el.find(".video-player div").removeClass("hidden"),el.find(".video-player h3").addClass("hidden"),self.fetchMetadata(),self.parseSpeed())):(console.log("[Video info]: Start player in YouTube mode."),self.fetchMetadata(),self.parseSpeed()),_setConfigurations(self),_renderElements(self)});else{if(!_prepareHTML5Video(this))return __dfd__.reject(),__dfd__.promise();console.log("[Video info]: Start player in HTML5 mode."),_setConfigurations(this),_renderElements(this)}return __dfd__.promise()}function parseYoutubeStreams(youtubeStreams){var _this;return"undefined"==typeof youtubeStreams||0===youtubeStreams.length?!1:(_this=this,this.videos={},$.each(youtubeStreams.split(/,/),function(index,video){var speed;video=video.split(/:/),speed=_this.speedToString(video[0]),_this.videos[speed]=video[1]}),_.isString(this.videos["1.0"]))}function fetchMetadata(){var _this=this,metadataXHRs=[];this.metadata={},$.each(this.videos,function(speed,url){var xhr=_this.getVideoMetadata(url,function(data){data.data&&(_this.metadata[data.data.id]=data.data)});metadataXHRs.push(xhr)}),$.when.apply(this,metadataXHRs).done(function(){_this.el.trigger("metadata_received"),_this.youtubeMetadataReceived=!0})}function parseSpeed(){this.speeds=$.map(this.videos,function(url,speed){return speed}).sort()}function setSpeed(newSpeed,updateStorage){var map={.25:"0.75","0.50":"0.75",.75:"0.50",1.25:"1.50","2.0":"1.50"};_.contains(this.speeds,newSpeed)?this.speed=newSpeed:(newSpeed=map[newSpeed],this.speed=_.contains(this.speeds,newSpeed)?newSpeed:"1.0"),updateStorage&&(this.storage.setItem("speed",this.speed,!0),this.storage.setItem("general_speed",this.speed))}function getVideoMetadata(url,callback){var successHandler,xhr;return"string"!=typeof url&&(url=this.videos["1.0"]||""),successHandler=$.isFunction(callback)?callback:null,xhr=$.ajax({url:[document.location.protocol,"//",this.config.ytTestUrl,url,"?v=2&alt=jsonc"].join(""),dataType:"jsonp",timeout:this.config.ytTestTimeout,success:successHandler})}function saveState(async,data){$.isPlainObject(data)||(data={saved_video_position:this.videoPlayer.currentTime}),data.speed&&this.storage.setItem("speed",data.speed,!0),data.hasOwnProperty("saved_video_position")&&(this.storage.setItem("savedVideoPosition",data.saved_video_position,!0),data.saved_video_position=Time.formatFull(data.saved_video_position)),$.ajax({url:this.config.saveStateUrl,type:"POST",async:async?!0:!1,dataType:"json",data:data})}function youtubeId(speed){var currentSpeed=this.isFlashMode()?this.speed:"1.0";return this.videos[speed]||this.videos[currentSpeed]||this.videos["1.0"]}function getDuration(){try{return this.metadata[this.youtubeId()].duration}catch(err){return _.result(this.metadata[this.youtubeId("1.0")],"duration")||0}}function setPlayerMode(mode){var supportedModes=["html5","flash"];mode=_.contains(supportedModes,mode)?mode:"html5",this.currentPlayerMode=mode
}function getPlayerMode(){return this.currentPlayerMode}function isFlashMode(){return"flash"===this.getPlayerMode()}function isHtml5Mode(){return"html5"===this.getPlayerMode()}function isYoutubeType(){return"youtube"===this.videoType}function speedToString(speed){return parseFloat(speed).toFixed(2).replace(/\.00$/,".0")}function getCurrentLanguage(){var keys=_.keys(this.config.transcriptLanguages);return keys.length?(_.contains(keys,this.lang)||(this.lang=_.contains(keys,"en")?"en":keys.pop()),this.lang):null}function trigger(objChain){var i,tmpObj,chain,extraParameters=Array.prototype.slice.call(arguments,1);for(tmpObj=this,chain=objChain.split(".");chain.length;){if(i=chain.shift(),!tmpObj.hasOwnProperty(i))return!1;tmpObj=tmpObj[i]}return tmpObj.apply(this,extraParameters),!0}var _oldOnYouTubeIframeAPIReady,Initialize=function(state,element){_makeFunctionsPublic(state),state.initialize(element).done(function(){return/iP(hone|od)/i.test(state.isTouch[0])?(_hideWaitPlaceholder(state),state.el.trigger("initialize",arguments),!1):void _initializeModules(state,i18n).done(function(){/iPad|Android/i.test(state.isTouch[0])?state.el.on("play",_.once(function(){state.trigger("videoControl.show",null)})):state.trigger("videoControl.show",null),_hideWaitPlaceholder(state),state.el.trigger("initialize",arguments)})})},methodsDict={bindTo:bindTo,fetchMetadata:fetchMetadata,getCurrentLanguage:getCurrentLanguage,getDuration:getDuration,getPlayerMode:getPlayerMode,getVideoMetadata:getVideoMetadata,initialize:initialize,isHtml5Mode:isHtml5Mode,isFlashMode:isFlashMode,isYoutubeType:isYoutubeType,parseSpeed:parseSpeed,parseYoutubeStreams:parseYoutubeStreams,saveState:saveState,setPlayerMode:setPlayerMode,setSpeed:setSpeed,speedToString:speedToString,trigger:trigger,youtubeId:youtubeId},_youtubeApiDeferred=null;return Initialize.prototype=methodsDict,Initialize})}(RequireJS.requirejs,RequireJS.require,RequireJS.define),function(requirejs,require,define){define("GLabelElOutput",[],function(){function GLabelElOutput(config,state){function processFuncObj(obj){var paramNames,funcString,func,disableAutoReturn;if("string"==typeof obj["@output"]&&"plot_label"===obj["@output"].toLowerCase()){if("string"!=typeof obj["@el_id"])return void console.log('ERROR: You specified "output" as "plot_label", but did not spify "el_id".');if("string"!=typeof obj["#text"])return void console.log("ERROR: Function body is not defined.");disableAutoReturn=obj["@disable_auto_return"],funcString=obj["#text"],void 0===disableAutoReturn||"string"==typeof disableAutoReturn&&"true"!==disableAutoReturn.toLowerCase()?-1===funcString.search(/return/i)&&(funcString="return "+funcString):-1===funcString.search(/return/i)&&console.log('ERROR: You have specified a JavaScript function without a "return" statemnt. Your function will return "undefined" by default.'),funcString=$("<div>").html(funcString).text(),paramNames=state.getAllParameterNames(),paramNames.push(funcString);try{func=Function.apply(null,paramNames)}catch(err){return console.log('ERROR: The function body "'+funcString+'" was not converted by the Function constructor.'),console.log('Error message: "'+err.message+'".'),state.showDebugInfo&&($("#"+gstId).html('<div style="color: red;">ERROR IN XML: Could not create a function from string "'+funcString+'".</div>'),$("#"+gstId).append('<div style="color: red;">Error message: "'+err.message+'".</div>')),void paramNames.pop()}paramNames.pop(),state.plde.push({elId:obj["@el_id"],func:func})}}$.isPlainObject(config.functions["function"])?processFuncObj(config.functions["function"]):$.isArray(config.functions["function"])&&!function(c1){for(;c1<config.functions["function"].length;)$.isPlainObject(config.functions["function"][c1])&&processFuncObj(config.functions["function"][c1]),c1+=1}(0)}return GLabelElOutput})}(RequireJS.requirejs,RequireJS.require,RequireJS.define),window.GraphicalSliderTool=function(el){RequireJS.require(["GstMain"],function(GstMain){$(el).children(".graphical_slider_tool").each(function(index,value){JavascriptLoader.executeModuleScripts($(value),function(){GstMain($(value).attr("id"))})})})},function(requirejs,require,define){define("video/025_focus_grabber.js",[],function(){function _makeFunctionsPublic(state){var methodsDict={disableFocusGrabber:disableFocusGrabber,enableFocusGrabber:enableFocusGrabber,onFocus:onFocus};state.bindTo(methodsDict,state.focusGrabber,state)}function _renderElements(state){state.focusGrabber.elFirst=state.el.find(".focus_grabber.first"),state.focusGrabber.elLast=state.el.find(".focus_grabber.last"),state.focusGrabber.disableFocusGrabber()}function _bindHandlers(state){state.focusGrabber.elFirst.on("focus",state.focusGrabber.onFocus),state.focusGrabber.elLast.on("focus",state.focusGrabber.onFocus),state.el.on("blur",function(){state.el.trigger("mousemove")})}function enableFocusGrabber(){var tabIndex;tabIndex=$(document.activeElement).parents().hasClass("video")?-1:0,this.focusGrabber.elFirst.attr("tabindex",tabIndex),this.focusGrabber.elLast.attr("tabindex",tabIndex),-1===tabIndex&&(this.el.focus(),this.focusGrabber.elFirst.attr("tabindex",0),this.focusGrabber.elLast.attr("tabindex",0))}function disableFocusGrabber(){this.focusGrabber.elFirst.attr("tabindex",-1),this.focusGrabber.elLast.attr("tabindex",-1)}function onFocus(){this.el.trigger("mousemove"),this.focusGrabber.disableFocusGrabber()}return function(state){var dfd=$.Deferred();return state.focusGrabber={},_makeFunctionsPublic(state),_renderElements(state),_bindHandlers(state),dfd.resolve(),dfd.promise()}})}(RequireJS.requirejs,RequireJS.require,RequireJS.define),function(requirejs,require,define){define("video/02_html5_video.js",[],function(){var HTML5Video={};return HTML5Video.Player=function(){function Player(el,config){var sourceList,_this,errorMessage,lastSource,isTouch=onTouchBasedDevice()||"";if(this.logs=[],this.el=$(el),0===this.el.length&&(this.el=$("#"+el),0===this.el.length)){if(errorMessage=gettext("VideoPlayer: Element corresponding to the given selector was not found."),!window.console||!console.log)throw new Error(errorMessage);return void console.log(errorMessage)}if($.isPlainObject(config)&&(this.config=config,config.videoSources||config.videoSources.length)){_this=this,sourceList=$.map(config.videoSources,function(source){return["<source ",'src="',source,-1===source.indexOf("?")?"?":"&",(new Date).getTime(),'" />'].join("")}),this.video=document.createElement("video"),errorMessage=[gettext("This browser cannot play .mp4, .ogg, or .webm files."),gettext("Try using a different browser, such as Google Chrome.")].join(""),this.video.innerHTML=sourceList.join("")+errorMessage,this.videoEl=$(this.video),lastSource=this.videoEl.find("source").last(),lastSource.on("error",this.showErrorMessage.bind(this)),/iP(hone|od)/i.test(isTouch[0])&&this.videoEl.prop("controls",!0),this.playerState=HTML5Video.PlayerState.UNSTARTED,this.videoEl.on("click",function(){var PlayerState=HTML5Video.PlayerState;_this.playerState===PlayerState.PLAYING?(_this.pauseVideo(),_this.playerState=PlayerState.PAUSED,_this.callStateChangeCallback()):(_this.playVideo(),_this.playerState=PlayerState.PLAYING,_this.callStateChangeCallback())});var events=["loadstart","progress","suspend","abort","error","emptied","stalled","play","pause","loadedmetadata","loadeddata","waiting","playing","canplay","canplaythrough","seeking","seeked","timeupdate","ended","ratechange","durationchange","volumechange"];this.debug=!1,$.each(events,function(index,eventName){_this.video.addEventListener(eventName,function(){_this.logs.push({"event name":eventName,state:_this.playerState}),_this.debug&&console.log("event name:",eventName,"state:",_this.playerState,"readyState:",_this.video.readyState,"networkState:",_this.video.networkState),el.trigger("html5:"+eventName,arguments)})}),this.video.addEventListener("loadedmetadata",function(){_this.playerState=HTML5Video.PlayerState.PAUSED,$.isFunction(_this.config.events.onReady)&&_this.config.events.onReady(null)},!1),this.video.addEventListener("play",function(){_this.playerState=HTML5Video.PlayerState.BUFFERING,_this.callStateChangeCallback()},!1),this.video.addEventListener("playing",function(){_this.playerState=HTML5Video.PlayerState.PLAYING,_this.callStateChangeCallback()},!1),this.video.addEventListener("pause",function(){_this.playerState=HTML5Video.PlayerState.PAUSED,_this.callStateChangeCallback()},!1),this.video.addEventListener("ended",function(){_this.playerState=HTML5Video.PlayerState.ENDED,_this.callStateChangeCallback()},!1),this.videoEl.appendTo(this.el.find(".video-player div"))}}return Player.prototype.callStateChangeCallback=function(){$.isFunction(this.config.events.onStateChange)&&this.config.events.onStateChange({data:this.playerState})},Player.prototype.pauseVideo=function(){this.video.pause()},Player.prototype.seekTo=function(value){"number"==typeof value&&value<=this.video.duration&&value>=0&&(this.video.currentTime=value)},Player.prototype.setVolume=function(value){"number"==typeof value&&100>=value&&value>=0&&(this.video.volume=.01*value)},Player.prototype.getCurrentTime=function(){return this.video.currentTime},Player.prototype.playVideo=function(){this.video.play()},Player.prototype.getPlayerState=function(){return this.playerState},Player.prototype.getVolume=function(){return this.video.volume},Player.prototype.getDuration=function(){return isNaN(this.video.duration)?0:this.video.duration},Player.prototype.setPlaybackRate=function(value){var newSpeed;newSpeed=parseFloat(value),isFinite(newSpeed)&&this.video.playbackRate!==value&&(this.video.playbackRate=value)},Player.prototype.getAvailablePlaybackRates=function(){return[.75,1,1.25,1.5]},Player.prototype._getLogs=function(){return this.logs},Player.prototype.showErrorMessage=function(){this.el.find(".video-player div").addClass("hidden").end().find(".video-player h3").removeClass("hidden").end().addClass("is-initialized").find(".spinner").attr({"aria-hidden":"true",tabindex:-1})},Player}(),HTML5Video.PlayerState={UNSTARTED:-1,ENDED:0,PLAYING:1,PAUSED:2,BUFFERING:3,CUED:5},HTML5Video})}(RequireJS.requirejs,RequireJS.require,RequireJS.define),function(requirejs,require,define){define("video/03_video_player.js",["video/02_html5_video.js","video/00_resizer.js"],function(HTML5Video,Resizer){function _makeFunctionsPublic(state){var debouncedF=_.debounce(function(params){return onSeek.call(this,params)}.bind(state),300);state.bindTo(methodsDict,state.videoPlayer,state),state.videoPlayer.onSlideSeek=debouncedF,state.videoPlayer.onCaptionSeek=debouncedF}function _initialize(state){var youTubeId,player;state.videoPlayer.ready=_.once(function(){$(window).on("unload",state.saveState),state.isFlashMode()||"1.0"==state.speed||state.videoPlayer.setPlaybackRate(state.speed,!0)}),state.isYoutubeType()?(state.videoPlayer.PlayerState=YT.PlayerState,state.videoPlayer.PlayerState.UNSTARTED=-1):state.videoPlayer.PlayerState=HTML5Video.PlayerState,state.videoPlayer.currentTime=0,state.videoPlayer.goToStartTime=!0,state.videoPlayer.stopAtEndTime=!0,state.videoPlayer.playerVars={controls:0,wmode:"transparent",rel:0,showinfo:0,enablejsapi:1,modestbranding:1},state.isFlashMode()||(state.videoPlayer.playerVars.html5=1),state.browserIsFirefox=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,"html5"===state.videoType?(state.videoPlayer.player=new HTML5Video.Player(state.el,{playerVars:state.videoPlayer.playerVars,videoSources:state.config.sources,events:{onReady:state.videoPlayer.onReady,onStateChange:state.videoPlayer.onStateChange}}),player=state.videoEl=state.videoPlayer.player.videoEl,player[0].addEventListener("loadedmetadata",function(){var videoWidth=player[0].videoWidth||player.width(),videoHeight=player[0].videoHeight||player.height();_resize(state,videoWidth,videoHeight),_updateVcrAndRegion(state)},!1)):(youTubeId=state.youtubeId(),state.videoPlayer.player=new YT.Player(state.id,{playerVars:state.videoPlayer.playerVars,videoId:youTubeId,events:{onReady:state.videoPlayer.onReady,onStateChange:state.videoPlayer.onStateChange,onPlaybackQualityChange:state.videoPlayer.onPlaybackQualityChange}}),state.el.on("initialize",function(){var player=state.videoEl=state.el.find("iframe"),videoWidth=player.attr("width")||player.width(),videoHeight=player.attr("height")||player.height();_resize(state,videoWidth,videoHeight),_updateVcrAndRegion(state,!0)})),state.isTouch&&dfd.resolve()}function _updateVcrAndRegion(state,isYoutube){var update=function(state){var time,duration=state.videoPlayer.duration();time=state.videoPlayer.figureOutStartingTime(duration),state.trigger("videoControl.updateVcrVidTime",{time:time,duration:duration}),state.trigger("videoProgressSlider.updateStartEndTimeRegion",{duration:duration}),state.trigger("videoProgressSlider.updatePlayTime",{time:time,duration:duration})};state.youtubeMetadataReceived||!isYoutube?update(state):state.el.on("metadata_received",function(){update(state)})}function _resize(state,videoWidth,videoHeight){state.resizer=new Resizer({element:state.videoEl,elementRatio:videoWidth/videoHeight,container:state.container}).callbacks.once(function(){state.el.trigger("caption:resize")}).setMode("width"),/iPad|Android/i.test(state.isTouch[0])&&state.el.on("controls:show",function(){state.el.trigger("caption:resize")}),$(window).on("resize",_.debounce(function(){state.trigger("videoControl.updateControlsHeight",null),state.el.trigger("caption:resize"),state.resizer.align()},100))}function _restartUsingFlash(state){state.videoPlayer.player.destroy(),state.setPlayerMode("flash"),console.log('[Video info]: Changing YouTube player mode to "flash".'),delete state.videoPlayer.playerVars.html5,state.videoPlayer.player=new YT.Player(state.id,{playerVars:state.videoPlayer.playerVars,videoId:state.youtubeId(),events:{onReady:state.videoPlayer.onReady,onStateChange:state.videoPlayer.onStateChange,onPlaybackQualityChange:state.videoPlayer.onPlaybackQualityChange}}),_updateVcrAndRegion(state,!0),state.el.trigger("caption:fetch"),state.resizer.setElement(state.el.find("iframe")).align()}function pause(){this.videoPlayer.player.pauseVideo&&this.videoPlayer.player.pauseVideo()}function play(){this.videoPlayer.player.playVideo&&(this.videoPlayer.isEnded()&&(this.videoPlayer.goToStartTime=!0,this.videoPlayer.stopAtEndTime=!0),this.videoPlayer.player.playVideo())}function update(time){this.videoPlayer.currentTime=time||this.videoPlayer.player.getCurrentTime(),isFinite(this.videoPlayer.currentTime)&&(this.videoPlayer.updatePlayTime(this.videoPlayer.currentTime),this.videoPlayer.stopAtEndTime&&null!==this.videoPlayer.endTime&&this.videoPlayer.endTime<=this.videoPlayer.currentTime&&(this.videoPlayer.stopAtEndTime=!1,this.videoPlayer.pause(),this.trigger("videoProgressSlider.notifyThroughHandleEnd",{end:!0})))}function setPlaybackRate(newSpeed,useCueVideoById){var methodName,youtubeId,duration=this.videoPlayer.duration(),time=this.videoPlayer.currentTime;!this.isHtml5Mode()||this.browserIsFirefox&&(useCueVideoById||"1.0"===newSpeed)&&this.isYoutubeType()?(methodName="cueVideoById",youtubeId=this.youtubeId(newSpeed),this.videoPlayer.isPlaying()&&(methodName="loadVideoById"),this.videoPlayer.player[methodName](youtubeId,time),_.isUndefined(time)||this.videoPlayer.updatePlayTime(time),time>0&&this.isFlashMode()&&(this.videoPlayer.seekTo(time),this.trigger("videoProgressSlider.updateStartEndTimeRegion",{duration:duration})),this.isHtml5Mode()&&"1.0"!=newSpeed&&this.videoPlayer.player.setPlaybackRate(newSpeed)):this.videoPlayer.player.setPlaybackRate(newSpeed)}function onSpeedChange(newSpeed){var time=this.videoPlayer.currentTime;this.isFlashMode()&&(this.videoPlayer.currentTime=Time.convert(time,parseFloat(this.speed),newSpeed)),newSpeed=parseFloat(newSpeed).toFixed(2).replace(/\.00$/,".0"),this.videoPlayer.log("speed_change_video",{current_time:time,old_speed:this.speed,new_speed:newSpeed}),this.setSpeed(newSpeed,!0),this.videoPlayer.setPlaybackRate(newSpeed),this.saveState(!0,{speed:newSpeed})}function onSeek(params){var time=params.time,type=params.type,oldTime=this.videoPlayer.currentTime;this.videoPlayer.goToStartTime=!1,(time>this.videoPlayer.endTime||null===this.videoPlayer.endTime)&&(this.videoPlayer.stopAtEndTime=!1),this.videoPlayer.seekTo(time),this.videoPlayer.log("seek_video",{old_time:oldTime,new_time:time,type:type})}function seekTo(time){var duration=this.videoPlayer.duration();if("number"!=typeof time||time>duration||0>time)return!1;this.el.off("play.seek"),this.videoPlayer.isPlaying()?this.videoPlayer.stopTimer():this.videoPlayer.currentTime=time;var isUnplayed=this.videoPlayer.isUnstarted()||this.videoPlayer.isCued();isUnplayed&&this.isYoutubeType()?this.videoPlayer.player.cueVideoById(this.youtubeId(),time):this.isYoutubeType()&&this.videoPlayer.isBuffering()?this.el.on("play.seek",function(){this.videoPlayer.player.seekTo(time,!0)}.bind(this)):this.videoPlayer.player.seekTo(time,!0),this.videoPlayer.updatePlayTime(time,!0),this.el.trigger("seek",arguments),this.videoPlayer.isPlaying()&&this.videoPlayer.runTimer()}function runTimer(){this.videoPlayer.updateInterval||(this.videoPlayer.updateInterval=window.setInterval(this.videoPlayer.update,200),this.videoPlayer.update())}function stopTimer(){window.clearInterval(this.videoPlayer.updateInterval),delete this.videoPlayer.updateInterval}function onEnded(){var time=this.videoPlayer.duration();this.videoPlayer.log("stop_video",{currentTime:this.videoPlayer.currentTime}),this.trigger("videoControl.pause",null),this.trigger("videoProgressSlider.notifyThroughHandleEnd",{end:!0}),this.videoPlayer.skipOnEndedStartEndReset&&(this.videoPlayer.skipOnEndedStartEndReset=void 0),this.videoPlayer.updatePlayTime(time),this.el.trigger("ended",arguments)}function onPause(){this.videoPlayer.log("pause_video",{currentTime:this.videoPlayer.currentTime}),this.videoPlayer.stopTimer(),this.trigger("videoControl.pause",null),this.saveState(!0),this.el.trigger("pause",arguments)}function onPlay(){this.videoPlayer.log("play_video",{currentTime:this.videoPlayer.currentTime}),this.videoPlayer.runTimer(),this.trigger("videoControl.play",null),this.trigger("videoProgressSlider.notifyThroughHandleEnd",{end:!1}),this.videoPlayer.ready(),this.el.trigger("play",arguments)}function onUnstarted(){}function handlePlaybackQualityChange(value){this.videoPlayer.player.setPlaybackQuality(value)}function onPlaybackQualityChange(){var quality;quality=this.videoPlayer.player.getPlaybackQuality(),this.trigger("videoQualityControl.onQualityChange",quality),this.el.trigger("qualitychange",arguments)}function onReady(){var availablePlaybackRates,baseSpeedSubs,_this=this;if(dfd.resolve(),this.el.on("speedchange",function(event,speed){_this.videoPlayer.onSpeedChange(speed)}),this.el.on("volumechange volumechange:silent",function(event,volume){_this.videoPlayer.onVolumeChange(volume)}),this.videoPlayer.log("load_video"),availablePlaybackRates=this.videoPlayer.player.getAvailablePlaybackRates(),availablePlaybackRates=_.filter(availablePlaybackRates,function(item){var speed=Number(item);return speed>.25&&5>=speed}),(this.isHtml5Mode()||availablePlaybackRates.length>1)&&this.isYoutubeType()){if(1===availablePlaybackRates.length&&!this.isTouch)return _restartUsingFlash(this),!1;availablePlaybackRates.length>1&&(this.setPlayerMode("html5"),baseSpeedSubs=this.videos["1.0"],$.each(this.videos,function(index){delete _this.videos[index]}),this.speeds=[],$.each(availablePlaybackRates,function(index,value){var key=value.toFixed(2).replace(/\.00$/,".0");_this.videos[key]=baseSpeedSubs,_this.speeds.push(key)}),this.setSpeed(this.speed),this.el.trigger("speed:render",[this.speeds,this.speed]))}this.isFlashMode()&&(this.setSpeed(this.speed),this.el.trigger("speed:set",[this.speed])),this.isHtml5Mode()&&this.videoPlayer.player.setPlaybackRate(this.speed);var duration=this.videoPlayer.duration(),time=this.videoPlayer.figureOutStartingTime(duration);time>0&&this.videoPlayer.goToStartTime&&this.videoPlayer.seekTo(time),this.el.trigger("ready",arguments)}function onStateChange(event){switch(this.el.removeClass(["is-unstarted","is-playing","is-paused","is-buffered","is-ended","is-cued"].join(" ")),event.data){case this.videoPlayer.PlayerState.UNSTARTED:this.el.addClass("is-unstarted"),this.videoPlayer.onUnstarted();break;case this.videoPlayer.PlayerState.PLAYING:this.el.addClass("is-playing"),this.videoPlayer.onPlay();break;case this.videoPlayer.PlayerState.PAUSED:this.el.addClass("is-paused"),this.videoPlayer.onPause();break;case this.videoPlayer.PlayerState.BUFFERING:this.el.addClass("is-buffered"),this.el.trigger("buffering");break;case this.videoPlayer.PlayerState.ENDED:this.el.addClass("is-ended"),this.videoPlayer.onEnded();break;case this.videoPlayer.PlayerState.CUED:this.el.addClass("is-cued"),this.isFlashMode()&&this.videoPlayer.play()}}function figureOutStartEndTime(duration){var videoPlayer=this.videoPlayer;videoPlayer.startTime=this.config.startTime,videoPlayer.startTime>=duration?videoPlayer.startTime=0:this.isFlashMode()&&(videoPlayer.startTime/=Number(this.speed)),videoPlayer.endTime=this.config.endTime,videoPlayer.endTime<=videoPlayer.startTime||videoPlayer.endTime>=duration?(videoPlayer.stopAtEndTime=!1,videoPlayer.endTime=null):this.isFlashMode()&&(videoPlayer.endTime/=Number(this.speed))}function figureOutStartingTime(duration){var startTime,endTime,savedVideoPosition=this.config.savedVideoPosition,time=0;return this.videoPlayer.figureOutStartEndTime(duration),startTime=this.videoPlayer.startTime,endTime=this.videoPlayer.endTime,startTime>0?time=savedVideoPosition>startTime&&(endTime>savedVideoPosition||null===endTime)&&duration-1>savedVideoPosition?savedVideoPosition:startTime:savedVideoPosition>0&&(endTime>savedVideoPosition||null===endTime)&&duration-1>savedVideoPosition&&(time=savedVideoPosition),time}function updatePlayTime(time){var duration=(this.videoPlayer,this.videoPlayer.duration());this.trigger("videoProgressSlider.updatePlayTime",{time:time,duration:duration}),this.trigger("videoControl.updateVcrVidTime",{time:time,duration:duration}),this.el.trigger("caption:update",[time])}function isEnded(){var playerState=this.videoPlayer.player.getPlayerState(),ENDED=this.videoPlayer.PlayerState.ENDED;return playerState===ENDED}function isPlaying(){var playerState=this.videoPlayer.player.getPlayerState();return playerState===this.videoPlayer.PlayerState.PLAYING}function isBuffering(){var playerState=this.videoPlayer.player.getPlayerState();return playerState===this.videoPlayer.PlayerState.BUFFERING}function isCued(){var playerState=this.videoPlayer.player.getPlayerState();return playerState===this.videoPlayer.PlayerState.CUED}function isUnstarted(){var playerState=this.videoPlayer.player.getPlayerState();return playerState===this.videoPlayer.PlayerState.UNSTARTED}function duration(){var dur;return this.videoPlayer.player.getDuration&&(dur=this.videoPlayer.player.getDuration()),(!isFinite(dur)||0>=dur)&&this.isYoutubeType()&&(dur=this.getDuration()),(!isFinite(dur)||0>=dur)&&(dur=0),Math.floor(dur)}function log(eventName,data){var logInfo;logInfo={id:this.id},data&&$.each(data,function(paramName,value){logInfo[paramName]=value}),logInfo.code=this.isYoutubeType()?this.youtubeId():"html5",Logger.log(eventName,logInfo)}function onVolumeChange(volume){this.videoPlayer.player.setVolume(volume)}var dfd=$.Deferred(),VideoPlayer=function(state){return state.videoPlayer={},_makeFunctionsPublic(state),_initialize(state),dfd.promise()},methodsDict={duration:duration,handlePlaybackQualityChange:handlePlaybackQualityChange,isBuffering:isBuffering,isCued:isCued,isEnded:isEnded,isPlaying:isPlaying,isUnstarted:isUnstarted,log:log,onCaptionSeek:onSeek,onEnded:onEnded,onPause:onPause,onPlay:onPlay,runTimer:runTimer,stopTimer:stopTimer,onPlaybackQualityChange:onPlaybackQualityChange,onReady:onReady,onSlideSeek:onSeek,onSpeedChange:onSpeedChange,onStateChange:onStateChange,onUnstarted:onUnstarted,onVolumeChange:onVolumeChange,pause:pause,play:play,seekTo:seekTo,setPlaybackRate:setPlaybackRate,update:update,figureOutStartEndTime:figureOutStartEndTime,figureOutStartingTime:figureOutStartingTime,updatePlayTime:updatePlayTime};return VideoPlayer.prototype=methodsDict,VideoPlayer})}(RequireJS.requirejs,RequireJS.require,RequireJS.define),function(requirejs,require,define){define("video/035_video_accessible_menu.js",[],function(){function _initialize(state){_makeFunctionsPublic(state),_renderElements(state),_addAriaAttributes(state),_bindHandlers(state)}function _makeFunctionsPublic(state){var methodsDict={changeFileType:changeFileType,setValue:setValue};state.bindTo(methodsDict,state.videoAccessibleMenu,state)}function _renderElements(state){var container=state.el.find("li.video-tracks>div.a11y-menu-container"),button=container.children("a.a11y-menu-button"),menuList=container.children("ol.a11y-menu-list"),menuItems=menuList.children("li.a11y-menu-item"),menuItemsLinks=menuItems.children("a.a11y-menu-item-link"),value=function(val,activeElement){return val||activeElement.find("a").data("value")||"srt"}(state.videoAccessibleMenu.value,menuItems.filter(".active")),msg="."+value;$.extend(state.videoAccessibleMenu,{container:container,button:button,menuList:menuList,menuItems:menuItems,menuItemsLinks:menuItemsLinks}),value&&(state.videoAccessibleMenu.setValue(value),button.text(gettext(msg)))}function _addAriaAttributes(state){var menu=state.videoAccessibleMenu;menu.button.attr({role:"button","aria-disabled":"false"}),menu.menuList.attr("role","menu"),menu.menuItemsLinks.each(function(){$(this).attr({role:"menuitem","aria-disabled":"false"})})}function _previousMenuItemLink(links,index){return $(links.eq(1>index?links.length-1:index-1))}function _nextMenuItemLink(links,index){return $(links.eq(index>=links.length-1?0:index+1))}function _menuItemsLinksFocused(menu){return menu.menuItemsLinks.is(":focus")}function _openMenu(menu,without_handler){menu.container.addClass("open"),menu.button.text("..."),without_handler||$(window).on("click.currentMenu",_closeMenuHandler.bind(menu))}function _closeMenu(menu,without_handler){var msg="."+menu.value;menu.container.removeClass("open"),menu.button.text(gettext(msg)),without_handler||$(window).off("click.currentMenu")}function _openMenuHandler(){return _openMenu(this,!0),!1}function _closeMenuHandler(event){return _menuItemsLinksFocused(this)&&"click"!=event.type||_closeMenu(this,!0),!1}function _toggleMenuHandler(){return this.container.hasClass("open")?_closeMenu(this,!0):_openMenu(this,!0),!1}function _clickHandler(event){$(event.currentTarget);return this.changeFileType.call(this,event),_closeMenu(this,!0),!1}function _keyDownHandler(event){var index,KEY=$.ui.keyCode,keyCode=event.keyCode,target=$(event.currentTarget);if(target.is("a.a11y-menu-item-link")){switch(index=target.parent().index(),keyCode){case KEY.UP:_previousMenuItemLink(this.menuItemsLinks,index).focus();break;case KEY.DOWN:_nextMenuItemLink(this.menuItemsLinks,index).focus();break;case KEY.TAB:_closeMenu(this);break;case KEY.ENTER:case KEY.SPACE:this.button.focus(),this.changeFileType.call(this,event),_closeMenu(this);break;case KEY.ESCAPE:_closeMenu(this),this.button.focus()}return!1}switch(keyCode){case KEY.ENTER:case KEY.SPACE:case KEY.UP:_openMenu(this),this.menuItemsLinks.last().focus();break;case KEY.ESCAPE:_closeMenu(this)}return event.keyCode===KEY.TAB}function _bindHandlers(state){var menu=state.videoAccessibleMenu;menu.container.on({mouseenter:_openMenuHandler.bind(menu),mouseleave:_closeMenuHandler.bind(menu),click:_toggleMenuHandler.bind(menu),keydown:_keyDownHandler.bind(menu)}),menu.menuItems.on("click","a.a11y-menu-item-link",_clickHandler.bind(menu)).on("keydown","a.a11y-menu-item-link",_keyDownHandler.bind(menu))}function setValue(value){var menu=this.videoAccessibleMenu;menu.value=value,menu.menuItems.removeClass("active").find("a[data-value='"+value+"']").parent().addClass("active")}function changeFileType(event){var fileType=$(event.currentTarget).data("value");this.videoAccessibleMenu.setValue(fileType),this.saveState(!0,{transcript_download_format:fileType}),this.storage.setItem("transcript_download_format",fileType)}return function(state){var dfd=$.Deferred();return 0===state.el.find("li.video-tracks")?(dfd.resolve(),dfd.promise()):(state.videoAccessibleMenu={value:state.storage.getItem("transcript_download_format")},_initialize(state),dfd.resolve(),dfd.promise())}})}(RequireJS.requirejs,RequireJS.require,RequireJS.define),function(requirejs,require,define){define("video/04_video_control.js",[],function(){function _makeFunctionsPublic(state){var methodsDict={exitFullScreenHandler:exitFullScreenHandler,hideControls:hideControls,hidePlayPlaceholder:hidePlayPlaceholder,pause:pause,play:play,show:show,showControls:showControls,showPlayPlaceholder:showPlayPlaceholder,toggleFullScreen:toggleFullScreen,toggleFullScreenHandler:toggleFullScreenHandler,togglePlayback:togglePlayback,updateControlsHeight:updateControlsHeight,updateVcrVidTime:updateVcrVidTime};state.bindTo(methodsDict,state.videoControl,state)}function _renderElements(state){state.videoControl.el=state.el.find(".video-controls"),state.videoControl.sliderEl=state.videoControl.el.find(".slider"),state.videoControl.playPauseEl=state.videoControl.el.find(".video_control"),state.videoControl.playPlaceholder=state.el.find(".btn-play"),state.videoControl.secondaryControlsEl=state.videoControl.el.find(".secondary-controls"),state.videoControl.fullScreenEl=state.videoControl.el.find(".add-fullscreen"),state.videoControl.vidTimeEl=state.videoControl.el.find(".vidtime"),state.videoControl.fullScreenState=!1,state.videoControl.pause(),state.isTouch&&"html5"===state.videoType&&state.videoControl.showPlayPlaceholder(),"html5"===state.videoType&&state.config.autohideHtml5&&(state.videoControl.fadeOutTimeout=state.config.fadeOutTimeout,state.videoControl.el.addClass("html5"),state.controlHideTimeout=setTimeout(state.videoControl.hideControls,state.videoControl.fadeOutTimeout)),state.videoControl.sliderEl.find(".ui-slider-handle").attr({role:"slider",title:gettext("Video slider")}),state.videoControl.updateControlsHeight()}function _bindHandlers(state){state.videoControl.playPauseEl.on("click",state.videoControl.togglePlayback),state.videoControl.fullScreenEl.on("click",state.videoControl.toggleFullScreenHandler),state.el.on("fullscreen",function(event,isFullScreen){var height=state.videoControl.updateControlsHeight();isFullScreen?state.resizer.delta.substract(height,"height").setMode("both"):state.resizer.delta.reset().setMode("width")}),$(document).on("keyup",state.videoControl.exitFullScreenHandler),"html5"===state.videoType&&state.config.autohideHtml5&&(state.el.on("mousemove",state.videoControl.showControls),state.el.on("keydown",state.videoControl.showControls)),state.videoControl.playPauseEl.on("blur",function(){state.previousFocus="playPause"}),/iPad|Android/i.test(state.isTouch[0])&&state.videoControl.playPlaceholder.on("click",function(){state.trigger("videoPlayer.play",null)})}function _getControlsHeight(control){return control.el.height()+.5*control.sliderEl.height()}function updateControlsHeight(){return this.videoControl.height=_getControlsHeight(this.videoControl),this.videoControl.height}function show(){this.videoControl.el.removeClass("is-hidden"),this.el.trigger("controls:show",arguments)}function showControls(){if(!this.controlShowLock){if(!this.captionsHidden)return;this.controlShowLock=!0,"invisible"===this.controlState?(this.videoControl.el.show(),this.controlState="visible"):"hiding"===this.controlState?(this.videoControl.el.stop(!0,!1).css("opacity",1).show(),this.controlState="visible"):"visible"===this.controlState&&clearTimeout(this.controlHideTimeout),this.controlHideTimeout=setTimeout(this.videoControl.hideControls,this.videoControl.fadeOutTimeout),this.controlShowLock=!1}}function hideControls(){var _this;this.controlHideTimeout=null,this.captionsHidden&&(this.controlState="hiding",_this=this,this.videoControl.el.fadeOut(this.videoControl.fadeOutTimeout,function(){_this.controlState="invisible",_this.videoVolumeControl.el.removeClass("open"),_this.videoSpeedControl.el.removeClass("open"),_this.focusGrabber.enableFocusGrabber()
}))}function showPlayPlaceholder(){this.videoControl.playPlaceholder.removeClass("is-hidden").attr({"aria-hidden":"false",tabindex:0})}function hidePlayPlaceholder(){this.videoControl.playPlaceholder.addClass("is-hidden").attr({"aria-hidden":"true",tabindex:-1})}function play(){this.videoControl.isPlaying=!0,this.videoControl.playPauseEl.removeClass("play").addClass("pause").attr("title",gettext("Pause")),/iPad|Android/i.test(this.isTouch[0])&&"html5"===this.videoType&&this.videoControl.hidePlayPlaceholder()}function pause(){this.videoControl.isPlaying=!1,this.videoControl.playPauseEl.removeClass("pause").addClass("play").attr("title",gettext("Play")),/iPad|Android/i.test(this.isTouch[0])&&"html5"===this.videoType&&this.videoControl.showPlayPlaceholder()}function togglePlayback(event){event.preventDefault(),this.videoCommands.execute("togglePlayback")}function toggleFullScreenHandler(event){event.preventDefault(),this.videoCommands.execute("toggleFullScreen")}function toggleFullScreen(){var text,fullScreenClassNameEl=this.el.add(document.documentElement),win=$(window);this.videoControl.fullScreenState?(this.videoControl.fullScreenState=this.isFullScreen=!1,fullScreenClassNameEl.removeClass("video-fullscreen"),text=gettext("Fill browser"),win.scrollTop(this.scrollPos)):(this.scrollPos=win.scrollTop(),win.scrollTop(0),this.videoControl.fullScreenState=this.isFullScreen=!0,fullScreenClassNameEl.addClass("video-fullscreen"),text=gettext("Exit full browser")),this.videoControl.fullScreenEl.attr("title",text).text(text),this.el.trigger("fullscreen",[this.isFullScreen])}function exitFullScreenHandler(event){this.isFullScreen&&27===event.keyCode&&(event.preventDefault(),this.videoCommands.execute("toggleFullScreen"))}function updateVcrVidTime(params){this.videoControl.vidTimeEl.html(Time.format(params.time)+" / "+Time.format(params.duration))}return function(state){var dfd=$.Deferred();return state.videoControl={},_makeFunctionsPublic(state),_renderElements(state),_bindHandlers(state),dfd.resolve(),dfd.promise()}})}(RequireJS.requirejs,RequireJS.require,RequireJS.define),function(requirejs,require,define){define("video/05_video_quality_control.js",[],function(){function _makeFunctionsPublic(state){var methodsDict={fetchAvailableQualities:fetchAvailableQualities,onQualityChange:onQualityChange,showQualityControl:showQualityControl,toggleQuality:toggleQuality};state.bindTo(methodsDict,state.videoQualityControl,state)}function _renderElements(state){state.videoQualityControl.el=state.el.find("a.quality-control"),state.videoQualityControl.el.show(),state.videoQualityControl.quality="large"}function _bindHandlers(state){state.videoQualityControl.el.on("click",state.videoQualityControl.toggleQuality),state.el.on("play",_.once(function(){state.videoQualityControl.fetchAvailableQualities()}))}function showQualityControl(){this.videoQualityControl.el.removeClass("is-hidden")}function fetchAvailableQualities(){var qualities=this.videoPlayer.player.getAvailableQualityLevels();this.config.availableHDQualities=_.intersection(qualities,["highres","hd1080","hd720"]),this.config.availableHDQualities.length>0&&this.trigger("videoQualityControl.showQualityControl"),this.trigger("videoPlayer.handlePlaybackQualityChange",this.videoQualityControl.quality)}function onQualityChange(value){var controlStateStr;this.videoQualityControl.quality=value,_.contains(this.config.availableHDQualities,value)?(controlStateStr=gettext("HD on"),this.videoQualityControl.el.addClass("active").attr("title",controlStateStr).text(controlStateStr)):(controlStateStr=gettext("HD off"),this.videoQualityControl.el.removeClass("active").attr("title",controlStateStr).text(controlStateStr))}function toggleQuality(event){var newQuality,value=this.videoQualityControl.quality,isHD=_.contains(this.config.availableHDQualities,value);event.preventDefault(),newQuality=isHD?"large":"highres",this.trigger("videoPlayer.handlePlaybackQualityChange",newQuality)}return function(state){var dfd=$.Deferred();return"youtube"!==state.videoType?void state.el.find("a.quality-control").remove():(state.videoQualityControl={},_makeFunctionsPublic(state),_renderElements(state),_bindHandlers(state),dfd.resolve(),dfd.promise())}})}(RequireJS.requirejs,RequireJS.require,RequireJS.define),function(requirejs,require,define){define("video/06_video_progress_slider.js",[],function(){function _makeFunctionsPublic(state){var methodsDict={buildSlider:buildSlider,getRangeParams:getRangeParams,onSlide:onSlide,onStop:onStop,updatePlayTime:updatePlayTime,updateStartEndTimeRegion:updateStartEndTimeRegion,notifyThroughHandleEnd:notifyThroughHandleEnd,getTimeDescription:getTimeDescription};state.bindTo(methodsDict,state.videoProgressSlider,state)}function _renderElements(state){state.videoProgressSlider.el=state.videoControl.sliderEl,state.videoProgressSlider.buildSlider(),_buildHandle(state)}function _buildHandle(state){state.videoProgressSlider.handle=state.videoProgressSlider.el.find(".ui-slider-handle"),state.videoProgressSlider.el.attr("tabindex",-1),state.videoProgressSlider.handle.attr({role:"slider",title:gettext("Video position"),"aria-disabled":!1,"aria-valuetext":getTimeDescription(state.videoProgressSlider.slider.slider("option","value")),"aria-valuemax":state.videoPlayer.duration(),"aria-valuemin":"0","aria-valuenow":state.videoPlayer.currentTime})}function buildSlider(){this.videoProgressSlider.slider=this.videoProgressSlider.el.slider({range:"min",slide:this.videoProgressSlider.onSlide,stop:this.videoProgressSlider.onStop}),this.videoProgressSlider.sliderProgress=this.videoProgressSlider.slider.find(".ui-slider-range.ui-widget-header.ui-slider-range-min")}function updateStartEndTimeRegion(params){var start,end,duration,rangeParams;params.duration&&(duration=params.duration,start=this.config.startTime,end=this.config.endTime,start>duration?start=0:this.isFlashMode()&&(start/=Number(this.speed)),null===end||end>duration?end=duration:this.isFlashMode()&&(end/=Number(this.speed)),(0!==start||end!==duration)&&(rangeParams=getRangeParams(start,end,duration),this.videoProgressSlider.sliderRange?this.videoProgressSlider.sliderRange.css(rangeParams):(this.videoProgressSlider.sliderRange=$("<div />",{"class":"ui-slider-range ui-widget-header ui-corner-all slider-range"}).css({left:rangeParams.left,width:rangeParams.width}),this.videoProgressSlider.sliderProgress.after(this.videoProgressSlider.sliderRange))))}function getRangeParams(startTime,endTime,duration){var step=100/duration,left=startTime*step,width=endTime*step-left;return{left:left+"%",width:width+"%"}}function onSlide(event,ui){var time=ui.value,duration=this.videoPlayer.duration();this.videoProgressSlider.frozen=!0,this.videoProgressSlider.lastSeekValue=time,this.trigger("videoControl.updateVcrVidTime",{time:time,duration:duration}),this.trigger("videoPlayer.onSlideSeek",{type:"onSlideSeek",time:time}),this.videoProgressSlider.handle.attr("aria-valuetext",getTimeDescription(this.videoPlayer.currentTime))}function onStop(event,ui){var _this=this;this.videoProgressSlider.frozen=!0,this.videoProgressSlider.lastSeekValue!==ui.value&&this.trigger("videoPlayer.onSlideSeek",{type:"onSlideSeek",time:ui.value}),this.videoProgressSlider.handle.attr("aria-valuetext",getTimeDescription(this.videoPlayer.currentTime)),setTimeout(function(){_this.videoProgressSlider.frozen=!1},200)}function updatePlayTime(params){var time=Math.floor(params.time),duration=Math.floor(params.duration);this.videoProgressSlider.slider&&!this.videoProgressSlider.frozen&&this.videoProgressSlider.slider.slider("option","max",duration).slider("option","value",time),this.videoProgressSlider.handle.attr({"aria-valuemax":duration,"aria-valuenow":time})}function notifyThroughHandleEnd(params){params.end?this.videoProgressSlider.handle.attr("title",gettext("Video ended")).focus():this.videoProgressSlider.handle.attr("title",gettext("Video position"))}function getTimeDescription(time){var seconds=Math.floor(time),minutes=Math.floor(seconds/60),hours=Math.floor(minutes/60),i18n=function(value,word){var msg;switch(word){case"hour":msg=ngettext("%(value)s hour","%(value)s hours",value);break;case"minute":msg=ngettext("%(value)s minute","%(value)s minutes",value);break;case"second":msg=ngettext("%(value)s second","%(value)s seconds",value)}return interpolate(msg,{value:value},!0)};return seconds%=60,minutes%=60,hours?i18n(hours,"hour")+" "+i18n(minutes,"minute")+" "+i18n(seconds,"second"):minutes?i18n(minutes,"minute")+" "+i18n(seconds,"second"):i18n(seconds,"second")}return function(state){var dfd=$.Deferred();return state.videoProgressSlider={},_makeFunctionsPublic(state),_renderElements(state),dfd.resolve(),dfd.promise()}})}(RequireJS.requirejs,RequireJS.require,RequireJS.define),function(define){"use strict";define("video/07_video_volume_control.js",[],function(){var VolumeControl=function(state,i18n){return this instanceof VolumeControl?(this.state=state,this.state.videoVolumeControl=this,this.i18n=i18n,this.initialize(),$.Deferred().resolve().promise()):new VolumeControl(state,i18n)};VolumeControl.prototype={min:0,max:100,step:20,initialize:function(){var volume;return this.el=this.state.el.find(".volume"),this.state.isTouch?(this.el.remove(),!1):(this.state.el.find("iframe").attr("tabindex",-1),this.button=this.el.children("a"),this.cookie=new CookieManager(this.min,this.max),this.a11y=new Accessibility(this.button,this.min,this.max,this.i18n),volume=this.cookie.getVolume(),this.storedVolume=this.max,this.render(),this.bindHandlers(),this.setVolume(volume,!0,!1),void this.checkMuteButtonStatus(volume))},render:function(){var container=this.el.find(".volume-slider");this.volumeSlider=container.slider({orientation:"vertical",range:"min",min:this.min,max:this.max,slide:this.onSlideHandler.bind(this)}),container.find("a").attr("tabindex",-1)},bindHandlers:function(){this.state.el.on({keydown:this.keyDownHandler.bind(this),play:_.once(this.updateVolumeSilently.bind(this)),volumechange:this.onVolumeChangeHandler.bind(this)}),this.el.on({mouseenter:this.openMenu.bind(this),mouseleave:this.closeMenu.bind(this)}),this.button.on({click:!1,mousedown:this.toggleMuteHandler.bind(this),keydown:this.keyDownButtonHandler.bind(this),focus:this.openMenu.bind(this),blur:this.closeMenu.bind(this)})},updateVolumeSilently:function(){this.state.el.trigger("volumechange:silent",[this.getVolume()])},getVolume:function(){return this.volume},setVolume:function(volume,silent,withoutSlider){return volume===this.getVolume()?!1:(this.volume=volume,this.a11y.update(this.getVolume()),withoutSlider||this.updateSliderView(this.getVolume()),void(silent||(this.cookie.setVolume(this.getVolume()),this.state.el.trigger("volumechange",[this.getVolume()]))))},increaseVolume:function(){var volume=Math.min(this.getVolume()+this.step,this.max);this.setVolume(volume,!1,!1)},decreaseVolume:function(){var volume=Math.max(this.getVolume()-this.step,this.min);this.setVolume(volume,!1,!1)},updateSliderView:function(volume){this.volumeSlider.slider("value",volume)},mute:function(muteStatus){var volume;this.updateMuteButtonView(muteStatus),muteStatus&&(this.storedVolume=this.getVolume()||this.max),volume=muteStatus?0:this.storedVolume,this.setVolume(volume,!1,!1)},getMuteStatus:function(){return 0===this.getVolume()},updateMuteButtonView:function(isMuted){var action=isMuted?"addClass":"removeClass";this.el[action]("is-muted")},toggleMute:function(){this.mute(!this.getMuteStatus())},checkMuteButtonStatus:function(volume){volume<=this.min&&(this.updateMuteButtonView(!0),this.state.el.off("volumechange.is-muted"),this.state.el.on("volumechange.is-muted",_.once(function(){this.updateMuteButtonView(!1)}.bind(this))))},openMenu:function(){this.el.addClass("is-opened")},closeMenu:function(){this.el.removeClass("is-opened")},keyDownHandler:function(event){if(event.altKey)return!0;if($(event.target).hasClass("ui-slider-handle"))return!0;var KEY=$.ui.keyCode,keyCode=event.keyCode;switch(keyCode){case KEY.UP:return event.shiftKey?!0:(this.increaseVolume(),!1);case KEY.DOWN:return event.shiftKey?!0:(this.decreaseVolume(),!1)}return!0},keyDownButtonHandler:function(event){if(event.altKey)return!0;var KEY=$.ui.keyCode,keyCode=event.keyCode;switch(keyCode){case KEY.ENTER:case KEY.SPACE:return this.toggleMute(),!1}return!0},onSlideHandler:function(event,ui){this.setVolume(ui.value,!1,!0)},toggleMuteHandler:function(event){this.toggleMute(),event.preventDefault()},onVolumeChangeHandler:function(event,volume){this.checkMuteButtonStatus(volume)}};var Accessibility=function(button,min,max,i18n){this.min=min,this.max=max,this.button=button,this.i18n=i18n,this.initialize()};Accessibility.prototype={initialize:function(){this.liveRegion=$("<div />",{"class":"sr video-live-region",role:"status","aria-hidden":"false","aria-live":"polite","aria-atomic":"false"}),this.button.after(this.liveRegion)},update:function(volume){this.liveRegion.text([this.getVolumeDescription(volume),this.i18n.Volume+"."].join(" "))},getVolumeDescription:function(volume){return 0===volume?this.i18n.Muted:20>=volume?this.i18n["Very low"]:40>=volume?this.i18n.Low:60>=volume?this.i18n.Average:80>=volume?this.i18n.Loud:99>=volume?this.i18n["Very loud"]:this.i18n.Maximum}};var CookieManager=function(min,max){this.min=min,this.max=max,this.cookieName="video_player_volume_level"};return CookieManager.prototype={getVolume:function(){var volume=parseInt($.cookie(this.cookieName),10);return _.isFinite(volume)?(volume=Math.max(volume,this.min),volume=Math.min(volume,this.max)):volume=this.max,volume},setVolume:function(value){$.cookie(this.cookieName,value,{expires:3650,path:"/"})}},VolumeControl})}(RequireJS.define),function(requirejs,require,define){define("video/08_video_speed_control.js",["video/00_iterator.js"],function(Iterator){"use strict";var SpeedControl=function(state){return this instanceof SpeedControl?(this.state=state,this.state.videoSpeedControl=this,this.initialize(),$.Deferred().resolve().promise()):new SpeedControl(state)};return SpeedControl.prototype={initialize:function(){var state=this.state;return this.el=state.el.find(".speeds"),this.speedsContainer=this.el.find(".video-speeds"),this.speedButton=this.el.find(".speed-button"),this.isPlaybackRatesSupported(state)?(this.render(state.speeds,state.speed),this.bindHandlers(),!0):(this.el.remove(),console.log("[Video info]: playbackRate is not supported."),!1)},render:function(speeds,currentSpeed){var speedsContainer=this.speedsContainer,reversedSpeeds=speeds.concat().reverse(),speedsList=$.map(reversedSpeeds,function(speed){return['<li data-speed="',speed,'" role="presentation">','<a class="speed-link" href="#" role="menuitem" tabindex="-1">',speed,"x","</a>","</li>"].join("")});speedsContainer.html(speedsList.join("")),this.speedLinks=new Iterator(speedsContainer.find(".speed-link")),this.setSpeed(currentSpeed,!0,!0)},bindHandlers:function(){var self=this;this.el.on({mouseenter:this.mouseEnterHandler.bind(this),mouseleave:this.mouseLeaveHandler.bind(this),click:this.clickMenuHandler.bind(this),keydown:this.keyDownMenuHandler.bind(this)}),this.speedsContainer.on({click:this.clickLinkHandler.bind(this),keydown:this.keyDownLinkHandler.bind(this)},"a.speed-link"),this.state.el.on({"speed:set":function(event,speed){self.setSpeed(speed,!0)},"speed:render":function(event,speeds,currentSpeed){self.render(speeds,currentSpeed)}})},isPlaybackRatesSupported:function(state){var isHtml5="html5"===state.videoType,isTouch=state.isTouch,video=document.createElement("video");return!isTouch||isHtml5&&!Boolean(video.playbackRate)},openMenu:function(bindEvent){bindEvent&&$(window).on("click.speedMenu",this.clickMenuHandler.bind(this)),this.el.addClass("is-opened"),this.speedButton.attr("tabindex",-1)},closeMenu:function(unBindEvent){unBindEvent&&$(window).off("click.speedMenu"),this.el.removeClass("is-opened"),this.speedButton.attr("tabindex",0)},setSpeed:function(speed,silent,forceUpdate){(speed!==this.currentSpeed||forceUpdate)&&(this.speedsContainer.find("li").removeClass("is-active").siblings("li[data-speed='"+speed+"']").addClass("is-active"),this.speedButton.find(".value").html(speed+"x"),this.currentSpeed=speed,silent||this.el.trigger("speedchange",[speed]))},clickMenuHandler:function(){return this.closeMenu(),!1},clickLinkHandler:function(event){var speed=$(event.currentTarget).parent().data("speed");return this.closeMenu(),this.state.videoCommands.execute("speed",speed),!1},mouseEnterHandler:function(){return this.openMenu(),!1},mouseLeaveHandler:function(){return this.speedLinks.list.is(":focus")||this.closeMenu(),!1},keyDownMenuHandler:function(event){var KEY=$.ui.keyCode,keyCode=event.keyCode;switch(keyCode){case KEY.ENTER:case KEY.SPACE:case KEY.UP:this.openMenu(!0),this.speedLinks.last().focus();break;case KEY.ESCAPE:this.closeMenu(!0)}return event.keyCode===KEY.TAB},keyDownLinkHandler:function(event){if(event.altKey)return!0;var KEY=$.ui.keyCode,self=this,parent=$(event.currentTarget).parent(),index=parent.index(),speed=parent.data("speed");switch(event.keyCode){case KEY.TAB:return setTimeout(function(){self.closeMenu(!0)},25),!0;case KEY.ESCAPE:return this.closeMenu(!0),this.speedButton.focus(),!1;case KEY.UP:return event.shiftKey?!0:(this.speedLinks.prev(index).focus(),!1);case KEY.DOWN:return event.shiftKey?!0:(this.speedLinks.next(index).focus(),!1);case KEY.ENTER:case KEY.SPACE:return this.closeMenu(!0),this.speedButton.focus(),this.setSpeed(this.state.speedToString(speed)),!1}return!0}},SpeedControl})}(RequireJS.requirejs,RequireJS.require,RequireJS.define),function(define){define("video/09_video_caption.js",["video/00_sjson.js","video/00_async_process.js"],function(Sjson,AsyncProcess){var VideoCaption=function(state){return this instanceof VideoCaption?(this.state=state,this.state.videoCaption=this,this.renderElements(),$.Deferred().resolve().promise()):new VideoCaption(state)};return VideoCaption.prototype={renderElements:function(){var state=this.state,languages=this.state.config.transcriptLanguages;this.loaded=!1,this.subtitlesEl=state.el.find("ol.subtitles"),this.container=state.el.find(".lang"),this.hideSubtitlesEl=state.el.find("a.hide-subtitles"),_.keys(languages).length?(this.renderLanguageMenu(languages),this.fetchCaption()||(this.hideCaptions(!0),this.hideSubtitlesEl.hide())):(this.hideCaptions(!0,!1),this.hideSubtitlesEl.hide())},bindHandlers:function(){var self=this,state=this.state,events=["mouseover","mouseout","mousedown","click","focus","blur","keydown"].join(" ");this.hideSubtitlesEl.on("click",this.toggle.bind(this)),this.subtitlesEl.on({mouseenter:this.onMouseEnter.bind(this),mouseleave:this.onMouseLeave.bind(this),mousemove:this.onMovement.bind(this),mousewheel:this.onMovement.bind(this),DOMMouseScroll:this.onMovement.bind(this)}).on(events,"li[data-index]",function(event){switch(event.type){case"mouseover":case"mouseout":self.captionMouseOverOut(event);break;case"mousedown":self.captionMouseDown(event);break;case"click":self.captionClick(event);break;case"focusin":self.captionFocus(event);break;case"focusout":self.captionBlur(event);break;case"keydown":self.captionKeyDown(event)}}),this.showLanguageMenu&&this.container.on({mouseenter:this.onContainerMouseEnter,mouseleave:this.onContainerMouseLeave}),state.el.on({"caption:fetch":this.fetchCaption.bind(this),"caption:resize":this.onResize.bind(this),"caption:update":function(event,time){self.updatePlayTime(time)},ended:this.pause.bind(this),fullscreen:this.onResize.bind(this),pause:this.pause.bind(this),play:this.play.bind(this)}),"html5"===state.videoType&&state.config.autohideHtml5&&this.subtitlesEl.on("scroll",state.videoControl.showControls)},onContainerMouseEnter:function(event){event.preventDefault(),$(event.currentTarget).addClass("is-opened")},onContainerMouseLeave:function(event){event.preventDefault(),$(event.currentTarget).removeClass("is-opened")},onMouseEnter:function(){this.frozen&&clearTimeout(this.frozen),this.frozen=setTimeout(this.onMouseLeave,this.state.config.captionsFreezeTime)},onMouseLeave:function(){this.frozen&&clearTimeout(this.frozen),this.frozen=null,this.playing&&this.scrollCaption()},onMovement:function(){this.onMouseEnter()},fetchCaption:function(){var data,youtubeId,self=this,state=this.state,language=state.getCurrentLanguage();if(this.loaded?this.hideCaptions(!1):this.hideCaptions(state.hide_captions,!1),this.fetchXHR&&this.fetchXHR.abort&&this.fetchXHR.abort(),"youtube"===state.videoType){if(youtubeId=state.youtubeId("1.0"),!youtubeId)return!1;data={videoId:youtubeId}}return state.el.removeClass("is-captions-rendered"),this.fetchXHR=$.ajaxWithPrefix({url:state.config.transcriptTranslationUrl+"/"+language,notifyOnError:!1,data:data,success:function(sjson){self.sjson=new Sjson(sjson);var start=self.sjson.getStartTimes(),captions=self.sjson.getCaptions();self.loaded?self.rendered&&(self.renderCaption(start,captions),self.updatePlayTime(state.videoPlayer.currentTime)):(state.isTouch?self.subtitlesEl.find("li").html(gettext("Caption will be displayed when you start playing the video.")):self.renderCaption(start,captions),self.bindHandlers()),self.loaded=!0},error:function(jqXHR,textStatus,errorThrown){console.log("[Video info]: ERROR while fetching captions."),console.log("[Video info]: STATUS:",textStatus+", MESSAGE:",""+errorThrown),_.keys(state.config.transcriptLanguages).length>1?self.fetchAvailableTranslations():(self.hideCaptions(!0,!1),self.hideSubtitlesEl.hide())}}),!0},fetchAvailableTranslations:function(){var self=this,state=this.state;return $.ajaxWithPrefix({url:state.config.transcriptAvailableTranslationsUrl,notifyOnError:!1,success:function(response){var currentLanguages=state.config.transcriptLanguages,newLanguages=_.pick(currentLanguages,response);state.config.transcriptLanguages=newLanguages,self.container.find(".langs-list").remove(),_.keys(newLanguages).length&&(self.fetchCaption(),self.renderLanguageMenu(newLanguages))},error:function(){self.hideCaptions(!0,!1),self.hideSubtitlesEl.hide()}})},onResize:function(){this.subtitlesEl.find(".spacing").first().height(this.topSpacingHeight()).end().find(".spacing").last().height(this.bottomSpacingHeight()),this.scrollCaption(),this.setSubtitlesHeight()},renderLanguageMenu:function(languages){var self=this,state=this.state,menu=$('<ol class="langs-list menu">'),currentLang=state.getCurrentLanguage();return _.keys(languages).length<2?!1:(this.showLanguageMenu=!0,$.each(languages,function(code,label){var li=$('<li data-lang-code="'+code+'" />'),link=$('<a href="javascript:void(0);">'+label+"</a>");currentLang===code&&li.addClass("is-active"),li.append(link),menu.append(li)}),this.container.append(menu),void menu.on("click","a",function(e){var el=$(e.currentTarget).parent(),state=self.state,langCode=el.data("lang-code");state.lang!==langCode&&(state.lang=langCode,state.storage.setItem("language",langCode),el.addClass("is-active").siblings("li").removeClass("is-active"),self.fetchCaption())}))},buildCaptions:function(container,start,captions){var process=function(text,index){var liEl=$("<li>",{"data-index":index,"data-start":start[index],tabindex:0}).html(text);return liEl[0]};return AsyncProcess.array(captions,process).done(function(list){container.append(list)})},renderCaption:function(start,captions){var self=this,onRender=function(){self.addPaddings(),self.autoScrolling=!0,self.currentCaptionIndex=-1,self.isMouseFocus=!1,self.rendered=!0,self.state.el.addClass("is-captions-rendered")};this.rendered=!1,this.subtitlesEl.empty(),this.setSubtitlesHeight(),this.buildCaptions(this.subtitlesEl,start,captions).done(onRender)},addPaddings:function(){this.subtitlesEl.prepend($('<li class="spacing">').height(this.topSpacingHeight()).attr("tabindex",-1)).append($('<li class="spacing">').height(this.bottomSpacingHeight()).attr("tabindex",-1))},captionMouseOverOut:function(event){var caption=$(event.target),captionIndex=parseInt(caption.attr("data-index"),10);captionIndex===this.currentCaptionIndex&&("mouseover"===event.type?caption.removeClass("focused"):caption.addClass("focused"))},captionMouseDown:function(event){var caption=$(event.target);this.isMouseFocus=!0,this.autoScrolling=!0,caption.removeClass("focused"),this.currentCaptionIndex=-1},captionClick:function(event){this.seekPlayer(event)},captionFocus:function(event){var caption=$(event.target),captionIndex=parseInt(caption.attr("data-index"),10);this.isMouseFocus?(this.autoScrolling=!0,caption.removeClass("focused"),this.currentCaptionIndex=-1):(this.currentCaptionIndex=captionIndex,caption.addClass("focused"),(1>=captionIndex||captionIndex>=this.sjson.getSize()-2)&&(this.autoScrolling=!1))},captionBlur:function(event){var caption=$(event.target),captionIndex=parseInt(caption.attr("data-index"),10);caption.removeClass("focused"),(0===captionIndex||captionIndex===this.sjson.getSize()-1)&&(this.autoScrolling=!0)},captionKeyDown:function(event){this.isMouseFocus=!1,13===event.which&&this.seekPlayer(event)},scrollCaption:function(){var el=this.subtitlesEl.find(".current:first");!this.frozen&&el.length&&this.autoScrolling&&this.subtitlesEl.scrollTo(el,{offset:-1*this.calculateOffset(el)})},play:function(){if(this.loaded){if(!this.rendered){var start=this.sjson.getStartTimes(),captions=this.sjson.getCaptions();this.renderCaption(start,captions)}this.playing=!0}},pause:function(){this.loaded&&(this.playing=!1)},updatePlayTime:function(time){var newIndex,state=this.state;this.loaded&&(state.isFlashMode()&&(time=Time.convert(time,state.speed,"1.0")),time=Math.round(1e3*time+100),newIndex=this.sjson.search(time),"undefined"!=typeof newIndex&&-1!==newIndex&&this.currentIndex!==newIndex&&("undefined"!=typeof this.currentIndex&&this.subtitlesEl.find("li.current").removeClass("current"),this.subtitlesEl.find("li[data-index='"+newIndex+"']").addClass("current"),this.currentIndex=newIndex,this.scrollCaption()))},seekPlayer:function(event){var state=this.state,time=parseInt($(event.target).data("start"),10);state.isFlashMode()&&(time=Math.round(Time.convert(time,"1.0",state.speed))),state.trigger("videoPlayer.onCaptionSeek",{type:"onCaptionSeek",time:time/1e3}),event.preventDefault()},calculateOffset:function(element){return this.captionHeight()/2-element.height()/2},topSpacingHeight:function(){return this.calculateOffset(this.subtitlesEl.find("li:not(.spacing)").first())},bottomSpacingHeight:function(){return this.calculateOffset(this.subtitlesEl.find("li:not(.spacing)").last())},toggle:function(event){event.preventDefault(),this.hideCaptions(this.state.el.hasClass("closed")?!1:!0)},hideCaptions:function(hide_captions,update_cookie){var type,text,hideSubtitlesEl=this.hideSubtitlesEl,state=this.state;"undefined"==typeof update_cookie&&(update_cookie=!0),hide_captions?(type="hide_transcript",state.captionsHidden=!0,state.el.addClass("closed"),text=gettext("Turn on captions")):(type="show_transcript",state.captionsHidden=!1,state.el.removeClass("closed"),this.scrollCaption(),text=gettext("Turn off captions")),hideSubtitlesEl.attr("title",text).text(gettext(text)),state.videoPlayer&&state.videoPlayer.log(type,{currentTime:state.videoPlayer.currentTime}),state.resizer&&(state.isFullScreen?state.resizer.setMode("both"):state.resizer.alignByWidthOnly()),this.setSubtitlesHeight(),update_cookie&&$.cookie("hide_captions",hide_captions,{expires:3650,path:"/"})},captionHeight:function(){var state=this.state;return state.isFullScreen?state.container.height()-state.videoControl.height:state.container.height()},setSubtitlesHeight:function(){var height=0,state=this.state;(void 0===state.captionsHidden&&state.hide_captions||state.captionsHidden===!0)&&(height=state.videoControl.el.height()+.5*state.videoControl.sliderEl.height()),this.subtitlesEl.css({maxHeight:this.captionHeight()-height})}},VideoCaption})}(RequireJS.define),function(define){"use strict";define("video/095_video_context_menu.js",["video/00_component.js"],function(Component){var AbstractItem,AbstractMenu,Menu,Overlay,Submenu,MenuItem;return AbstractItem=Component.extend({initialize:function(options){this.options=$.extend(!0,{label:"",prefix:"edx-",dataAttrs:{menu:this},attrs:{},items:[],callback:$.noop,initialize:$.noop},options),this.id=_.uniqueId(),this.element=this.createElement(),this.element.attr(this.options.attrs).data(this.options.dataAttrs),this.children=[],this.delegateEvents(),this.options.initialize.call(this,this)},destroy:function(){_.invoke(this.getChildren(),"destroy"),this.undelegateEvents(),this.getElement().remove()},open:function(){return this.getElement().addClass("is-opened"),this},close:function(){},closeSiblings:function(){return _.invoke(this.getSiblings(),"close"),this},getElement:function(){return this.element},addChild:function(child){var firstChild=null,lastChild=null;return this.hasChildren()&&(lastChild=this.getLastChild(),lastChild.next=child,firstChild=this.getFirstChild(),firstChild.prev=child),child.parent=this,child.next=firstChild,child.prev=lastChild,this.children.push(child),this},getChildren:function(){return this.children.concat()},hasChildren:function(){return this.getChildren().length>0},getFirstChild:function(){return _.first(this.children)},getLastChild:function(){return _.last(this.children)},bindEvent:function(element,events,handler){return $(element).on(this.addNamespace(events),handler),this},getNext:function(){for(var item=this.next;item.isHidden()&&this.id!==item.id;)item=item.next;return item},getPrev:function(){for(var item=this.prev;item.isHidden()&&this.id!==item.id;)item=item.prev;return item},createElement:function(){return null},getRoot:function(){for(var item=this;item.parent;)item=item.parent;return item},populateElement:function(){},focus:function(){return this.getElement().focus(),this.closeSiblings(),this},isHidden:function(){return this.getElement().is(":hidden")},getSiblings:function(){for(var items=[],item=this;item.next&&item.next.id!==this.id;)item=item.next,items.push(item);return items},select:function(){},unselect:function(){},setLabel:function(){},itemHandler:function(){},keyDownHandler:function(){},delegateEvents:function(){},undelegateEvents:function(){this.getElement().off("."+this.id)},addNamespace:function(events){return _.map(events.split(/\s+/),function(event){return event+"."+this.id},this).join(" ")}}),AbstractMenu=AbstractItem.extend({delegateEvents:function(){return this.bindEvent(this.getElement(),"keydown mouseleave mouseover",this.itemHandler.bind(this)).bindEvent(this.getElement(),"contextmenu",function(event){event.preventDefault()}),this},populateElement:function(){var fragment=document.createDocumentFragment();return _.each(this.getChildren(),function(child){fragment.appendChild(child.populateElement()[0])},this),this.appendContent([fragment]),this.isRendered=!0,this.getElement()},close:function(){return this.closeChildren(),this.getElement().removeClass("is-opened"),this},closeChildren:function(){return _.invoke(this.getChildren(),"close"),this},itemHandler:function(event){event.preventDefault();var item=$(event.target).data("menu");switch(event.type){case"keydown":this.keyDownHandler.call(this,event,item);break;case"mouseover":this.mouseOverHandler.call(this,event,item);break;case"mouseleave":this.mouseLeaveHandler.call(this,event,item)}},keyDownHandler:function(){},mouseOverHandler:function(){},mouseLeaveHandler:function(){}}),Menu=AbstractMenu.extend({initialize:function(options,contextmenuElement,container){this.contextmenuElement=$(contextmenuElement),this.container=$(container),this.overlay=this.getOverlay(),AbstractMenu.prototype.initialize.apply(this,arguments),this.build(this,this.options.items)},createElement:function(){return $("<ol />",{"class":["contextmenu",this.options.prefix+"contextmenu"].join(" "),role:"menu",tabindex:-1})},delegateEvents:function(){return AbstractMenu.prototype.delegateEvents.call(this),this.bindEvent(this.contextmenuElement,"contextmenu",this.contextmenuHandler.bind(this)).bindEvent(window,"resize",_.debounce(this.close.bind(this),100)),this
},destroy:function(){return AbstractMenu.prototype.destroy.call(this),this.overlay.destroy(),this.contextmenuElement.removeData("contextmenu"),this},undelegateEvents:function(){return AbstractMenu.prototype.undelegateEvents.call(this),this.contextmenuElement.off(this.addNamespace("contextmenu")),this.overlay.undelegateEvents(),this},appendContent:function(content){return this.getElement().append(content),this},addChild:function(){return AbstractMenu.prototype.addChild.apply(this,arguments),this.next=this.getFirstChild(),this.prev=this.getLastChild(),this},build:function(container,items){return _.each(items,function(item){var child;child=_.has(item,"items")?this.build(new Submenu(item,this.contextmenuElement),item.items):new MenuItem(item),container.addChild(child)},this),container},focus:function(){return this.getElement().focus(),this},open:function(){var menu=this.isRendered?this.getElement():this.populateElement();return this.container.append(menu),AbstractItem.prototype.open.call(this),this.overlay.show(this.container),this},close:function(){return AbstractMenu.prototype.close.call(this),this.getElement().detach(),this.overlay.hide(),this},position:function(event){return this.getElement().position({my:"left top",of:event,collision:"flipfit flipfit",within:this.contextmenuElement}),this},pointInContainerBox:function(x,y){var containerOffset=this.contextmenuElement.offset(),containerBox={x0:containerOffset.left,y0:containerOffset.top,x1:containerOffset.left+this.contextmenuElement.outerWidth(),y1:containerOffset.top+this.contextmenuElement.outerHeight()};return containerBox.x0<=x&&x<=containerBox.x1&&containerBox.y0<=y&&y<=containerBox.y1},getOverlay:function(){return new Overlay(this.close.bind(this),function(event){event.preventDefault(),this.pointInContainerBox(event.pageX,event.pageY)?(this.position(event).focus(),this.closeChildren()):this.close()}.bind(this))},contextmenuHandler:function(event){event.preventDefault(),event.stopPropagation(),this.open().position(event).focus()},keyDownHandler:function(event,item){var KEY=$.ui.keyCode,keyCode=event.keyCode;switch(keyCode){case KEY.UP:item.getPrev().focus(),event.stopPropagation();break;case KEY.DOWN:item.getNext().focus(),event.stopPropagation();break;case KEY.TAB:event.stopPropagation();break;case KEY.ESCAPE:this.close()}return!1}}),Overlay=Component.extend({ns:".overlay",initialize:function(clickHandler,contextmenuHandler){this.element=$("<div />",{"class":"overlay"}),this.clickHandler=clickHandler,this.contextmenuHandler=contextmenuHandler},destroy:function(){this.getElement().remove(),this.undelegateEvents()},getElement:function(){return this.element},hide:function(){return this.getElement().detach(),this.undelegateEvents(),this},show:function(container){return $(container).append(this.getElement()),this.delegateEvents(),this},delegateEvents:function(){var self=this;return $(document).on("click"+this.ns,function(){_.isFunction(self.clickHandler)&&self.clickHandler.apply(this,arguments),self.hide()}).on("contextmenu"+this.ns,function(){_.isFunction(self.contextmenuHandler)&&self.contextmenuHandler.apply(this,arguments)}),this},undelegateEvents:function(){return $(document).off(this.ns),this}}),Submenu=AbstractMenu.extend({initialize:function(options,contextmenuElement){this.contextmenuElement=contextmenuElement,AbstractMenu.prototype.initialize.apply(this,arguments)},createElement:function(){var element=$("<li />",{"class":["submenu-item","menu-item",this.options.prefix+"submenu-item"].join(" "),"aria-expanded":"false","aria-haspopup":"true","aria-labelledby":"submenu-item-label-"+this.id,role:"menuitem",tabindex:-1});return this.label=$("<span />",{id:"submenu-item-label-"+this.id,text:this.options.label}).appendTo(element),this.list=$("<ol />",{"class":["submenu",this.options.prefix+"submenu"].join(" "),role:"menu"}).appendTo(element),element},appendContent:function(content){return this.list.append(content),this},setLabel:function(label){return this.label.text(label),this},openKeyboard:function(){return this.hasChildren()&&(this.open(),this.getFirstChild().focus()),this},keyDownHandler:function(event){var KEY=$.ui.keyCode,keyCode=event.keyCode;switch(keyCode){case KEY.LEFT:this.close().focus(),event.stopPropagation();break;case KEY.RIGHT:case KEY.ENTER:case KEY.SPACE:this.openKeyboard(),event.stopPropagation()}return!1},open:function(){return AbstractMenu.prototype.open.call(this),this.getElement().attr({"aria-expanded":"true"}),this.position(),this},close:function(){return AbstractMenu.prototype.close.call(this),this.getElement().attr({"aria-expanded":"false"}),this},position:function(){return this.list.position({my:"left top",at:"right top",of:this.getElement(),collision:"flipfit flipfit",within:this.contextmenuElement}),this},mouseOverHandler:function(){clearTimeout(this.timer),this.timer=setTimeout(this.open.bind(this),200),this.focus()},mouseLeaveHandler:function(){clearTimeout(this.timer),this.timer=setTimeout(this.close.bind(this),200),this.focus()}}),MenuItem=AbstractItem.extend({createElement:function(){var classNames=["menu-item",this.options.prefix+"menu-item",this.options.isSelected?"is-selected":""].join(" ");return $("<li />",{"class":classNames,"aria-selected":this.options.isSelected?"true":"false",role:"menuitem",tabindex:-1,text:this.options.label})},populateElement:function(){return this.getElement()},delegateEvents:function(){return this.bindEvent(this.getElement(),"click keydown contextmenu mouseover",this.itemHandler.bind(this)),this},setLabel:function(label){return this.getElement().text(label),this},select:function(event){return this.options.callback.call(this,event,this,this.options),this.getElement().addClass("is-selected").attr({"aria-selected":"true"}),_.invoke(this.getSiblings(),"unselect"),this.getRoot().close(),this},unselect:function(){return this.getElement().removeClass("is-selected").attr({"aria-selected":"false"}),this},itemHandler:function(event){switch(event.preventDefault(),event.type){case"contextmenu":case"click":this.select();break;case"mouseover":this.focus(),event.stopPropagation();break;case"keydown":this.keyDownHandler.call(this,event,this)}},keyDownHandler:function(event){var KEY=$.ui.keyCode,keyCode=event.keyCode;switch(keyCode){case KEY.RIGHT:event.stopPropagation();break;case KEY.ENTER:case KEY.SPACE:this.select(),event.stopPropagation()}return!1}}),function(state,i18n){var speedCallback=function(event,menuitem,options){var speed=parseFloat(options.label);state.videoCommands.execute("speed",speed)},options={items:[{label:i18n.Play,callback:function(){state.videoCommands.execute("togglePlayback")},initialize:function(menuitem){state.el.on({play:function(){menuitem.setLabel(i18n.Pause)},pause:function(){menuitem.setLabel(i18n.Play)}})}},{label:state.videoVolumeControl.getMuteStatus()?i18n.Unmute:i18n.Mute,callback:function(){state.videoCommands.execute("toggleMute")},initialize:function(menuitem){state.el.on({volumechange:function(){menuitem.setLabel(state.videoVolumeControl.getMuteStatus()?i18n.Unmute:i18n.Mute)}})}},{label:i18n["Fill browser"],callback:function(){state.videoCommands.execute("toggleFullScreen")},initialize:function(menuitem){state.el.on({fullscreen:function(event,isFullscreen){menuitem.setLabel(isFullscreen?i18n["Exit full browser"]:i18n["Fill browser"])}})}},{label:i18n.Speed,items:_.map(state.speeds,function(speed){var isSelected=speed===state.speed;return{label:speed+"x",callback:speedCallback,speed:speed,isSelected:isSelected}}),initialize:function(menuitem){state.el.on({speedchange:function(event,speed){var item=menuitem.getChildren().filter(function(item){return item.options.speed===speed})[0];item&&item.select()}})}}]};return $.fn.contextmenu=function(container,options){return this.each(function(){$(this).data("contextmenu",new Menu(options,this,container))})},state.isYoutubeType()||state.el.find("video").contextmenu(state.el,options),$.Deferred().resolve().promise()}})}(RequireJS.define),function(define){"use strict";define("video/10_commands.js",[],function(){var VideoCommands,Command,playCommand,pauseCommand,togglePlaybackCommand,toggleMuteCommand,toggleFullScreenCommand,setSpeedCommand;return VideoCommands=function(state,i18n){return this instanceof VideoCommands?(this.state=state,this.state.videoCommands=this,this.i18n=i18n,this.commands=[],this.initialize(),$.Deferred().resolve().promise()):new VideoCommands(state,i18n)},VideoCommands.prototype={initialize:function(){this.commands=this.getCommands()},execute:function(command){var args=[].slice.call(arguments,1)||[];_.has(this.commands,command)?this.commands[command].execute.apply(this,[this.state].concat(args)):console.log('Command "'+command+'" is not available.')},getCommands:function(){var commands={},commandsList=[playCommand,pauseCommand,togglePlaybackCommand,toggleMuteCommand,toggleFullScreenCommand,setSpeedCommand];return _.each(commandsList,function(command){commands[command.name]=command},this),commands}},Command=function(name,execute){this.name=name,this.execute=execute},playCommand=new Command("play",function(state){state.videoPlayer.play()}),pauseCommand=new Command("pause",function(state){state.videoPlayer.pause()}),togglePlaybackCommand=new Command("togglePlayback",function(state){state.videoControl.isPlaying?pauseCommand.execute(state):playCommand.execute(state)}),toggleMuteCommand=new Command("toggleMute",function(state){state.videoVolumeControl.toggleMute()}),toggleFullScreenCommand=new Command("toggleFullScreen",function(state){state.videoControl.toggleFullScreen()}),setSpeedCommand=new Command("speed",function(state,speed){state.videoSpeedControl.setSpeed(state.speedToString(speed))}),VideoCommands})}(RequireJS.define),function(require,$){"use strict";window.Video=function(){var tempCallStack=[];return function(element,processTempCallStack){return processTempCallStack?void $.each(tempCallStack,function(index,element){window.Video(element)}):(tempCallStack.push(element),{})}}(),require(["video/01_initialize.js","video/025_focus_grabber.js","video/035_video_accessible_menu.js","video/04_video_control.js","video/05_video_quality_control.js","video/06_video_progress_slider.js","video/07_video_volume_control.js","video/08_video_speed_control.js","video/09_video_caption.js","video/10_commands.js","video/095_video_context_menu.js"],function(initialize,FocusGrabber,VideoAccessibleMenu,VideoControl,VideoQualityControl,VideoProgressSlider,VideoVolumeControl,VideoSpeedControl,VideoCaption,VideoCommands,VideoContextMenu){var youtubeXhr=null,oldVideo=window.Video;window.Video=function(element){var state,previousState=window.Video.previousState;return previousState&&previousState.videoPlayer&&(previousState.saveState(!0),$(window).off("unload",previousState.saveState)),state={},window.Video.previousState=state,state.modules=[FocusGrabber,VideoAccessibleMenu,VideoControl,VideoQualityControl,VideoProgressSlider,VideoVolumeControl,VideoSpeedControl,VideoCaption,VideoCommands,VideoContextMenu],state.youtubeXhr=youtubeXhr,initialize(state,element),youtubeXhr||(youtubeXhr=state.youtubeXhr),$(element).find(".video").data("video-player-state",state),state},window.Video.clearYoutubeXhr=function(){youtubeXhr=null},oldVideo(null,!0)})}(window.RequireJS.require,window.jQuery);